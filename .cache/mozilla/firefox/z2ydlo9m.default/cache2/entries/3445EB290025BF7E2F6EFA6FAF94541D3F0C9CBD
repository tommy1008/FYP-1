/*
Copyright 2012 Igor Vaynberg

Version: 3.5.2 Timestamp: Sat Nov  1 14:43:36 EDT 2014

This software is licensed under the Apache License, Version 2.0 (the "Apache License") or the GNU
General Public License version 2 (the "GPL License"). You may choose either license to govern your
use of this software only upon the condition that you accept all of the terms of either the Apache
License or the GPL License.

You may obtain a copy of the Apache License and the GPL License at:

    http://www.apache.org/licenses/LICENSE-2.0
    http://www.gnu.org/licenses/gpl-2.0.html

Unless required by applicable law or agreed to in writing, software distributed under the
Apache License or the GPL License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
CONDITIONS OF ANY KIND, either express or implied. See the Apache License and the GPL License for
the specific language governing permissions and limitations under the Apache License and the GPL License.
*/
(function ($) {
    if(typeof $.fn.each2 == "undefined") {
        $.extend($.fn, {
            /*
            * 4-10 times faster .each replacement
            * use it carefully, as it overrides jQuery context of element on each iteration
            */
            each2 : function (c) {
                var j = $([0]), i = -1, l = this.length;
                while (
                    ++i < l
                    && (j.context = j[0] = this[i])
                    && c.call(j[0], i, j) !== false //"this"=DOM, i=index, j=jQuery object
                );
                return this;
            }
        });
    }
})(jQuery);

(function ($, undefined) {
    "use strict";
    /*global document, window, jQuery, console */

    if (window.Select2 !== undefined) {
        return;
    }

    var AbstractSelect2, SingleSelect2, MultiSelect2, nextUid, sizer,
        lastMousePosition={x:0,y:0}, $document, scrollBarDimensions,

    KEY = {
        TAB: 9,
        ENTER: 13,
        ESC: 27,
        SPACE: 32,
        LEFT: 37,
        UP: 38,
        RIGHT: 39,
        DOWN: 40,
        SHIFT: 16,
        CTRL: 17,
        ALT: 18,
        PAGE_UP: 33,
        PAGE_DOWN: 34,
        HOME: 36,
        END: 35,
        BACKSPACE: 8,
        DELETE: 46,
        isArrow: function (k) {
            k = k.which ? k.which : k;
            switch (k) {
            case KEY.LEFT:
            case KEY.RIGHT:
            case KEY.UP:
            case KEY.DOWN:
                return true;
            }
            return false;
        },
        isControl: function (e) {
            var k = e.which;
            switch (k) {
            case KEY.SHIFT:
            case KEY.CTRL:
            case KEY.ALT:
                return true;
            }

            if (e.metaKey) return true;

            return false;
        },
        isFunctionKey: function (k) {
            k = k.which ? k.which : k;
            return k >= 112 && k <= 123;
        }
    },
    MEASURE_SCROLLBAR_TEMPLATE = "<div class='select2-measure-scrollbar'></div>",

    DIACRITICS = {"\u24B6":"A","\uFF21":"A","\u00C0":"A","\u00C1":"A","\u00C2":"A","\u1EA6":"A","\u1EA4":"A","\u1EAA":"A","\u1EA8":"A","\u00C3":"A","\u0100":"A","\u0102":"A","\u1EB0":"A","\u1EAE":"A","\u1EB4":"A","\u1EB2":"A","\u0226":"A","\u01E0":"A","\u00C4":"A","\u01DE":"A","\u1EA2":"A","\u00C5":"A","\u01FA":"A","\u01CD":"A","\u0200":"A","\u0202":"A","\u1EA0":"A","\u1EAC":"A","\u1EB6":"A","\u1E00":"A","\u0104":"A","\u023A":"A","\u2C6F":"A","\uA732":"AA","\u00C6":"AE","\u01FC":"AE","\u01E2":"AE","\uA734":"AO","\uA736":"AU","\uA738":"AV","\uA73A":"AV","\uA73C":"AY","\u24B7":"B","\uFF22":"B","\u1E02":"B","\u1E04":"B","\u1E06":"B","\u0243":"B","\u0182":"B","\u0181":"B","\u24B8":"C","\uFF23":"C","\u0106":"C","\u0108":"C","\u010A":"C","\u010C":"C","\u00C7":"C","\u1E08":"C","\u0187":"C","\u023B":"C","\uA73E":"C","\u24B9":"D","\uFF24":"D","\u1E0A":"D","\u010E":"D","\u1E0C":"D","\u1E10":"D","\u1E12":"D","\u1E0E":"D","\u0110":"D","\u018B":"D","\u018A":"D","\u0189":"D","\uA779":"D","\u01F1":"DZ","\u01C4":"DZ","\u01F2":"Dz","\u01C5":"Dz","\u24BA":"E","\uFF25":"E","\u00C8":"E","\u00C9":"E","\u00CA":"E","\u1EC0":"E","\u1EBE":"E","\u1EC4":"E","\u1EC2":"E","\u1EBC":"E","\u0112":"E","\u1E14":"E","\u1E16":"E","\u0114":"E","\u0116":"E","\u00CB":"E","\u1EBA":"E","\u011A":"E","\u0204":"E","\u0206":"E","\u1EB8":"E","\u1EC6":"E","\u0228":"E","\u1E1C":"E","\u0118":"E","\u1E18":"E","\u1E1A":"E","\u0190":"E","\u018E":"E","\u24BB":"F","\uFF26":"F","\u1E1E":"F","\u0191":"F","\uA77B":"F","\u24BC":"G","\uFF27":"G","\u01F4":"G","\u011C":"G","\u1E20":"G","\u011E":"G","\u0120":"G","\u01E6":"G","\u0122":"G","\u01E4":"G","\u0193":"G","\uA7A0":"G","\uA77D":"G","\uA77E":"G","\u24BD":"H","\uFF28":"H","\u0124":"H","\u1E22":"H","\u1E26":"H","\u021E":"H","\u1E24":"H","\u1E28":"H","\u1E2A":"H","\u0126":"H","\u2C67":"H","\u2C75":"H","\uA78D":"H","\u24BE":"I","\uFF29":"I","\u00CC":"I","\u00CD":"I","\u00CE":"I","\u0128":"I","\u012A":"I","\u012C":"I","\u0130":"I","\u00CF":"I","\u1E2E":"I","\u1EC8":"I","\u01CF":"I","\u0208":"I","\u020A":"I","\u1ECA":"I","\u012E":"I","\u1E2C":"I","\u0197":"I","\u24BF":"J","\uFF2A":"J","\u0134":"J","\u0248":"J","\u24C0":"K","\uFF2B":"K","\u1E30":"K","\u01E8":"K","\u1E32":"K","\u0136":"K","\u1E34":"K","\u0198":"K","\u2C69":"K","\uA740":"K","\uA742":"K","\uA744":"K","\uA7A2":"K","\u24C1":"L","\uFF2C":"L","\u013F":"L","\u0139":"L","\u013D":"L","\u1E36":"L","\u1E38":"L","\u013B":"L","\u1E3C":"L","\u1E3A":"L","\u0141":"L","\u023D":"L","\u2C62":"L","\u2C60":"L","\uA748":"L","\uA746":"L","\uA780":"L","\u01C7":"LJ","\u01C8":"Lj","\u24C2":"M","\uFF2D":"M","\u1E3E":"M","\u1E40":"M","\u1E42":"M","\u2C6E":"M","\u019C":"M","\u24C3":"N","\uFF2E":"N","\u01F8":"N","\u0143":"N","\u00D1":"N","\u1E44":"N","\u0147":"N","\u1E46":"N","\u0145":"N","\u1E4A":"N","\u1E48":"N","\u0220":"N","\u019D":"N","\uA790":"N","\uA7A4":"N","\u01CA":"NJ","\u01CB":"Nj","\u24C4":"O","\uFF2F":"O","\u00D2":"O","\u00D3":"O","\u00D4":"O","\u1ED2":"O","\u1ED0":"O","\u1ED6":"O","\u1ED4":"O","\u00D5":"O","\u1E4C":"O","\u022C":"O","\u1E4E":"O","\u014C":"O","\u1E50":"O","\u1E52":"O","\u014E":"O","\u022E":"O","\u0230":"O","\u00D6":"O","\u022A":"O","\u1ECE":"O","\u0150":"O","\u01D1":"O","\u020C":"O","\u020E":"O","\u01A0":"O","\u1EDC":"O","\u1EDA":"O","\u1EE0":"O","\u1EDE":"O","\u1EE2":"O","\u1ECC":"O","\u1ED8":"O","\u01EA":"O","\u01EC":"O","\u00D8":"O","\u01FE":"O","\u0186":"O","\u019F":"O","\uA74A":"O","\uA74C":"O","\u01A2":"OI","\uA74E":"OO","\u0222":"OU","\u24C5":"P","\uFF30":"P","\u1E54":"P","\u1E56":"P","\u01A4":"P","\u2C63":"P","\uA750":"P","\uA752":"P","\uA754":"P","\u24C6":"Q","\uFF31":"Q","\uA756":"Q","\uA758":"Q","\u024A":"Q","\u24C7":"R","\uFF32":"R","\u0154":"R","\u1E58":"R","\u0158":"R","\u0210":"R","\u0212":"R","\u1E5A":"R","\u1E5C":"R","\u0156":"R","\u1E5E":"R","\u024C":"R","\u2C64":"R","\uA75A":"R","\uA7A6":"R","\uA782":"R","\u24C8":"S","\uFF33":"S","\u1E9E":"S","\u015A":"S","\u1E64":"S","\u015C":"S","\u1E60":"S","\u0160":"S","\u1E66":"S","\u1E62":"S","\u1E68":"S","\u0218":"S","\u015E":"S","\u2C7E":"S","\uA7A8":"S","\uA784":"S","\u24C9":"T","\uFF34":"T","\u1E6A":"T","\u0164":"T","\u1E6C":"T","\u021A":"T","\u0162":"T","\u1E70":"T","\u1E6E":"T","\u0166":"T","\u01AC":"T","\u01AE":"T","\u023E":"T","\uA786":"T","\uA728":"TZ","\u24CA":"U","\uFF35":"U","\u00D9":"U","\u00DA":"U","\u00DB":"U","\u0168":"U","\u1E78":"U","\u016A":"U","\u1E7A":"U","\u016C":"U","\u00DC":"U","\u01DB":"U","\u01D7":"U","\u01D5":"U","\u01D9":"U","\u1EE6":"U","\u016E":"U","\u0170":"U","\u01D3":"U","\u0214":"U","\u0216":"U","\u01AF":"U","\u1EEA":"U","\u1EE8":"U","\u1EEE":"U","\u1EEC":"U","\u1EF0":"U","\u1EE4":"U","\u1E72":"U","\u0172":"U","\u1E76":"U","\u1E74":"U","\u0244":"U","\u24CB":"V","\uFF36":"V","\u1E7C":"V","\u1E7E":"V","\u01B2":"V","\uA75E":"V","\u0245":"V","\uA760":"VY","\u24CC":"W","\uFF37":"W","\u1E80":"W","\u1E82":"W","\u0174":"W","\u1E86":"W","\u1E84":"W","\u1E88":"W","\u2C72":"W","\u24CD":"X","\uFF38":"X","\u1E8A":"X","\u1E8C":"X","\u24CE":"Y","\uFF39":"Y","\u1EF2":"Y","\u00DD":"Y","\u0176":"Y","\u1EF8":"Y","\u0232":"Y","\u1E8E":"Y","\u0178":"Y","\u1EF6":"Y","\u1EF4":"Y","\u01B3":"Y","\u024E":"Y","\u1EFE":"Y","\u24CF":"Z","\uFF3A":"Z","\u0179":"Z","\u1E90":"Z","\u017B":"Z","\u017D":"Z","\u1E92":"Z","\u1E94":"Z","\u01B5":"Z","\u0224":"Z","\u2C7F":"Z","\u2C6B":"Z","\uA762":"Z","\u24D0":"a","\uFF41":"a","\u1E9A":"a","\u00E0":"a","\u00E1":"a","\u00E2":"a","\u1EA7":"a","\u1EA5":"a","\u1EAB":"a","\u1EA9":"a","\u00E3":"a","\u0101":"a","\u0103":"a","\u1EB1":"a","\u1EAF":"a","\u1EB5":"a","\u1EB3":"a","\u0227":"a","\u01E1":"a","\u00E4":"a","\u01DF":"a","\u1EA3":"a","\u00E5":"a","\u01FB":"a","\u01CE":"a","\u0201":"a","\u0203":"a","\u1EA1":"a","\u1EAD":"a","\u1EB7":"a","\u1E01":"a","\u0105":"a","\u2C65":"a","\u0250":"a","\uA733":"aa","\u00E6":"ae","\u01FD":"ae","\u01E3":"ae","\uA735":"ao","\uA737":"au","\uA739":"av","\uA73B":"av","\uA73D":"ay","\u24D1":"b","\uFF42":"b","\u1E03":"b","\u1E05":"b","\u1E07":"b","\u0180":"b","\u0183":"b","\u0253":"b","\u24D2":"c","\uFF43":"c","\u0107":"c","\u0109":"c","\u010B":"c","\u010D":"c","\u00E7":"c","\u1E09":"c","\u0188":"c","\u023C":"c","\uA73F":"c","\u2184":"c","\u24D3":"d","\uFF44":"d","\u1E0B":"d","\u010F":"d","\u1E0D":"d","\u1E11":"d","\u1E13":"d","\u1E0F":"d","\u0111":"d","\u018C":"d","\u0256":"d","\u0257":"d","\uA77A":"d","\u01F3":"dz","\u01C6":"dz","\u24D4":"e","\uFF45":"e","\u00E8":"e","\u00E9":"e","\u00EA":"e","\u1EC1":"e","\u1EBF":"e","\u1EC5":"e","\u1EC3":"e","\u1EBD":"e","\u0113":"e","\u1E15":"e","\u1E17":"e","\u0115":"e","\u0117":"e","\u00EB":"e","\u1EBB":"e","\u011B":"e","\u0205":"e","\u0207":"e","\u1EB9":"e","\u1EC7":"e","\u0229":"e","\u1E1D":"e","\u0119":"e","\u1E19":"e","\u1E1B":"e","\u0247":"e","\u025B":"e","\u01DD":"e","\u24D5":"f","\uFF46":"f","\u1E1F":"f","\u0192":"f","\uA77C":"f","\u24D6":"g","\uFF47":"g","\u01F5":"g","\u011D":"g","\u1E21":"g","\u011F":"g","\u0121":"g","\u01E7":"g","\u0123":"g","\u01E5":"g","\u0260":"g","\uA7A1":"g","\u1D79":"g","\uA77F":"g","\u24D7":"h","\uFF48":"h","\u0125":"h","\u1E23":"h","\u1E27":"h","\u021F":"h","\u1E25":"h","\u1E29":"h","\u1E2B":"h","\u1E96":"h","\u0127":"h","\u2C68":"h","\u2C76":"h","\u0265":"h","\u0195":"hv","\u24D8":"i","\uFF49":"i","\u00EC":"i","\u00ED":"i","\u00EE":"i","\u0129":"i","\u012B":"i","\u012D":"i","\u00EF":"i","\u1E2F":"i","\u1EC9":"i","\u01D0":"i","\u0209":"i","\u020B":"i","\u1ECB":"i","\u012F":"i","\u1E2D":"i","\u0268":"i","\u0131":"i","\u24D9":"j","\uFF4A":"j","\u0135":"j","\u01F0":"j","\u0249":"j","\u24DA":"k","\uFF4B":"k","\u1E31":"k","\u01E9":"k","\u1E33":"k","\u0137":"k","\u1E35":"k","\u0199":"k","\u2C6A":"k","\uA741":"k","\uA743":"k","\uA745":"k","\uA7A3":"k","\u24DB":"l","\uFF4C":"l","\u0140":"l","\u013A":"l","\u013E":"l","\u1E37":"l","\u1E39":"l","\u013C":"l","\u1E3D":"l","\u1E3B":"l","\u017F":"l","\u0142":"l","\u019A":"l","\u026B":"l","\u2C61":"l","\uA749":"l","\uA781":"l","\uA747":"l","\u01C9":"lj","\u24DC":"m","\uFF4D":"m","\u1E3F":"m","\u1E41":"m","\u1E43":"m","\u0271":"m","\u026F":"m","\u24DD":"n","\uFF4E":"n","\u01F9":"n","\u0144":"n","\u00F1":"n","\u1E45":"n","\u0148":"n","\u1E47":"n","\u0146":"n","\u1E4B":"n","\u1E49":"n","\u019E":"n","\u0272":"n","\u0149":"n","\uA791":"n","\uA7A5":"n","\u01CC":"nj","\u24DE":"o","\uFF4F":"o","\u00F2":"o","\u00F3":"o","\u00F4":"o","\u1ED3":"o","\u1ED1":"o","\u1ED7":"o","\u1ED5":"o","\u00F5":"o","\u1E4D":"o","\u022D":"o","\u1E4F":"o","\u014D":"o","\u1E51":"o","\u1E53":"o","\u014F":"o","\u022F":"o","\u0231":"o","\u00F6":"o","\u022B":"o","\u1ECF":"o","\u0151":"o","\u01D2":"o","\u020D":"o","\u020F":"o","\u01A1":"o","\u1EDD":"o","\u1EDB":"o","\u1EE1":"o","\u1EDF":"o","\u1EE3":"o","\u1ECD":"o","\u1ED9":"o","\u01EB":"o","\u01ED":"o","\u00F8":"o","\u01FF":"o","\u0254":"o","\uA74B":"o","\uA74D":"o","\u0275":"o","\u01A3":"oi","\u0223":"ou","\uA74F":"oo","\u24DF":"p","\uFF50":"p","\u1E55":"p","\u1E57":"p","\u01A5":"p","\u1D7D":"p","\uA751":"p","\uA753":"p","\uA755":"p","\u24E0":"q","\uFF51":"q","\u024B":"q","\uA757":"q","\uA759":"q","\u24E1":"r","\uFF52":"r","\u0155":"r","\u1E59":"r","\u0159":"r","\u0211":"r","\u0213":"r","\u1E5B":"r","\u1E5D":"r","\u0157":"r","\u1E5F":"r","\u024D":"r","\u027D":"r","\uA75B":"r","\uA7A7":"r","\uA783":"r","\u24E2":"s","\uFF53":"s","\u00DF":"s","\u015B":"s","\u1E65":"s","\u015D":"s","\u1E61":"s","\u0161":"s","\u1E67":"s","\u1E63":"s","\u1E69":"s","\u0219":"s","\u015F":"s","\u023F":"s","\uA7A9":"s","\uA785":"s","\u1E9B":"s","\u24E3":"t","\uFF54":"t","\u1E6B":"t","\u1E97":"t","\u0165":"t","\u1E6D":"t","\u021B":"t","\u0163":"t","\u1E71":"t","\u1E6F":"t","\u0167":"t","\u01AD":"t","\u0288":"t","\u2C66":"t","\uA787":"t","\uA729":"tz","\u24E4":"u","\uFF55":"u","\u00F9":"u","\u00FA":"u","\u00FB":"u","\u0169":"u","\u1E79":"u","\u016B":"u","\u1E7B":"u","\u016D":"u","\u00FC":"u","\u01DC":"u","\u01D8":"u","\u01D6":"u","\u01DA":"u","\u1EE7":"u","\u016F":"u","\u0171":"u","\u01D4":"u","\u0215":"u","\u0217":"u","\u01B0":"u","\u1EEB":"u","\u1EE9":"u","\u1EEF":"u","\u1EED":"u","\u1EF1":"u","\u1EE5":"u","\u1E73":"u","\u0173":"u","\u1E77":"u","\u1E75":"u","\u0289":"u","\u24E5":"v","\uFF56":"v","\u1E7D":"v","\u1E7F":"v","\u028B":"v","\uA75F":"v","\u028C":"v","\uA761":"vy","\u24E6":"w","\uFF57":"w","\u1E81":"w","\u1E83":"w","\u0175":"w","\u1E87":"w","\u1E85":"w","\u1E98":"w","\u1E89":"w","\u2C73":"w","\u24E7":"x","\uFF58":"x","\u1E8B":"x","\u1E8D":"x","\u24E8":"y","\uFF59":"y","\u1EF3":"y","\u00FD":"y","\u0177":"y","\u1EF9":"y","\u0233":"y","\u1E8F":"y","\u00FF":"y","\u1EF7":"y","\u1E99":"y","\u1EF5":"y","\u01B4":"y","\u024F":"y","\u1EFF":"y","\u24E9":"z","\uFF5A":"z","\u017A":"z","\u1E91":"z","\u017C":"z","\u017E":"z","\u1E93":"z","\u1E95":"z","\u01B6":"z","\u0225":"z","\u0240":"z","\u2C6C":"z","\uA763":"z","\u0386":"\u0391","\u0388":"\u0395","\u0389":"\u0397","\u038A":"\u0399","\u03AA":"\u0399","\u038C":"\u039F","\u038E":"\u03A5","\u03AB":"\u03A5","\u038F":"\u03A9","\u03AC":"\u03B1","\u03AD":"\u03B5","\u03AE":"\u03B7","\u03AF":"\u03B9","\u03CA":"\u03B9","\u0390":"\u03B9","\u03CC":"\u03BF","\u03CD":"\u03C5","\u03CB":"\u03C5","\u03B0":"\u03C5","\u03C9":"\u03C9","\u03C2":"\u03C3"};

    $document = $(document);

    nextUid=(function() { var counter=1; return function() { return counter++; }; }());


    function reinsertElement(element) {
        var placeholder = $(document.createTextNode(''));

        element.before(placeholder);
        placeholder.before(element);
        placeholder.remove();
    }

    function stripDiacritics(str) {
        // Used 'uni range + named function' from http://jsperf.com/diacritics/18
        function match(a) {
            return DIACRITICS[a] || a;
        }

        return str.replace(/[^\u0000-\u007E]/g, match);
    }

    function indexOf(value, array) {
        var i = 0, l = array.length;
        for (; i < l; i = i + 1) {
            if (equal(value, array[i])) return i;
        }
        return -1;
    }

    function measureScrollbar () {
        var $template = $( MEASURE_SCROLLBAR_TEMPLATE );
        $template.appendTo(document.body);

        var dim = {
            width: $template.width() - $template[0].clientWidth,
            height: $template.height() - $template[0].clientHeight
        };
        $template.remove();

        return dim;
    }

    /**
     * Compares equality of a and b
     * @param a
     * @param b
     */
    function equal(a, b) {
        if (a === b) return true;
        if (a === undefined || b === undefined) return false;
        if (a === null || b === null) return false;
        // Check whether 'a' or 'b' is a string (primitive or object).
        // The concatenation of an empty string (+'') converts its argument to a string's primitive.
        if (a.constructor === String) return a+'' === b+''; // a+'' - in case 'a' is a String object
        if (b.constructor === String) return b+'' === a+''; // b+'' - in case 'b' is a String object
        return false;
    }

    /**
     * Splits the string into an array of values, transforming each value. An empty array is returned for nulls or empty
     * strings
     * @param string
     * @param separator
     */
    function splitVal(string, separator, transform) {
        var val, i, l;
        if (string === null || string.length < 1) return [];
        val = string.split(separator);
        for (i = 0, l = val.length; i < l; i = i + 1) val[i] = transform(val[i]);
        return val;
    }

    function getSideBorderPadding(element) {
        return element.outerWidth(false) - element.width();
    }

    function installKeyUpChangeEvent(element) {
        var key="keyup-change-value";
        element.on("keydown", function () {
            if ($.data(element, key) === undefined) {
                $.data(element, key, element.val());
            }
        });
        element.on("keyup", function () {
            var val= $.data(element, key);
            if (val !== undefined && element.val() !== val) {
                $.removeData(element, key);
                element.trigger("keyup-change");
            }
        });
    }


    /**
     * filters mouse events so an event is fired only if the mouse moved.
     *
     * filters out mouse events that occur when mouse is stationary but
     * the elements under the pointer are scrolled.
     */
    function installFilteredMouseMove(element) {
        element.on("mousemove", function (e) {
            var lastpos = lastMousePosition;
            if (lastpos === undefined || lastpos.x !== e.pageX || lastpos.y !== e.pageY) {
                $(e.target).trigger("mousemove-filtered", e);
            }
        });
    }

    /**
     * Debounces a function. Returns a function that calls the original fn function only if no invocations have been made
     * within the last quietMillis milliseconds.
     *
     * @param quietMillis number of milliseconds to wait before invoking fn
     * @param fn function to be debounced
     * @param ctx object to be used as this reference within fn
     * @return debounced version of fn
     */
    function debounce(quietMillis, fn, ctx) {
        ctx = ctx || undefined;
        var timeout;
        return function () {
            var args = arguments;
            window.clearTimeout(timeout);
            timeout = window.setTimeout(function() {
                fn.apply(ctx, args);
            }, quietMillis);
        };
    }

    function installDebouncedScroll(threshold, element) {
        var notify = debounce(threshold, function (e) { element.trigger("scroll-debounced", e);});
        element.on("scroll", function (e) {
            if (indexOf(e.target, element.get()) >= 0) notify(e);
        });
    }

    function focus($el) {
        if ($el[0] === document.activeElement) return;

        /* set the focus in a 0 timeout - that way the focus is set after the processing
            of the current event has finished - which seems like the only reliable way
            to set focus */
        window.setTimeout(function() {
            var el=$el[0], pos=$el.val().length, range;

            $el.focus();

            /* make sure el received focus so we do not error out when trying to manipulate the caret.
                sometimes modals or others listeners may steal it after its set */
            var isVisible = (el.offsetWidth > 0 || el.offsetHeight > 0);
            if (isVisible && el === document.activeElement) {

                /* after the focus is set move the caret to the end, necessary when we val()
                    just before setting focus */
                if(el.setSelectionRange)
                {
                    el.setSelectionRange(pos, pos);
                }
                else if (el.createTextRange) {
                    range = el.createTextRange();
                    range.collapse(false);
                    range.select();
                }
            }
        }, 0);
    }

    function getCursorInfo(el) {
        el = $(el)[0];
        var offset = 0;
        var length = 0;
        if ('selectionStart' in el) {
            offset = el.selectionStart;
            length = el.selectionEnd - offset;
        } else if ('selection' in document) {
            el.focus();
            var sel = document.selection.createRange();
            length = document.selection.createRange().text.length;
            sel.moveStart('character', -el.value.length);
            offset = sel.text.length - length;
        }
        return { offset: offset, length: length };
    }

    function killEvent(event) {
        event.preventDefault();
        event.stopPropagation();
    }
    function killEventImmediately(event) {
        event.preventDefault();
        event.stopImmediatePropagation();
    }

    function measureTextWidth(e) {
        if (!sizer){
            var style = e[0].currentStyle || window.getComputedStyle(e[0], null);
            sizer = $(document.createElement("div")).css({
                position: "absolute",
                left: "-10000px",
                top: "-10000px",
                display: "none",
                fontSize: style.fontSize,
                fontFamily: style.fontFamily,
                fontStyle: style.fontStyle,
                fontWeight: style.fontWeight,
                letterSpacing: style.letterSpacing,
                textTransform: style.textTransform,
                whiteSpace: "nowrap"
            });
            sizer.attr("class","select2-sizer");
            $(document.body).append(sizer);
        }
        sizer.text(e.val());
        return sizer.width();
    }

    function syncCssClasses(dest, src, adapter) {
        var classes, replacements = [], adapted;

        classes = $.trim(dest.attr("class"));

        if (classes) {
            classes = '' + classes; // for IE which returns object

            $(classes.split(/\s+/)).each2(function() {
                if (this.indexOf("select2-") === 0) {
                    replacements.push(this);
                }
            });
        }

        classes = $.trim(src.attr("class"));

        if (classes) {
            classes = '' + classes; // for IE which returns object

            $(classes.split(/\s+/)).each2(function() {
                if (this.indexOf("select2-") !== 0) {
                    adapted = adapter(this);

                    if (adapted) {
                        replacements.push(adapted);
                    }
                }
            });
        }

        dest.attr("class", replacements.join(" "));
    }


    function markMatch(text, term, markup, escapeMarkup) {
        var match=stripDiacritics(text.toUpperCase()).indexOf(stripDiacritics(term.toUpperCase())),
            tl=term.length;

        if (match<0) {
            markup.push(escapeMarkup(text));
            return;
        }

        markup.push(escapeMarkup(text.substring(0, match)));
        markup.push("<span class='select2-match'>");
        markup.push(escapeMarkup(text.substring(match, match + tl)));
        markup.push("</span>");
        markup.push(escapeMarkup(text.substring(match + tl, text.length)));
    }

    function defaultEscapeMarkup(markup) {
        var replace_map = {
            '\\': '&#92;',
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#39;',
            "/": '&#47;'
        };

        return String(markup).replace(/[&<>"'\/\\]/g, function (match) {
            return replace_map[match];
        });
    }

    /**
     * Produces an ajax-based query function
     *
     * @param options object containing configuration parameters
     * @param options.params parameter map for the transport ajax call, can contain such options as cache, jsonpCallback, etc. see $.ajax
     * @param options.transport function that will be used to execute the ajax request. must be compatible with parameters supported by $.ajax
     * @param options.url url for the data
     * @param options.data a function(searchTerm, pageNumber, context) that should return an object containing query string parameters for the above url.
     * @param options.dataType request data type: ajax, jsonp, other datatypes supported by jQuery's $.ajax function or the transport function if specified
     * @param options.quietMillis (optional) milliseconds to wait before making the ajaxRequest, helps debounce the ajax function if invoked too often
     * @param options.results a function(remoteData, pageNumber, query) that converts data returned form the remote request to the format expected by Select2.
     *      The expected format is an object containing the following keys:
     *      results array of objects that will be used as choices
     *      more (optional) boolean indicating whether there are more results available
     *      Example: {results:[{id:1, text:'Red'},{id:2, text:'Blue'}], more:true}
     */
    function ajax(options) {
        var timeout, // current scheduled but not yet executed request
            handler = null,
            quietMillis = options.quietMillis || 100,
            ajaxUrl = options.url,
            self = this;

        return function (query) {
            window.clearTimeout(timeout);
            timeout = window.setTimeout(function () {
                var data = options.data, // ajax data function
                    url = ajaxUrl, // ajax url string or function
                    transport = options.transport || $.fn.select2.ajaxDefaults.transport,
                    // deprecated - to be removed in 4.0  - use params instead
                    deprecated = {
                        type: options.type || 'GET', // set type of request (GET or POST)
                        cache: options.cache || false,
                        jsonpCallback: options.jsonpCallback||undefined,
                        dataType: options.dataType||"json"
                    },
                    params = $.extend({}, $.fn.select2.ajaxDefaults.params, deprecated);

                data = data ? data.call(self, query.term, query.page, query.context) : null;
                url = (typeof url === 'function') ? url.call(self, query.term, query.page, query.context) : url;

                if (handler && typeof handler.abort === "function") { handler.abort(); }

                if (options.params) {
                    if ($.isFunction(options.params)) {
                        $.extend(params, options.params.call(self));
                    } else {
                        $.extend(params, options.params);
                    }
                }

                $.extend(params, {
                    url: url,
                    dataType: options.dataType,
                    data: data,
                    success: function (data) {
                        // TODO - replace query.page with query so users have access to term, page, etc.
                        // added query as third paramter to keep backwards compatibility
                        var results = options.results(data, query.page, query);
                        query.callback(results);
                    },
                    error: function(jqXHR, textStatus, errorThrown){
                        var results = {
                            hasError: true,
                            jqXHR: jqXHR,
                            textStatus: textStatus,
                            errorThrown: errorThrown
                        };

                        query.callback(results);
                    }
                });
                handler = transport.call(self, params);
            }, quietMillis);
        };
    }

    /**
     * Produces a query function that works with a local array
     *
     * @param options object containing configuration parameters. The options parameter can either be an array or an
     * object.
     *
     * If the array form is used it is assumed that it contains objects with 'id' and 'text' keys.
     *
     * If the object form is used it is assumed that it contains 'data' and 'text' keys. The 'data' key should contain
     * an array of objects that will be used as choices. These objects must contain at least an 'id' key. The 'text'
     * key can either be a String in which case it is expected that each element in the 'data' array has a key with the
     * value of 'text' which will be used to match choices. Alternatively, text can be a function(item) that can extract
     * the text.
     */
    function local(options) {
        var data = options, // data elements
            dataText,
            tmp,
            text = function (item) { return ""+item.text; }; // function used to retrieve the text portion of a data item that is matched against the search

         if ($.isArray(data)) {
            tmp = data;
            data = { results: tmp };
        }

         if ($.isFunction(data) === false) {
            tmp = data;
            data = function() { return tmp; };
        }

        var dataItem = data();
        if (dataItem.text) {
            text = dataItem.text;
            // if text is not a function we assume it to be a key name
            if (!$.isFunction(text)) {
                dataText = dataItem.text; // we need to store this in a separate variable because in the next step data gets reset and data.text is no longer available
                text = function (item) { return item[dataText]; };
            }
        }

        return function (query) {
            var t = query.term, filtered = { results: [] }, process;
            if (t === "") {
                query.callback(data());
                return;
            }

            process = function(datum, collection) {
                var group, attr;
                datum = datum[0];
                if (datum.children) {
                    group = {};
                    for (attr in datum) {
                        if (datum.hasOwnProperty(attr)) group[attr]=datum[attr];
                    }
                    group.children=[];
                    $(datum.children).each2(function(i, childDatum) { process(childDatum, group.children); });
                    if (group.children.length || query.matcher(t, text(group), datum)) {
                        collection.push(group);
                    }
                } else {
                    if (query.matcher(t, text(datum), datum)) {
                        collection.push(datum);
                    }
                }
            };

            $(data().results).each2(function(i, datum) { process(datum, filtered.results); });
            query.callback(filtered);
        };
    }

    // TODO javadoc
    function tags(data) {
        var isFunc = $.isFunction(data);
        return function (query) {
            var t = query.term, filtered = {results: []};
            var result = isFunc ? data(query) : data;
            if ($.isArray(result)) {
                $(result).each(function () {
                    var isObject = this.text !== undefined,
                        text = isObject ? this.text : this;
                    if (t === "" || query.matcher(t, text)) {
                        filtered.results.push(isObject ? this : {id: this, text: this});
                    }
                });
                query.callback(filtered);
            }
        };
    }

    /**
     * Checks if the formatter function should be used.
     *
     * Throws an error if it is not a function. Returns true if it should be used,
     * false if no formatting should be performed.
     *
     * @param formatter
     */
    function checkFormatter(formatter, formatterName) {
        if ($.isFunction(formatter)) return true;
        if (!formatter) return false;
        if (typeof(formatter) === 'string') return true;
        throw new Error(formatterName +" must be a string, function, or falsy value");
    }

  /**
   * Returns a given value
   * If given a function, returns its output
   *
   * @param val string|function
   * @param context value of "this" to be passed to function
   * @returns {*}
   */
    function evaluate(val, context) {
        if ($.isFunction(val)) {
            var args = Array.prototype.slice.call(arguments, 2);
            return val.apply(context, args);
        }
        return val;
    }

    function countResults(results) {
        var count = 0;
        $.each(results, function(i, item) {
            if (item.children) {
                count += countResults(item.children);
            } else {
                count++;
            }
        });
        return count;
    }

    /**
     * Default tokenizer. This function uses breaks the input on substring match of any string from the
     * opts.tokenSeparators array and uses opts.createSearchChoice to create the choice object. Both of those
     * two options have to be defined in order for the tokenizer to work.
     *
     * @param input text user has typed so far or pasted into the search field
     * @param selection currently selected choices
     * @param selectCallback function(choice) callback tho add the choice to selection
     * @param opts select2's opts
     * @return undefined/null to leave the current input unchanged, or a string to change the input to the returned value
     */
    function defaultTokenizer(input, selection, selectCallback, opts) {
        var original = input, // store the original so we can compare and know if we need to tell the search to update its text
            dupe = false, // check for whether a token we extracted represents a duplicate selected choice
            token, // token
            index, // position at which the separator was found
            i, l, // looping variables
            separator; // the matched separator

        if (!opts.createSearchChoice || !opts.tokenSeparators || opts.tokenSeparators.length < 1) return undefined;

        while (true) {
            index = -1;

            for (i = 0, l = opts.tokenSeparators.length; i < l; i++) {
                separator = opts.tokenSeparators[i];
                index = input.indexOf(separator);
                if (index >= 0) break;
            }

            if (index < 0) break; // did not find any token separator in the input string, bail

            token = input.substring(0, index);
            input = input.substring(index + separator.length);

            if (token.length > 0) {
                token = opts.createSearchChoice.call(this, token, selection);
                if (token !== undefined && token !== null && opts.id(token) !== undefined && opts.id(token) !== null) {
                    dupe = false;
                    for (i = 0, l = selection.length; i < l; i++) {
                        if (equal(opts.id(token), opts.id(selection[i]))) {
                            dupe = true; break;
                        }
                    }

                    if (!dupe) selectCallback(token);
                }
            }
        }

        if (original!==input) return input;
    }

    function cleanupJQueryElements() {
        var self = this;

        $.each(arguments, function (i, element) {
            self[element].remove();
            self[element] = null;
        });
    }

    /**
     * Creates a new class
     *
     * @param superClass
     * @param methods
     */
    function clazz(SuperClass, methods) {
        var constructor = function () {};
        constructor.prototype = new SuperClass;
        constructor.prototype.constructor = constructor;
        constructor.prototype.parent = SuperClass.prototype;
        constructor.prototype = $.extend(constructor.prototype, methods);
        return constructor;
    }

    AbstractSelect2 = clazz(Object, {

        // abstract
        bind: function (func) {
            var self = this;
            return function () {
                func.apply(self, arguments);
            };
        },

        // abstract
        init: function (opts) {
            var results, search, resultsSelector = ".select2-results";

            // prepare options
            this.opts = opts = this.prepareOpts(opts);

            this.id=opts.id;

            // destroy if called on an existing component
            if (opts.element.data("select2") !== undefined &&
                opts.element.data("select2") !== null) {
                opts.element.data("select2").destroy();
            }

            this.container = this.createContainer();

            this.liveRegion = $('.select2-hidden-accessible');
            if (this.liveRegion.length == 0) {
                this.liveRegion = $("<span>", {
                        role: "status",
                        "aria-live": "polite"
                    })
                    .addClass("select2-hidden-accessible")
                    .appendTo(document.body);
            }

            this.containerId="s2id_"+(opts.element.attr("id") || "autogen"+nextUid());
            this.containerEventName= this.containerId
                .replace(/([.])/g, '_')
                .replace(/([;&,\-\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g, '\\$1');
            this.container.attr("id", this.containerId);

            this.container.attr("title", opts.element.attr("title"));

            this.body = $(document.body);

            syncCssClasses(this.container, this.opts.element, this.opts.adaptContainerCssClass);

            this.container.attr("style", opts.element.attr("style"));
            this.container.css(evaluate(opts.containerCss, this.opts.element));
            this.container.addClass(evaluate(opts.containerCssClass, this.opts.element));

            this.elementTabIndex = this.opts.element.attr("tabindex");

            // swap container for the element
            this.opts.element
                .data("select2", this)
                .attr("tabindex", "-1")
                .before(this.container)
                .on("click.select2", killEvent); // do not leak click events

            this.container.data("select2", this);

            this.dropdown = this.container.find(".select2-drop");

            syncCssClasses(this.dropdown, this.opts.element, this.opts.adaptDropdownCssClass);

            this.dropdown.addClass(evaluate(opts.dropdownCssClass, this.opts.element));
            this.dropdown.data("select2", this);
            this.dropdown.on("click", killEvent);

            this.results = results = this.container.find(resultsSelector);
            this.search = search = this.container.find("input.select2-input");

            this.queryCount = 0;
            this.resultsPage = 0;
            this.context = null;

            // initialize the container
            this.initContainer();

            this.container.on("click", killEvent);

            installFilteredMouseMove(this.results);

            this.dropdown.on("mousemove-filtered", resultsSelector, this.bind(this.highlightUnderEvent));
            this.dropdown.on("touchstart touchmove touchend", resultsSelector, this.bind(function (event) {
                this._touchEvent = true;
                this.highlightUnderEvent(event);
            }));
            this.dropdown.on("touchmove", resultsSelector, this.bind(this.touchMoved));
            this.dropdown.on("touchstart touchend", resultsSelector, this.bind(this.clearTouchMoved));

            // Waiting for a click event on touch devices to select option and hide dropdown
            // otherwise click will be triggered on an underlying element
            this.dropdown.on('click', this.bind(function (event) {
                if (this._touchEvent) {
                    this._touchEvent = false;
                    this.selectHighlighted();
                }
            }));

            installDebouncedScroll(80, this.results);
            this.dropdown.on("scroll-debounced", resultsSelector, this.bind(this.loadMoreIfNeeded));

            // do not propagate change event from the search field out of the component
            $(this.container).on("change", ".select2-input", function(e) {e.stopPropagation();});
            $(this.dropdown).on("change", ".select2-input", function(e) {e.stopPropagation();});

            // if jquery.mousewheel plugin is installed we can prevent out-of-bounds scrolling of results via mousewheel
            if ($.fn.mousewheel) {
                results.mousewheel(function (e, delta, deltaX, deltaY) {
                    var top = results.scrollTop();
                    if (deltaY > 0 && top - deltaY <= 0) {
                        results.scrollTop(0);
                        killEvent(e);
                    } else if (deltaY < 0 && results.get(0).scrollHeight - results.scrollTop() + deltaY <= results.height()) {
                        results.scrollTop(results.get(0).scrollHeight - results.height());
                        killEvent(e);
                    }
                });
            }

            installKeyUpChangeEvent(search);
            search.on("keyup-change input paste", this.bind(this.updateResults));
            search.on("focus", function () { search.addClass("select2-focused"); });
            search.on("blur", function () { search.removeClass("select2-focused");});

            this.dropdown.on("mouseup", resultsSelector, this.bind(function (e) {
                if ($(e.target).closest(".select2-result-selectable").length > 0) {
                    this.highlightUnderEvent(e);
                    this.selectHighlighted(e);
                }
            }));

            // trap all mouse events from leaving the dropdown. sometimes there may be a modal that is listening
            // for mouse events outside of itself so it can close itself. since the dropdown is now outside the select2's
            // dom it will trigger the popup close, which is not what we want
            // focusin can cause focus wars between modals and select2 since the dropdown is outside the modal.
            this.dropdown.on("click mouseup mousedown touchstart touchend focusin", function (e) { e.stopPropagation(); });

            this.nextSearchTerm = undefined;

            if ($.isFunction(this.opts.initSelection)) {
                // initialize selection based on the current value of the source element
                this.initSelection();

                // if the user has provided a function that can set selection based on the value of the source element
                // we monitor the change event on the element and trigger it, allowing for two way synchronization
                this.monitorSource();
            }

            if (opts.maximumInputLength !== null) {
                this.search.attr("maxlength", opts.maximumInputLength);
            }

            var disabled = opts.element.prop("disabled");
            if (disabled === undefined) disabled = false;
            this.enable(!disabled);

            var readonly = opts.element.prop("readonly");
            if (readonly === undefined) readonly = false;
            this.readonly(readonly);

            // Calculate size of scrollbar
            scrollBarDimensions = scrollBarDimensions || measureScrollbar();

            this.autofocus = opts.element.prop("autofocus");
            opts.element.prop("autofocus", false);
            if (this.autofocus) this.focus();

            this.search.attr("placeholder", opts.searchInputPlaceholder);
        },

        // abstract
        destroy: function () {
            var element=this.opts.element, select2 = element.data("select2"), self = this;

            this.close();

            if (element.length && element[0].detachEvent && self._sync) {
                element.each(function () {
                    if (self._sync) {
                        this.detachEvent("onpropertychange", self._sync);
                    }
                });
            }
            if (this.propertyObserver) {
                this.propertyObserver.disconnect();
                this.propertyObserver = null;
            }
            this._sync = null;

            if (select2 !== undefined) {
                select2.container.remove();
                select2.liveRegion.remove();
                select2.dropdown.remove();
                element
                    .show()
                    .removeData("select2")
                    .off(".select2")
                    .prop("autofocus", this.autofocus || false);
                if (this.elementTabIndex) {
                    element.attr({tabindex: this.elementTabIndex});
                } else {
                    element.removeAttr("tabindex");
                }
                element.show();
            }

            cleanupJQueryElements.call(this,
                "container",
                "liveRegion",
                "dropdown",
                "results",
                "search"
            );
        },

        // abstract
        optionToData: function(element) {
            if (element.is("option")) {
                return {
                    id:element.prop("value"),
                    text:element.text(),
                    element: element.get(),
                    css: element.attr("class"),
                    disabled: element.prop("disabled"),
                    locked: equal(element.attr("locked"), "locked") || equal(element.data("locked"), true)
                };
            } else if (element.is("optgroup")) {
                return {
                    text:element.attr("label"),
                    children:[],
                    element: element.get(),
                    css: element.attr("class")
                };
            }
        },

        // abstract
        prepareOpts: function (opts) {
            var element, select, idKey, ajaxUrl, self = this;

            element = opts.element;

            if (element.get(0).tagName.toLowerCase() === "select") {
                this.select = select = opts.element;
            }

            if (select) {
                // these options are not allowed when attached to a select because they are picked up off the element itself
                $.each(["id", "multiple", "ajax", "query", "createSearchChoice", "initSelection", "data", "tags"], function () {
                    if (this in opts) {
                        throw new Error("Option '" + this + "' is not allowed for Select2 when attached to a <select> element.");
                    }
                });
            }

            opts = $.extend({}, {
                populateResults: function(container, results, query) {
                    var populate, id=this.opts.id, liveRegion=this.liveRegion;

                    populate=function(results, container, depth) {

                        var i, l, result, selectable, disabled, compound, node, label, innerContainer, formatted;

                        results = opts.sortResults(results, container, query);

                        // collect the created nodes for bulk append
                        var nodes = [];
                        for (i = 0, l = results.length; i < l; i = i + 1) {

                            result=results[i];

                            disabled = (result.disabled === true);
                            selectable = (!disabled) && (id(result) !== undefined);

                            compound=result.children && result.children.length > 0;

                            node=$("<li></li>");
                            node.addClass("select2-results-dept-"+depth);
                            node.addClass("select2-result");
                            node.addClass(selectable ? "select2-result-selectable" : "select2-result-unselectable");
                            if (disabled) { node.addClass("select2-disabled"); }
                            if (compound) { node.addClass("select2-result-with-children"); }
                            node.addClass(self.opts.formatResultCssClass(result));
                            node.attr("role", "presentation");

                            label=$(document.createElement("div"));
                            label.addClass("select2-result-label");
                            label.attr("id", "select2-result-label-" + nextUid());
                            label.attr("role", "option");

                            formatted=opts.formatResult(result, label, query, self.opts.escapeMarkup);
                            if (formatted!==undefined) {
                                label.html(formatted);
                                node.append(label);
                            }


                            if (compound) {

                                innerContainer=$("<ul></ul>");
                                innerContainer.addClass("select2-result-sub");
                                populate(result.children, innerContainer, depth+1);
                                node.append(innerContainer);
                            }

                            node.data("select2-data", result);
                            nodes.push(node[0]);
                        }

                        // bulk append the created nodes
                        container.append(nodes);
                        liveRegion.text(opts.formatMatches(results.length));
                    };

                    populate(results, container, 0);
                }
            }, $.fn.select2.defaults, opts);

            if (typeof(opts.id) !== "function") {
                idKey = opts.id;
                opts.id = function (e) { return e[idKey]; };
            }

            if ($.isArray(opts.element.data("select2Tags"))) {
                if ("tags" in opts) {
                    throw "tags specified as both an attribute 'data-select2-tags' and in options of Select2 " + opts.element.attr("id");
                }
                opts.tags=opts.element.data("select2Tags");
            }

            if (select) {
                opts.query = this.bind(function (query) {
                    var data = { results: [], more: false },
                        term = query.term,
                        children, placeholderOption, process;

                    process=function(element, collection) {
                        var group;
                        if (element.is("option")) {
                            if (query.matcher(term, element.text(), element)) {
                                collection.push(self.optionToData(element));
                            }
                        } else if (element.is("optgroup")) {
                            group=self.optionToData(element);
                            element.children().each2(function(i, elm) { process(elm, group.children); });
                            if (group.children.length>0) {
                                collection.push(group);
                            }
                        }
                    };

                    children=element.children();

                    // ignore the placeholder option if there is one
                    if (this.getPlaceholder() !== undefined && children.length > 0) {
                        placeholderOption = this.getPlaceholderOption();
                        if (placeholderOption) {
                            children=children.not(placeholderOption);
                        }
                    }

                    children.each2(function(i, elm) { process(elm, data.results); });

                    query.callback(data);
                });
                // this is needed because inside val() we construct choices from options and their id is hardcoded
                opts.id=function(e) { return e.id; };
            } else {
                if (!("query" in opts)) {

                    if ("ajax" in opts) {
                        ajaxUrl = opts.element.data("ajax-url");
                        if (ajaxUrl && ajaxUrl.length > 0) {
                            opts.ajax.url = ajaxUrl;
                        }
                        opts.query = ajax.call(opts.element, opts.ajax);
                    } else if ("data" in opts) {
                        opts.query = local(opts.data);
                    } else if ("tags" in opts) {
                        opts.query = tags(opts.tags);
                        if (opts.createSearchChoice === undefined) {
                            opts.createSearchChoice = function (term) { return {id: $.trim(term), text: $.trim(term)}; };
                        }
                        if (opts.initSelection === undefined) {
                            opts.initSelection = function (element, callback) {
                                var data = [];
                                $(splitVal(element.val(), opts.separator, opts.transformVal)).each(function () {
                                    var obj = { id: this, text: this },
                                        tags = opts.tags;
                                    if ($.isFunction(tags)) tags=tags();
                                    $(tags).each(function() { if (equal(this.id, obj.id)) { obj = this; return false; } });
                                    data.push(obj);
                                });

                                callback(data);
                            };
                        }
                    }
                }
            }
            if (typeof(opts.query) !== "function") {
                throw "query function not defined for Select2 " + opts.element.attr("id");
            }

            if (opts.createSearchChoicePosition === 'top') {
                opts.createSearchChoicePosition = function(list, item) { list.unshift(item); };
            }
            else if (opts.createSearchChoicePosition === 'bottom') {
                opts.createSearchChoicePosition = function(list, item) { list.push(item); };
            }
            else if (typeof(opts.createSearchChoicePosition) !== "function")  {
                throw "invalid createSearchChoicePosition option must be 'top', 'bottom' or a custom function";
            }

            return opts;
        },

        /**
         * Monitor the original element for changes and update select2 accordingly
         */
        // abstract
        monitorSource: function () {
            var el = this.opts.element, observer, self = this;

            el.on("change.select2", this.bind(function (e) {
                if (this.opts.element.data("select2-change-triggered") !== true) {
                    this.initSelection();
                }
            }));

            this._sync = this.bind(function () {

                // sync enabled state
                var disabled = el.prop("disabled");
                if (disabled === undefined) disabled = false;
                this.enable(!disabled);

                var readonly = el.prop("readonly");
                if (readonly === undefined) readonly = false;
                this.readonly(readonly);

                if (this.container) {
                    syncCssClasses(this.container, this.opts.element, this.opts.adaptContainerCssClass);
                    this.container.addClass(evaluate(this.opts.containerCssClass, this.opts.element));
                }

                if (this.dropdown) {
                    syncCssClasses(this.dropdown, this.opts.element, this.opts.adaptDropdownCssClass);
                    this.dropdown.addClass(evaluate(this.opts.dropdownCssClass, this.opts.element));
                }

            });

            // IE8-10 (IE9/10 won't fire propertyChange via attachEventListener)
            if (el.length && el[0].attachEvent) {
                el.each(function() {
                    this.attachEvent("onpropertychange", self._sync);
                });
            }

            // safari, chrome, firefox, IE11
            observer = window.MutationObserver || window.WebKitMutationObserver|| window.MozMutationObserver;
            if (observer !== undefined) {
                if (this.propertyObserver) { delete this.propertyObserver; this.propertyObserver = null; }
                this.propertyObserver = new observer(function (mutations) {
                    $.each(mutations, self._sync);
                });
                this.propertyObserver.observe(el.get(0), { attributes:true, subtree:false });
            }
        },

        // abstract
        triggerSelect: function(data) {
            var evt = $.Event("select2-selecting", { val: this.id(data), object: data, choice: data });
            this.opts.element.trigger(evt);
            return !evt.isDefaultPrevented();
        },

        /**
         * Triggers the change event on the source element
         */
        // abstract
        triggerChange: function (details) {

            details = details || {};
            details= $.extend({}, details, { type: "change", val: this.val() });
            // prevents recursive triggering
            this.opts.element.data("select2-change-triggered", true);
            this.opts.element.trigger(details);
            this.opts.element.data("select2-change-triggered", false);

            // some validation frameworks ignore the change event and listen instead to keyup, click for selects
            // so here we trigger the click event manually
            this.opts.element.click();

            // ValidationEngine ignores the change event and listens instead to blur
            // so here we trigger the blur event manually if so desired
            if (this.opts.blurOnChange)
                this.opts.element.blur();
        },

        //abstract
        isInterfaceEnabled: function()
        {
            return this.enabledInterface === true;
        },

        // abstract
        enableInterface: function() {
            var enabled = this._enabled && !this._readonly,
                disabled = !enabled;

            if (enabled === this.enabledInterface) return false;

            this.container.toggleClass("select2-container-disabled", disabled);
            this.close();
            this.enabledInterface = enabled;

            return true;
        },

        // abstract
        enable: function(enabled) {
            if (enabled === undefined) enabled = true;
            if (this._enabled === enabled) return;
            this._enabled = enabled;

            this.opts.element.prop("disabled", !enabled);
            this.enableInterface();
        },

        // abstract
        disable: function() {
            this.enable(false);
        },

        // abstract
        readonly: function(enabled) {
            if (enabled === undefined) enabled = false;
            if (this._readonly === enabled) return;
            this._readonly = enabled;

            this.opts.element.prop("readonly", enabled);
            this.enableInterface();
        },

        // abstract
        opened: function () {
            return (this.container) ? this.container.hasClass("select2-dropdown-open") : false;
        },

        // abstract
        positionDropdown: function() {
            var $dropdown = this.dropdown,
                container = this.container,
                offset = container.offset(),
                height = container.outerHeight(false),
                width = container.outerWidth(false),
                dropHeight = $dropdown.outerHeight(false),
                $window = $(window),
                windowWidth = $window.width(),
                windowHeight = $window.height(),
                viewPortRight = $window.scrollLeft() + windowWidth,
                viewportBottom = $window.scrollTop() + windowHeight,
                dropTop = offset.top + height,
                dropLeft = offset.left,
                enoughRoomBelow = dropTop + dropHeight <= viewportBottom,
                enoughRoomAbove = (offset.top - dropHeight) >= $window.scrollTop(),
                dropWidth = $dropdown.outerWidth(false),
                enoughRoomOnRight = function() {
                    return dropLeft + dropWidth <= viewPortRight;
                },
                enoughRoomOnLeft = function() {
                    return offset.left + viewPortRight + container.outerWidth(false)  > dropWidth;
                },
                aboveNow = $dropdown.hasClass("select2-drop-above"),
                bodyOffset,
                above,
                changeDirection,
                css,
                resultsListNode;

            // always prefer the current above/below alignment, unless there is not enough room
            if (aboveNow) {
                above = true;
                if (!enoughRoomAbove && enoughRoomBelow) {
                    changeDirection = true;
                    above = false;
                }
            } else {
                above = false;
                if (!enoughRoomBelow && enoughRoomAbove) {
                    changeDirection = true;
                    above = true;
                }
            }

            //if we are changing direction we need to get positions when dropdown is hidden;
            if (changeDirection) {
                $dropdown.hide();
                offset = this.container.offset();
                height = this.container.outerHeight(false);
                width = this.container.outerWidth(false);
                dropHeight = $dropdown.outerHeight(false);
                viewPortRight = $window.scrollLeft() + windowWidth;
                viewportBottom = $window.scrollTop() + windowHeight;
                dropTop = offset.top + height;
                dropLeft = offset.left;
                dropWidth = $dropdown.outerWidth(false);
                $dropdown.show();

                // fix so the cursor does not move to the left within the search-textbox in IE
                this.focusSearch();
            }

            if (this.opts.dropdownAutoWidth) {
                resultsListNode = $('.select2-results', $dropdown)[0];
                $dropdown.addClass('select2-drop-auto-width');
                $dropdown.css('width', '');
                // Add scrollbar width to dropdown if vertical scrollbar is present
                dropWidth = $dropdown.outerWidth(false) + (resultsListNode.scrollHeight === resultsListNode.clientHeight ? 0 : scrollBarDimensions.width);
                dropWidth > width ? width = dropWidth : dropWidth = width;
                dropHeight = $dropdown.outerHeight(false);
            }
            else {
                this.container.removeClass('select2-drop-auto-width');
            }

            //console.log("below/ droptop:", dropTop, "dropHeight", dropHeight, "sum", (dropTop+dropHeight)+" viewport bottom", viewportBottom, "enough?", enoughRoomBelow);
            //console.log("above/ offset.top", offset.top, "dropHeight", dropHeight, "top", (offset.top-dropHeight), "scrollTop", this.body.scrollTop(), "enough?", enoughRoomAbove);

            // fix positioning when body has an offset and is not position: static
            if (this.body.css('position') !== 'static') {
                bodyOffset = this.body.offset();
                dropTop -= bodyOffset.top;
                dropLeft -= bodyOffset.left;
            }

            if (!enoughRoomOnRight() && enoughRoomOnLeft()) {
                dropLeft = offset.left + this.container.outerWidth(false) - dropWidth;
            }

            css =  {
                left: dropLeft,
                width: width
            };

            if (above) {
                css.top = offset.top - dropHeight;
                css.bottom = 'auto';
                this.container.addClass("select2-drop-above");
                $dropdown.addClass("select2-drop-above");
            }
            else {
                css.top = dropTop;
                css.bottom = 'auto';
                this.container.removeClass("select2-drop-above");
                $dropdown.removeClass("select2-drop-above");
            }
            css = $.extend(css, evaluate(this.opts.dropdownCss, this.opts.element));

            $dropdown.css(css);
        },

        // abstract
        shouldOpen: function() {
            var event;

            if (this.opened()) return false;

            if (this._enabled === false || this._readonly === true) return false;

            event = $.Event("select2-opening");
            this.opts.element.trigger(event);
            return !event.isDefaultPrevented();
        },

        // abstract
        clearDropdownAlignmentPreference: function() {
            // clear the classes used to figure out the preference of where the dropdown should be opened
            this.container.removeClass("select2-drop-above");
            this.dropdown.removeClass("select2-drop-above");
        },

        /**
         * Opens the dropdown
         *
         * @return {Boolean} whether or not dropdown was opened. This method will return false if, for example,
         * the dropdown is already open, or if the 'open' event listener on the element called preventDefault().
         */
        // abstract
        open: function () {

            if (!this.shouldOpen()) return false;

            this.opening();

            // Only bind the document mousemove when the dropdown is visible
            $document.on("mousemove.select2Event", function (e) {
                lastMousePosition.x = e.pageX;
                lastMousePosition.y = e.pageY;
            });

            return true;
        },

        /**
         * Performs the opening of the dropdown
         */
        // abstract
        opening: function() {
            var cid = this.containerEventName,
                scroll = "scroll." + cid,
                resize = "resize."+cid,
                orient = "orientationchange."+cid,
                mask;

            this.container.addClass("select2-dropdown-open").addClass("select2-container-active");

            this.clearDropdownAlignmentPreference();

            if(this.dropdown[0] !== this.body.children().last()[0]) {
                this.dropdown.detach().appendTo(this.body);
            }

            // create the dropdown mask if doesn't already exist
            mask = $("#select2-drop-mask");
            if (mask.length === 0) {
                mask = $(document.createElement("div"));
                mask.attr("id","select2-drop-mask").attr("class","select2-drop-mask");
                mask.hide();
                mask.appendTo(this.body);
                mask.on("mousedown touchstart click", function (e) {
                    // Prevent IE from generating a click event on the body
                    reinsertElement(mask);

                    var dropdown = $("#select2-drop"), self;
                    if (dropdown.length > 0) {
                        self=dropdown.data("select2");
                        if (self.opts.selectOnBlur) {
                            self.selectHighlighted({noFocus: true});
                        }
                        self.close();
                        e.preventDefault();
                        e.stopPropagation();
                    }
                });
            }

            // ensure the mask is always right before the dropdown
            if (this.dropdown.prev()[0] !== mask[0]) {
                this.dropdown.before(mask);
            }

            // move the global id to the correct dropdown
            $("#select2-drop").removeAttr("id");
            this.dropdown.attr("id", "select2-drop");

            // show the elements
            mask.show();

            this.positionDropdown();
            this.dropdown.show();
            this.positionDropdown();

            this.dropdown.addClass("select2-drop-active");

            // attach listeners to events that can change the position of the container and thus require
            // the position of the dropdown to be updated as well so it does not come unglued from the container
            var that = this;
            this.container.parents().add(window).each(function () {
                $(this).on(resize+" "+scroll+" "+orient, function (e) {
                    if (that.opened()) that.positionDropdown();
                });
            });


        },

        // abstract
        close: function () {
            if (!this.opened()) return;

            var cid = this.containerEventName,
                scroll = "scroll." + cid,
                resize = "resize."+cid,
                orient = "orientationchange."+cid;

            // unbind event listeners
            this.container.parents().add(window).each(function () { $(this).off(scroll).off(resize).off(orient); });

            this.clearDropdownAlignmentPreference();

            $("#select2-drop-mask").hide();
            this.dropdown.removeAttr("id"); // only the active dropdown has the select2-drop id
            this.dropdown.hide();
            this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active");
            this.results.empty();

            // Now that the dropdown is closed, unbind the global document mousemove event
            $document.off("mousemove.select2Event");

            this.clearSearch();
            this.search.removeClass("select2-active");
            this.opts.element.trigger($.Event("select2-close"));
        },

        /**
         * Opens control, sets input value, and updates results.
         */
        // abstract
        externalSearch: function (term) {
            this.open();
            this.search.val(term);
            this.updateResults(false);
        },

        // abstract
        clearSearch: function () {

        },

        //abstract
        getMaximumSelectionSize: function() {
            return evaluate(this.opts.maximumSelectionSize, this.opts.element);
        },

        // abstract
        ensureHighlightVisible: function () {
            var results = this.results, children, index, child, hb, rb, y, more, topOffset;

            index = this.highlight();

            if (index < 0) return;

            if (index == 0) {

                // if the first element is highlighted scroll all the way to the top,
                // that way any unselectable headers above it will also be scrolled
                // into view

                results.scrollTop(0);
                return;
            }

            children = this.findHighlightableChoices().find('.select2-result-label');

            child = $(children[index]);

            topOffset = (child.offset() || {}).top || 0;

            hb = topOffset + child.outerHeight(true);

            // if this is the last child lets also make sure select2-more-results is visible
            if (index === children.length - 1) {
                more = results.find("li.select2-more-results");
                if (more.length > 0) {
                    hb = more.offset().top + more.outerHeight(true);
                }
            }

            rb = results.offset().top + results.outerHeight(false);
            if (hb > rb) {
                results.scrollTop(results.scrollTop() + (hb - rb));
            }
            y = topOffset - results.offset().top;

            // make sure the top of the element is visible
            if (y < 0 && child.css('display') != 'none' ) {
                results.scrollTop(results.scrollTop() + y); // y is negative
            }
        },

        // abstract
        findHighlightableChoices: function() {
            return this.results.find(".select2-result-selectable:not(.select2-disabled):not(.select2-selected)");
        },

        // abstract
        moveHighlight: function (delta) {
            var choices = this.findHighlightableChoices(),
                index = this.highlight();

            while (index > -1 && index < choices.length) {
                index += delta;
                var choice = $(choices[index]);
                if (choice.hasClass("select2-result-selectable") && !choice.hasClass("select2-disabled") && !choice.hasClass("select2-selected")) {
                    this.highlight(index);
                    break;
                }
            }
        },

        // abstract
        highlight: function (index) {
            var choices = this.findHighlightableChoices(),
                choice,
                data;

            if (arguments.length === 0) {
                return indexOf(choices.filter(".select2-highlighted")[0], choices.get());
            }

            if (index >= choices.length) index = choices.length - 1;
            if (index < 0) index = 0;

            this.removeHighlight();

            choice = $(choices[index]);
            choice.addClass("select2-highlighted");

            // ensure assistive technology can determine the active choice
            this.search.attr("aria-activedescendant", choice.find(".select2-result-label").attr("id"));

            this.ensureHighlightVisible();

            this.liveRegion.text(choice.text());

            data = choice.data("select2-data");
            if (data) {
                this.opts.element.trigger({ type: "select2-highlight", val: this.id(data), choice: data });
            }
        },

        removeHighlight: function() {
            this.results.find(".select2-highlighted").removeClass("select2-highlighted");
        },

        touchMoved: function() {
            this._touchMoved = true;
        },

        clearTouchMoved: function() {
          this._touchMoved = false;
        },

        // abstract
        countSelectableResults: function() {
            return this.findHighlightableChoices().length;
        },

        // abstract
        highlightUnderEvent: function (event) {
            var el = $(event.target).closest(".select2-result-selectable");
            if (el.length > 0 && !el.is(".select2-highlighted")) {
                var choices = this.findHighlightableChoices();
                this.highlight(choices.index(el));
            } else if (el.length == 0) {
                // if we are over an unselectable item remove all highlights
                this.removeHighlight();
            }
        },

        // abstract
        loadMoreIfNeeded: function () {
            var results = this.results,
                more = results.find("li.select2-more-results"),
                below, // pixels the element is below the scroll fold, below==0 is when the element is starting to be visible
                page = this.resultsPage + 1,
                self=this,
                term=this.search.val(),
                context=this.context;

            if (more.length === 0) return;
            below = more.offset().top - results.offset().top - results.height();

            if (below <= this.opts.loadMorePadding) {
                more.addClass("select2-active");
                this.opts.query({
                        element: this.opts.element,
                        term: term,
                        page: page,
                        context: context,
                        matcher: this.opts.matcher,
                        callback: this.bind(function (data) {

                    // ignore a response if the select2 has been closed before it was received
                    if (!self.opened()) return;


                    self.opts.populateResults.call(this, results, data.results, {term: term, page: page, context:context});
                    self.postprocessResults(data, false, false);

                    if (data.more===true) {
                        more.detach().appendTo(results).html(self.opts.escapeMarkup(evaluate(self.opts.formatLoadMore, self.opts.element, page+1)));
                        window.setTimeout(function() { self.loadMoreIfNeeded(); }, 10);
                    } else {
                        more.remove();
                    }
                    self.positionDropdown();
                    self.resultsPage = page;
                    self.context = data.context;
                    this.opts.element.trigger({ type: "select2-loaded", items: data });
                })});
            }
        },

        /**
         * Default tokenizer function which does nothing
         */
        tokenize: function() {

        },

        /**
         * @param initial whether or not this is the call to this method right after the dropdown has been opened
         */
        // abstract
        updateResults: function (initial) {
            var search = this.search,
                results = this.results,
                opts = this.opts,
                data,
                self = this,
                input,
                term = search.val(),
                lastTerm = $.data(this.container, "select2-last-term"),
                // sequence number used to drop out-of-order responses
                queryNumber;

            // prevent duplicate queries against the same term
            if (initial !== true && lastTerm && equal(term, lastTerm)) return;

            $.data(this.container, "select2-last-term", term);

            // if the search is currently hidden we do not alter the results
            if (initial !== true && (this.showSearchInput === false || !this.opened())) {
                return;
            }

            function postRender() {
                search.removeClass("select2-active");
                self.positionDropdown();
                if (results.find('.select2-no-results,.select2-selection-limit,.select2-searching').length) {
                    self.liveRegion.text(results.text());
                }
                else {
                    self.liveRegion.text(self.opts.formatMatches(results.find('.select2-result-selectable:not(".select2-selected")').length));
                }
            }

            function render(html) {
                results.html(html);
                postRender();
            }

            queryNumber = ++this.queryCount;

            var maxSelSize = this.getMaximumSelectionSize();
            if (maxSelSize >=1) {
                data = this.data();
                if ($.isArray(data) && data.length >= maxSelSize && checkFormatter(opts.formatSelectionTooBig, "formatSelectionTooBig")) {
                    render("<li class='select2-selection-limit'>" + evaluate(opts.formatSelectionTooBig, opts.element, maxSelSize) + "</li>");
                    return;
                }
            }

            if (search.val().length < opts.minimumInputLength) {
                if (checkFormatter(opts.formatInputTooShort, "formatInputTooShort")) {
                    render("<li class='select2-no-results'>" + evaluate(opts.formatInputTooShort, opts.element, search.val(), opts.minimumInputLength) + "</li>");
                } else {
                    render("");
                }
                if (initial && this.showSearch) this.showSearch(true);
                return;
            }

            if (opts.maximumInputLength && search.val().length > opts.maximumInputLength) {
                if (checkFormatter(opts.formatInputTooLong, "formatInputTooLong")) {
                    render("<li class='select2-no-results'>" + evaluate(opts.formatInputTooLong, opts.element, search.val(), opts.maximumInputLength) + "</li>");
                } else {
                    render("");
                }
                return;
            }

            if (opts.formatSearching && this.findHighlightableChoices().length === 0) {
                render("<li class='select2-searching'>" + evaluate(opts.formatSearching, opts.element) + "</li>");
            }

            search.addClass("select2-active");

            this.removeHighlight();

            // give the tokenizer a chance to pre-process the input
            input = this.tokenize();
            if (input != undefined && input != null) {
                search.val(input);
            }

            this.resultsPage = 1;

            opts.query({
                element: opts.element,
                    term: search.val(),
                    page: this.resultsPage,
                    context: null,
                    matcher: opts.matcher,
                    callback: this.bind(function (data) {
                var def; // default choice

                // ignore old responses
                if (queryNumber != this.queryCount) {
                  return;
                }

                // ignore a response if the select2 has been closed before it was received
                if (!this.opened()) {
                    this.search.removeClass("select2-active");
                    return;
                }

                // handle ajax error
                if(data.hasError !== undefined && checkFormatter(opts.formatAjaxError, "formatAjaxError")) {
                    render("<li class='select2-ajax-error'>" + evaluate(opts.formatAjaxError, opts.element, data.jqXHR, data.textStatus, data.errorThrown) + "</li>");
                    return;
                }

                // save context, if any
                this.context = (data.context===undefined) ? null : data.context;
                // create a default choice and prepend it to the list
                if (this.opts.createSearchChoice && search.val() !== "") {
                    def = this.opts.createSearchChoice.call(self, search.val(), data.results);
                    if (def !== undefined && def !== null && self.id(def) !== undefined && self.id(def) !== null) {
                        if ($(data.results).filter(
                            function () {
                                return equal(self.id(this), self.id(def));
                            }).length === 0) {
                            this.opts.createSearchChoicePosition(data.results, def);
                        }
                    }
                }

                if (data.results.length === 0 && checkFormatter(opts.formatNoMatches, "formatNoMatches")) {
                    render("<li class='select2-no-results'>" + evaluate(opts.formatNoMatches, opts.element, search.val()) + "</li>");
                    return;
                }

                results.empty();
                self.opts.populateResults.call(this, results, data.results, {term: search.val(), page: this.resultsPage, context:null});

                if (data.more === true && checkFormatter(opts.formatLoadMore, "formatLoadMore")) {
                    results.append("<li class='select2-more-results'>" + opts.escapeMarkup(evaluate(opts.formatLoadMore, opts.element, this.resultsPage)) + "</li>");
                    window.setTimeout(function() { self.loadMoreIfNeeded(); }, 10);
                }

                this.postprocessResults(data, initial);

                postRender();

                this.opts.element.trigger({ type: "select2-loaded", items: data });
            })});
        },

        // abstract
        cancel: function () {
            this.close();
        },

        // abstract
        blur: function () {
            // if selectOnBlur == true, select the currently highlighted option
            if (this.opts.selectOnBlur)
                this.selectHighlighted({noFocus: true});

            this.close();
            this.container.removeClass("select2-container-active");
            // synonymous to .is(':focus'), which is available in jquery >= 1.6
            if (this.search[0] === document.activeElement) { this.search.blur(); }
            this.clearSearch();
            this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");
        },

        // abstract
        focusSearch: function () {
            focus(this.search);
        },

        // abstract
        selectHighlighted: function (options) {
            if (this._touchMoved) {
              this.clearTouchMoved();
              return;
            }
            var index=this.highlight(),
                highlighted=this.results.find(".select2-highlighted"),
                data = highlighted.closest('.select2-result').data("select2-data");

            if (data) {
                this.highlight(index);
                this.onSelect(data, options);
            } else if (options && options.noFocus) {
                this.close();
            }
        },

        // abstract
        getPlaceholder: function () {
            var placeholderOption;
            return this.opts.element.attr("placeholder") ||
                this.opts.element.attr("data-placeholder") || // jquery 1.4 compat
                this.opts.element.data("placeholder") ||
                this.opts.placeholder ||
                ((placeholderOption = this.getPlaceholderOption()) !== undefined ? placeholderOption.text() : undefined);
        },

        // abstract
        getPlaceholderOption: function() {
            if (this.select) {
                var firstOption = this.select.children('option').first();
                if (this.opts.placeholderOption !== undefined ) {
                    //Determine the placeholder option based on the specified placeholderOption setting
                    return (this.opts.placeholderOption === "first" && firstOption) ||
                           (typeof this.opts.placeholderOption === "function" && this.opts.placeholderOption(this.select));
                } else if ($.trim(firstOption.text()) === "" && firstOption.val() === "") {
                    //No explicit placeholder option specified, use the first if it's blank
                    return firstOption;
                }
            }
        },

        /**
         * Get the desired width for the container element.  This is
         * derived first from option `width` passed to select2, then
         * the inline 'style' on the original element, and finally
         * falls back to the jQuery calculated element width.
         */
        // abstract
        initContainerWidth: function () {
            function resolveContainerWidth() {
                var style, attrs, matches, i, l, attr;

                if (this.opts.width === "off") {
                    return null;
                } else if (this.opts.width === "element"){
                    return this.opts.element.outerWidth(false) === 0 ? 'auto' : this.opts.element.outerWidth(false) + 'px';
                } else if (this.opts.width === "copy" || this.opts.width === "resolve") {
                    // check if there is inline style on the element that contains width
                    style = this.opts.element.attr('style');
                    if (style !== undefined) {
                        attrs = style.split(';');
                        for (i = 0, l = attrs.length; i < l; i = i + 1) {
                            attr = attrs[i].replace(/\s/g, '');
                            matches = attr.match(/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i);
                            if (matches !== null && matches.length >= 1)
                                return matches[1];
                        }
                    }

                    if (this.opts.width === "resolve") {
                        // next check if css('width') can resolve a width that is percent based, this is sometimes possible
                        // when attached to input type=hidden or elements hidden via css
                        style = this.opts.element.css('width');
                        if (style.indexOf("%") > 0) return style;

                        // finally, fallback on the calculated width of the element
                        return (this.opts.element.outerWidth(false) === 0 ? 'auto' : this.opts.element.outerWidth(false) + 'px');
                    }

                    return null;
                } else if ($.isFunction(this.opts.width)) {
                    return this.opts.width();
                } else {
                    return this.opts.width;
               }
            };

            var width = resolveContainerWidth.call(this);
            if (width !== null) {
                this.container.css("width", width);
            }
        }
    });

    SingleSelect2 = clazz(AbstractSelect2, {

        // single

        createContainer: function () {
            var container = $(document.createElement("div")).attr({
                "class": "select2-container"
            }).html([
                "<a href='javascript:void(0)' class='select2-choice' tabindex='-1'>",
                "   <span class='select2-chosen'>&#160;</span><abbr class='select2-search-choice-close'></abbr>",
                "   <span class='select2-arrow' role='presentation'><b role='presentation'></b></span>",
                "</a>",
                "<label for='' class='select2-offscreen'></label>",
                "<input class='select2-focusser select2-offscreen' type='text' aria-haspopup='true' role='button' />",
                "<div class='select2-drop select2-display-none'>",
                "   <div class='select2-search'>",
                "       <label for='' class='select2-offscreen'></label>",
                "       <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input' role='combobox' aria-expanded='true'",
                "       aria-autocomplete='list' />",
                "   </div>",
                "   <ul class='select2-results' role='listbox'>",
                "   </ul>",
                "</div>"].join(""));
            return container;
        },

        // single
        enableInterface: function() {
            if (this.parent.enableInterface.apply(this, arguments)) {
                this.focusser.prop("disabled", !this.isInterfaceEnabled());
            }
        },

        // single
        opening: function () {
            var el, range, len;

            if (this.opts.minimumResultsForSearch >= 0) {
                this.showSearch(true);
            }

            this.parent.opening.apply(this, arguments);

            if (this.showSearchInput !== false) {
                // IE appends focusser.val() at the end of field :/ so we manually insert it at the beginning using a range
                // all other browsers handle this just fine

                this.search.val(this.focusser.val());
            }
            if (this.opts.shouldFocusInput(this)) {
                this.search.focus();
                // move the cursor to the end after focussing, otherwise it will be at the beginning and
                // new text will appear *before* focusser.val()
                el = this.search.get(0);
                if (el.createTextRange) {
                    range = el.createTextRange();
                    range.collapse(false);
                    range.select();
                } else if (el.setSelectionRange) {
                    len = this.search.val().length;
                    el.setSelectionRange(len, len);
                }
            }

            // initializes search's value with nextSearchTerm (if defined by user)
            // ignore nextSearchTerm if the dropdown is opened by the user pressing a letter
            if(this.search.val() === "") {
                if(this.nextSearchTerm != undefined){
                    this.search.val(this.nextSearchTerm);
                    this.search.select();
                }
            }

            this.focusser.prop("disabled", true).val("");
            this.updateResults(true);
            this.opts.element.trigger($.Event("select2-open"));
        },

        // single
        close: function () {
            if (!this.opened()) return;
            this.parent.close.apply(this, arguments);

            this.focusser.prop("disabled", false);

            if (this.opts.shouldFocusInput(this)) {
                this.focusser.focus();
            }
        },

        // single
        focus: function () {
            if (this.opened()) {
                this.close();
            } else {
                this.focusser.prop("disabled", false);
                if (this.opts.shouldFocusInput(this)) {
                    this.focusser.focus();
                }
            }
        },

        // single
        isFocused: function () {
            return this.container.hasClass("select2-container-active");
        },

        // single
        cancel: function () {
            this.parent.cancel.apply(this, arguments);
            this.focusser.prop("disabled", false);

            if (this.opts.shouldFocusInput(this)) {
                this.focusser.focus();
            }
        },

        // single
        destroy: function() {
            $("label[for='" + this.focusser.attr('id') + "']")
                .attr('for', this.opts.element.attr("id"));
            this.parent.destroy.apply(this, arguments);

            cleanupJQueryElements.call(this,
                "selection",
                "focusser"
            );
        },

        // single
        initContainer: function () {

            var selection,
                container = this.container,
                dropdown = this.dropdown,
                idSuffix = nextUid(),
                elementLabel;

            if (this.opts.minimumResultsForSearch < 0) {
                this.showSearch(false);
            } else {
                this.showSearch(true);
            }

            this.selection = selection = container.find(".select2-choice");

            this.focusser = container.find(".select2-focusser");

            // add aria associations
            selection.find(".select2-chosen").attr("id", "select2-chosen-"+idSuffix);
            this.focusser.attr("aria-labelledby", "select2-chosen-"+idSuffix);
            this.results.attr("id", "select2-results-"+idSuffix);
            this.search.attr("aria-owns", "select2-results-"+idSuffix);

            // rewrite labels from original element to focusser
            this.focusser.attr("id", "s2id_autogen"+idSuffix);

            elementLabel = $("label[for='" + this.opts.element.attr("id") + "']");
            this.opts.element.focus(this.bind(function () { this.focus(); }));

            this.focusser.prev()
                .text(elementLabel.text())
                .attr('for', this.focusser.attr('id'));

            // Ensure the original element retains an accessible name
            var originalTitle = this.opts.element.attr("title");
            this.opts.element.attr("title", (originalTitle || elementLabel.text()));

            this.focusser.attr("tabindex", this.elementTabIndex);

            // write label for search field using the label from the focusser element
            this.search.attr("id", this.focusser.attr('id') + '_search');

            this.search.prev()
                .text($("label[for='" + this.focusser.attr('id') + "']").text())
                .attr('for', this.search.attr('id'));

            this.search.on("keydown", this.bind(function (e) {
                if (!this.isInterfaceEnabled()) return;

                // filter 229 keyCodes (input method editor is processing key input)
                if (229 == e.keyCode) return;

                if (e.which === KEY.PAGE_UP || e.which === KEY.PAGE_DOWN) {
                    // prevent the page from scrolling
                    killEvent(e);
                    return;
                }

                switch (e.which) {
                    case KEY.UP:
                    case KEY.DOWN:
                        this.moveHighlight((e.which === KEY.UP) ? -1 : 1);
                        killEvent(e);
                        return;
                    case KEY.ENTER:
                        this.selectHighlighted();
                        killEvent(e);
                        return;
                    case KEY.TAB:
                        this.selectHighlighted({noFocus: true});
                        return;
                    case KEY.ESC:
                        this.cancel(e);
                        killEvent(e);
                        return;
                }
            }));

            this.search.on("blur", this.bind(function(e) {
                // a workaround for chrome to keep the search field focussed when the scroll bar is used to scroll the dropdown.
                // without this the search field loses focus which is annoying
                if (document.activeElement === this.body.get(0)) {
                    window.setTimeout(this.bind(function() {
                        if (this.opened()) {
                            this.search.focus();
                        }
                    }), 0);
                }
            }));

            this.focusser.on("keydown", this.bind(function (e) {
                if (!this.isInterfaceEnabled()) return;

                if (e.which === KEY.TAB || KEY.isControl(e) || KEY.isFunctionKey(e) || e.which === KEY.ESC) {
                    return;
                }

                if (this.opts.openOnEnter === false && e.which === KEY.ENTER) {
                    killEvent(e);
                    return;
                }

                if (e.which == KEY.DOWN || e.which == KEY.UP
                    || (e.which == KEY.ENTER && this.opts.openOnEnter)) {

                    if (e.altKey || e.ctrlKey || e.shiftKey || e.metaKey) return;

                    this.open();
                    killEvent(e);
                    return;
                }

                if (e.which == KEY.DELETE || e.which == KEY.BACKSPACE) {
                    if (this.opts.allowClear) {
                        this.clear();
                    }
                    killEvent(e);
                    return;
                }
            }));


            installKeyUpChangeEvent(this.focusser);
            this.focusser.on("keyup-change input", this.bind(function(e) {
                if (this.opts.minimumResultsForSearch >= 0) {
                    e.stopPropagation();
                    if (this.opened()) return;
                    this.open();
                }
            }));

            selection.on("mousedown touchstart", "abbr", this.bind(function (e) {
                if (!this.isInterfaceEnabled()) {
                    return;
                }

                this.clear();
                killEventImmediately(e);
                this.close();

                if (this.selection) {
                    this.selection.focus();
                }
            }));

            selection.on("mousedown touchstart", this.bind(function (e) {
                // Prevent IE from generating a click event on the body
                reinsertElement(selection);

                if (!this.container.hasClass("select2-container-active")) {
                    this.opts.element.trigger($.Event("select2-focus"));
                }

                if (this.opened()) {
                    this.close();
                } else if (this.isInterfaceEnabled()) {
                    this.open();
                }

                killEvent(e);
            }));

            dropdown.on("mousedown touchstart", this.bind(function() {
                if (this.opts.shouldFocusInput(this)) {
                    this.search.focus();
                }
            }));

            selection.on("focus", this.bind(function(e) {
                killEvent(e);
            }));

            this.focusser.on("focus", this.bind(function(){
                if (!this.container.hasClass("select2-container-active")) {
                    this.opts.element.trigger($.Event("select2-focus"));
                }
                this.container.addClass("select2-container-active");
            })).on("blur", this.bind(function() {
                if (!this.opened()) {
                    this.container.removeClass("select2-container-active");
                    this.opts.element.trigger($.Event("select2-blur"));
                }
            }));
            this.search.on("focus", this.bind(function(){
                if (!this.container.hasClass("select2-container-active")) {
                    this.opts.element.trigger($.Event("select2-focus"));
                }
                this.container.addClass("select2-container-active");
            }));

            this.initContainerWidth();
            this.opts.element.hide();
            this.setPlaceholder();

        },

        // single
        clear: function(triggerChange) {
            var data=this.selection.data("select2-data");
            if (data) { // guard against queued quick consecutive clicks
                var evt = $.Event("select2-clearing");
                this.opts.element.trigger(evt);
                if (evt.isDefaultPrevented()) {
                    return;
                }
                var placeholderOption = this.getPlaceholderOption();
                this.opts.element.val(placeholderOption ? placeholderOption.val() : "");
                this.selection.find(".select2-chosen").empty();
                this.selection.removeData("select2-data");
                this.setPlaceholder();

                if (triggerChange !== false){
                    this.opts.element.trigger({ type: "select2-removed", val: this.id(data), choice: data });
                    this.triggerChange({removed:data});
                }
            }
        },

        /**
         * Sets selection based on source element's value
         */
        // single
        initSelection: function () {
            var selected;
            if (this.isPlaceholderOptionSelected()) {
                this.updateSelection(null);
                this.close();
                this.setPlaceholder();
            } else {
                var self = this;
                this.opts.initSelection.call(null, this.opts.element, function(selected){
                    if (selected !== undefined && selected !== null) {
                        self.updateSelection(selected);
                        self.close();
                        self.setPlaceholder();
                        self.nextSearchTerm = self.opts.nextSearchTerm(selected, self.search.val());
                    }
                });
            }
        },

        isPlaceholderOptionSelected: function() {
            var placeholderOption;
            if (this.getPlaceholder() === undefined) return false; // no placeholder specified so no option should be considered
            return ((placeholderOption = this.getPlaceholderOption()) !== undefined && placeholderOption.prop("selected"))
                || (this.opts.element.val() === "")
                || (this.opts.element.val() === undefined)
                || (this.opts.element.val() === null);
        },

        // single
        prepareOpts: function () {
            var opts = this.parent.prepareOpts.apply(this, arguments),
                self=this;

            if (opts.element.get(0).tagName.toLowerCase() === "select") {
                // install the selection initializer
                opts.initSelection = function (element, callback) {
                    var selected = element.find("option").filter(function() { return this.selected && !this.disabled });
                    // a single select box always has a value, no need to null check 'selected'
                    callback(self.optionToData(selected));
                };
            } else if ("data" in opts) {
                // install default initSelection when applied to hidden input and data is local
                opts.initSelection = opts.initSelection || function (element, callback) {
                    var id = element.val();
                    //search in data by id, storing the actual matching item
                    var match = null;
                    opts.query({
                        matcher: function(term, text, el){
                            var is_match = equal(id, opts.id(el));
                            if (is_match) {
                                match = el;
                            }
                            return is_match;
                        },
                        callback: !$.isFunction(callback) ? $.noop : function() {
                            callback(match);
                        }
                    });
                };
            }

            return opts;
        },

        // single
        getPlaceholder: function() {
            // if a placeholder is specified on a single select without a valid placeholder option ignore it
            if (this.select) {
                if (this.getPlaceholderOption() === undefined) {
                    return undefined;
                }
            }

            return this.parent.getPlaceholder.apply(this, arguments);
        },

        // single
        setPlaceholder: function () {
            var placeholder = this.getPlaceholder();

            if (this.isPlaceholderOptionSelected() && placeholder !== undefined) {

                // check for a placeholder option if attached to a select
                if (this.select && this.getPlaceholderOption() === undefined) return;

                this.selection.find(".select2-chosen").html(this.opts.escapeMarkup(placeholder));

                this.selection.addClass("select2-default");

                this.container.removeClass("select2-allowclear");
            }
        },

        // single
        postprocessResults: function (data, initial, noHighlightUpdate) {
            var selected = 0, self = this, showSearchInput = true;

            // find the selected element in the result list

            this.findHighlightableChoices().each2(function (i, elm) {
                if (equal(self.id(elm.data("select2-data")), self.opts.element.val())) {
                    selected = i;
                    return false;
                }
            });

            // and highlight it
            if (noHighlightUpdate !== false) {
                if (initial === true && selected >= 0) {
                    this.highlight(selected);
                } else {
                    this.highlight(0);
                }
            }

            // hide the search box if this is the first we got the results and there are enough of them for search

            if (initial === true) {
                var min = this.opts.minimumResultsForSearch;
                if (min >= 0) {
                    this.showSearch(countResults(data.results) >= min);
                }
            }
        },

        // single
        showSearch: function(showSearchInput) {
            if (this.showSearchInput === showSearchInput) return;

            this.showSearchInput = showSearchInput;

            this.dropdown.find(".select2-search").toggleClass("select2-search-hidden", !showSearchInput);
            this.dropdown.find(".select2-search").toggleClass("select2-offscreen", !showSearchInput);
            //add "select2-with-searchbox" to the container if search box is shown
            $(this.dropdown, this.container).toggleClass("select2-with-searchbox", showSearchInput);
        },

        // single
        onSelect: function (data, options) {

            if (!this.triggerSelect(data)) { return; }

            var old = this.opts.element.val(),
                oldData = this.data();

            this.opts.element.val(this.id(data));
            this.updateSelection(data);

            this.opts.element.trigger({ type: "select2-selected", val: this.id(data), choice: data });

            this.nextSearchTerm = this.opts.nextSearchTerm(data, this.search.val());
            this.close();

            if ((!options || !options.noFocus) && this.opts.shouldFocusInput(this)) {
                this.focusser.focus();
            }

            if (!equal(old, this.id(data))) {
                this.triggerChange({ added: data, removed: oldData });
            }
        },

        // single
        updateSelection: function (data) {

            var container=this.selection.find(".select2-chosen"), formatted, cssClass;

            this.selection.data("select2-data", data);

            container.empty();
            if (data !== null) {
                formatted=this.opts.formatSelection(data, container, this.opts.escapeMarkup);
            }
            if (formatted !== undefined) {
                container.append(formatted);
            }
            cssClass=this.opts.formatSelectionCssClass(data, container);
            if (cssClass !== undefined) {
                container.addClass(cssClass);
            }

            this.selection.removeClass("select2-default");

            if (this.opts.allowClear && this.getPlaceholder() !== undefined) {
                this.container.addClass("select2-allowclear");
            }
        },

        // single
        val: function () {
            var val,
                triggerChange = false,
                data = null,
                self = this,
                oldData = this.data();

            if (arguments.length === 0) {
                return this.opts.element.val();
            }

            val = arguments[0];

            if (arguments.length > 1) {
                triggerChange = arguments[1];
            }

            if (this.select) {
                this.select
                    .val(val)
                    .find("option").filter(function() { return this.selected }).each2(function (i, elm) {
                        data = self.optionToData(elm);
                        return false;
                    });
                this.updateSelection(data);
                this.setPlaceholder();
                if (triggerChange) {
                    this.triggerChange({added: data, removed:oldData});
                }
            } else {
                // val is an id. !val is true for [undefined,null,'',0] - 0 is legal
                if (!val && val !== 0) {
                    this.clear(triggerChange);
                    return;
                }
                if (this.opts.initSelection === undefined) {
                    throw new Error("cannot call val() if initSelection() is not defined");
                }
                this.opts.element.val(val);
                this.opts.initSelection(this.opts.element, function(data){
                    self.opts.element.val(!data ? "" : self.id(data));
                    self.updateSelection(data);
                    self.setPlaceholder();
                    if (triggerChange) {
                        self.triggerChange({added: data, removed:oldData});
                    }
                });
            }
        },

        // single
        clearSearch: function () {
            this.search.val("");
            this.focusser.val("");
        },

        // single
        data: function(value) {
            var data,
                triggerChange = false;

            if (arguments.length === 0) {
                data = this.selection.data("select2-data");
                if (data == undefined) data = null;
                return data;
            } else {
                if (arguments.length > 1) {
                    triggerChange = arguments[1];
                }
                if (!value) {
                    this.clear(triggerChange);
                } else {
                    data = this.data();
                    this.opts.element.val(!value ? "" : this.id(value));
                    this.updateSelection(value);
                    if (triggerChange) {
                        this.triggerChange({added: value, removed:data});
                    }
                }
            }
        }
    });

    MultiSelect2 = clazz(AbstractSelect2, {

        // multi
        createContainer: function () {
            var container = $(document.createElement("div")).attr({
                "class": "select2-container select2-container-multi"
            }).html([
                "<ul class='select2-choices'>",
                "  <li class='select2-search-field'>",
                "    <label for='' class='select2-offscreen'></label>",
                "    <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'>",
                "  </li>",
                "</ul>",
                "<div class='select2-drop select2-drop-multi select2-display-none'>",
                "   <ul class='select2-results'>",
                "   </ul>",
                "</div>"].join(""));
            return container;
        },

        // multi
        prepareOpts: function () {
            var opts = this.parent.prepareOpts.apply(this, arguments),
                self=this;

            // TODO validate placeholder is a string if specified
            if (opts.element.get(0).tagName.toLowerCase() === "select") {
                // install the selection initializer
                opts.initSelection = function (element, callback) {

                    var data = [];

                    element.find("option").filter(function() { return this.selected && !this.disabled }).each2(function (i, elm) {
                        data.push(self.optionToData(elm));
                    });
                    callback(data);
                };
            } else if ("data" in opts) {
                // install default initSelection when applied to hidden input and data is local
                opts.initSelection = opts.initSelection || function (element, callback) {
                    var ids = splitVal(element.val(), opts.separator, opts.transformVal);
                    //search in data by array of ids, storing matching items in a list
                    var matches = [];
                    opts.query({
                        matcher: function(term, text, el){
                            var is_match = $.grep(ids, function(id) {
                                return equal(id, opts.id(el));
                            }).length;
                            if (is_match) {
                                matches.push(el);
                            }
                            return is_match;
                        },
                        callback: !$.isFunction(callback) ? $.noop : function() {
                            // reorder matches based on the order they appear in the ids array because right now
                            // they are in the order in which they appear in data array
                            var ordered = [];
                            for (var i = 0; i < ids.length; i++) {
                                var id = ids[i];
                                for (var j = 0; j < matches.length; j++) {
                                    var match = matches[j];
                                    if (equal(id, opts.id(match))) {
                                        ordered.push(match);
                                        matches.splice(j, 1);
                                        break;
                                    }
                                }
                            }
                            callback(ordered);
                        }
                    });
                };
            }

            return opts;
        },

        // multi
        selectChoice: function (choice) {

            var selected = this.container.find(".select2-search-choice-focus");
            if (selected.length && choice && choice[0] == selected[0]) {

            } else {
                if (selected.length) {
                    this.opts.element.trigger("choice-deselected", selected);
                }
                selected.removeClass("select2-search-choice-focus");
                if (choice && choice.length) {
                    this.close();
                    choice.addClass("select2-search-choice-focus");
                    this.opts.element.trigger("choice-selected", choice);
                }
            }
        },

        // multi
        destroy: function() {
            $("label[for='" + this.search.attr('id') + "']")
                .attr('for', this.opts.element.attr("id"));
            this.parent.destroy.apply(this, arguments);

            cleanupJQueryElements.call(this,
                "searchContainer",
                "selection"
            );
        },

        // multi
        initContainer: function () {

            var selector = ".select2-choices", selection;

            this.searchContainer = this.container.find(".select2-search-field");
            this.selection = selection = this.container.find(selector);

            var _this = this;
            this.selection.on("click", ".select2-container:not(.select2-container-disabled) .select2-search-choice:not(.select2-locked)", function (e) {
                _this.search[0].focus();
                _this.selectChoice($(this));
            });

            // rewrite labels from original element to focusser
            this.search.attr("id", "s2id_autogen"+nextUid());

            this.search.prev()
                .text($("label[for='" + this.opts.element.attr("id") + "']").text())
                .attr('for', this.search.attr('id'));
            this.opts.element.focus(this.bind(function () { this.focus(); }));

            this.search.on("input paste", this.bind(function() {
                if (this.search.attr('placeholder') && this.search.val().length == 0) return;
                if (!this.isInterfaceEnabled()) return;
                if (!this.opened()) {
                    this.open();
                }
            }));

            this.search.attr("tabindex", this.elementTabIndex);

            this.keydowns = 0;
            this.search.on("keydown", this.bind(function (e) {
                if (!this.isInterfaceEnabled()) return;

                ++this.keydowns;
                var selected = selection.find(".select2-search-choice-focus");
                var prev = selected.prev(".select2-search-choice:not(.select2-locked)");
                var next = selected.next(".select2-search-choice:not(.select2-locked)");
                var pos = getCursorInfo(this.search);

                if (selected.length &&
                    (e.which == KEY.LEFT || e.which == KEY.RIGHT || e.which == KEY.BACKSPACE || e.which == KEY.DELETE || e.which == KEY.ENTER)) {
                    var selectedChoice = selected;
                    if (e.which == KEY.LEFT && prev.length) {
                        selectedChoice = prev;
                    }
                    else if (e.which == KEY.RIGHT) {
                        selectedChoice = next.length ? next : null;
                    }
                    else if (e.which === KEY.BACKSPACE) {
                        if (this.unselect(selected.first())) {
                            this.search.width(10);
                            selectedChoice = prev.length ? prev : next;
                        }
                    } else if (e.which == KEY.DELETE) {
                        if (this.unselect(selected.first())) {
                            this.search.width(10);
                            selectedChoice = next.length ? next : null;
                        }
                    } else if (e.which == KEY.ENTER) {
                        selectedChoice = null;
                    }

                    this.selectChoice(selectedChoice);
                    killEvent(e);
                    if (!selectedChoice || !selectedChoice.length) {
                        this.open();
                    }
                    return;
                } else if (((e.which === KEY.BACKSPACE && this.keydowns == 1)
                    || e.which == KEY.LEFT) && (pos.offset == 0 && !pos.length)) {

                    this.selectChoice(selection.find(".select2-search-choice:not(.select2-locked)").last());
                    killEvent(e);
                    return;
                } else {
                    this.selectChoice(null);
                }

                if (this.opened()) {
                    switch (e.which) {
                    case KEY.UP:
                    case KEY.DOWN:
                        this.moveHighlight((e.which === KEY.UP) ? -1 : 1);
                        killEvent(e);
                        return;
                    case KEY.ENTER:
                        this.selectHighlighted();
                        killEvent(e);
                        return;
                    case KEY.TAB:
                        this.selectHighlighted({noFocus:true});
                        this.close();
                        return;
                    case KEY.ESC:
                        this.cancel(e);
                        killEvent(e);
                        return;
                    }
                }

                if (e.which === KEY.TAB || KEY.isControl(e) || KEY.isFunctionKey(e)
                 || e.which === KEY.BACKSPACE || e.which === KEY.ESC) {
                    return;
                }

                if (e.which === KEY.ENTER) {
                    if (this.opts.openOnEnter === false) {
                        return;
                    } else if (e.altKey || e.ctrlKey || e.shiftKey || e.metaKey) {
                        return;
                    }
                }

                this.open();

                if (e.which === KEY.PAGE_UP || e.which === KEY.PAGE_DOWN) {
                    // prevent the page from scrolling
                    killEvent(e);
                }

                if (e.which === KEY.ENTER) {
                    // prevent form from being submitted
                    killEvent(e);
                }

            }));

            this.search.on("keyup", this.bind(function (e) {
                this.keydowns = 0;
                this.resizeSearch();
            })
            );

            this.search.on("blur", this.bind(function(e) {
                this.container.removeClass("select2-container-active");
                this.search.removeClass("select2-focused");
                this.selectChoice(null);
                if (!this.opened()) this.clearSearch();
                e.stopImmediatePropagation();
                this.opts.element.trigger($.Event("select2-blur"));
            }));

            this.container.on("click", selector, this.bind(function (e) {
                if (!this.isInterfaceEnabled()) return;
                if ($(e.target).closest(".select2-search-choice").length > 0) {
                    // clicked inside a select2 search choice, do not open
                    return;
                }
                this.selectChoice(null);
                this.clearPlaceholder();
                if (!this.container.hasClass("select2-container-active")) {
                    this.opts.element.trigger($.Event("select2-focus"));
                }
                this.open();
                this.focusSearch();
                e.preventDefault();
            }));

            this.container.on("focus", selector, this.bind(function () {
                if (!this.isInterfaceEnabled()) return;
                if (!this.container.hasClass("select2-container-active")) {
                    this.opts.element.trigger($.Event("select2-focus"));
                }
                this.container.addClass("select2-container-active");
                this.dropdown.addClass("select2-drop-active");
                this.clearPlaceholder();
            }));

            this.initContainerWidth();
            this.opts.element.hide();

            // set the placeholder if necessary
            this.clearSearch();
        },

        // multi
        enableInterface: function() {
            if (this.parent.enableInterface.apply(this, arguments)) {
                this.search.prop("disabled", !this.isInterfaceEnabled());
            }
        },

        // multi
        initSelection: function () {
            var data;
            if (this.opts.element.val() === "" && this.opts.element.text() === "") {
                this.updateSelection([]);
                this.close();
                // set the placeholder if necessary
                this.clearSearch();
            }
            if (this.select || this.opts.element.val() !== "") {
                var self = this;
                this.opts.initSelection.call(null, this.opts.element, function(data){
                    if (data !== undefined && data !== null) {
                        self.updateSelection(data);
                        self.close();
                        // set the placeholder if necessary
                        self.clearSearch();
                    }
                });
            }
        },

        // multi
        clearSearch: function () {
            var placeholder = this.getPlaceholder(),
                maxWidth = this.getMaxSearchWidth();

            if (placeholder !== undefined  && this.getVal().length === 0 && this.search.hasClass("select2-focused") === false) {
                this.search.val(placeholder).addClass("select2-default");
                // stretch the search box to full width of the container so as much of the placeholder is visible as possible
                // we could call this.resizeSearch(), but we do not because that requires a sizer and we do not want to create one so early because of a firefox bug, see #944
                this.search.width(maxWidth > 0 ? maxWidth : this.container.css("width"));
            } else {
                this.search.val("").width(10);
            }
        },

        // multi
        clearPlaceholder: function () {
            if (this.search.hasClass("select2-default")) {
                this.search.val("").removeClass("select2-default");
            }
        },

        // multi
        opening: function () {
            this.clearPlaceholder(); // should be done before super so placeholder is not used to search
            this.resizeSearch();

            this.parent.opening.apply(this, arguments);

            this.focusSearch();

            // initializes search's value with nextSearchTerm (if defined by user)
            // ignore nextSearchTerm if the dropdown is opened by the user pressing a letter
            if(this.search.val() === "") {
                if(this.nextSearchTerm != undefined){
                    this.search.val(this.nextSearchTerm);
                    this.search.select();
                }
            }

            this.updateResults(true);
            if (this.opts.shouldFocusInput(this)) {
                this.search.focus();
            }
            this.opts.element.trigger($.Event("select2-open"));
        },

        // multi
        close: function () {
            if (!this.opened()) return;
            this.parent.close.apply(this, arguments);
        },

        // multi
        focus: function () {
            this.close();
            this.search.focus();
        },

        // multi
        isFocused: function () {
            return this.search.hasClass("select2-focused");
        },

        // multi
        updateSelection: function (data) {
            var ids = [], filtered = [], self = this;

            // filter out duplicates
            $(data).each(function () {
                if (indexOf(self.id(this), ids) < 0) {
                    ids.push(self.id(this));
                    filtered.push(this);
                }
            });
            data = filtered;

            this.selection.find(".select2-search-choice").remove();
            $(data).each(function () {
                self.addSelectedChoice(this);
            });
            self.postprocessResults();
        },

        // multi
        tokenize: function() {
            var input = this.search.val();
            input = this.opts.tokenizer.call(this, input, this.data(), this.bind(this.onSelect), this.opts);
            if (input != null && input != undefined) {
                this.search.val(input);
                if (input.length > 0) {
                    this.open();
                }
            }

        },

        // multi
        onSelect: function (data, options) {

            if (!this.triggerSelect(data) || data.text === "") { return; }

            this.addSelectedChoice(data);

            this.opts.element.trigger({ type: "selected", val: this.id(data), choice: data });

            // keep track of the search's value before it gets cleared
            this.nextSearchTerm = this.opts.nextSearchTerm(data, this.search.val());

            this.clearSearch();
            this.updateResults();

            if (this.select || !this.opts.closeOnSelect) this.postprocessResults(data, false, this.opts.closeOnSelect===true);

            if (this.opts.closeOnSelect) {
                this.close();
                this.search.width(10);
            } else {
                if (this.countSelectableResults()>0) {
                    this.search.width(10);
                    this.resizeSearch();
                    if (this.getMaximumSelectionSize() > 0 && this.val().length >= this.getMaximumSelectionSize()) {
                        // if we reached max selection size repaint the results so choices
                        // are replaced with the max selection reached message
                        this.updateResults(true);
                    } else {
                        // initializes search's value with nextSearchTerm and update search result
                        if(this.nextSearchTerm != undefined){
                            this.search.val(this.nextSearchTerm);
                            this.updateResults();
                            this.search.select();
                        }
                    }
                    this.positionDropdown();
                } else {
                    // if nothing left to select close
                    this.close();
                    this.search.width(10);
                }
            }

            // since its not possible to select an element that has already been
            // added we do not need to check if this is a new element before firing change
            this.triggerChange({ added: data });

            if (!options || !options.noFocus)
                this.focusSearch();
        },

        // multi
        cancel: function () {
            this.close();
            this.focusSearch();
        },

        addSelectedChoice: function (data) {
            var enableChoice = !data.locked,
                enabledItem = $(
                    "<li class='select2-search-choice'>" +
                    "    <div></div>" +
                    "    <a href='#' class='select2-search-choice-close' tabindex='-1'></a>" +
                    "</li>"),
                disabledItem = $(
                    "<li class='select2-search-choice select2-locked'>" +
                    "<div></div>" +
                    "</li>");
            var choice = enableChoice ? enabledItem : disabledItem,
                id = this.id(data),
                val = this.getVal(),
                formatted,
                cssClass;

            formatted=this.opts.formatSelection(data, choice.find("div"), this.opts.escapeMarkup);
            if (formatted != undefined) {
                choice.find("div").replaceWith($("<div></div>").html(formatted));
            }
            cssClass=this.opts.formatSelectionCssClass(data, choice.find("div"));
            if (cssClass != undefined) {
                choice.addClass(cssClass);
            }

            if(enableChoice){
              choice.find(".select2-search-choice-close")
                  .on("mousedown", killEvent)
                  .on("click dblclick", this.bind(function (e) {
                  if (!this.isInterfaceEnabled()) return;

                  this.unselect($(e.target));
                  this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");
                  killEvent(e);
                  this.close();
                  this.focusSearch();
              })).on("focus", this.bind(function () {
                  if (!this.isInterfaceEnabled()) return;
                  this.container.addClass("select2-container-active");
                  this.dropdown.addClass("select2-drop-active");
              }));
            }

            choice.data("select2-data", data);
            choice.insertBefore(this.searchContainer);

            val.push(id);
            this.setVal(val);
        },

        // multi
        unselect: function (selected) {
            var val = this.getVal(),
                data,
                index;
            selected = selected.closest(".select2-search-choice");

            if (selected.length === 0) {
                throw "Invalid argument: " + selected + ". Must be .select2-search-choice";
            }

            data = selected.data("select2-data");

            if (!data) {
                // prevent a race condition when the 'x' is clicked really fast repeatedly the event can be queued
                // and invoked on an element already removed
                return;
            }

            var evt = $.Event("select2-removing");
            evt.val = this.id(data);
            evt.choice = data;
            this.opts.element.trigger(evt);

            if (evt.isDefaultPrevented()) {
                return false;
            }

            while((index = indexOf(this.id(data), val)) >= 0) {
                val.splice(index, 1);
                this.setVal(val);
                if (this.select) this.postprocessResults();
            }

            selected.remove();

            this.opts.element.trigger({ type: "select2-removed", val: this.id(data), choice: data });
            this.triggerChange({ removed: data });

            return true;
        },

        // multi
        postprocessResults: function (data, initial, noHighlightUpdate) {
            var val = this.getVal(),
                choices = this.results.find(".select2-result"),
                compound = this.results.find(".select2-result-with-children"),
                self = this;

            choices.each2(function (i, choice) {
                var id = self.id(choice.data("select2-data"));
                if (indexOf(id, val) >= 0) {
                    choice.addClass("select2-selected");
                    // mark all children of the selected parent as selected
                    choice.find(".select2-result-selectable").addClass("select2-selected");
                }
            });

            compound.each2(function(i, choice) {
                // hide an optgroup if it doesn't have any selectable children
                if (!choice.is('.select2-result-selectable')
                    && choice.find(".select2-result-selectable:not(.select2-selected)").length === 0) {
                    choice.addClass("select2-selected");
                }
            });

            if (this.highlight() == -1 && noHighlightUpdate !== false && this.opts.closeOnSelect === true){
                self.highlight(0);
            }

            //If all results are chosen render formatNoMatches
            if(!this.opts.createSearchChoice && !choices.filter('.select2-result:not(.select2-selected)').length > 0){
                if(!data || data && !data.more && this.results.find(".select2-no-results").length === 0) {
                    if (checkFormatter(self.opts.formatNoMatches, "formatNoMatches")) {
                        this.results.append("<li class='select2-no-results'>" + evaluate(self.opts.formatNoMatches, self.opts.element, self.search.val()) + "</li>");
                    }
                }
            }

        },

        // multi
        getMaxSearchWidth: function() {
            return this.selection.width() - getSideBorderPadding(this.search);
        },

        // multi
        resizeSearch: function () {
            var minimumWidth, left, maxWidth, containerLeft, searchWidth,
                sideBorderPadding = getSideBorderPadding(this.search);

            minimumWidth = measureTextWidth(this.search) + 10;

            left = this.search.offset().left;

            maxWidth = this.selection.width();
            containerLeft = this.selection.offset().left;

            searchWidth = maxWidth - (left - containerLeft) - sideBorderPadding;

            if (searchWidth < minimumWidth) {
                searchWidth = maxWidth - sideBorderPadding;
            }

            if (searchWidth < 40) {
                searchWidth = maxWidth - sideBorderPadding;
            }

            if (searchWidth <= 0) {
              searchWidth = minimumWidth;
            }

            this.search.width(Math.floor(searchWidth));
        },

        // multi
        getVal: function () {
            var val;
            if (this.select) {
                val = this.select.val();
                return val === null ? [] : val;
            } else {
                val = this.opts.element.val();
                return splitVal(val, this.opts.separator, this.opts.transformVal);
            }
        },

        // multi
        setVal: function (val) {
            var unique;
            if (this.select) {
                this.select.val(val);
            } else {
                unique = [];
                // filter out duplicates
                $(val).each(function () {
                    if (indexOf(this, unique) < 0) unique.push(this);
                });
                this.opts.element.val(unique.length === 0 ? "" : unique.join(this.opts.separator));
            }
        },

        // multi
        buildChangeDetails: function (old, current) {
            var current = current.slice(0),
                old = old.slice(0);

            // remove intersection from each array
            for (var i = 0; i < current.length; i++) {
                for (var j = 0; j < old.length; j++) {
                    if (equal(this.opts.id(current[i]), this.opts.id(old[j]))) {
                        current.splice(i, 1);
                        if(i>0){
                            i--;
                        }
                        old.splice(j, 1);
                        j--;
                    }
                }
            }

            return {added: current, removed: old};
        },


        // multi
        val: function (val, triggerChange) {
            var oldData, self=this;

            if (arguments.length === 0) {
                return this.getVal();
            }

            oldData=this.data();
            if (!oldData.length) oldData=[];

            // val is an id. !val is true for [undefined,null,'',0] - 0 is legal
            if (!val && val !== 0) {
                this.opts.element.val("");
                this.updateSelection([]);
                this.clearSearch();
                if (triggerChange) {
                    this.triggerChange({added: this.data(), removed: oldData});
                }
                return;
            }

            // val is a list of ids
            this.setVal(val);

            if (this.select) {
                this.opts.initSelection(this.select, this.bind(this.updateSelection));
                if (triggerChange) {
                    this.triggerChange(this.buildChangeDetails(oldData, this.data()));
                }
            } else {
                if (this.opts.initSelection === undefined) {
                    throw new Error("val() cannot be called if initSelection() is not defined");
                }

                this.opts.initSelection(this.opts.element, function(data){
                    var ids=$.map(data, self.id);
                    self.setVal(ids);
                    self.updateSelection(data);
                    self.clearSearch();
                    if (triggerChange) {
                        self.triggerChange(self.buildChangeDetails(oldData, self.data()));
                    }
                });
            }
            this.clearSearch();
        },

        // multi
        onSortStart: function() {
            if (this.select) {
                throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");
            }

            // collapse search field into 0 width so its container can be collapsed as well
            this.search.width(0);
            // hide the container
            this.searchContainer.hide();
        },

        // multi
        onSortEnd:function() {

            var val=[], self=this;

            // show search and move it to the end of the list
            this.searchContainer.show();
            // make sure the search container is the last item in the list
            this.searchContainer.appendTo(this.searchContainer.parent());
            // since we collapsed the width in dragStarted, we resize it here
            this.resizeSearch();

            // update selection
            this.selection.find(".select2-search-choice").each(function() {
                val.push(self.opts.id($(this).data("select2-data")));
            });
            this.setVal(val);
            this.triggerChange();
        },

        // multi
        data: function(values, triggerChange) {
            var self=this, ids, old;
            if (arguments.length === 0) {
                 return this.selection
                     .children(".select2-search-choice")
                     .map(function() { return $(this).data("select2-data"); })
                     .get();
            } else {
                old = this.data();
                if (!values) { values = []; }
                ids = $.map(values, function(e) { return self.opts.id(e); });
                this.setVal(ids);
                this.updateSelection(values);
                this.clearSearch();
                if (triggerChange) {
                    this.triggerChange(this.buildChangeDetails(old, this.data()));
                }
            }
        }
    });

    $.fn.select2 = function () {

        var args = Array.prototype.slice.call(arguments, 0),
            opts,
            select2,
            method, value, multiple,
            allowedMethods = ["val", "destroy", "opened", "open", "close", "focus", "isFocused", "container", "dropdown", "onSortStart", "onSortEnd", "enable", "disable", "readonly", "positionDropdown", "data", "search"],
            valueMethods = ["opened", "isFocused", "container", "dropdown"],
            propertyMethods = ["val", "data"],
            methodsMap = { search: "externalSearch" };

        this.each(function () {
            if (args.length === 0 || typeof(args[0]) === "object") {
                opts = args.length === 0 ? {} : $.extend({}, args[0]);
                opts.element = $(this);

                if (opts.element.get(0).tagName.toLowerCase() === "select") {
                    multiple = opts.element.prop("multiple");
                } else {
                    multiple = opts.multiple || false;
                    if ("tags" in opts) {opts.multiple = multiple = true;}
                }

                select2 = multiple ? new window.Select2["class"].multi() : new window.Select2["class"].single();
                select2.init(opts);
            } else if (typeof(args[0]) === "string") {

                if (indexOf(args[0], allowedMethods) < 0) {
                    throw "Unknown method: " + args[0];
                }

                value = undefined;
                select2 = $(this).data("select2");
                if (select2 === undefined) return;

                method=args[0];

                if (method === "container") {
                    value = select2.container;
                } else if (method === "dropdown") {
                    value = select2.dropdown;
                } else {
                    if (methodsMap[method]) method = methodsMap[method];

                    value = select2[method].apply(select2, args.slice(1));
                }
                if (indexOf(args[0], valueMethods) >= 0
                    || (indexOf(args[0], propertyMethods) >= 0 && args.length == 1)) {
                    return false; // abort the iteration, ready to return first matched value
                }
            } else {
                throw "Invalid arguments to select2 plugin: " + args;
            }
        });
        return (value === undefined) ? this : value;
    };

    // plugin defaults, accessible to users
    $.fn.select2.defaults = {
        width: "copy",
        loadMorePadding: 0,
        closeOnSelect: true,
        openOnEnter: true,
        containerCss: {},
        dropdownCss: {},
        containerCssClass: "",
        dropdownCssClass: "",
        formatResult: function(result, container, query, escapeMarkup) {
            var markup=[];
            markMatch(this.text(result), query.term, markup, escapeMarkup);
            return markup.join("");
        },
        transformVal: function(val) {
            return $.trim(val);
        },
        formatSelection: function (data, container, escapeMarkup) {
            return data ? escapeMarkup(this.text(data)) : undefined;
        },
        sortResults: function (results, container, query) {
            return results;
        },
        formatResultCssClass: function(data) {return data.css;},
        formatSelectionCssClass: function(data, container) {return undefined;},
        minimumResultsForSearch: 0,
        minimumInputLength: 0,
        maximumInputLength: null,
        maximumSelectionSize: 0,
        id: function (e) { return e == undefined ? null : e.id; },
        text: function (e) {
          if (e && this.data && this.data.text) {
            if ($.isFunction(this.data.text)) {
              return this.data.text(e);
            } else {
              return e[this.data.text];
            }
          } else {
            return e.text;
          }
        },
        matcher: function(term, text) {
            return stripDiacritics(''+text).toUpperCase().indexOf(stripDiacritics(''+term).toUpperCase()) >= 0;
        },
        separator: ",",
        tokenSeparators: [],
        tokenizer: defaultTokenizer,
        escapeMarkup: defaultEscapeMarkup,
        blurOnChange: false,
        selectOnBlur: false,
        adaptContainerCssClass: function(c) { return c; },
        adaptDropdownCssClass: function(c) { return null; },
        nextSearchTerm: function(selectedObject, currentSearchTerm) { return undefined; },
        searchInputPlaceholder: '',
        createSearchChoicePosition: 'top',
        shouldFocusInput: function (instance) {
            // Attempt to detect touch devices
            var supportsTouchEvents = (('ontouchstart' in window) ||
                                       (navigator.msMaxTouchPoints > 0));

            // Only devices which support touch events should be special cased
            if (!supportsTouchEvents) {
                return true;
            }

            // Never focus the input if search is disabled
            if (instance.opts.minimumResultsForSearch < 0) {
                return false;
            }

            return true;
        }
    };

    $.fn.select2.locales = [];

    $.fn.select2.locales['en'] = {
         formatMatches: function (matches) { if (matches === 1) { return "One result is available, press enter to select it."; } return matches + " results are available, use up and down arrow keys to navigate."; },
         formatNoMatches: function () { return "No matches found"; },
         formatAjaxError: function (jqXHR, textStatus, errorThrown) { return "Loading failed"; },
         formatInputTooShort: function (input, min) { var n = min - input.length; return "Please enter " + n + " or more character" + (n == 1 ? "" : "s"); },
         formatInputTooLong: function (input, max) { var n = input.length - max; return "Please delete " + n + " character" + (n == 1 ? "" : "s"); },
         formatSelectionTooBig: function (limit) { return "You can only select " + limit + " item" + (limit == 1 ? "" : "s"); },
         formatLoadMore: function (pageNumber) { return "Loading more results"; },
         formatSearching: function () { return "Searching"; }
    };

    $.extend($.fn.select2.defaults, $.fn.select2.locales['en']);

    $.fn.select2.ajaxDefaults = {
        transport: $.ajax,
        params: {
            type: "GET",
            cache: false,
            dataType: "json"
        }
    };

    // exports
    window.Select2 = {
        query: {
            ajax: ajax,
            local: local,
            tags: tags
        }, util: {
            debounce: debounce,
            markMatch: markMatch,
            escapeMarkup: defaultEscapeMarkup,
            stripDiacritics: stripDiacritics
        }, "class": {
            "abstract": AbstractSelect2,
            "single": SingleSelect2,
            "multi": MultiSelect2
        }
    };

}(jQuery));
         20181116154524                                             4D     / * 
 C o p y r i g h t   2 0 1 2   I g o r   V a y n b e r g 
 
 V e r s i o n :   3 . 5 . 2   T i m e s t a m p :   S a t   N o v     1   1 4 : 4 3 : 3 6   E D T   2 0 1 4 
 
 T h i s   s o f t w a r e   i s   l i c e n s e d   u n d e r   t h e   A p a c h e   L i c e n s e ,   V e r s i o n   2 . 0   ( t h e   " A p a c h e   L i c e n s e " )   o r   t h e   G N U 
 G e n e r a l   P u b l i c   L i c e n s e   v e r s i o n   2   ( t h e   " G P L   L i c e n s e " ) .   Y o u   m a y   c h o o s e   e i t h e r   l i c e n s e   t o   g o v e r n   y o u r 
 u s e   o f   t h i s   s o f t w a r e   o n l y   u p o n   t h e   c o n d i t i o n   t h a t   y o u   a c c e p t   a l l   o f   t h e   t e r m s   o f   e i t h e r   t h e   A p a c h e 
 L i c e n s e   o r   t h e   G P L   L i c e n s e . 
 
 Y o u   m a y   o b t a i n   a   c o p y   o f   t h e   A p a c h e   L i c e n s e   a n d   t h e   G P L   L i c e n s e   a t : 
 
         h t t p : / / w w w . a p a c h e . o r g / l i c e n s e s / L I C E N S E - 2 . 0 
         h t t p : / / w w w . g n u . o r g / l i c e n s e s / g p l - 2 . 0 . h t m l 
 
 U n l e s s   r e q u i r e d   b y   a p p l i c a b l e   l a w   o r   a g r e e d   t o   i n   w r i t i n g ,   s o f t w a r e   d i s t r i b u t e d   u n d e r   t h e 
 A p a c h e   L i c e n s e   o r   t h e   G P L   L i c e n s e   i s   d i s t r i b u t e d   o n   a n   " A S   I S "   B A S I S ,   W I T H O U T   W A R R A N T I E S   O R 
 C O N D I T I O N S   O F   A N Y   K I N D ,   e i t h e r   e x p r e s s   o r   i m p l i e d .   S e e   t h e   A p a c h e   L i c e n s e   a n d   t h e   G P L   L i c e n s e   f o r 
 t h e   s p e c i f i c   l a n g u a g e   g o v e r n i n g   p e r m i s s i o n s   a n d   l i m i t a t i o n s   u n d e r   t h e   A p a c h e   L i c e n s e   a n d   t h e   G P L   L i c e n s e . 
 * / 
 ( f u n c t i o n   ( $ )   { 
         i f ( t y p e o f   $ . f n . e a c h 2   = =   " u n d e f i n e d " )   { 
                 $ . e x t e n d ( $ . f n ,   { 
                         / * 
                         *   4 - 1 0   t i m e s   f a s t e r   . e a c h   r e p l a c e m e n t 
                         *   u s e   i t   c a r e f u l l y ,   a s   i t   o v e r r i d e s   j Q u e r y   c o n t e x t   o f   e l e m e n t   o n   e a c h   i t e r a t i o n 
                         * / 
                         e a c h 2   :   f u n c t i o n   ( c )   { 
                                 v a r   j   =   $ ( [ 0 ] ) ,   i   =   - 1 ,   l   =   t h i s . l e n g t h ; 
                                 w h i l e   ( 
                                         + + i   <   l 
                                         & &   ( j . c o n t e x t   =   j [ 0 ]   =   t h i s [ i ] ) 
                                         & &   c . c a l l ( j [ 0 ] ,   i ,   j )   ! = =   f a l s e   / / " t h i s " = D O M ,   i = i n d e x ,   j = j Q u e r y   o b j e c t 
                                 ) ; 
                                 r e t u r n   t h i s ; 
                         } 
                 } ) ; 
         } 
 } ) ( j Q u e r y ) ; 
 
 ( f u n c t i o n   ( $ ,   u n d e f i n e d )   { 
         " u s e   s t r i c t " ; 
         / * g l o b a l   d o c u m e n t ,   w i n d o w ,   j Q u e r y ,   c o n s o l e   * / 
 
         i f   ( w i n d o w . S e l e c t 2   ! = =   u n d e f i n e d )   { 
                 r e t u r n ; 
         } 
 
         v a r   A b s t r a c t S e l e c t 2 ,   S i n g l e S e l e c t 2 ,   M u l t i S e l e c t 2 ,   n e x t U i d ,   s i z e r , 
                 l a s t M o u s e P o s i t i o n = { x : 0 , y : 0 } ,   $ d o c u m e n t ,   s c r o l l B a r D i m e n s i o n s , 
 
         K E Y   =   { 
                 T A B :   9 , 
                 E N T E R :   1 3 , 
                 E S C :   2 7 , 
                 S P A C E :   3 2 , 
                 L E F T :   3 7 , 
                 U P :   3 8 , 
                 R I G H T :   3 9 , 
                 D O W N :   4 0 , 
                 S H I F T :   1 6 , 
                 C T R L :   1 7 , 
                 A L T :   1 8 , 
                 P A G E _ U P :   3 3 , 
                 P A G E _ D O W N :   3 4 , 
                 H O M E :   3 6 , 
                 E N D :   3 5 , 
                 B A C K S P A C E :   8 , 
                 D E L E T E :   4 6 , 
                 i s A r r o w :   f u n c t i o n   ( k )   { 
                         k   =   k . w h i c h   ?   k . w h i c h   :   k ; 
                         s w i t c h   ( k )   { 
                         c a s e   K E Y . L E F T : 
                         c a s e   K E Y . R I G H T : 
                         c a s e   K E Y . U P : 
                         c a s e   K E Y . D O W N : 
                                 r e t u r n   t r u e ; 
                         } 
                         r e t u r n   f a l s e ; 
                 } , 
                 i s C o n t r o l :   f u n c t i o n   ( e )   { 
                         v a r   k   =   e . w h i c h ; 
                         s w i t c h   ( k )   { 
                         c a s e   K E Y . S H I F T : 
                         c a s e   K E Y . C T R L : 
                         c a s e   K E Y . A L T : 
                                 r e t u r n   t r u e ; 
                         } 
 
                         i f   ( e . m e t a K e y )   r e t u r n   t r u e ; 
 
                         r e t u r n   f a l s e ; 
                 } , 
                 i s F u n c t i o n K e y :   f u n c t i o n   ( k )   { 
                         k   =   k . w h i c h   ?   k . w h i c h   :   k ; 
                         r e t u r n   k   > =   1 1 2   & &   k   < =   1 2 3 ; 
                 } 
         } , 
         M E A S U R E _ S C R O L L B A R _ T E M P L A T E   =   " < d i v   c l a s s = ' s e l e c t 2 - m e a s u r e - s c r o l l b a r ' > < / d i v > " , 
 
         D I A C R I T I C S   =   { " \ u 2 4 B 6 " : " A " , " \ u F F 2 1 " : " A " , " \ u 0 0 C 0 " : " A " , " \ u 0 0 C 1 " : " A " , " \ u 0 0 C 2 " : " A " , " \ u 1 E A 6 " : " A " , " \ u 1 E A 4 " : " A " , " \ u 1 E A A " : " A " , " \ u 1 E A 8 " : " A " , " \ u 0 0 C 3 " : " A " , " \ u 0 1 0 0 " : " A " , " \ u 0 1 0 2 " : " A " , " \ u 1 E B 0 " : " A " , " \ u 1 E A E " : " A " , " \ u 1 E B 4 " : " A " , " \ u 1 E B 2 " : " A " , " \ u 0 2 2 6 " : " A " , " \ u 0 1 E 0 " : " A " , " \ u 0 0 C 4 " : " A " , " \ u 0 1 D E " : " A " , " \ u 1 E A 2 " : " A " , " \ u 0 0 C 5 " : " A " , " \ u 0 1 F A " : " A " , " \ u 0 1 C D " : " A " , " \ u 0 2 0 0 " : " A " , " \ u 0 2 0 2 " : " A " , " \ u 1 E A 0 " : " A " , " \ u 1 E A C " : " A " , " \ u 1 E B 6 " : " A " , " \ u 1 E 0 0 " : " A " , " \ u 0 1 0 4 " : " A " , " \ u 0 2 3 A " : " A " , " \ u 2 C 6 F " : " A " , " \ u A 7 3 2 " : " A A " , " \ u 0 0 C 6 " : " A E " , " \ u 0 1 F C " : " A E " , " \ u 0 1 E 2 " : " A E " , " \ u A 7 3 4 " : " A O " , " \ u A 7 3 6 " : " A U " , " \ u A 7 3 8 " : " A V " , " \ u A 7 3 A " : " A V " , " \ u A 7 3 C " : " A Y " , " \ u 2 4 B 7 " : " B " , " \ u F F 2 2 " : " B " , " \ u 1 E 0 2 " : " B " , " \ u 1 E 0 4 " : " B " , " \ u 1 E 0 6 " : " B " , " \ u 0 2 4 3 " : " B " , " \ u 0 1 8 2 " : " B " , " \ u 0 1 8 1 " : " B " , " \ u 2 4 B 8 " : " C " , " \ u F F 2 3 " : " C " , " \ u 0 1 0 6 " : " C " , " \ u 0 1 0 8 " : " C " , " \ u 0 1 0 A " : " C " , " \ u 0 1 0 C " : " C " , " \ u 0 0 C 7 " : " C " , " \ u 1 E 0 8 " : " C " , " \ u 0 1 8 7 " : " C " , " \ u 0 2 3 B " : " C " , " \ u A 7 3 E " : " C " , " \ u 2 4 B 9 " : " D " , " \ u F F 2 4 " : " D " , " \ u 1 E 0 A " : " D " , " \ u 0 1 0 E " : " D " , " \ u 1 E 0 C " : " D " , " \ u 1 E 1 0 " : " D " , " \ u 1 E 1 2 " : " D " , " \ u 1 E 0 E " : " D " , " \ u 0 1 1 0 " : " D " , " \ u 0 1 8 B " : " D " , " \ u 0 1 8 A " : " D " , " \ u 0 1 8 9 " : " D " , " \ u A 7 7 9 " : " D " , " \ u 0 1 F 1 " : " D Z " , " \ u 0 1 C 4 " : " D Z " , " \ u 0 1 F 2 " : " D z " , " \ u 0 1 C 5 " : " D z " , " \ u 2 4 B A " : " E " , " \ u F F 2 5 " : " E " , " \ u 0 0 C 8 " : " E " , " \ u 0 0 C 9 " : " E " , " \ u 0 0 C A " : " E " , " \ u 1 E C 0 " : " E " , " \ u 1 E B E " : " E " , " \ u 1 E C 4 " : " E " , " \ u 1 E C 2 " : " E " , " \ u 1 E B C " : " E " , " \ u 0 1 1 2 " : " E " , " \ u 1 E 1 4 " : " E " , " \ u 1 E 1 6 " : " E " , " \ u 0 1 1 4 " : " E " , " \ u 0 1 1 6 " : " E " , " \ u 0 0 C B " : " E " , " \ u 1 E B A " : " E " , " \ u 0 1 1 A " : " E " , " \ u 0 2 0 4 " : " E " , " \ u 0 2 0 6 " : " E " , " \ u 1 E B 8 " : " E " , " \ u 1 E C 6 " : " E " , " \ u 0 2 2 8 " : " E " , " \ u 1 E 1 C " : " E " , " \ u 0 1 1 8 " : " E " , " \ u 1 E 1 8 " : " E " , " \ u 1 E 1 A " : " E " , " \ u 0 1 9 0 " : " E " , " \ u 0 1 8 E " : " E " , " \ u 2 4 B B " : " F " , " \ u F F 2 6 " : " F " , " \ u 1 E 1 E " : " F " , " \ u 0 1 9 1 " : " F " , " \ u A 7 7 B " : " F " , " \ u 2 4 B C " : " G " , " \ u F F 2 7 " : " G " , " \ u 0 1 F 4 " : " G " , " \ u 0 1 1 C " : " G " , " \ u 1 E 2 0 " : " G " , " \ u 0 1 1 E " : " G " , " \ u 0 1 2 0 " : " G " , " \ u 0 1 E 6 " : " G " , " \ u 0 1 2 2 " : " G " , " \ u 0 1 E 4 " : " G " , " \ u 0 1 9 3 " : " G " , " \ u A 7 A 0 " : " G " , " \ u A 7 7 D " : " G " , " \ u A 7 7 E " : " G " , " \ u 2 4 B D " : " H " , " \ u F F 2 8 " : " H " , " \ u 0 1 2 4 " : " H " , " \ u 1 E 2 2 " : " H " , " \ u 1 E 2 6 " : " H " , " \ u 0 2 1 E " : " H " , " \ u 1 E 2 4 " : " H " , " \ u 1 E 2 8 " : " H " , " \ u 1 E 2 A " : " H " , " \ u 0 1 2 6 " : " H " , " \ u 2 C 6 7 " : " H " , " \ u 2 C 7 5 " : " H " , " \ u A 7 8 D " : " H " , " \ u 2 4 B E " : " I " , " \ u F F 2 9 " : " I " , " \ u 0 0 C C " : " I " , " \ u 0 0 C D " : " I " , " \ u 0 0 C E " : " I " , " \ u 0 1 2 8 " : " I " , " \ u 0 1 2 A " : " I " , " \ u 0 1 2 C " : " I " , " \ u 0 1 3 0 " : " I " , " \ u 0 0 C F " : " I " , " \ u 1 E 2 E " : " I " , " \ u 1 E C 8 " : " I " , " \ u 0 1 C F " : " I " , " \ u 0 2 0 8 " : " I " , " \ u 0 2 0 A " : " I " , " \ u 1 E C A " : " I " , " \ u 0 1 2 E " : " I " , " \ u 1 E 2 C " : " I " , " \ u 0 1 9 7 " : " I " , " \ u 2 4 B F " : " J " , " \ u F F 2 A " : " J " , " \ u 0 1 3 4 " : " J " , " \ u 0 2 4 8 " : " J " , " \ u 2 4 C 0 " : " K " , " \ u F F 2 B " : " K " , " \ u 1 E 3 0 " : " K " , " \ u 0 1 E 8 " : " K " , " \ u 1 E 3 2 " : " K " , " \ u 0 1 3 6 " : " K " , " \ u 1 E 3 4 " : " K " , " \ u 0 1 9 8 " : " K " , " \ u 2 C 6 9 " : " K " , " \ u A 7 4 0 " : " K " , " \ u A 7 4 2 " : " K " , " \ u A 7 4 4 " : " K " , " \ u A 7 A 2 " : " K " , " \ u 2 4 C 1 " : " L " , " \ u F F 2 C " : " L " , " \ u 0 1 3 F " : " L " , " \ u 0 1 3 9 " : " L " , " \ u 0 1 3 D " : " L " , " \ u 1 E 3 6 " : " L " , " \ u 1 E 3 8 " : " L " , " \ u 0 1 3 B " : " L " , " \ u 1 E 3 C " : " L " , " \ u 1 E 3 A " : " L " , " \ u 0 1 4 1 " : " L " , " \ u 0 2 3 D " : " L " , " \ u 2 C 6 2 " : " L " , " \ u 2 C 6 0 " : " L " , " \ u A 7 4 8 " : " L " , " \ u A 7 4 6 " : " L " , " \ u A 7 8 0 " : " L " , " \ u 0 1 C 7 " : " L J " , " \ u 0 1 C 8 " : " L j " , " \ u 2 4 C 2 " : " M " , " \ u F F 2 D " : " M " , " \ u 1 E 3 E " : " M " , " \ u 1 E 4 0 " : " M " , " \ u 1 E 4 2 " : " M " , " \ u 2 C 6 E " : " M " , " \ u 0 1 9 C " : " M " , " \ u 2 4 C 3 " : " N " , " \ u F F 2 E " : " N " , " \ u 0 1 F 8 " : " N " , " \ u 0 1 4 3 " : " N " , " \ u 0 0 D 1 " : " N " , " \ u 1 E 4 4 " : " N " , " \ u 0 1 4 7 " : " N " , " \ u 1 E 4 6 " : " N " , " \ u 0 1 4 5 " : " N " , " \ u 1 E 4 A " : " N " , " \ u 1 E 4 8 " : " N " , " \ u 0 2 2 0 " : " N " , " \ u 0 1 9 D " : " N " , " \ u A 7 9 0 " : " N " , " \ u A 7 A 4 " : " N " , " \ u 0 1 C A " : " N J " , " \ u 0 1 C B " : " N j " , " \ u 2 4 C 4 " : " O " , " \ u F F 2 F " : " O " , " \ u 0 0 D 2 " : " O " , " \ u 0 0 D 3 " : " O " , " \ u 0 0 D 4 " : " O " , " \ u 1 E D 2 " : " O " , " \ u 1 E D 0 " : " O " , " \ u 1 E D 6 " : " O " , " \ u 1 E D 4 " : " O " , " \ u 0 0 D 5 " : " O " , " \ u 1 E 4 C " : " O " , " \ u 0 2 2 C " : " O " , " \ u 1 E 4 E " : " O " , " \ u 0 1 4 C " : " O " , " \ u 1 E 5 0 " : " O " , " \ u 1 E 5 2 " : " O " , " \ u 0 1 4 E " : " O " , " \ u 0 2 2 E " : " O " , " \ u 0 2 3 0 " : " O " , " \ u 0 0 D 6 " : " O " , " \ u 0 2 2 A " : " O " , " \ u 1 E C E " : " O " , " \ u 0 1 5 0 " : " O " , " \ u 0 1 D 1 " : " O " , " \ u 0 2 0 C " : " O " , " \ u 0 2 0 E " : " O " , " \ u 0 1 A 0 " : " O " , " \ u 1 E D C " : " O " , " \ u 1 E D A " : " O " , " \ u 1 E E 0 " : " O " , " \ u 1 E D E " : " O " , " \ u 1 E E 2 " : " O " , " \ u 1 E C C " : " O " , " \ u 1 E D 8 " : " O " , " \ u 0 1 E A " : " O " , " \ u 0 1 E C " : " O " , " \ u 0 0 D 8 " : " O " , " \ u 0 1 F E " : " O " , " \ u 0 1 8 6 " : " O " , " \ u 0 1 9 F " : " O " , " \ u A 7 4 A " : " O " , " \ u A 7 4 C " : " O " , " \ u 0 1 A 2 " : " O I " , " \ u A 7 4 E " : " O O " , " \ u 0 2 2 2 " : " O U " , " \ u 2 4 C 5 " : " P " , " \ u F F 3 0 " : " P " , " \ u 1 E 5 4 " : " P " , " \ u 1 E 5 6 " : " P " , " \ u 0 1 A 4 " : " P " , " \ u 2 C 6 3 " : " P " , " \ u A 7 5 0 " : " P " , " \ u A 7 5 2 " : " P " , " \ u A 7 5 4 " : " P " , " \ u 2 4 C 6 " : " Q " , " \ u F F 3 1 " : " Q " , " \ u A 7 5 6 " : " Q " , " \ u A 7 5 8 " : " Q " , " \ u 0 2 4 A " : " Q " , " \ u 2 4 C 7 " : " R " , " \ u F F 3 2 " : " R " , " \ u 0 1 5 4 " : " R " , " \ u 1 E 5 8 " : " R " , " \ u 0 1 5 8 " : " R " , " \ u 0 2 1 0 " : " R " , " \ u 0 2 1 2 " : " R " , " \ u 1 E 5 A " : " R " , " \ u 1 E 5 C " : " R " , " \ u 0 1 5 6 " : " R " , " \ u 1 E 5 E " : " R " , " \ u 0 2 4 C " : " R " , " \ u 2 C 6 4 " : " R " , " \ u A 7 5 A " : " R " , " \ u A 7 A 6 " : " R " , " \ u A 7 8 2 " : " R " , " \ u 2 4 C 8 " : " S " , " \ u F F 3 3 " : " S " , " \ u 1 E 9 E " : " S " , " \ u 0 1 5 A " : " S " , " \ u 1 E 6 4 " : " S " , " \ u 0 1 5 C " : " S " , " \ u 1 E 6 0 " : " S " , " \ u 0 1 6 0 " : " S " , " \ u 1 E 6 6 " : " S " , " \ u 1 E 6 2 " : " S " , " \ u 1 E 6 8 " : " S " , " \ u 0 2 1 8 " : " S " , " \ u 0 1 5 E " : " S " , " \ u 2 C 7 E " : " S " , " \ u A 7 A 8 " : " S " , " \ u A 7 8 4 " : " S " , " \ u 2 4 C 9 " : " T " , " \ u F F 3 4 " : " T " , " \ u 1 E 6 A " : " T " , " \ u 0 1 6 4 " : " T " , " \ u 1 E 6 C " : " T " , " \ u 0 2 1 A " : " T " , " \ u 0 1 6 2 " : " T " , " \ u 1 E 7 0 " : " T " , " \ u 1 E 6 E " : " T " , " \ u 0 1 6 6 " : " T " , " \ u 0 1 A C " : " T " , " \ u 0 1 A E " : " T " , " \ u 0 2 3 E " : " T " , " \ u A 7 8 6 " : " T " , " \ u A 7 2 8 " : " T Z " , " \ u 2 4 C A " : " U " , " \ u F F 3 5 " : " U " , " \ u 0 0 D 9 " : " U " , " \ u 0 0 D A " : " U " , " \ u 0 0 D B " : " U " , " \ u 0 1 6 8 " : " U " , " \ u 1 E 7 8 " : " U " , " \ u 0 1 6 A " : " U " , " \ u 1 E 7 A " : " U " , " \ u 0 1 6 C " : " U " , " \ u 0 0 D C " : " U " , " \ u 0 1 D B " : " U " , " \ u 0 1 D 7 " : " U " , " \ u 0 1 D 5 " : " U " , " \ u 0 1 D 9 " : " U " , " \ u 1 E E 6 " : " U " , " \ u 0 1 6 E " : " U " , " \ u 0 1 7 0 " : " U " , " \ u 0 1 D 3 " : " U " , " \ u 0 2 1 4 " : " U " , " \ u 0 2 1 6 " : " U " , " \ u 0 1 A F " : " U " , " \ u 1 E E A " : " U " , " \ u 1 E E 8 " : " U " , " \ u 1 E E E " : " U " , " \ u 1 E E C " : " U " , " \ u 1 E F 0 " : " U " , " \ u 1 E E 4 " : " U " , " \ u 1 E 7 2 " : " U " , " \ u 0 1 7 2 " : " U " , " \ u 1 E 7 6 " : " U " , " \ u 1 E 7 4 " : " U " , " \ u 0 2 4 4 " : " U " , " \ u 2 4 C B " : " V " , " \ u F F 3 6 " : " V " , " \ u 1 E 7 C " : " V " , " \ u 1 E 7 E " : " V " , " \ u 0 1 B 2 " : " V " , " \ u A 7 5 E " : " V " , " \ u 0 2 4 5 " : " V " , " \ u A 7 6 0 " : " V Y " , " \ u 2 4 C C " : " W " , " \ u F F 3 7 " : " W " , " \ u 1 E 8 0 " : " W " , " \ u 1 E 8 2 " : " W " , " \ u 0 1 7 4 " : " W " , " \ u 1 E 8 6 " : " W " , " \ u 1 E 8 4 " : " W " , " \ u 1 E 8 8 " : " W " , " \ u 2 C 7 2 " : " W " , " \ u 2 4 C D " : " X " , " \ u F F 3 8 " : " X " , " \ u 1 E 8 A " : " X " , " \ u 1 E 8 C " : " X " , " \ u 2 4 C E " : " Y " , " \ u F F 3 9 " : " Y " , " \ u 1 E F 2 " : " Y " , " \ u 0 0 D D " : " Y " , " \ u 0 1 7 6 " : " Y " , " \ u 1 E F 8 " : " Y " , " \ u 0 2 3 2 " : " Y " , " \ u 1 E 8 E " : " Y " , " \ u 0 1 7 8 " : " Y " , " \ u 1 E F 6 " : " Y " , " \ u 1 E F 4 " : " Y " , " \ u 0 1 B 3 " : " Y " , " \ u 0 2 4 E " : " Y " , " \ u 1 E F E " : " Y " , " \ u 2 4 C F " : " Z " , " \ u F F 3 A " : " Z " , " \ u 0 1 7 9 " : " Z " , " \ u 1 E 9 0 " : " Z " , " \ u 0 1 7 B " : " Z " , " \ u 0 1 7 D " : " Z " , " \ u 1 E 9 2 " : " Z " , " \ u 1 E 9 4 " : " Z " , " \ u 0 1 B 5 " : " Z " , " \ u 0 2 2 4 " : " Z " , " \ u 2 C 7 F " : " Z " , " \ u 2 C 6 B " : " Z " , " \ u A 7 6 2 " : " Z " , " \ u 2 4 D 0 " : " a " , " \ u F F 4 1 " : " a " , " \ u 1 E 9 A " : " a " , " \ u 0 0 E 0 " : " a " , " \ u 0 0 E 1 " : " a " , " \ u 0 0 E 2 " : " a " , " \ u 1 E A 7 " : " a " , " \ u 1 E A 5 " : " a " , " \ u 1 E A B " : " a " , " \ u 1 E A 9 " : " a " , " \ u 0 0 E 3 " : " a " , " \ u 0 1 0 1 " : " a " , " \ u 0 1 0 3 " : " a " , " \ u 1 E B 1 " : " a " , " \ u 1 E A F " : " a " , " \ u 1 E B 5 " : " a " , " \ u 1 E B 3 " : " a " , " \ u 0 2 2 7 " : " a " , " \ u 0 1 E 1 " : " a " , " \ u 0 0 E 4 " : " a " , " \ u 0 1 D F " : " a " , " \ u 1 E A 3 " : " a " , " \ u 0 0 E 5 " : " a " , " \ u 0 1 F B " : " a " , " \ u 0 1 C E " : " a " , " \ u 0 2 0 1 " : " a " , " \ u 0 2 0 3 " : " a " , " \ u 1 E A 1 " : " a " , " \ u 1 E A D " : " a " , " \ u 1 E B 7 " : " a " , " \ u 1 E 0 1 " : " a " , " \ u 0 1 0 5 " : " a " , " \ u 2 C 6 5 " : " a " , " \ u 0 2 5 0 " : " a " , " \ u A 7 3 3 " : " a a " , " \ u 0 0 E 6 " : " a e " , " \ u 0 1 F D " : " a e " , " \ u 0 1 E 3 " : " a e " , " \ u A 7 3 5 " : " a o " , " \ u A 7 3 7 " : " a u " , " \ u A 7 3 9 " : " a v " , " \ u A 7 3 B " : " a v " , " \ u A 7 3 D " : " a y " , " \ u 2 4 D 1 " : " b " , " \ u F F 4 2 " : " b " , " \ u 1 E 0 3 " : " b " , " \ u 1 E 0 5 " : " b " , " \ u 1 E 0 7 " : " b " , " \ u 0 1 8 0 " : " b " , " \ u 0 1 8 3 " : " b " , " \ u 0 2 5 3 " : " b " , " \ u 2 4 D 2 " : " c " , " \ u F F 4 3 " : " c " , " \ u 0 1 0 7 " : " c " , " \ u 0 1 0 9 " : " c " , " \ u 0 1 0 B " : " c " , " \ u 0 1 0 D " : " c " , " \ u 0 0 E 7 " : " c " , " \ u 1 E 0 9 " : " c " , " \ u 0 1 8 8 " : " c " , " \ u 0 2 3 C " : " c " , " \ u A 7 3 F " : " c " , " \ u 2 1 8 4 " : " c " , " \ u 2 4 D 3 " : " d " , " \ u F F 4 4 " : " d " , " \ u 1 E 0 B " : " d " , " \ u 0 1 0 F " : " d " , " \ u 1 E 0 D " : " d " , " \ u 1 E 1 1 " : " d " , " \ u 1 E 1 3 " : " d " , " \ u 1 E 0 F " : " d " , " \ u 0 1 1 1 " : " d " , " \ u 0 1 8 C " : " d " , " \ u 0 2 5 6 " : " d " , " \ u 0 2 5 7 " : " d " , " \ u A 7 7 A " : " d " , " \ u 0 1 F 3 " : " d z " , " \ u 0 1 C 6 " : " d z " , " \ u 2 4 D 4 " : " e " , " \ u F F 4 5 " : " e " , " \ u 0 0 E 8 " : " e " , " \ u 0 0 E 9 " : " e " , " \ u 0 0 E A " : " e " , " \ u 1 E C 1 " : " e " , " \ u 1 E B F " : " e " , " \ u 1 E C 5 " : " e " , " \ u 1 E C 3 " : " e " , " \ u 1 E B D " : " e " , " \ u 0 1 1 3 " : " e " , " \ u 1 E 1 5 " : " e " , " \ u 1 E 1 7 " : " e " , " \ u 0 1 1 5 " : " e " , " \ u 0 1 1 7 " : " e " , " \ u 0 0 E B " : " e " , " \ u 1 E B B " : " e " , " \ u 0 1 1 B " : " e " , " \ u 0 2 0 5 " : " e " , " \ u 0 2 0 7 " : " e " , " \ u 1 E B 9 " : " e " , " \ u 1 E C 7 " : " e " , " \ u 0 2 2 9 " : " e " , " \ u 1 E 1 D " : " e " , " \ u 0 1 1 9 " : " e " , " \ u 1 E 1 9 " : " e " , " \ u 1 E 1 B " : " e " , " \ u 0 2 4 7 " : " e " , " \ u 0 2 5 B " : " e " , " \ u 0 1 D D " : " e " , " \ u 2 4 D 5 " : " f " , " \ u F F 4 6 " : " f " , " \ u 1 E 1 F " : " f " , " \ u 0 1 9 2 " : " f " , " \ u A 7 7 C " : " f " , " \ u 2 4 D 6 " : " g " , " \ u F F 4 7 " : " g " , " \ u 0 1 F 5 " : " g " , " \ u 0 1 1 D " : " g " , " \ u 1 E 2 1 " : " g " , " \ u 0 1 1 F " : " g " , " \ u 0 1 2 1 " : " g " , " \ u 0 1 E 7 " : " g " , " \ u 0 1 2 3 " : " g " , " \ u 0 1 E 5 " : " g " , " \ u 0 2 6 0 " : " g " , " \ u A 7 A 1 " : " g " , " \ u 1 D 7 9 " : " g " , " \ u A 7 7 F " : " g " , " \ u 2 4 D 7 " : " h " , " \ u F F 4 8 " : " h " , " \ u 0 1 2 5 " : " h " , " \ u 1 E 2 3 " : " h " , " \ u 1 E 2 7 " : " h " , " \ u 0 2 1 F " : " h " , " \ u 1 E 2 5 " : " h " , " \ u 1 E 2 9 " : " h " , " \ u 1 E 2 B " : " h " , " \ u 1 E 9 6 " : " h " , " \ u 0 1 2 7 " : " h " , " \ u 2 C 6 8 " : " h " , " \ u 2 C 7 6 " : " h " , " \ u 0 2 6 5 " : " h " , " \ u 0 1 9 5 " : " h v " , " \ u 2 4 D 8 " : " i " , " \ u F F 4 9 " : " i " , " \ u 0 0 E C " : " i " , " \ u 0 0 E D " : " i " , " \ u 0 0 E E " : " i " , " \ u 0 1 2 9 " : " i " , " \ u 0 1 2 B " : " i " , " \ u 0 1 2 D " : " i " , " \ u 0 0 E F " : " i " , " \ u 1 E 2 F " : " i " , " \ u 1 E C 9 " : " i " , " \ u 0 1 D 0 " : " i " , " \ u 0 2 0 9 " : " i " , " \ u 0 2 0 B " : " i " , " \ u 1 E C B " : " i " , " \ u 0 1 2 F " : " i " , " \ u 1 E 2 D " : " i " , " \ u 0 2 6 8 " : " i " , " \ u 0 1 3 1 " : " i " , " \ u 2 4 D 9 " : " j " , " \ u F F 4 A " : " j " , " \ u 0 1 3 5 " : " j " , " \ u 0 1 F 0 " : " j " , " \ u 0 2 4 9 " : " j " , " \ u 2 4 D A " : " k " , " \ u F F 4 B " : " k " , " \ u 1 E 3 1 " : " k " , " \ u 0 1 E 9 " : " k " , " \ u 1 E 3 3 " : " k " , " \ u 0 1 3 7 " : " k " , " \ u 1 E 3 5 " : " k " , " \ u 0 1 9 9 " : " k " , " \ u 2 C 6 A " : " k " , " \ u A 7 4 1 " : " k " , " \ u A 7 4 3 " : " k " , " \ u A 7 4 5 " : " k " , " \ u A 7 A 3 " : " k " , " \ u 2 4 D B " : " l " , " \ u F F 4 C " : " l " , " \ u 0 1 4 0 " : " l " , " \ u 0 1 3 A " : " l " , " \ u 0 1 3 E " : " l " , " \ u 1 E 3 7 " : " l " , " \ u 1 E 3 9 " : " l " , " \ u 0 1 3 C " : " l " , " \ u 1 E 3 D " : " l " , " \ u 1 E 3 B " : " l " , " \ u 0 1 7 F " : " l " , " \ u 0 1 4 2 " : " l " , " \ u 0 1 9 A " : " l " , " \ u 0 2 6 B " : " l " , " \ u 2 C 6 1 " : " l " , " \ u A 7 4 9 " : " l " , " \ u A 7 8 1 " : " l " , " \ u A 7 4 7 " : " l " , " \ u 0 1 C 9 " : " l j " , " \ u 2 4 D C " : " m " , " \ u F F 4 D " : " m " , " \ u 1 E 3 F " : " m " , " \ u 1 E 4 1 " : " m " , " \ u 1 E 4 3 " : " m " , " \ u 0 2 7 1 " : " m " , " \ u 0 2 6 F " : " m " , " \ u 2 4 D D " : " n " , " \ u F F 4 E " : " n " , " \ u 0 1 F 9 " : " n " , " \ u 0 1 4 4 " : " n " , " \ u 0 0 F 1 " : " n " , " \ u 1 E 4 5 " : " n " , " \ u 0 1 4 8 " : " n " , " \ u 1 E 4 7 " : " n " , " \ u 0 1 4 6 " : " n " , " \ u 1 E 4 B " : " n " , " \ u 1 E 4 9 " : " n " , " \ u 0 1 9 E " : " n " , " \ u 0 2 7 2 " : " n " , " \ u 0 1 4 9 " : " n " , " \ u A 7 9 1 " : " n " , " \ u A 7 A 5 " : " n " , " \ u 0 1 C C " : " n j " , " \ u 2 4 D E " : " o " , " \ u F F 4 F " : " o " , " \ u 0 0 F 2 " : " o " , " \ u 0 0 F 3 " : " o " , " \ u 0 0 F 4 " : " o " , " \ u 1 E D 3 " : " o " , " \ u 1 E D 1 " : " o " , " \ u 1 E D 7 " : " o " , " \ u 1 E D 5 " : " o " , " \ u 0 0 F 5 " : " o " , " \ u 1 E 4 D " : " o " , " \ u 0 2 2 D " : " o " , " \ u 1 E 4 F " : " o " , " \ u 0 1 4 D " : " o " , " \ u 1 E 5 1 " : " o " , " \ u 1 E 5 3 " : " o " , " \ u 0 1 4 F " : " o " , " \ u 0 2 2 F " : " o " , " \ u 0 2 3 1 " : " o " , " \ u 0 0 F 6 " : " o " , " \ u 0 2 2 B " : " o " , " \ u 1 E C F " : " o " , " \ u 0 1 5 1 " : " o " , " \ u 0 1 D 2 " : " o " , " \ u 0 2 0 D " : " o " , " \ u 0 2 0 F " : " o " , " \ u 0 1 A 1 " : " o " , " \ u 1 E D D " : " o " , " \ u 1 E D B " : " o " , " \ u 1 E E 1 " : " o " , " \ u 1 E D F " : " o " , " \ u 1 E E 3 " : " o " , " \ u 1 E C D " : " o " , " \ u 1 E D 9 " : " o " , " \ u 0 1 E B " : " o " , " \ u 0 1 E D " : " o " , " \ u 0 0 F 8 " : " o " , " \ u 0 1 F F " : " o " , " \ u 0 2 5 4 " : " o " , " \ u A 7 4 B " : " o " , " \ u A 7 4 D " : " o " , " \ u 0 2 7 5 " : " o " , " \ u 0 1 A 3 " : " o i " , " \ u 0 2 2 3 " : " o u " , " \ u A 7 4 F " : " o o " , " \ u 2 4 D F " : " p " , " \ u F F 5 0 " : " p " , " \ u 1 E 5 5 " : " p " , " \ u 1 E 5 7 " : " p " , " \ u 0 1 A 5 " : " p " , " \ u 1 D 7 D " : " p " , " \ u A 7 5 1 " : " p " , " \ u A 7 5 3 " : " p " , " \ u A 7 5 5 " : " p " , " \ u 2 4 E 0 " : " q " , " \ u F F 5 1 " : " q " , " \ u 0 2 4 B " : " q " , " \ u A 7 5 7 " : " q " , " \ u A 7 5 9 " : " q " , " \ u 2 4 E 1 " : " r " , " \ u F F 5 2 " : " r " , " \ u 0 1 5 5 " : " r " , " \ u 1 E 5 9 " : " r " , " \ u 0 1 5 9 " : " r " , " \ u 0 2 1 1 " : " r " , " \ u 0 2 1 3 " : " r " , " \ u 1 E 5 B " : " r " , " \ u 1 E 5 D " : " r " , " \ u 0 1 5 7 " : " r " , " \ u 1 E 5 F " : " r " , " \ u 0 2 4 D " : " r " , " \ u 0 2 7 D " : " r " , " \ u A 7 5 B " : " r " , " \ u A 7 A 7 " : " r " , " \ u A 7 8 3 " : " r " , " \ u 2 4 E 2 " : " s " , " \ u F F 5 3 " : " s " , " \ u 0 0 D F " : " s " , " \ u 0 1 5 B " : " s " , " \ u 1 E 6 5 " : " s " , " \ u 0 1 5 D " : " s " , " \ u 1 E 6 1 " : " s " , " \ u 0 1 6 1 " : " s " , " \ u 1 E 6 7 " : " s " , " \ u 1 E 6 3 " : " s " , " \ u 1 E 6 9 " : " s " , " \ u 0 2 1 9 " : " s " , " \ u 0 1 5 F " : " s " , " \ u 0 2 3 F " : " s " , " \ u A 7 A 9 " : " s " , " \ u A 7 8 5 " : " s " , " \ u 1 E 9 B " : " s " , " \ u 2 4 E 3 " : " t " , " \ u F F 5 4 " : " t " , " \ u 1 E 6 B " : " t " , " \ u 1 E 9 7 " : " t " , " \ u 0 1 6 5 " : " t " , " \ u 1 E 6 D " : " t " , " \ u 0 2 1 B " : " t " , " \ u 0 1 6 3 " : " t " , " \ u 1 E 7 1 " : " t " , " \ u 1 E 6 F " : " t " , " \ u 0 1 6 7 " : " t " , " \ u 0 1 A D " : " t " , " \ u 0 2 8 8 " : " t " , " \ u 2 C 6 6 " : " t " , " \ u A 7 8 7 " : " t " , " \ u A 7 2 9 " : " t z " , " \ u 2 4 E 4 " : " u " , " \ u F F 5 5 " : " u " , " \ u 0 0 F 9 " : " u " , " \ u 0 0 F A " : " u " , " \ u 0 0 F B " : " u " , " \ u 0 1 6 9 " : " u " , " \ u 1 E 7 9 " : " u " , " \ u 0 1 6 B " : " u " , " \ u 1 E 7 B " : " u " , " \ u 0 1 6 D " : " u " , " \ u 0 0 F C " : " u " , " \ u 0 1 D C " : " u " , " \ u 0 1 D 8 " : " u " , " \ u 0 1 D 6 " : " u " , " \ u 0 1 D A " : " u " , " \ u 1 E E 7 " : " u " , " \ u 0 1 6 F " : " u " , " \ u 0 1 7 1 " : " u " , " \ u 0 1 D 4 " : " u " , " \ u 0 2 1 5 " : " u " , " \ u 0 2 1 7 " : " u " , " \ u 0 1 B 0 " : " u " , " \ u 1 E E B " : " u " , " \ u 1 E E 9 " : " u " , " \ u 1 E E F " : " u " , " \ u 1 E E D " : " u " , " \ u 1 E F 1 " : " u " , " \ u 1 E E 5 " : " u " , " \ u 1 E 7 3 " : " u " , " \ u 0 1 7 3 " : " u " , " \ u 1 E 7 7 " : " u " , " \ u 1 E 7 5 " : " u " , " \ u 0 2 8 9 " : " u " , " \ u 2 4 E 5 " : " v " , " \ u F F 5 6 " : " v " , " \ u 1 E 7 D " : " v " , " \ u 1 E 7 F " : " v " , " \ u 0 2 8 B " : " v " , " \ u A 7 5 F " : " v " , " \ u 0 2 8 C " : " v " , " \ u A 7 6 1 " : " v y " , " \ u 2 4 E 6 " : " w " , " \ u F F 5 7 " : " w " , " \ u 1 E 8 1 " : " w " , " \ u 1 E 8 3 " : " w " , " \ u 0 1 7 5 " : " w " , " \ u 1 E 8 7 " : " w " , " \ u 1 E 8 5 " : " w " , " \ u 1 E 9 8 " : " w " , " \ u 1 E 8 9 " : " w " , " \ u 2 C 7 3 " : " w " , " \ u 2 4 E 7 " : " x " , " \ u F F 5 8 " : " x " , " \ u 1 E 8 B " : " x " , " \ u 1 E 8 D " : " x " , " \ u 2 4 E 8 " : " y " , " \ u F F 5 9 " : " y " , " \ u 1 E F 3 " : " y " , " \ u 0 0 F D " : " y " , " \ u 0 1 7 7 " : " y " , " \ u 1 E F 9 " : " y " , " \ u 0 2 3 3 " : " y " , " \ u 1 E 8 F " : " y " , " \ u 0 0 F F " : " y " , " \ u 1 E F 7 " : " y " , " \ u 1 E 9 9 " : " y " , " \ u 1 E F 5 " : " y " , " \ u 0 1 B 4 " : " y " , " \ u 0 2 4 F " : " y " , " \ u 1 E F F " : " y " , " \ u 2 4 E 9 " : " z " , " \ u F F 5 A " : " z " , " \ u 0 1 7 A " : " z " , " \ u 1 E 9 1 " : " z " , " \ u 0 1 7 C " : " z " , " \ u 0 1 7 E " : " z " , " \ u 1 E 9 3 " : " z " , " \ u 1 E 9 5 " : " z " , " \ u 0 1 B 6 " : " z " , " \ u 0 2 2 5 " : " z " , " \ u 0 2 4 0 " : " z " , " \ u 2 C 6 C " : " z " , " \ u A 7 6 3 " : " z " , " \ u 0 3 8 6 " : " \ u 0 3 9 1 " , " \ u 0 3 8 8 " : " \ u 0 3 9 5 " , " \ u 0 3 8 9 " : " \ u 0 3 9 7 " , " \ u 0 3 8 A " : " \ u 0 3 9 9 " , " \ u 0 3 A A " : " \ u 0 3 9 9 " , " \ u 0 3 8 C " : " \ u 0 3 9 F " , " \ u 0 3 8 E " : " \ u 0 3 A 5 " , " \ u 0 3 A B " : " \ u 0 3 A 5 " , " \ u 0 3 8 F " : " \ u 0 3 A 9 " , " \ u 0 3 A C " : " \ u 0 3 B 1 " , " \ u 0 3 A D " : " \ u 0 3 B 5 " , " \ u 0 3 A E " : " \ u 0 3 B 7 " , " \ u 0 3 A F " : " \ u 0 3 B 9 " , " \ u 0 3 C A " : " \ u 0 3 B 9 " , " \ u 0 3 9 0 " : " \ u 0 3 B 9 " , " \ u 0 3 C C " : " \ u 0 3 B F " , " \ u 0 3 C D " : " \ u 0 3 C 5 " , " \ u 0 3 C B " : " \ u 0 3 C 5 " , " \ u 0 3 B 0 " : " \ u 0 3 C 5 " , " \ u 0 3 C 9 " : " \ u 0 3 C 9 " , " \ u 0 3 C 2 " : " \ u 0 3 C 3 " } ; 
 
         $ d o c u m e n t   =   $ ( d o c u m e n t ) ; 
 
         n e x t U i d = ( f u n c t i o n ( )   {   v a r   c o u n t e r = 1 ;   r e t u r n   f u n c t i o n ( )   {   r e t u r n   c o u n t e r + + ;   } ;   } ( ) ) ; 
 
 
         f u n c t i o n   r e i n s e r t E l e m e n t ( e l e m e n t )   { 
                 v a r   p l a c e h o l d e r   =   $ ( d o c u m e n t . c r e a t e T e x t N o d e ( ' ' ) ) ; 
 
                 e l e m e n t . b e f o r e ( p l a c e h o l d e r ) ; 
                 p l a c e h o l d e r . b e f o r e ( e l e m e n t ) ; 
                 p l a c e h o l d e r . r e m o v e ( ) ; 
         } 
 
         f u n c t i o n   s t r i p D i a c r i t i c s ( s t r )   { 
                 / /   U s e d   ' u n i   r a n g e   +   n a m e d   f u n c t i o n '   f r o m   h t t p : / / j s p e r f . c o m / d i a c r i t i c s / 1 8 
                 f u n c t i o n   m a t c h ( a )   { 
                         r e t u r n   D I A C R I T I C S [ a ]   | |   a ; 
                 } 
 
                 r e t u r n   s t r . r e p l a c e ( / [ ^ \ u 0 0 0 0 - \ u 0 0 7 E ] / g ,   m a t c h ) ; 
         } 
 
         f u n c t i o n   i n d e x O f ( v a l u e ,   a r r a y )   { 
                 v a r   i   =   0 ,   l   =   a r r a y . l e n g t h ; 
                 f o r   ( ;   i   <   l ;   i   =   i   +   1 )   { 
                         i f   ( e q u a l ( v a l u e ,   a r r a y [ i ] ) )   r e t u r n   i ; 
                 } 
                 r e t u r n   - 1 ; 
         } 
 
         f u n c t i o n   m e a s u r e S c r o l l b a r   ( )   { 
                 v a r   $ t e m p l a t e   =   $ (   M E A S U R E _ S C R O L L B A R _ T E M P L A T E   ) ; 
                 $ t e m p l a t e . a p p e n d T o ( d o c u m e n t . b o d y ) ; 
 
                 v a r   d i m   =   { 
                         w i d t h :   $ t e m p l a t e . w i d t h ( )   -   $ t e m p l a t e [ 0 ] . c l i e n t W i d t h , 
                         h e i g h t :   $ t e m p l a t e . h e i g h t ( )   -   $ t e m p l a t e [ 0 ] . c l i e n t H e i g h t 
                 } ; 
                 $ t e m p l a t e . r e m o v e ( ) ; 
 
                 r e t u r n   d i m ; 
         } 
 
         / * * 
           *   C o m p a r e s   e q u a l i t y   o f   a   a n d   b 
           *   @ p a r a m   a 
           *   @ p a r a m   b 
           * / 
         f u n c t i o n   e q u a l ( a ,   b )   { 
                 i f   ( a   = = =   b )   r e t u r n   t r u e ; 
                 i f   ( a   = = =   u n d e f i n e d   | |   b   = = =   u n d e f i n e d )   r e t u r n   f a l s e ; 
                 i f   ( a   = = =   n u l l   | |   b   = = =   n u l l )   r e t u r n   f a l s e ; 
                 / /   C h e c k   w h e t h e r   ' a '   o r   ' b '   i s   a   s t r i n g   ( p r i m i t i v e   o r   o b j e c t ) . 
                 / /   T h e   c o n c a t e n a t i o n   o f   a n   e m p t y   s t r i n g   ( + ' ' )   c o n v e r t s   i t s   a r g u m e n t   t o   a   s t r i n g ' s   p r i m i t i v e . 
                 i f   ( a . c o n s t r u c t o r   = = =   S t r i n g )   r e t u r n   a + ' '   = = =   b + ' ' ;   / /   a + ' '   -   i n   c a s e   ' a '   i s   a   S t r i n g   o b j e c t 
                 i f   ( b . c o n s t r u c t o r   = = =   S t r i n g )   r e t u r n   b + ' '   = = =   a + ' ' ;   / /   b + ' '   -   i n   c a s e   ' b '   i s   a   S t r i n g   o b j e c t 
                 r e t u r n   f a l s e ; 
         } 
 
         / * * 
           *   S p l i t s   t h e   s t r i n g   i n t o   a n   a r r a y   o f   v a l u e s ,   t r a n s f o r m i n g   e a c h   v a l u e .   A n   e m p t y   a r r a y   i s   r e t u r n e d   f o r   n u l l s   o r   e m p t y 
           *   s t r i n g s 
           *   @ p a r a m   s t r i n g 
           *   @ p a r a m   s e p a r a t o r 
           * / 
         f u n c t i o n   s p l i t V a l ( s t r i n g ,   s e p a r a t o r ,   t r a n s f o r m )   { 
                 v a r   v a l ,   i ,   l ; 
                 i f   ( s t r i n g   = = =   n u l l   | |   s t r i n g . l e n g t h   <   1 )   r e t u r n   [ ] ; 
                 v a l   =   s t r i n g . s p l i t ( s e p a r a t o r ) ; 
                 f o r   ( i   =   0 ,   l   =   v a l . l e n g t h ;   i   <   l ;   i   =   i   +   1 )   v a l [ i ]   =   t r a n s f o r m ( v a l [ i ] ) ; 
                 r e t u r n   v a l ; 
         } 
 
         f u n c t i o n   g e t S i d e B o r d e r P a d d i n g ( e l e m e n t )   { 
                 r e t u r n   e l e m e n t . o u t e r W i d t h ( f a l s e )   -   e l e m e n t . w i d t h ( ) ; 
         } 
 
         f u n c t i o n   i n s t a l l K e y U p C h a n g e E v e n t ( e l e m e n t )   { 
                 v a r   k e y = " k e y u p - c h a n g e - v a l u e " ; 
                 e l e m e n t . o n ( " k e y d o w n " ,   f u n c t i o n   ( )   { 
                         i f   ( $ . d a t a ( e l e m e n t ,   k e y )   = = =   u n d e f i n e d )   { 
                                 $ . d a t a ( e l e m e n t ,   k e y ,   e l e m e n t . v a l ( ) ) ; 
                         } 
                 } ) ; 
                 e l e m e n t . o n ( " k e y u p " ,   f u n c t i o n   ( )   { 
                         v a r   v a l =   $ . d a t a ( e l e m e n t ,   k e y ) ; 
                         i f   ( v a l   ! = =   u n d e f i n e d   & &   e l e m e n t . v a l ( )   ! = =   v a l )   { 
                                 $ . r e m o v e D a t a ( e l e m e n t ,   k e y ) ; 
                                 e l e m e n t . t r i g g e r ( " k e y u p - c h a n g e " ) ; 
                         } 
                 } ) ; 
         } 
 
 
         / * * 
           *   f i l t e r s   m o u s e   e v e n t s   s o   a n   e v e n t   i s   f i r e d   o n l y   i f   t h e   m o u s e   m o v e d . 
           * 
           *   f i l t e r s   o u t   m o u s e   e v e n t s   t h a t   o c c u r   w h e n   m o u s e   i s   s t a t i o n a r y   b u t 
           *   t h e   e l e m e n t s   u n d e r   t h e   p o i n t e r   a r e   s c r o l l e d . 
           * / 
         f u n c t i o n   i n s t a l l F i l t e r e d M o u s e M o v e ( e l e m e n t )   { 
                 e l e m e n t . o n ( " m o u s e m o v e " ,   f u n c t i o n   ( e )   { 
                         v a r   l a s t p o s   =   l a s t M o u s e P o s i t i o n ; 
                         i f   ( l a s t p o s   = = =   u n d e f i n e d   | |   l a s t p o s . x   ! = =   e . p a g e X   | |   l a s t p o s . y   ! = =   e . p a g e Y )   { 
                                 $ ( e . t a r g e t ) . t r i g g e r ( " m o u s e m o v e - f i l t e r e d " ,   e ) ; 
                         } 
                 } ) ; 
         } 
 
         / * * 
           *   D e b o u n c e s   a   f u n c t i o n .   R e t u r n s   a   f u n c t i o n   t h a t   c a l l s   t h e   o r i g i n a l   f n   f u n c t i o n   o n l y   i f   n o   i n v o c a t i o n s   h a v e   b e e n   m a d e 
           *   w i t h i n   t h e   l a s t   q u i e t M i l l i s   m i l l i s e c o n d s . 
           * 
           *   @ p a r a m   q u i e t M i l l i s   n u m b e r   o f   m i l l i s e c o n d s   t o   w a i t   b e f o r e   i n v o k i n g   f n 
           *   @ p a r a m   f n   f u n c t i o n   t o   b e   d e b o u n c e d 
           *   @ p a r a m   c t x   o b j e c t   t o   b e   u s e d   a s   t h i s   r e f e r e n c e   w i t h i n   f n 
           *   @ r e t u r n   d e b o u n c e d   v e r s i o n   o f   f n 
           * / 
         f u n c t i o n   d e b o u n c e ( q u i e t M i l l i s ,   f n ,   c t x )   { 
                 c t x   =   c t x   | |   u n d e f i n e d ; 
                 v a r   t i m e o u t ; 
                 r e t u r n   f u n c t i o n   ( )   { 
                         v a r   a r g s   =   a r g u m e n t s ; 
                         w i n d o w . c l e a r T i m e o u t ( t i m e o u t ) ; 
                         t i m e o u t   =   w i n d o w . s e t T i m e o u t ( f u n c t i o n ( )   { 
                                 f n . a p p l y ( c t x ,   a r g s ) ; 
                         } ,   q u i e t M i l l i s ) ; 
                 } ; 
         } 
 
         f u n c t i o n   i n s t a l l D e b o u n c e d S c r o l l ( t h r e s h o l d ,   e l e m e n t )   { 
                 v a r   n o t i f y   =   d e b o u n c e ( t h r e s h o l d ,   f u n c t i o n   ( e )   {   e l e m e n t . t r i g g e r ( " s c r o l l - d e b o u n c e d " ,   e ) ; } ) ; 
                 e l e m e n t . o n ( " s c r o l l " ,   f u n c t i o n   ( e )   { 
                         i f   ( i n d e x O f ( e . t a r g e t ,   e l e m e n t . g e t ( ) )   > =   0 )   n o t i f y ( e ) ; 
                 } ) ; 
         } 
 
         f u n c t i o n   f o c u s ( $ e l )   { 
                 i f   ( $ e l [ 0 ]   = = =   d o c u m e n t . a c t i v e E l e m e n t )   r e t u r n ; 
 
                 / *   s e t   t h e   f o c u s   i n   a   0   t i m e o u t   -   t h a t   w a y   t h e   f o c u s   i s   s e t   a f t e r   t h e   p r o c e s s i n g 
                         o f   t h e   c u r r e n t   e v e n t   h a s   f i n i s h e d   -   w h i c h   s e e m s   l i k e   t h e   o n l y   r e l i a b l e   w a y 
                         t o   s e t   f o c u s   * / 
                 w i n d o w . s e t T i m e o u t ( f u n c t i o n ( )   { 
                         v a r   e l = $ e l [ 0 ] ,   p o s = $ e l . v a l ( ) . l e n g t h ,   r a n g e ; 
 
                         $ e l . f o c u s ( ) ; 
 
                         / *   m a k e   s u r e   e l   r e c e i v e d   f o c u s   s o   w e   d o   n o t   e r r o r   o u t   w h e n   t r y i n g   t o   m a n i p u l a t e   t h e   c a r e t . 
                                 s o m e t i m e s   m o d a l s   o r   o t h e r s   l i s t e n e r s   m a y   s t e a l   i t   a f t e r   i t s   s e t   * / 
                         v a r   i s V i s i b l e   =   ( e l . o f f s e t W i d t h   >   0   | |   e l . o f f s e t H e i g h t   >   0 ) ; 
                         i f   ( i s V i s i b l e   & &   e l   = = =   d o c u m e n t . a c t i v e E l e m e n t )   { 
 
                                 / *   a f t e r   t h e   f o c u s   i s   s e t   m o v e   t h e   c a r e t   t o   t h e   e n d ,   n e c e s s a r y   w h e n   w e   v a l ( ) 
                                         j u s t   b e f o r e   s e t t i n g   f o c u s   * / 
                                 i f ( e l . s e t S e l e c t i o n R a n g e ) 
                                 { 
                                         e l . s e t S e l e c t i o n R a n g e ( p o s ,   p o s ) ; 
                                 } 
                                 e l s e   i f   ( e l . c r e a t e T e x t R a n g e )   { 
                                         r a n g e   =   e l . c r e a t e T e x t R a n g e ( ) ; 
                                         r a n g e . c o l l a p s e ( f a l s e ) ; 
                                         r a n g e . s e l e c t ( ) ; 
                                 } 
                         } 
                 } ,   0 ) ; 
         } 
 
         f u n c t i o n   g e t C u r s o r I n f o ( e l )   { 
                 e l   =   $ ( e l ) [ 0 ] ; 
                 v a r   o f f s e t   =   0 ; 
                 v a r   l e n g t h   =   0 ; 
                 i f   ( ' s e l e c t i o n S t a r t '   i n   e l )   { 
                         o f f s e t   =   e l . s e l e c t i o n S t a r t ; 
                         l e n g t h   =   e l . s e l e c t i o n E n d   -   o f f s e t ; 
                 }   e l s e   i f   ( ' s e l e c t i o n '   i n   d o c u m e n t )   { 
                         e l . f o c u s ( ) ; 
                         v a r   s e l   =   d o c u m e n t . s e l e c t i o n . c r e a t e R a n g e ( ) ; 
                         l e n g t h   =   d o c u m e n t . s e l e c t i o n . c r e a t e R a n g e ( ) . t e x t . l e n g t h ; 
                         s e l . m o v e S t a r t ( ' c h a r a c t e r ' ,   - e l . v a l u e . l e n g t h ) ; 
                         o f f s e t   =   s e l . t e x t . l e n g t h   -   l e n g t h ; 
                 } 
                 r e t u r n   {   o f f s e t :   o f f s e t ,   l e n g t h :   l e n g t h   } ; 
         } 
 
         f u n c t i o n   k i l l E v e n t ( e v e n t )   { 
                 e v e n t . p r e v e n t D e f a u l t ( ) ; 
                 e v e n t . s t o p P r o p a g a t i o n ( ) ; 
         } 
         f u n c t i o n   k i l l E v e n t I m m e d i a t e l y ( e v e n t )   { 
                 e v e n t . p r e v e n t D e f a u l t ( ) ; 
                 e v e n t . s t o p I m m e d i a t e P r o p a g a t i o n ( ) ; 
         } 
 
         f u n c t i o n   m e a s u r e T e x t W i d t h ( e )   { 
                 i f   ( ! s i z e r ) { 
                         v a r   s t y l e   =   e [ 0 ] . c u r r e n t S t y l e   | |   w i n d o w . g e t C o m p u t e d S t y l e ( e [ 0 ] ,   n u l l ) ; 
                         s i z e r   =   $ ( d o c u m e n t . c r e a t e E l e m e n t ( " d i v " ) ) . c s s ( { 
                                 p o s i t i o n :   " a b s o l u t e " , 
                                 l e f t :   " - 1 0 0 0 0 p x " , 
                                 t o p :   " - 1 0 0 0 0 p x " , 
                                 d i s p l a y :   " n o n e " , 
                                 f o n t S i z e :   s t y l e . f o n t S i z e , 
                                 f o n t F a m i l y :   s t y l e . f o n t F a m i l y , 
                                 f o n t S t y l e :   s t y l e . f o n t S t y l e , 
                                 f o n t W e i g h t :   s t y l e . f o n t W e i g h t , 
                                 l e t t e r S p a c i n g :   s t y l e . l e t t e r S p a c i n g , 
                                 t e x t T r a n s f o r m :   s t y l e . t e x t T r a n s f o r m , 
                                 w h i t e S p a c e :   " n o w r a p " 
                         } ) ; 
                         s i z e r . a t t r ( " c l a s s " , " s e l e c t 2 - s i z e r " ) ; 
                         $ ( d o c u m e n t . b o d y ) . a p p e n d ( s i z e r ) ; 
                 } 
                 s i z e r . t e x t ( e . v a l ( ) ) ; 
                 r e t u r n   s i z e r . w i d t h ( ) ; 
         } 
 
         f u n c t i o n   s y n c C s s C l a s s e s ( d e s t ,   s r c ,   a d a p t e r )   { 
                 v a r   c l a s s e s ,   r e p l a c e m e n t s   =   [ ] ,   a d a p t e d ; 
 
                 c l a s s e s   =   $ . t r i m ( d e s t . a t t r ( " c l a s s " ) ) ; 
 
                 i f   ( c l a s s e s )   { 
                         c l a s s e s   =   ' '   +   c l a s s e s ;   / /   f o r   I E   w h i c h   r e t u r n s   o b j e c t 
 
                         $ ( c l a s s e s . s p l i t ( / \ s + / ) ) . e a c h 2 ( f u n c t i o n ( )   { 
                                 i f   ( t h i s . i n d e x O f ( " s e l e c t 2 - " )   = = =   0 )   { 
                                         r e p l a c e m e n t s . p u s h ( t h i s ) ; 
                                 } 
                         } ) ; 
                 } 
 
                 c l a s s e s   =   $ . t r i m ( s r c . a t t r ( " c l a s s " ) ) ; 
 
                 i f   ( c l a s s e s )   { 
                         c l a s s e s   =   ' '   +   c l a s s e s ;   / /   f o r   I E   w h i c h   r e t u r n s   o b j e c t 
 
                         $ ( c l a s s e s . s p l i t ( / \ s + / ) ) . e a c h 2 ( f u n c t i o n ( )   { 
                                 i f   ( t h i s . i n d e x O f ( " s e l e c t 2 - " )   ! = =   0 )   { 
                                         a d a p t e d   =   a d a p t e r ( t h i s ) ; 
 
                                         i f   ( a d a p t e d )   { 
                                                 r e p l a c e m e n t s . p u s h ( a d a p t e d ) ; 
                                         } 
                                 } 
                         } ) ; 
                 } 
 
                 d e s t . a t t r ( " c l a s s " ,   r e p l a c e m e n t s . j o i n ( "   " ) ) ; 
         } 
 
 
         f u n c t i o n   m a r k M a t c h ( t e x t ,   t e r m ,   m a r k u p ,   e s c a p e M a r k u p )   { 
                 v a r   m a t c h = s t r i p D i a c r i t i c s ( t e x t . t o U p p e r C a s e ( ) ) . i n d e x O f ( s t r i p D i a c r i t i c s ( t e r m . t o U p p e r C a s e ( ) ) ) , 
                         t l = t e r m . l e n g t h ; 
 
                 i f   ( m a t c h < 0 )   { 
                         m a r k u p . p u s h ( e s c a p e M a r k u p ( t e x t ) ) ; 
                         r e t u r n ; 
                 } 
 
                 m a r k u p . p u s h ( e s c a p e M a r k u p ( t e x t . s u b s t r i n g ( 0 ,   m a t c h ) ) ) ; 
                 m a r k u p . p u s h ( " < s p a n   c l a s s = ' s e l e c t 2 - m a t c h ' > " ) ; 
                 m a r k u p . p u s h ( e s c a p e M a r k u p ( t e x t . s u b s t r i n g ( m a t c h ,   m a t c h   +   t l ) ) ) ; 
                 m a r k u p . p u s h ( " < / s p a n > " ) ; 
                 m a r k u p . p u s h ( e s c a p e M a r k u p ( t e x t . s u b s t r i n g ( m a t c h   +   t l ,   t e x t . l e n g t h ) ) ) ; 
         } 
 
         f u n c t i o n   d e f a u l t E s c a p e M a r k u p ( m a r k u p )   { 
                 v a r   r e p l a c e _ m a p   =   { 
                         ' \ \ ' :   ' & # 9 2 ; ' , 
                         ' & ' :   ' & a m p ; ' , 
                         ' < ' :   ' & l t ; ' , 
                         ' > ' :   ' & g t ; ' , 
                         ' " ' :   ' & q u o t ; ' , 
                         " ' " :   ' & # 3 9 ; ' , 
                         " / " :   ' & # 4 7 ; ' 
                 } ; 
 
                 r e t u r n   S t r i n g ( m a r k u p ) . r e p l a c e ( / [ & < > " ' \ / \ \ ] / g ,   f u n c t i o n   ( m a t c h )   { 
                         r e t u r n   r e p l a c e _ m a p [ m a t c h ] ; 
                 } ) ; 
         } 
 
         / * * 
           *   P r o d u c e s   a n   a j a x - b a s e d   q u e r y   f u n c t i o n 
           * 
           *   @ p a r a m   o p t i o n s   o b j e c t   c o n t a i n i n g   c o n f i g u r a t i o n   p a r a m e t e r s 
           *   @ p a r a m   o p t i o n s . p a r a m s   p a r a m e t e r   m a p   f o r   t h e   t r a n s p o r t   a j a x   c a l l ,   c a n   c o n t a i n   s u c h   o p t i o n s   a s   c a c h e ,   j s o n p C a l l b a c k ,   e t c .   s e e   $ . a j a x 
           *   @ p a r a m   o p t i o n s . t r a n s p o r t   f u n c t i o n   t h a t   w i l l   b e   u s e d   t o   e x e c u t e   t h e   a j a x   r e q u e s t .   m u s t   b e   c o m p a t i b l e   w i t h   p a r a m e t e r s   s u p p o r t e d   b y   $ . a j a x 
           *   @ p a r a m   o p t i o n s . u r l   u r l   f o r   t h e   d a t a 
           *   @ p a r a m   o p t i o n s . d a t a   a   f u n c t i o n ( s e a r c h T e r m ,   p a g e N u m b e r ,   c o n t e x t )   t h a t   s h o u l d   r e t u r n   a n   o b j e c t   c o n t a i n i n g   q u e r y   s t r i n g   p a r a m e t e r s   f o r   t h e   a b o v e   u r l . 
           *   @ p a r a m   o p t i o n s . d a t a T y p e   r e q u e s t   d a t a   t y p e :   a j a x ,   j s o n p ,   o t h e r   d a t a t y p e s   s u p p o r t e d   b y   j Q u e r y ' s   $ . a j a x   f u n c t i o n   o r   t h e   t r a n s p o r t   f u n c t i o n   i f   s p e c i f i e d 
           *   @ p a r a m   o p t i o n s . q u i e t M i l l i s   ( o p t i o n a l )   m i l l i s e c o n d s   t o   w a i t   b e f o r e   m a k i n g   t h e   a j a x R e q u e s t ,   h e l p s   d e b o u n c e   t h e   a j a x   f u n c t i o n   i f   i n v o k e d   t o o   o f t e n 
           *   @ p a r a m   o p t i o n s . r e s u l t s   a   f u n c t i o n ( r e m o t e D a t a ,   p a g e N u m b e r ,   q u e r y )   t h a t   c o n v e r t s   d a t a   r e t u r n e d   f o r m   t h e   r e m o t e   r e q u e s t   t o   t h e   f o r m a t   e x p e c t e d   b y   S e l e c t 2 . 
           *             T h e   e x p e c t e d   f o r m a t   i s   a n   o b j e c t   c o n t a i n i n g   t h e   f o l l o w i n g   k e y s : 
           *             r e s u l t s   a r r a y   o f   o b j e c t s   t h a t   w i l l   b e   u s e d   a s   c h o i c e s 
           *             m o r e   ( o p t i o n a l )   b o o l e a n   i n d i c a t i n g   w h e t h e r   t h e r e   a r e   m o r e   r e s u l t s   a v a i l a b l e 
           *             E x a m p l e :   { r e s u l t s : [ { i d : 1 ,   t e x t : ' R e d ' } , { i d : 2 ,   t e x t : ' B l u e ' } ] ,   m o r e : t r u e } 
           * / 
         f u n c t i o n   a j a x ( o p t i o n s )   { 
                 v a r   t i m e o u t ,   / /   c u r r e n t   s c h e d u l e d   b u t   n o t   y e t   e x e c u t e d   r e q u e s t 
                         h a n d l e r   =   n u l l , 
                         q u i e t M i l l i s   =   o p t i o n s . q u i e t M i l l i s   | |   1 0 0 , 
                         a j a x U r l   =   o p t i o n s . u r l , 
                         s e l f   =   t h i s ; 
 
                 r e t u r n   f u n c t i o n   ( q u e r y )   { 
                         w i n d o w . c l e a r T i m e o u t ( t i m e o u t ) ; 
                         t i m e o u t   =   w i n d o w . s e t T i m e o u t ( f u n c t i o n   ( )   { 
                                 v a r   d a t a   =   o p t i o n s . d a t a ,   / /   a j a x   d a t a   f u n c t i o n 
                                         u r l   =   a j a x U r l ,   / /   a j a x   u r l   s t r i n g   o r   f u n c t i o n 
                                         t r a n s p o r t   =   o p t i o n s . t r a n s p o r t   | |   $ . f n . s e l e c t 2 . a j a x D e f a u l t s . t r a n s p o r t , 
                                         / /   d e p r e c a t e d   -   t o   b e   r e m o v e d   i n   4 . 0     -   u s e   p a r a m s   i n s t e a d 
                                         d e p r e c a t e d   =   { 
                                                 t y p e :   o p t i o n s . t y p e   | |   ' G E T ' ,   / /   s e t   t y p e   o f   r e q u e s t   ( G E T   o r   P O S T ) 
                                                 c a c h e :   o p t i o n s . c a c h e   | |   f a l s e , 
                                                 j s o n p C a l l b a c k :   o p t i o n s . j s o n p C a l l b a c k | | u n d e f i n e d , 
                                                 d a t a T y p e :   o p t i o n s . d a t a T y p e | | " j s o n " 
                                         } , 
                                         p a r a m s   =   $ . e x t e n d ( { } ,   $ . f n . s e l e c t 2 . a j a x D e f a u l t s . p a r a m s ,   d e p r e c a t e d ) ; 
 
                                 d a t a   =   d a t a   ?   d a t a . c a l l ( s e l f ,   q u e r y . t e r m ,   q u e r y . p a g e ,   q u e r y . c o n t e x t )   :   n u l l ; 
                                 u r l   =   ( t y p e o f   u r l   = = =   ' f u n c t i o n ' )   ?   u r l . c a l l ( s e l f ,   q u e r y . t e r m ,   q u e r y . p a g e ,   q u e r y . c o n t e x t )   :   u r l ; 
 
                                 i f   ( h a n d l e r   & &   t y p e o f   h a n d l e r . a b o r t   = = =   " f u n c t i o n " )   {   h a n d l e r . a b o r t ( ) ;   } 
 
                                 i f   ( o p t i o n s . p a r a m s )   { 
                                         i f   ( $ . i s F u n c t i o n ( o p t i o n s . p a r a m s ) )   { 
                                                 $ . e x t e n d ( p a r a m s ,   o p t i o n s . p a r a m s . c a l l ( s e l f ) ) ; 
                                         }   e l s e   { 
                                                 $ . e x t e n d ( p a r a m s ,   o p t i o n s . p a r a m s ) ; 
                                         } 
                                 } 
 
                                 $ . e x t e n d ( p a r a m s ,   { 
                                         u r l :   u r l , 
                                         d a t a T y p e :   o p t i o n s . d a t a T y p e , 
                                         d a t a :   d a t a , 
                                         s u c c e s s :   f u n c t i o n   ( d a t a )   { 
                                                 / /   T O D O   -   r e p l a c e   q u e r y . p a g e   w i t h   q u e r y   s o   u s e r s   h a v e   a c c e s s   t o   t e r m ,   p a g e ,   e t c . 
                                                 / /   a d d e d   q u e r y   a s   t h i r d   p a r a m t e r   t o   k e e p   b a c k w a r d s   c o m p a t i b i l i t y 
                                                 v a r   r e s u l t s   =   o p t i o n s . r e s u l t s ( d a t a ,   q u e r y . p a g e ,   q u e r y ) ; 
                                                 q u e r y . c a l l b a c k ( r e s u l t s ) ; 
                                         } , 
                                         e r r o r :   f u n c t i o n ( j q X H R ,   t e x t S t a t u s ,   e r r o r T h r o w n ) { 
                                                 v a r   r e s u l t s   =   { 
                                                         h a s E r r o r :   t r u e , 
                                                         j q X H R :   j q X H R , 
                                                         t e x t S t a t u s :   t e x t S t a t u s , 
                                                         e r r o r T h r o w n :   e r r o r T h r o w n 
                                                 } ; 
 
                                                 q u e r y . c a l l b a c k ( r e s u l t s ) ; 
                                         } 
                                 } ) ; 
                                 h a n d l e r   =   t r a n s p o r t . c a l l ( s e l f ,   p a r a m s ) ; 
                         } ,   q u i e t M i l l i s ) ; 
                 } ; 
         } 
 
         / * * 
           *   P r o d u c e s   a   q u e r y   f u n c t i o n   t h a t   w o r k s   w i t h   a   l o c a l   a r r a y 
           * 
           *   @ p a r a m   o p t i o n s   o b j e c t   c o n t a i n i n g   c o n f i g u r a t i o n   p a r a m e t e r s .   T h e   o p t i o n s   p a r a m e t e r   c a n   e i t h e r   b e   a n   a r r a y   o r   a n 
           *   o b j e c t . 
           * 
           *   I f   t h e   a r r a y   f o r m   i s   u s e d   i t   i s   a s s u m e d   t h a t   i t   c o n t a i n s   o b j e c t s   w i t h   ' i d '   a n d   ' t e x t '   k e y s . 
           * 
           *   I f   t h e   o b j e c t   f o r m   i s   u s e d   i t   i s   a s s u m e d   t h a t   i t   c o n t a i n s   ' d a t a '   a n d   ' t e x t '   k e y s .   T h e   ' d a t a '   k e y   s h o u l d   c o n t a i n 
           *   a n   a r r a y   o f   o b j e c t s   t h a t   w i l l   b e   u s e d   a s   c h o i c e s .   T h e s e   o b j e c t s   m u s t   c o n t a i n   a t   l e a s t   a n   ' i d '   k e y .   T h e   ' t e x t ' 
           *   k e y   c a n   e i t h e r   b e   a   S t r i n g   i n   w h i c h   c a s e   i t   i s   e x p e c t e d   t h a t   e a c h   e l e m e n t   i n   t h e   ' d a t a '   a r r a y   h a s   a   k e y   w i t h   t h e 
           *   v a l u e   o f   ' t e x t '   w h i c h   w i l l   b e   u s e d   t o   m a t c h   c h o i c e s .   A l t e r n a t i v e l y ,   t e x t   c a n   b e   a   f u n c t i o n ( i t e m )   t h a t   c a n   e x t r a c t 
           *   t h e   t e x t . 
           * / 
         f u n c t i o n   l o c a l ( o p t i o n s )   { 
                 v a r   d a t a   =   o p t i o n s ,   / /   d a t a   e l e m e n t s 
                         d a t a T e x t , 
                         t m p , 
                         t e x t   =   f u n c t i o n   ( i t e m )   {   r e t u r n   " " + i t e m . t e x t ;   } ;   / /   f u n c t i o n   u s e d   t o   r e t r i e v e   t h e   t e x t   p o r t i o n   o f   a   d a t a   i t e m   t h a t   i s   m a t c h e d   a g a i n s t   t h e   s e a r c h 
 
                   i f   ( $ . i s A r r a y ( d a t a ) )   { 
                         t m p   =   d a t a ; 
                         d a t a   =   {   r e s u l t s :   t m p   } ; 
                 } 
 
                   i f   ( $ . i s F u n c t i o n ( d a t a )   = = =   f a l s e )   { 
                         t m p   =   d a t a ; 
                         d a t a   =   f u n c t i o n ( )   {   r e t u r n   t m p ;   } ; 
                 } 
 
                 v a r   d a t a I t e m   =   d a t a ( ) ; 
                 i f   ( d a t a I t e m . t e x t )   { 
                         t e x t   =   d a t a I t e m . t e x t ; 
                         / /   i f   t e x t   i s   n o t   a   f u n c t i o n   w e   a s s u m e   i t   t o   b e   a   k e y   n a m e 
                         i f   ( ! $ . i s F u n c t i o n ( t e x t ) )   { 
                                 d a t a T e x t   =   d a t a I t e m . t e x t ;   / /   w e   n e e d   t o   s t o r e   t h i s   i n   a   s e p a r a t e   v a r i a b l e   b e c a u s e   i n   t h e   n e x t   s t e p   d a t a   g e t s   r e s e t   a n d   d a t a . t e x t   i s   n o   l o n g e r   a v a i l a b l e 
                                 t e x t   =   f u n c t i o n   ( i t e m )   {   r e t u r n   i t e m [ d a t a T e x t ] ;   } ; 
                         } 
                 } 
 
                 r e t u r n   f u n c t i o n   ( q u e r y )   { 
                         v a r   t   =   q u e r y . t e r m ,   f i l t e r e d   =   {   r e s u l t s :   [ ]   } ,   p r o c e s s ; 
                         i f   ( t   = = =   " " )   { 
                                 q u e r y . c a l l b a c k ( d a t a ( ) ) ; 
                                 r e t u r n ; 
                         } 
 
                         p r o c e s s   =   f u n c t i o n ( d a t u m ,   c o l l e c t i o n )   { 
                                 v a r   g r o u p ,   a t t r ; 
                                 d a t u m   =   d a t u m [ 0 ] ; 
                                 i f   ( d a t u m . c h i l d r e n )   { 
                                         g r o u p   =   { } ; 
                                         f o r   ( a t t r   i n   d a t u m )   { 
                                                 i f   ( d a t u m . h a s O w n P r o p e r t y ( a t t r ) )   g r o u p [ a t t r ] = d a t u m [ a t t r ] ; 
                                         } 
                                         g r o u p . c h i l d r e n = [ ] ; 
                                         $ ( d a t u m . c h i l d r e n ) . e a c h 2 ( f u n c t i o n ( i ,   c h i l d D a t u m )   {   p r o c e s s ( c h i l d D a t u m ,   g r o u p . c h i l d r e n ) ;   } ) ; 
                                         i f   ( g r o u p . c h i l d r e n . l e n g t h   | |   q u e r y . m a t c h e r ( t ,   t e x t ( g r o u p ) ,   d a t u m ) )   { 
                                                 c o l l e c t i o n . p u s h ( g r o u p ) ; 
                                         } 
                                 }   e l s e   { 
                                         i f   ( q u e r y . m a t c h e r ( t ,   t e x t ( d a t u m ) ,   d a t u m ) )   { 
                                                 c o l l e c t i o n . p u s h ( d a t u m ) ; 
                                         } 
                                 } 
                         } ; 
 
                         $ ( d a t a ( ) . r e s u l t s ) . e a c h 2 ( f u n c t i o n ( i ,   d a t u m )   {   p r o c e s s ( d a t u m ,   f i l t e r e d . r e s u l t s ) ;   } ) ; 
                         q u e r y . c a l l b a c k ( f i l t e r e d ) ; 
                 } ; 
         } 
 
         / /   T O D O   j a v a d o c 
         f u n c t i o n   t a g s ( d a t a )   { 
                 v a r   i s F u n c   =   $ . i s F u n c t i o n ( d a t a ) ; 
                 r e t u r n   f u n c t i o n   ( q u e r y )   { 
                         v a r   t   =   q u e r y . t e r m ,   f i l t e r e d   =   { r e s u l t s :   [ ] } ; 
                         v a r   r e s u l t   =   i s F u n c   ?   d a t a ( q u e r y )   :   d a t a ; 
                         i f   ( $ . i s A r r a y ( r e s u l t ) )   { 
                                 $ ( r e s u l t ) . e a c h ( f u n c t i o n   ( )   { 
                                         v a r   i s O b j e c t   =   t h i s . t e x t   ! = =   u n d e f i n e d , 
                                                 t e x t   =   i s O b j e c t   ?   t h i s . t e x t   :   t h i s ; 
                                         i f   ( t   = = =   " "   | |   q u e r y . m a t c h e r ( t ,   t e x t ) )   { 
                                                 f i l t e r e d . r e s u l t s . p u s h ( i s O b j e c t   ?   t h i s   :   { i d :   t h i s ,   t e x t :   t h i s } ) ; 
                                         } 
                                 } ) ; 
                                 q u e r y . c a l l b a c k ( f i l t e r e d ) ; 
                         } 
                 } ; 
         } 
 
         / * * 
           *   C h e c k s   i f   t h e   f o r m a t t e r   f u n c t i o n   s h o u l d   b e   u s e d . 
           * 
           *   T h r o w s   a n   e r r o r   i f   i t   i s   n o t   a   f u n c t i o n .   R e t u r n s   t r u e   i f   i t   s h o u l d   b e   u s e d , 
           *   f a l s e   i f   n o   f o r m a t t i n g   s h o u l d   b e   p e r f o r m e d . 
           * 
           *   @ p a r a m   f o r m a t t e r 
           * / 
         f u n c t i o n   c h e c k F o r m a t t e r ( f o r m a t t e r ,   f o r m a t t e r N a m e )   { 
                 i f   ( $ . i s F u n c t i o n ( f o r m a t t e r ) )   r e t u r n   t r u e ; 
                 i f   ( ! f o r m a t t e r )   r e t u r n   f a l s e ; 
                 i f   ( t y p e o f ( f o r m a t t e r )   = = =   ' s t r i n g ' )   r e t u r n   t r u e ; 
                 t h r o w   n e w   E r r o r ( f o r m a t t e r N a m e   + "   m u s t   b e   a   s t r i n g ,   f u n c t i o n ,   o r   f a l s y   v a l u e " ) ; 
         } 
 
     / * * 
       *   R e t u r n s   a   g i v e n   v a l u e 
       *   I f   g i v e n   a   f u n c t i o n ,   r e t u r n s   i t s   o u t p u t 
       * 
       *   @ p a r a m   v a l   s t r i n g | f u n c t i o n 
       *   @ p a r a m   c o n t e x t   v a l u e   o f   " t h i s "   t o   b e   p a s s e d   t o   f u n c t i o n 
       *   @ r e t u r n s   { * } 
       * / 
         f u n c t i o n   e v a l u a t e ( v a l ,   c o n t e x t )   { 
                 i f   ( $ . i s F u n c t i o n ( v a l ) )   { 
                         v a r   a r g s   =   A r r a y . p r o t o t y p e . s l i c e . c a l l ( a r g u m e n t s ,   2 ) ; 
                         r e t u r n   v a l . a p p l y ( c o n t e x t ,   a r g s ) ; 
                 } 
                 r e t u r n   v a l ; 
         } 
 
         f u n c t i o n   c o u n t R e s u l t s ( r e s u l t s )   { 
                 v a r   c o u n t   =   0 ; 
                 $ . e a c h ( r e s u l t s ,   f u n c t i o n ( i ,   i t e m )   { 
                         i f   ( i t e m . c h i l d r e n )   { 
                                 c o u n t   + =   c o u n t R e s u l t s ( i t e m . c h i l d r e n ) ; 
                         }   e l s e   { 
                                 c o u n t + + ; 
                         } 
                 } ) ; 
                 r e t u r n   c o u n t ; 
         } 
 
         / * * 
           *   D e f a u l t   t o k e n i z e r .   T h i s   f u n c t i o n   u s e s   b r e a k s   t h e   i n p u t   o n   s u b s t r i n g   m a t c h   o f   a n y   s t r i n g   f r o m   t h e 
           *   o p t s . t o k e n S e p a r a t o r s   a r r a y   a n d   u s e s   o p t s . c r e a t e S e a r c h C h o i c e   t o   c r e a t e   t h e   c h o i c e   o b j e c t .   B o t h   o f   t h o s e 
           *   t w o   o p t i o n s   h a v e   t o   b e   d e f i n e d   i n   o r d e r   f o r   t h e   t o k e n i z e r   t o   w o r k . 
           * 
           *   @ p a r a m   i n p u t   t e x t   u s e r   h a s   t y p e d   s o   f a r   o r   p a s t e d   i n t o   t h e   s e a r c h   f i e l d 
           *   @ p a r a m   s e l e c t i o n   c u r r e n t l y   s e l e c t e d   c h o i c e s 
           *   @ p a r a m   s e l e c t C a l l b a c k   f u n c t i o n ( c h o i c e )   c a l l b a c k   t h o   a d d   t h e   c h o i c e   t o   s e l e c t i o n 
           *   @ p a r a m   o p t s   s e l e c t 2 ' s   o p t s 
           *   @ r e t u r n   u n d e f i n e d / n u l l   t o   l e a v e   t h e   c u r r e n t   i n p u t   u n c h a n g e d ,   o r   a   s t r i n g   t o   c h a n g e   t h e   i n p u t   t o   t h e   r e t u r n e d   v a l u e 
           * / 
         f u n c t i o n   d e f a u l t T o k e n i z e r ( i n p u t ,   s e l e c t i o n ,   s e l e c t C a l l b a c k ,   o p t s )   { 
                 v a r   o r i g i n a l   =   i n p u t ,   / /   s t o r e   t h e   o r i g i n a l   s o   w e   c a n   c o m p a r e   a n d   k n o w   i f   w e   n e e d   t o   t e l l   t h e   s e a r c h   t o   u p d a t e   i t s   t e x t 
                         d u p e   =   f a l s e ,   / /   c h e c k   f o r   w h e t h e r   a   t o k e n   w e   e x t r a c t e d   r e p r e s e n t s   a   d u p l i c a t e   s e l e c t e d   c h o i c e 
                         t o k e n ,   / /   t o k e n 
                         i n d e x ,   / /   p o s i t i o n   a t   w h i c h   t h e   s e p a r a t o r   w a s   f o u n d 
                         i ,   l ,   / /   l o o p i n g   v a r i a b l e s 
                         s e p a r a t o r ;   / /   t h e   m a t c h e d   s e p a r a t o r 
 
                 i f   ( ! o p t s . c r e a t e S e a r c h C h o i c e   | |   ! o p t s . t o k e n S e p a r a t o r s   | |   o p t s . t o k e n S e p a r a t o r s . l e n g t h   <   1 )   r e t u r n   u n d e f i n e d ; 
 
                 w h i l e   ( t r u e )   { 
                         i n d e x   =   - 1 ; 
 
                         f o r   ( i   =   0 ,   l   =   o p t s . t o k e n S e p a r a t o r s . l e n g t h ;   i   <   l ;   i + + )   { 
                                 s e p a r a t o r   =   o p t s . t o k e n S e p a r a t o r s [ i ] ; 
                                 i n d e x   =   i n p u t . i n d e x O f ( s e p a r a t o r ) ; 
                                 i f   ( i n d e x   > =   0 )   b r e a k ; 
                         } 
 
                         i f   ( i n d e x   <   0 )   b r e a k ;   / /   d i d   n o t   f i n d   a n y   t o k e n   s e p a r a t o r   i n   t h e   i n p u t   s t r i n g ,   b a i l 
 
                         t o k e n   =   i n p u t . s u b s t r i n g ( 0 ,   i n d e x ) ; 
                         i n p u t   =   i n p u t . s u b s t r i n g ( i n d e x   +   s e p a r a t o r . l e n g t h ) ; 
 
                         i f   ( t o k e n . l e n g t h   >   0 )   { 
                                 t o k e n   =   o p t s . c r e a t e S e a r c h C h o i c e . c a l l ( t h i s ,   t o k e n ,   s e l e c t i o n ) ; 
                                 i f   ( t o k e n   ! = =   u n d e f i n e d   & &   t o k e n   ! = =   n u l l   & &   o p t s . i d ( t o k e n )   ! = =   u n d e f i n e d   & &   o p t s . i d ( t o k e n )   ! = =   n u l l )   { 
                                         d u p e   =   f a l s e ; 
                                         f o r   ( i   =   0 ,   l   =   s e l e c t i o n . l e n g t h ;   i   <   l ;   i + + )   { 
                                                 i f   ( e q u a l ( o p t s . i d ( t o k e n ) ,   o p t s . i d ( s e l e c t i o n [ i ] ) ) )   { 
                                                         d u p e   =   t r u e ;   b r e a k ; 
                                                 } 
                                         } 
 
                                         i f   ( ! d u p e )   s e l e c t C a l l b a c k ( t o k e n ) ; 
                                 } 
                         } 
                 } 
 
                 i f   ( o r i g i n a l ! = = i n p u t )   r e t u r n   i n p u t ; 
         } 
 
         f u n c t i o n   c l e a n u p J Q u e r y E l e m e n t s ( )   { 
                 v a r   s e l f   =   t h i s ; 
 
                 $ . e a c h ( a r g u m e n t s ,   f u n c t i o n   ( i ,   e l e m e n t )   { 
                         s e l f [ e l e m e n t ] . r e m o v e ( ) ; 
                         s e l f [ e l e m e n t ]   =   n u l l ; 
                 } ) ; 
         } 
 
         / * * 
           *   C r e a t e s   a   n e w   c l a s s 
           * 
           *   @ p a r a m   s u p e r C l a s s 
           *   @ p a r a m   m e t h o d s 
           * / 
         f u n c t i o n   c l a z z ( S u p e r C l a s s ,   m e t h o d s )   { 
                 v a r   c o n s t r u c t o r   =   f u n c t i o n   ( )   { } ; 
                 c o n s t r u c t o r . p r o t o t y p e   =   n e w   S u p e r C l a s s ; 
                 c o n s t r u c t o r . p r o t o t y p e . c o n s t r u c t o r   =   c o n s t r u c t o r ; 
                 c o n s t r u c t o r . p r o t o t y p e . p a r e n t   =   S u p e r C l a s s . p r o t o t y p e ; 
                 c o n s t r u c t o r . p r o t o t y p e   =   $ . e x t e n d ( c o n s t r u c t o r . p r o t o t y p e ,   m e t h o d s ) ; 
                 r e t u r n   c o n s t r u c t o r ; 
         } 
 
         A b s t r a c t S e l e c t 2   =   c l a z z ( O b j e c t ,   { 
 
                 / /   a b s t r a c t 
                 b i n d :   f u n c t i o n   ( f u n c )   { 
                         v a r   s e l f   =   t h i s ; 
                         r e t u r n   f u n c t i o n   ( )   { 
                                 f u n c . a p p l y ( s e l f ,   a r g u m e n t s ) ; 
                         } ; 
                 } , 
 
                 / /   a b s t r a c t 
                 i n i t :   f u n c t i o n   ( o p t s )   { 
                         v a r   r e s u l t s ,   s e a r c h ,   r e s u l t s S e l e c t o r   =   " . s e l e c t 2 - r e s u l t s " ; 
 
                         / /   p r e p a r e   o p t i o n s 
                         t h i s . o p t s   =   o p t s   =   t h i s . p r e p a r e O p t s ( o p t s ) ; 
 
                         t h i s . i d = o p t s . i d ; 
 
                         / /   d e s t r o y   i f   c a l l e d   o n   a n   e x i s t i n g   c o m p o n e n t 
                         i f   ( o p t s . e l e m e n t . d a t a ( " s e l e c t 2 " )   ! = =   u n d e f i n e d   & & 
                                 o p t s . e l e m e n t . d a t a ( " s e l e c t 2 " )   ! = =   n u l l )   { 
                                 o p t s . e l e m e n t . d a t a ( " s e l e c t 2 " ) . d e s t r o y ( ) ; 
                         } 
 
                         t h i s . c o n t a i n e r   =   t h i s . c r e a t e C o n t a i n e r ( ) ; 
 
                         t h i s . l i v e R e g i o n   =   $ ( ' . s e l e c t 2 - h i d d e n - a c c e s s i b l e ' ) ; 
                         i f   ( t h i s . l i v e R e g i o n . l e n g t h   = =   0 )   { 
                                 t h i s . l i v e R e g i o n   =   $ ( " < s p a n > " ,   { 
                                                 r o l e :   " s t a t u s " , 
                                                 " a r i a - l i v e " :   " p o l i t e " 
                                         } ) 
                                         . a d d C l a s s ( " s e l e c t 2 - h i d d e n - a c c e s s i b l e " ) 
                                         . a p p e n d T o ( d o c u m e n t . b o d y ) ; 
                         } 
 
                         t h i s . c o n t a i n e r I d = " s 2 i d _ " + ( o p t s . e l e m e n t . a t t r ( " i d " )   | |   " a u t o g e n " + n e x t U i d ( ) ) ; 
                         t h i s . c o n t a i n e r E v e n t N a m e =   t h i s . c o n t a i n e r I d 
                                 . r e p l a c e ( / ( [ . ] ) / g ,   ' _ ' ) 
                                 . r e p l a c e ( / ( [ ; & , \ - \ . \ + \ * \ ~ ' : " \ ! \ ^ # $ % @ \ [ \ ] \ ( \ ) = > \ | ] ) / g ,   ' \ \ $ 1 ' ) ; 
                         t h i s . c o n t a i n e r . a t t r ( " i d " ,   t h i s . c o n t a i n e r I d ) ; 
 
                         t h i s . c o n t a i n e r . a t t r ( " t i t l e " ,   o p t s . e l e m e n t . a t t r ( " t i t l e " ) ) ; 
 
                         t h i s . b o d y   =   $ ( d o c u m e n t . b o d y ) ; 
 
                         s y n c C s s C l a s s e s ( t h i s . c o n t a i n e r ,   t h i s . o p t s . e l e m e n t ,   t h i s . o p t s . a d a p t C o n t a i n e r C s s C l a s s ) ; 
 
                         t h i s . c o n t a i n e r . a t t r ( " s t y l e " ,   o p t s . e l e m e n t . a t t r ( " s t y l e " ) ) ; 
                         t h i s . c o n t a i n e r . c s s ( e v a l u a t e ( o p t s . c o n t a i n e r C s s ,   t h i s . o p t s . e l e m e n t ) ) ; 
                         t h i s . c o n t a i n e r . a d d C l a s s ( e v a l u a t e ( o p t s . c o n t a i n e r C s s C l a s s ,   t h i s . o p t s . e l e m e n t ) ) ; 
 
                         t h i s . e l e m e n t T a b I n d e x   =   t h i s . o p t s . e l e m e n t . a t t r ( " t a b i n d e x " ) ; 
 
                         / /   s w a p   c o n t a i n e r   f o r   t h e   e l e m e n t 
                         t h i s . o p t s . e l e m e n t 
                                 . d a t a ( " s e l e c t 2 " ,   t h i s ) 
                                 . a t t r ( " t a b i n d e x " ,   " - 1 " ) 
                                 . b e f o r e ( t h i s . c o n t a i n e r ) 
                                 . o n ( " c l i c k . s e l e c t 2 " ,   k i l l E v e n t ) ;   / /   d o   n o t   l e a k   c l i c k   e v e n t s 
 
                         t h i s . c o n t a i n e r . d a t a ( " s e l e c t 2 " ,   t h i s ) ; 
 
                         t h i s . d r o p d o w n   =   t h i s . c o n t a i n e r . f i n d ( " . s e l e c t 2 - d r o p " ) ; 
 
                         s y n c C s s C l a s s e s ( t h i s . d r o p d o w n ,   t h i s . o p t s . e l e m e n t ,   t h i s . o p t s . a d a p t D r o p d o w n C s s C l a s s ) ; 
 
                         t h i s . d r o p d o w n . a d d C l a s s ( e v a l u a t e ( o p t s . d r o p d o w n C s s C l a s s ,   t h i s . o p t s . e l e m e n t ) ) ; 
                         t h i s . d r o p d o w n . d a t a ( " s e l e c t 2 " ,   t h i s ) ; 
                         t h i s . d r o p d o w n . o n ( " c l i c k " ,   k i l l E v e n t ) ; 
 
                         t h i s . r e s u l t s   =   r e s u l t s   =   t h i s . c o n t a i n e r . f i n d ( r e s u l t s S e l e c t o r ) ; 
                         t h i s . s e a r c h   =   s e a r c h   =   t h i s . c o n t a i n e r . f i n d ( " i n p u t . s e l e c t 2 - i n p u t " ) ; 
 
                         t h i s . q u e r y C o u n t   =   0 ; 
                         t h i s . r e s u l t s P a g e   =   0 ; 
                         t h i s . c o n t e x t   =   n u l l ; 
 
                         / /   i n i t i a l i z e   t h e   c o n t a i n e r 
                         t h i s . i n i t C o n t a i n e r ( ) ; 
 
                         t h i s . c o n t a i n e r . o n ( " c l i c k " ,   k i l l E v e n t ) ; 
 
                         i n s t a l l F i l t e r e d M o u s e M o v e ( t h i s . r e s u l t s ) ; 
 
                         t h i s . d r o p d o w n . o n ( " m o u s e m o v e - f i l t e r e d " ,   r e s u l t s S e l e c t o r ,   t h i s . b i n d ( t h i s . h i g h l i g h t U n d e r E v e n t ) ) ; 
                         t h i s . d r o p d o w n . o n ( " t o u c h s t a r t   t o u c h m o v e   t o u c h e n d " ,   r e s u l t s S e l e c t o r ,   t h i s . b i n d ( f u n c t i o n   ( e v e n t )   { 
                                 t h i s . _ t o u c h E v e n t   =   t r u e ; 
                                 t h i s . h i g h l i g h t U n d e r E v e n t ( e v e n t ) ; 
                         } ) ) ; 
                         t h i s . d r o p d o w n . o n ( " t o u c h m o v e " ,   r e s u l t s S e l e c t o r ,   t h i s . b i n d ( t h i s . t o u c h M o v e d ) ) ; 
                         t h i s . d r o p d o w n . o n ( " t o u c h s t a r t   t o u c h e n d " ,   r e s u l t s S e l e c t o r ,   t h i s . b i n d ( t h i s . c l e a r T o u c h M o v e d ) ) ; 
 
                         / /   W a i t i n g   f o r   a   c l i c k   e v e n t   o n   t o u c h   d e v i c e s   t o   s e l e c t   o p t i o n   a n d   h i d e   d r o p d o w n 
                         / /   o t h e r w i s e   c l i c k   w i l l   b e   t r i g g e r e d   o n   a n   u n d e r l y i n g   e l e m e n t 
                         t h i s . d r o p d o w n . o n ( ' c l i c k ' ,   t h i s . b i n d ( f u n c t i o n   ( e v e n t )   { 
                                 i f   ( t h i s . _ t o u c h E v e n t )   { 
                                         t h i s . _ t o u c h E v e n t   =   f a l s e ; 
                                         t h i s . s e l e c t H i g h l i g h t e d ( ) ; 
                                 } 
                         } ) ) ; 
 
                         i n s t a l l D e b o u n c e d S c r o l l ( 8 0 ,   t h i s . r e s u l t s ) ; 
                         t h i s . d r o p d o w n . o n ( " s c r o l l - d e b o u n c e d " ,   r e s u l t s S e l e c t o r ,   t h i s . b i n d ( t h i s . l o a d M o r e I f N e e d e d ) ) ; 
 
                         / /   d o   n o t   p r o p a g a t e   c h a n g e   e v e n t   f r o m   t h e   s e a r c h   f i e l d   o u t   o f   t h e   c o m p o n e n t 
                         $ ( t h i s . c o n t a i n e r ) . o n ( " c h a n g e " ,   " . s e l e c t 2 - i n p u t " ,   f u n c t i o n ( e )   { e . s t o p P r o p a g a t i o n ( ) ; } ) ; 
                         $ ( t h i s . d r o p d o w n ) . o n ( " c h a n g e " ,   " . s e l e c t 2 - i n p u t " ,   f u n c t i o n ( e )   { e . s t o p P r o p a g a t i o n ( ) ; } ) ; 
 
                         / /   i f   j q u e r y . m o u s e w h e e l   p l u g i n   i s   i n s t a l l e d   w e   c a n   p r e v e n t   o u t - o f - b o u n d s   s c r o l l i n g   o f   r e s u l t s   v i a   m o u s e w h e e l 
                         i f   ( $ . f n . m o u s e w h e e l )   { 
                                 r e s u l t s . m o u s e w h e e l ( f u n c t i o n   ( e ,   d e l t a ,   d e l t a X ,   d e l t a Y )   { 
                                         v a r   t o p   =   r e s u l t s . s c r o l l T o p ( ) ; 
                                         i f   ( d e l t a Y   >   0   & &   t o p   -   d e l t a Y   < =   0 )   { 
                                                 r e s u l t s . s c r o l l T o p ( 0 ) ; 
                                                 k i l l E v e n t ( e ) ; 
                                         }   e l s e   i f   ( d e l t a Y   <   0   & &   r e s u l t s . g e t ( 0 ) . s c r o l l H e i g h t   -   r e s u l t s . s c r o l l T o p ( )   +   d e l t a Y   < =   r e s u l t s . h e i g h t ( ) )   { 
                                                 r e s u l t s . s c r o l l T o p ( r e s u l t s . g e t ( 0 ) . s c r o l l H e i g h t   -   r e s u l t s . h e i g h t ( ) ) ; 
                                                 k i l l E v e n t ( e ) ; 
                                         } 
                                 } ) ; 
                         } 
 
                         i n s t a l l K e y U p C h a n g e E v e n t ( s e a r c h ) ; 
                         s e a r c h . o n ( " k e y u p - c h a n g e   i n p u t   p a s t e " ,   t h i s . b i n d ( t h i s . u p d a t e R e s u l t s ) ) ; 
                         s e a r c h . o n ( " f o c u s " ,   f u n c t i o n   ( )   {   s e a r c h . a d d C l a s s ( " s e l e c t 2 - f o c u s e d " ) ;   } ) ; 
                         s e a r c h . o n ( " b l u r " ,   f u n c t i o n   ( )   {   s e a r c h . r e m o v e C l a s s ( " s e l e c t 2 - f o c u s e d " ) ; } ) ; 
 
                         t h i s . d r o p d o w n . o n ( " m o u s e u p " ,   r e s u l t s S e l e c t o r ,   t h i s . b i n d ( f u n c t i o n   ( e )   { 
                                 i f   ( $ ( e . t a r g e t ) . c l o s e s t ( " . s e l e c t 2 - r e s u l t - s e l e c t a b l e " ) . l e n g t h   >   0 )   { 
                                         t h i s . h i g h l i g h t U n d e r E v e n t ( e ) ; 
                                         t h i s . s e l e c t H i g h l i g h t e d ( e ) ; 
                                 } 
                         } ) ) ; 
 
                         / /   t r a p   a l l   m o u s e   e v e n t s   f r o m   l e a v i n g   t h e   d r o p d o w n .   s o m e t i m e s   t h e r e   m a y   b e   a   m o d a l   t h a t   i s   l i s t e n i n g 
                         / /   f o r   m o u s e   e v e n t s   o u t s i d e   o f   i t s e l f   s o   i t   c a n   c l o s e   i t s e l f .   s i n c e   t h e   d r o p d o w n   i s   n o w   o u t s i d e   t h e   s e l e c t 2 ' s 
                         / /   d o m   i t   w i l l   t r i g g e r   t h e   p o p u p   c l o s e ,   w h i c h   i s   n o t   w h a t   w e   w a n t 
                         / /   f o c u s i n   c a n   c a u s e   f o c u s   w a r s   b e t w e e n   m o d a l s   a n d   s e l e c t 2   s i n c e   t h e   d r o p d o w n   i s   o u t s i d e   t h e   m o d a l . 
                         t h i s . d r o p d o w n . o n ( " c l i c k   m o u s e u p   m o u s e d o w n   t o u c h s t a r t   t o u c h e n d   f o c u s i n " ,   f u n c t i o n   ( e )   {   e . s t o p P r o p a g a t i o n ( ) ;   } ) ; 
 
                         t h i s . n e x t S e a r c h T e r m   =   u n d e f i n e d ; 
 
                         i f   ( $ . i s F u n c t i o n ( t h i s . o p t s . i n i t S e l e c t i o n ) )   { 
                                 / /   i n i t i a l i z e   s e l e c t i o n   b a s e d   o n   t h e   c u r r e n t   v a l u e   o f   t h e   s o u r c e   e l e m e n t 
                                 t h i s . i n i t S e l e c t i o n ( ) ; 
 
                                 / /   i f   t h e   u s e r   h a s   p r o v i d e d   a   f u n c t i o n   t h a t   c a n   s e t   s e l e c t i o n   b a s e d   o n   t h e   v a l u e   o f   t h e   s o u r c e   e l e m e n t 
                                 / /   w e   m o n i t o r   t h e   c h a n g e   e v e n t   o n   t h e   e l e m e n t   a n d   t r i g g e r   i t ,   a l l o w i n g   f o r   t w o   w a y   s y n c h r o n i z a t i o n 
                                 t h i s . m o n i t o r S o u r c e ( ) ; 
                         } 
 
                         i f   ( o p t s . m a x i m u m I n p u t L e n g t h   ! = =   n u l l )   { 
                                 t h i s . s e a r c h . a t t r ( " m a x l e n g t h " ,   o p t s . m a x i m u m I n p u t L e n g t h ) ; 
                         } 
 
                         v a r   d i s a b l e d   =   o p t s . e l e m e n t . p r o p ( " d i s a b l e d " ) ; 
                         i f   ( d i s a b l e d   = = =   u n d e f i n e d )   d i s a b l e d   =   f a l s e ; 
                         t h i s . e n a b l e ( ! d i s a b l e d ) ; 
 
                         v a r   r e a d o n l y   =   o p t s . e l e m e n t . p r o p ( " r e a d o n l y " ) ; 
                         i f   ( r e a d o n l y   = = =   u n d e f i n e d )   r e a d o n l y   =   f a l s e ; 
                         t h i s . r e a d o n l y ( r e a d o n l y ) ; 
 
                         / /   C a l c u l a t e   s i z e   o f   s c r o l l b a r 
                         s c r o l l B a r D i m e n s i o n s   =   s c r o l l B a r D i m e n s i o n s   | |   m e a s u r e S c r o l l b a r ( ) ; 
 
                         t h i s . a u t o f o c u s   =   o p t s . e l e m e n t . p r o p ( " a u t o f o c u s " ) ; 
                         o p t s . e l e m e n t . p r o p ( " a u t o f o c u s " ,   f a l s e ) ; 
                         i f   ( t h i s . a u t o f o c u s )   t h i s . f o c u s ( ) ; 
 
                         t h i s . s e a r c h . a t t r ( " p l a c e h o l d e r " ,   o p t s . s e a r c h I n p u t P l a c e h o l d e r ) ; 
                 } , 
 
                 / /   a b s t r a c t 
                 d e s t r o y :   f u n c t i o n   ( )   { 
                         v a r   e l e m e n t = t h i s . o p t s . e l e m e n t ,   s e l e c t 2   =   e l e m e n t . d a t a ( " s e l e c t 2 " ) ,   s e l f   =   t h i s ; 
 
                         t h i s . c l o s e ( ) ; 
 
                         i f   ( e l e m e n t . l e n g t h   & &   e l e m e n t [ 0 ] . d e t a c h E v e n t   & &   s e l f . _ s y n c )   { 
                                 e l e m e n t . e a c h ( f u n c t i o n   ( )   { 
                                         i f   ( s e l f . _ s y n c )   { 
                                                 t h i s . d e t a c h E v e n t ( " o n p r o p e r t y c h a n g e " ,   s e l f . _ s y n c ) ; 
                                         } 
                                 } ) ; 
                         } 
                         i f   ( t h i s . p r o p e r t y O b s e r v e r )   { 
                                 t h i s . p r o p e r t y O b s e r v e r . d i s c o n n e c t ( ) ; 
                                 t h i s . p r o p e r t y O b s e r v e r   =   n u l l ; 
                         } 
                         t h i s . _ s y n c   =   n u l l ; 
 
                         i f   ( s e l e c t 2   ! = =   u n d e f i n e d )   { 
                                 s e l e c t 2 . c o n t a i n e r . r e m o v e ( ) ; 
                                 s e l e c t 2 . l i v e R e g i o n . r e m o v e ( ) ; 
                                 s e l e c t 2 . d r o p d o w n . r e m o v e ( ) ; 
                                 e l e m e n t 
                                         . s h o w ( ) 
                                         . r e m o v e D a t a ( " s e l e c t 2 " ) 
                                         . o f f ( " . s e l e c t 2 " ) 
                                         . p r o p ( " a u t o f o c u s " ,   t h i s . a u t o f o c u s   | |   f a l s e ) ; 
                                 i f   ( t h i s . e l e m e n t T a b I n d e x )   { 
                                         e l e m e n t . a t t r ( { t a b i n d e x :   t h i s . e l e m e n t T a b I n d e x } ) ; 
                                 }   e l s e   { 
                                         e l e m e n t . r e m o v e A t t r ( " t a b i n d e x " ) ; 
                                 } 
                                 e l e m e n t . s h o w ( ) ; 
                         } 
 
                         c l e a n u p J Q u e r y E l e m e n t s . c a l l ( t h i s , 
                                 " c o n t a i n e r " , 
                                 " l i v e R e g i o n " , 
                                 " d r o p d o w n " , 
                                 " r e s u l t s " , 
                                 " s e a r c h " 
                         ) ; 
                 } , 
 
                 / /   a b s t r a c t 
                 o p t i o n T o D a t a :   f u n c t i o n ( e l e m e n t )   { 
                         i f   ( e l e m e n t . i s ( " o p t i o n " ) )   { 
                                 r e t u r n   { 
                                         i d : e l e m e n t . p r o p ( " v a l u e " ) , 
                                         t e x t : e l e m e n t . t e x t ( ) , 
                                         e l e m e n t :   e l e m e n t . g e t ( ) , 
                                         c s s :   e l e m e n t . a t t r ( " c l a s s " ) , 
                                         d i s a b l e d :   e l e m e n t . p r o p ( " d i s a b l e d " ) , 
                                         l o c k e d :   e q u a l ( e l e m e n t . a t t r ( " l o c k e d " ) ,   " l o c k e d " )   | |   e q u a l ( e l e m e n t . d a t a ( " l o c k e d " ) ,   t r u e ) 
                                 } ; 
                         }   e l s e   i f   ( e l e m e n t . i s ( " o p t g r o u p " ) )   { 
                                 r e t u r n   { 
                                         t e x t : e l e m e n t . a t t r ( " l a b e l " ) , 
                                         c h i l d r e n : [ ] , 
                                         e l e m e n t :   e l e m e n t . g e t ( ) , 
                                         c s s :   e l e m e n t . a t t r ( " c l a s s " ) 
                                 } ; 
                         } 
                 } , 
 
                 / /   a b s t r a c t 
                 p r e p a r e O p t s :   f u n c t i o n   ( o p t s )   { 
                         v a r   e l e m e n t ,   s e l e c t ,   i d K e y ,   a j a x U r l ,   s e l f   =   t h i s ; 
 
                         e l e m e n t   =   o p t s . e l e m e n t ; 
 
                         i f   ( e l e m e n t . g e t ( 0 ) . t a g N a m e . t o L o w e r C a s e ( )   = = =   " s e l e c t " )   { 
                                 t h i s . s e l e c t   =   s e l e c t   =   o p t s . e l e m e n t ; 
                         } 
 
                         i f   ( s e l e c t )   { 
                                 / /   t h e s e   o p t i o n s   a r e   n o t   a l l o w e d   w h e n   a t t a c h e d   t o   a   s e l e c t   b e c a u s e   t h e y   a r e   p i c k e d   u p   o f f   t h e   e l e m e n t   i t s e l f 
                                 $ . e a c h ( [ " i d " ,   " m u l t i p l e " ,   " a j a x " ,   " q u e r y " ,   " c r e a t e S e a r c h C h o i c e " ,   " i n i t S e l e c t i o n " ,   " d a t a " ,   " t a g s " ] ,   f u n c t i o n   ( )   { 
                                         i f   ( t h i s   i n   o p t s )   { 
                                                 t h r o w   n e w   E r r o r ( " O p t i o n   ' "   +   t h i s   +   " '   i s   n o t   a l l o w e d   f o r   S e l e c t 2   w h e n   a t t a c h e d   t o   a   < s e l e c t >   e l e m e n t . " ) ; 
                                         } 
                                 } ) ; 
                         } 
 
                         o p t s   =   $ . e x t e n d ( { } ,   { 
                                 p o p u l a t e R e s u l t s :   f u n c t i o n ( c o n t a i n e r ,   r e s u l t s ,   q u e r y )   { 
                                         v a r   p o p u l a t e ,   i d = t h i s . o p t s . i d ,   l i v e R e g i o n = t h i s . l i v e R e g i o n ; 
 
                                         p o p u l a t e = f u n c t i o n ( r e s u l t s ,   c o n t a i n e r ,   d e p t h )   { 
 
                                                 v a r   i ,   l ,   r e s u l t ,   s e l e c t a b l e ,   d i s a b l e d ,   c o m p o u n d ,   n o d e ,   l a b e l ,   i n n e r C o n t a i n e r ,   f o r m a t t e d ; 
 
                                                 r e s u l t s   =   o p t s . s o r t R e s u l t s ( r e s u l t s ,   c o n t a i n e r ,   q u e r y ) ; 
 
                                                 / /   c o l l e c t   t h e   c r e a t e d   n o d e s   f o r   b u l k   a p p e n d 
                                                 v a r   n o d e s   =   [ ] ; 
                                                 f o r   ( i   =   0 ,   l   =   r e s u l t s . l e n g t h ;   i   <   l ;   i   =   i   +   1 )   { 
 
                                                         r e s u l t = r e s u l t s [ i ] ; 
 
                                                         d i s a b l e d   =   ( r e s u l t . d i s a b l e d   = = =   t r u e ) ; 
                                                         s e l e c t a b l e   =   ( ! d i s a b l e d )   & &   ( i d ( r e s u l t )   ! = =   u n d e f i n e d ) ; 
 
                                                         c o m p o u n d = r e s u l t . c h i l d r e n   & &   r e s u l t . c h i l d r e n . l e n g t h   >   0 ; 
 
                                                         n o d e = $ ( " < l i > < / l i > " ) ; 
                                                         n o d e . a d d C l a s s ( " s e l e c t 2 - r e s u l t s - d e p t - " + d e p t h ) ; 
                                                         n o d e . a d d C l a s s ( " s e l e c t 2 - r e s u l t " ) ; 
                                                         n o d e . a d d C l a s s ( s e l e c t a b l e   ?   " s e l e c t 2 - r e s u l t - s e l e c t a b l e "   :   " s e l e c t 2 - r e s u l t - u n s e l e c t a b l e " ) ; 
                                                         i f   ( d i s a b l e d )   {   n o d e . a d d C l a s s ( " s e l e c t 2 - d i s a b l e d " ) ;   } 
                                                         i f   ( c o m p o u n d )   {   n o d e . a d d C l a s s ( " s e l e c t 2 - r e s u l t - w i t h - c h i l d r e n " ) ;   } 
                                                         n o d e . a d d C l a s s ( s e l f . o p t s . f o r m a t R e s u l t C s s C l a s s ( r e s u l t ) ) ; 
                                                         n o d e . a t t r ( " r o l e " ,   " p r e s e n t a t i o n " ) ; 
 
                                                         l a b e l = $ ( d o c u m e n t . c r e a t e E l e m e n t ( " d i v " ) ) ; 
                                                         l a b e l . a d d C l a s s ( " s e l e c t 2 - r e s u l t - l a b e l " ) ; 
                                                         l a b e l . a t t r ( " i d " ,   " s e l e c t 2 - r e s u l t - l a b e l - "   +   n e x t U i d ( ) ) ; 
                                                         l a b e l . a t t r ( " r o l e " ,   " o p t i o n " ) ; 
 
                                                         f o r m a t t e d = o p t s . f o r m a t R e s u l t ( r e s u l t ,   l a b e l ,   q u e r y ,   s e l f . o p t s . e s c a p e M a r k u p ) ; 
                                                         i f   ( f o r m a t t e d ! = = u n d e f i n e d )   { 
                                                                 l a b e l . h t m l ( f o r m a t t e d ) ; 
                                                                 n o d e . a p p e n d ( l a b e l ) ; 
                                                         } 
 
 
                                                         i f   ( c o m p o u n d )   { 
 
                                                                 i n n e r C o n t a i n e r = $ ( " < u l > < / u l > " ) ; 
                                                                 i n n e r C o n t a i n e r . a d d C l a s s ( " s e l e c t 2 - r e s u l t - s u b " ) ; 
                                                                 p o p u l a t e ( r e s u l t . c h i l d r e n ,   i n n e r C o n t a i n e r ,   d e p t h + 1 ) ; 
                                                                 n o d e . a p p e n d ( i n n e r C o n t a i n e r ) ; 
                                                         } 
 
                                                         n o d e . d a t a ( " s e l e c t 2 - d a t a " ,   r e s u l t ) ; 
                                                         n o d e s . p u s h ( n o d e [ 0 ] ) ; 
                                                 } 
 
                                                 / /   b u l k   a p p e n d   t h e   c r e a t e d   n o d e s 
                                                 c o n t a i n e r . a p p e n d ( n o d e s ) ; 
                                                 l i v e R e g i o n . t e x t ( o p t s . f o r m a t M a t c h e s ( r e s u l t s . l e n g t h ) ) ; 
                                         } ; 
 
                                         p o p u l a t e ( r e s u l t s ,   c o n t a i n e r ,   0 ) ; 
                                 } 
                         } ,   $ . f n . s e l e c t 2 . d e f a u l t s ,   o p t s ) ; 
 
                         i f   ( t y p e o f ( o p t s . i d )   ! = =   " f u n c t i o n " )   { 
                                 i d K e y   =   o p t s . i d ; 
                                 o p t s . i d   =   f u n c t i o n   ( e )   {   r e t u r n   e [ i d K e y ] ;   } ; 
                         } 
 
                         i f   ( $ . i s A r r a y ( o p t s . e l e m e n t . d a t a ( " s e l e c t 2 T a g s " ) ) )   { 
                                 i f   ( " t a g s "   i n   o p t s )   { 
                                         t h r o w   " t a g s   s p e c i f i e d   a s   b o t h   a n   a t t r i b u t e   ' d a t a - s e l e c t 2 - t a g s '   a n d   i n   o p t i o n s   o f   S e l e c t 2   "   +   o p t s . e l e m e n t . a t t r ( " i d " ) ; 
                                 } 
                                 o p t s . t a g s = o p t s . e l e m e n t . d a t a ( " s e l e c t 2 T a g s " ) ; 
                         } 
 
                         i f   ( s e l e c t )   { 
                                 o p t s . q u e r y   =   t h i s . b i n d ( f u n c t i o n   ( q u e r y )   { 
                                         v a r   d a t a   =   {   r e s u l t s :   [ ] ,   m o r e :   f a l s e   } , 
                                                 t e r m   =   q u e r y . t e r m , 
                                                 c h i l d r e n ,   p l a c e h o l d e r O p t i o n ,   p r o c e s s ; 
 
                                         p r o c e s s = f u n c t i o n ( e l e m e n t ,   c o l l e c t i o n )   { 
                                                 v a r   g r o u p ; 
                                                 i f   ( e l e m e n t . i s ( " o p t i o n " ) )   { 
                                                         i f   ( q u e r y . m a t c h e r ( t e r m ,   e l e m e n t . t e x t ( ) ,   e l e m e n t ) )   { 
                                                                 c o l l e c t i o n . p u s h ( s e l f . o p t i o n T o D a t a ( e l e m e n t ) ) ; 
                                                         } 
                                                 }   e l s e   i f   ( e l e m e n t . i s ( " o p t g r o u p " ) )   { 
                                                         g r o u p = s e l f . o p t i o n T o D a t a ( e l e m e n t ) ; 
                                                         e l e m e n t . c h i l d r e n ( ) . e a c h 2 ( f u n c t i o n ( i ,   e l m )   {   p r o c e s s ( e l m ,   g r o u p . c h i l d r e n ) ;   } ) ; 
                                                         i f   ( g r o u p . c h i l d r e n . l e n g t h > 0 )   { 
                                                                 c o l l e c t i o n . p u s h ( g r o u p ) ; 
                                                         } 
                                                 } 
                                         } ; 
 
                                         c h i l d r e n = e l e m e n t . c h i l d r e n ( ) ; 
 
                                         / /   i g n o r e   t h e   p l a c e h o l d e r   o p t i o n   i f   t h e r e   i s   o n e 
                                         i f   ( t h i s . g e t P l a c e h o l d e r ( )   ! = =   u n d e f i n e d   & &   c h i l d r e n . l e n g t h   >   0 )   { 
                                                 p l a c e h o l d e r O p t i o n   =   t h i s . g e t P l a c e h o l d e r O p t i o n ( ) ; 
                                                 i f   ( p l a c e h o l d e r O p t i o n )   { 
                                                         c h i l d r e n = c h i l d r e n . n o t ( p l a c e h o l d e r O p t i o n ) ; 
                                                 } 
                                         } 
 
                                         c h i l d r e n . e a c h 2 ( f u n c t i o n ( i ,   e l m )   {   p r o c e s s ( e l m ,   d a t a . r e s u l t s ) ;   } ) ; 
 
                                         q u e r y . c a l l b a c k ( d a t a ) ; 
                                 } ) ; 
                                 / /   t h i s   i s   n e e d e d   b e c a u s e   i n s i d e   v a l ( )   w e   c o n s t r u c t   c h o i c e s   f r o m   o p t i o n s   a n d   t h e i r   i d   i s   h a r d c o d e d 
                                 o p t s . i d = f u n c t i o n ( e )   {   r e t u r n   e . i d ;   } ; 
                         }   e l s e   { 
                                 i f   ( ! ( " q u e r y "   i n   o p t s ) )   { 
 
                                         i f   ( " a j a x "   i n   o p t s )   { 
                                                 a j a x U r l   =   o p t s . e l e m e n t . d a t a ( " a j a x - u r l " ) ; 
                                                 i f   ( a j a x U r l   & &   a j a x U r l . l e n g t h   >   0 )   { 
                                                         o p t s . a j a x . u r l   =   a j a x U r l ; 
                                                 } 
                                                 o p t s . q u e r y   =   a j a x . c a l l ( o p t s . e l e m e n t ,   o p t s . a j a x ) ; 
                                         }   e l s e   i f   ( " d a t a "   i n   o p t s )   { 
                                                 o p t s . q u e r y   =   l o c a l ( o p t s . d a t a ) ; 
                                         }   e l s e   i f   ( " t a g s "   i n   o p t s )   { 
                                                 o p t s . q u e r y   =   t a g s ( o p t s . t a g s ) ; 
                                                 i f   ( o p t s . c r e a t e S e a r c h C h o i c e   = = =   u n d e f i n e d )   { 
                                                         o p t s . c r e a t e S e a r c h C h o i c e   =   f u n c t i o n   ( t e r m )   {   r e t u r n   { i d :   $ . t r i m ( t e r m ) ,   t e x t :   $ . t r i m ( t e r m ) } ;   } ; 
                                                 } 
                                                 i f   ( o p t s . i n i t S e l e c t i o n   = = =   u n d e f i n e d )   { 
                                                         o p t s . i n i t S e l e c t i o n   =   f u n c t i o n   ( e l e m e n t ,   c a l l b a c k )   { 
                                                                 v a r   d a t a   =   [ ] ; 
                                                                 $ ( s p l i t V a l ( e l e m e n t . v a l ( ) ,   o p t s . s e p a r a t o r ,   o p t s . t r a n s f o r m V a l ) ) . e a c h ( f u n c t i o n   ( )   { 
                                                                         v a r   o b j   =   {   i d :   t h i s ,   t e x t :   t h i s   } , 
                                                                                 t a g s   =   o p t s . t a g s ; 
                                                                         i f   ( $ . i s F u n c t i o n ( t a g s ) )   t a g s = t a g s ( ) ; 
                                                                         $ ( t a g s ) . e a c h ( f u n c t i o n ( )   {   i f   ( e q u a l ( t h i s . i d ,   o b j . i d ) )   {   o b j   =   t h i s ;   r e t u r n   f a l s e ;   }   } ) ; 
                                                                         d a t a . p u s h ( o b j ) ; 
                                                                 } ) ; 
 
                                                                 c a l l b a c k ( d a t a ) ; 
                                                         } ; 
                                                 } 
                                         } 
                                 } 
                         } 
                         i f   ( t y p e o f ( o p t s . q u e r y )   ! = =   " f u n c t i o n " )   { 
                                 t h r o w   " q u e r y   f u n c t i o n   n o t   d e f i n e d   f o r   S e l e c t 2   "   +   o p t s . e l e m e n t . a t t r ( " i d " ) ; 
                         } 
 
                         i f   ( o p t s . c r e a t e S e a r c h C h o i c e P o s i t i o n   = = =   ' t o p ' )   { 
                                 o p t s . c r e a t e S e a r c h C h o i c e P o s i t i o n   =   f u n c t i o n ( l i s t ,   i t e m )   {   l i s t . u n s h i f t ( i t e m ) ;   } ; 
                         } 
                         e l s e   i f   ( o p t s . c r e a t e S e a r c h C h o i c e P o s i t i o n   = = =   ' b o t t o m ' )   { 
                                 o p t s . c r e a t e S e a r c h C h o i c e P o s i t i o n   =   f u n c t i o n ( l i s t ,   i t e m )   {   l i s t . p u s h ( i t e m ) ;   } ; 
                         } 
                         e l s e   i f   ( t y p e o f ( o p t s . c r e a t e S e a r c h C h o i c e P o s i t i o n )   ! = =   " f u n c t i o n " )     { 
                                 t h r o w   " i n v a l i d   c r e a t e S e a r c h C h o i c e P o s i t i o n   o p t i o n   m u s t   b e   ' t o p ' ,   ' b o t t o m '   o r   a   c u s t o m   f u n c t i o n " ; 
                         } 
 
                         r e t u r n   o p t s ; 
                 } , 
 
                 / * * 
                   *   M o n i t o r   t h e   o r i g i n a l   e l e m e n t   f o r   c h a n g e s   a n d   u p d a t e   s e l e c t 2   a c c o r d i n g l y 
                   * / 
                 / /   a b s t r a c t 
                 m o n i t o r S o u r c e :   f u n c t i o n   ( )   { 
                         v a r   e l   =   t h i s . o p t s . e l e m e n t ,   o b s e r v e r ,   s e l f   =   t h i s ; 
 
                         e l . o n ( " c h a n g e . s e l e c t 2 " ,   t h i s . b i n d ( f u n c t i o n   ( e )   { 
                                 i f   ( t h i s . o p t s . e l e m e n t . d a t a ( " s e l e c t 2 - c h a n g e - t r i g g e r e d " )   ! = =   t r u e )   { 
                                         t h i s . i n i t S e l e c t i o n ( ) ; 
                                 } 
                         } ) ) ; 
 
                         t h i s . _ s y n c   =   t h i s . b i n d ( f u n c t i o n   ( )   { 
 
                                 / /   s y n c   e n a b l e d   s t a t e 
                                 v a r   d i s a b l e d   =   e l . p r o p ( " d i s a b l e d " ) ; 
                                 i f   ( d i s a b l e d   = = =   u n d e f i n e d )   d i s a b l e d   =   f a l s e ; 
                                 t h i s . e n a b l e ( ! d i s a b l e d ) ; 
 
                                 v a r   r e a d o n l y   =   e l . p r o p ( " r e a d o n l y " ) ; 
                                 i f   ( r e a d o n l y   = = =   u n d e f i n e d )   r e a d o n l y   =   f a l s e ; 
                                 t h i s . r e a d o n l y ( r e a d o n l y ) ; 
 
                                 i f   ( t h i s . c o n t a i n e r )   { 
                                         s y n c C s s C l a s s e s ( t h i s . c o n t a i n e r ,   t h i s . o p t s . e l e m e n t ,   t h i s . o p t s . a d a p t C o n t a i n e r C s s C l a s s ) ; 
                                         t h i s . c o n t a i n e r . a d d C l a s s ( e v a l u a t e ( t h i s . o p t s . c o n t a i n e r C s s C l a s s ,   t h i s . o p t s . e l e m e n t ) ) ; 
                                 } 
 
                                 i f   ( t h i s . d r o p d o w n )   { 
                                         s y n c C s s C l a s s e s ( t h i s . d r o p d o w n ,   t h i s . o p t s . e l e m e n t ,   t h i s . o p t s . a d a p t D r o p d o w n C s s C l a s s ) ; 
                                         t h i s . d r o p d o w n . a d d C l a s s ( e v a l u a t e ( t h i s . o p t s . d r o p d o w n C s s C l a s s ,   t h i s . o p t s . e l e m e n t ) ) ; 
                                 } 
 
                         } ) ; 
 
                         / /   I E 8 - 1 0   ( I E 9 / 1 0   w o n ' t   f i r e   p r o p e r t y C h a n g e   v i a   a t t a c h E v e n t L i s t e n e r ) 
                         i f   ( e l . l e n g t h   & &   e l [ 0 ] . a t t a c h E v e n t )   { 
                                 e l . e a c h ( f u n c t i o n ( )   { 
                                         t h i s . a t t a c h E v e n t ( " o n p r o p e r t y c h a n g e " ,   s e l f . _ s y n c ) ; 
                                 } ) ; 
                         } 
 
                         / /   s a f a r i ,   c h r o m e ,   f i r e f o x ,   I E 1 1 
                         o b s e r v e r   =   w i n d o w . M u t a t i o n O b s e r v e r   | |   w i n d o w . W e b K i t M u t a t i o n O b s e r v e r | |   w i n d o w . M o z M u t a t i o n O b s e r v e r ; 
                         i f   ( o b s e r v e r   ! = =   u n d e f i n e d )   { 
                                 i f   ( t h i s . p r o p e r t y O b s e r v e r )   {   d e l e t e   t h i s . p r o p e r t y O b s e r v e r ;   t h i s . p r o p e r t y O b s e r v e r   =   n u l l ;   } 
                                 t h i s . p r o p e r t y O b s e r v e r   =   n e w   o b s e r v e r ( f u n c t i o n   ( m u t a t i o n s )   { 
                                         $ . e a c h ( m u t a t i o n s ,   s e l f . _ s y n c ) ; 
                                 } ) ; 
                                 t h i s . p r o p e r t y O b s e r v e r . o b s e r v e ( e l . g e t ( 0 ) ,   {   a t t r i b u t e s : t r u e ,   s u b t r e e : f a l s e   } ) ; 
                         } 
                 } , 
 
                 / /   a b s t r a c t 
                 t r i g g e r S e l e c t :   f u n c t i o n ( d a t a )   { 
                         v a r   e v t   =   $ . E v e n t ( " s e l e c t 2 - s e l e c t i n g " ,   {   v a l :   t h i s . i d ( d a t a ) ,   o b j e c t :   d a t a ,   c h o i c e :   d a t a   } ) ; 
                         t h i s . o p t s . e l e m e n t . t r i g g e r ( e v t ) ; 
                         r e t u r n   ! e v t . i s D e f a u l t P r e v e n t e d ( ) ; 
                 } , 
 
                 / * * 
                   *   T r i g g e r s   t h e   c h a n g e   e v e n t   o n   t h e   s o u r c e   e l e m e n t 
                   * / 
                 / /   a b s t r a c t 
                 t r i g g e r C h a n g e :   f u n c t i o n   ( d e t a i l s )   { 
 
                         d e t a i l s   =   d e t a i l s   | |   { } ; 
                         d e t a i l s =   $ . e x t e n d ( { } ,   d e t a i l s ,   {   t y p e :   " c h a n g e " ,   v a l :   t h i s . v a l ( )   } ) ; 
                         / /   p r e v e n t s   r e c u r s i v e   t r i g g e r i n g 
                         t h i s . o p t s . e l e m e n t . d a t a ( " s e l e c t 2 - c h a n g e - t r i g g e r e d " ,   t r u e ) ; 
                         t h i s . o p t s . e l e m e n t . t r i g g e r ( d e t a i l s ) ; 
                         t h i s . o p t s . e l e m e n t . d a t a ( " s e l e c t 2 - c h a n g e - t r i g g e r e d " ,   f a l s e ) ; 
 
                         / /   s o m e   v a l i d a t i o n   f r a m e w o r k s   i g n o r e   t h e   c h a n g e   e v e n t   a n d   l i s t e n   i n s t e a d   t o   k e y u p ,   c l i c k   f o r   s e l e c t s 
                         / /   s o   h e r e   w e   t r i g g e r   t h e   c l i c k   e v e n t   m a n u a l l y 
                         t h i s . o p t s . e l e m e n t . c l i c k ( ) ; 
 
                         / /   V a l i d a t i o n E n g i n e   i g n o r e s   t h e   c h a n g e   e v e n t   a n d   l i s t e n s   i n s t e a d   t o   b l u r 
                         / /   s o   h e r e   w e   t r i g g e r   t h e   b l u r   e v e n t   m a n u a l l y   i f   s o   d e s i r e d 
                         i f   ( t h i s . o p t s . b l u r O n C h a n g e ) 
                                 t h i s . o p t s . e l e m e n t . b l u r ( ) ; 
                 } , 
 
                 / / a b s t r a c t 
                 i s I n t e r f a c e E n a b l e d :   f u n c t i o n ( ) 
                 { 
                         r e t u r n   t h i s . e n a b l e d I n t e r f a c e   = = =   t r u e ; 
                 } , 
 
                 / /   a b s t r a c t 
                 e n a b l e I n t e r f a c e :   f u n c t i o n ( )   { 
                         v a r   e n a b l e d   =   t h i s . _ e n a b l e d   & &   ! t h i s . _ r e a d o n l y , 
                                 d i s a b l e d   =   ! e n a b l e d ; 
 
                         i f   ( e n a b l e d   = = =   t h i s . e n a b l e d I n t e r f a c e )   r e t u r n   f a l s e ; 
 
                         t h i s . c o n t a i n e r . t o g g l e C l a s s ( " s e l e c t 2 - c o n t a i n e r - d i s a b l e d " ,   d i s a b l e d ) ; 
                         t h i s . c l o s e ( ) ; 
                         t h i s . e n a b l e d I n t e r f a c e   =   e n a b l e d ; 
 
                         r e t u r n   t r u e ; 
                 } , 
 
                 / /   a b s t r a c t 
                 e n a b l e :   f u n c t i o n ( e n a b l e d )   { 
                         i f   ( e n a b l e d   = = =   u n d e f i n e d )   e n a b l e d   =   t r u e ; 
                         i f   ( t h i s . _ e n a b l e d   = = =   e n a b l e d )   r e t u r n ; 
                         t h i s . _ e n a b l e d   =   e n a b l e d ; 
 
                         t h i s . o p t s . e l e m e n t . p r o p ( " d i s a b l e d " ,   ! e n a b l e d ) ; 
                         t h i s . e n a b l e I n t e r f a c e ( ) ; 
                 } , 
 
                 / /   a b s t r a c t 
                 d i s a b l e :   f u n c t i o n ( )   { 
                         t h i s . e n a b l e ( f a l s e ) ; 
                 } , 
 
                 / /   a b s t r a c t 
                 r e a d o n l y :   f u n c t i o n ( e n a b l e d )   { 
                         i f   ( e n a b l e d   = = =   u n d e f i n e d )   e n a b l e d   =   f a l s e ; 
                         i f   ( t h i s . _ r e a d o n l y   = = =   e n a b l e d )   r e t u r n ; 
                         t h i s . _ r e a d o n l y   =   e n a b l e d ; 
 
                         t h i s . o p t s . e l e m e n t . p r o p ( " r e a d o n l y " ,   e n a b l e d ) ; 
                         t h i s . e n a b l e I n t e r f a c e ( ) ; 
                 } , 
 
                 / /   a b s t r a c t 
                 o p e n e d :   f u n c t i o n   ( )   { 
                         r e t u r n   ( t h i s . c o n t a i n e r )   ?   t h i s . c o n t a i n e r . h a s C l a s s ( " s e l e c t 2 - d r o p d o w n - o p e n " )   :   f a l s e ; 
                 } , 
 
                 / /   a b s t r a c t 
                 p o s i t i o n D r o p d o w n :   f u n c t i o n ( )   { 
                         v a r   $ d r o p d o w n   =   t h i s . d r o p d o w n , 
                                 c o n t a i n e r   =   t h i s . c o n t a i n e r , 
                                 o f f s e t   =   c o n t a i n e r . o f f s e t ( ) , 
                                 h e i g h t   =   c o n t a i n e r . o u t e r H e i g h t ( f a l s e ) , 
                                 w i d t h   =   c o n t a i n e r . o u t e r W i d t h ( f a l s e ) , 
                                 d r o p H e i g h t   =   $ d r o p d o w n . o u t e r H e i g h t ( f a l s e ) , 
                                 $ w i n d o w   =   $ ( w i n d o w ) , 
                                 w i n d o w W i d t h   =   $ w i n d o w . w i d t h ( ) , 
                                 w i n d o w H e i g h t   =   $ w i n d o w . h e i g h t ( ) , 
                                 v i e w P o r t R i g h t   =   $ w i n d o w . s c r o l l L e f t ( )   +   w i n d o w W i d t h , 
                                 v i e w p o r t B o t t o m   =   $ w i n d o w . s c r o l l T o p ( )   +   w i n d o w H e i g h t , 
                                 d r o p T o p   =   o f f s e t . t o p   +   h e i g h t , 
                                 d r o p L e f t   =   o f f s e t . l e f t , 
                                 e n o u g h R o o m B e l o w   =   d r o p T o p   +   d r o p H e i g h t   < =   v i e w p o r t B o t t o m , 
                                 e n o u g h R o o m A b o v e   =   ( o f f s e t . t o p   -   d r o p H e i g h t )   > =   $ w i n d o w . s c r o l l T o p ( ) , 
                                 d r o p W i d t h   =   $ d r o p d o w n . o u t e r W i d t h ( f a l s e ) , 
                                 e n o u g h R o o m O n R i g h t   =   f u n c t i o n ( )   { 
                                         r e t u r n   d r o p L e f t   +   d r o p W i d t h   < =   v i e w P o r t R i g h t ; 
                                 } , 
                                 e n o u g h R o o m O n L e f t   =   f u n c t i o n ( )   { 
                                         r e t u r n   o f f s e t . l e f t   +   v i e w P o r t R i g h t   +   c o n t a i n e r . o u t e r W i d t h ( f a l s e )     >   d r o p W i d t h ; 
                                 } , 
                                 a b o v e N o w   =   $ d r o p d o w n . h a s C l a s s ( " s e l e c t 2 - d r o p - a b o v e " ) , 
                                 b o d y O f f s e t , 
                                 a b o v e , 
                                 c h a n g e D i r e c t i o n , 
                                 c s s , 
                                 r e s u l t s L i s t N o d e ; 
 
                         / /   a l w a y s   p r e f e r   t h e   c u r r e n t   a b o v e / b e l o w   a l i g n m e n t ,   u n l e s s   t h e r e   i s   n o t   e n o u g h   r o o m 
                         i f   ( a b o v e N o w )   { 
                                 a b o v e   =   t r u e ; 
                                 i f   ( ! e n o u g h R o o m A b o v e   & &   e n o u g h R o o m B e l o w )   { 
                                         c h a n g e D i r e c t i o n   =   t r u e ; 
                                         a b o v e   =   f a l s e ; 
                                 } 
                         }   e l s e   { 
                                 a b o v e   =   f a l s e ; 
                                 i f   ( ! e n o u g h R o o m B e l o w   & &   e n o u g h R o o m A b o v e )   { 
                                         c h a n g e D i r e c t i o n   =   t r u e ; 
                                         a b o v e   =   t r u e ; 
                                 } 
                         } 
 
                         / / i f   w e   a r e   c h a n g i n g   d i r e c t i o n   w e   n e e d   t o   g e t   p o s i t i o n s   w h e n   d r o p d o w n   i s   h i d d e n ; 
                         i f   ( c h a n g e D i r e c t i o n )   { 
                                 $ d r o p d o w n . h i d e ( ) ; 
                                 o f f s e t   =   t h i s . c o n t a i n e r . o f f s e t ( ) ; 
                                 h e i g h t   =   t h i s . c o n t a i n e r . o u t e r H e i g h t ( f a l s e ) ; 
                                 w i d t h   =   t h i s . c o n t a i n e r . o u t e r W i d t h ( f a l s e ) ; 
                                 d r o p H e i g h t   =   $ d r o p d o w n . o u t e r H e i g h t ( f a l s e ) ; 
                                 v i e w P o r t R i g h t   =   $ w i n d o w . s c r o l l L e f t ( )   +   w i n d o w W i d t h ; 
                                 v i e w p o r t B o t t o m   =   $ w i n d o w . s c r o l l T o p ( )   +   w i n d o w H e i g h t ; 
                                 d r o p T o p   =   o f f s e t . t o p   +   h e i g h t ; 
                                 d r o p L e f t   =   o f f s e t . l e f t ; 
                                 d r o p W i d t h   =   $ d r o p d o w n . o u t e r W i d t h ( f a l s e ) ; 
                                 $ d r o p d o w n . s h o w ( ) ; 
 
                                 / /   f i x   s o   t h e   c u r s o r   d o e s   n o t   m o v e   t o   t h e   l e f t   w i t h i n   t h e   s e a r c h - t e x t b o x   i n   I E 
                                 t h i s . f o c u s S e a r c h ( ) ; 
                         } 
 
                         i f   ( t h i s . o p t s . d r o p d o w n A u t o W i d t h )   { 
                                 r e s u l t s L i s t N o d e   =   $ ( ' . s e l e c t 2 - r e s u l t s ' ,   $ d r o p d o w n ) [ 0 ] ; 
                                 $ d r o p d o w n . a d d C l a s s ( ' s e l e c t 2 - d r o p - a u t o - w i d t h ' ) ; 
                                 $ d r o p d o w n . c s s ( ' w i d t h ' ,   ' ' ) ; 
                                 / /   A d d   s c r o l l b a r   w i d t h   t o   d r o p d o w n   i f   v e r t i c a l   s c r o l l b a r   i s   p r e s e n t 
                                 d r o p W i d t h   =   $ d r o p d o w n . o u t e r W i d t h ( f a l s e )   +   ( r e s u l t s L i s t N o d e . s c r o l l H e i g h t   = = =   r e s u l t s L i s t N o d e . c l i e n t H e i g h t   ?   0   :   s c r o l l B a r D i m e n s i o n s . w i d t h ) ; 
                                 d r o p W i d t h   >   w i d t h   ?   w i d t h   =   d r o p W i d t h   :   d r o p W i d t h   =   w i d t h ; 
                                 d r o p H e i g h t   =   $ d r o p d o w n . o u t e r H e i g h t ( f a l s e ) ; 
                         } 
                         e l s e   { 
                                 t h i s . c o n t a i n e r . r e m o v e C l a s s ( ' s e l e c t 2 - d r o p - a u t o - w i d t h ' ) ; 
                         } 
 
                         / / c o n s o l e . l o g ( " b e l o w /   d r o p t o p : " ,   d r o p T o p ,   " d r o p H e i g h t " ,   d r o p H e i g h t ,   " s u m " ,   ( d r o p T o p + d r o p H e i g h t ) + "   v i e w p o r t   b o t t o m " ,   v i e w p o r t B o t t o m ,   " e n o u g h ? " ,   e n o u g h R o o m B e l o w ) ; 
                         / / c o n s o l e . l o g ( " a b o v e /   o f f s e t . t o p " ,   o f f s e t . t o p ,   " d r o p H e i g h t " ,   d r o p H e i g h t ,   " t o p " ,   ( o f f s e t . t o p - d r o p H e i g h t ) ,   " s c r o l l T o p " ,   t h i s . b o d y . s c r o l l T o p ( ) ,   " e n o u g h ? " ,   e n o u g h R o o m A b o v e ) ; 
 
                         / /   f i x   p o s i t i o n i n g   w h e n   b o d y   h a s   a n   o f f s e t   a n d   i s   n o t   p o s i t i o n :   s t a t i c 
                         i f   ( t h i s . b o d y . c s s ( ' p o s i t i o n ' )   ! = =   ' s t a t i c ' )   { 
                                 b o d y O f f s e t   =   t h i s . b o d y . o f f s e t ( ) ; 
                                 d r o p T o p   - =   b o d y O f f s e t . t o p ; 
                                 d r o p L e f t   - =   b o d y O f f s e t . l e f t ; 
                         } 
 
                         i f   ( ! e n o u g h R o o m O n R i g h t ( )   & &   e n o u g h R o o m O n L e f t ( ) )   { 
                                 d r o p L e f t   =   o f f s e t . l e f t   +   t h i s . c o n t a i n e r . o u t e r W i d t h ( f a l s e )   -   d r o p W i d t h ; 
                         } 
 
                         c s s   =     { 
                                 l e f t :   d r o p L e f t , 
                                 w i d t h :   w i d t h 
                         } ; 
 
                         i f   ( a b o v e )   { 
                                 c s s . t o p   =   o f f s e t . t o p   -   d r o p H e i g h t ; 
                                 c s s . b o t t o m   =   ' a u t o ' ; 
                                 t h i s . c o n t a i n e r . a d d C l a s s ( " s e l e c t 2 - d r o p - a b o v e " ) ; 
                                 $ d r o p d o w n . a d d C l a s s ( " s e l e c t 2 - d r o p - a b o v e " ) ; 
                         } 
                         e l s e   { 
                                 c s s . t o p   =   d r o p T o p ; 
                                 c s s . b o t t o m   =   ' a u t o ' ; 
                                 t h i s . c o n t a i n e r . r e m o v e C l a s s ( " s e l e c t 2 - d r o p - a b o v e " ) ; 
                                 $ d r o p d o w n . r e m o v e C l a s s ( " s e l e c t 2 - d r o p - a b o v e " ) ; 
                         } 
                         c s s   =   $ . e x t e n d ( c s s ,   e v a l u a t e ( t h i s . o p t s . d r o p d o w n C s s ,   t h i s . o p t s . e l e m e n t ) ) ; 
 
                         $ d r o p d o w n . c s s ( c s s ) ; 
                 } , 
 
                 / /   a b s t r a c t 
                 s h o u l d O p e n :   f u n c t i o n ( )   { 
                         v a r   e v e n t ; 
 
                         i f   ( t h i s . o p e n e d ( ) )   r e t u r n   f a l s e ; 
 
                         i f   ( t h i s . _ e n a b l e d   = = =   f a l s e   | |   t h i s . _ r e a d o n l y   = = =   t r u e )   r e t u r n   f a l s e ; 
 
                         e v e n t   =   $ . E v e n t ( " s e l e c t 2 - o p e n i n g " ) ; 
                         t h i s . o p t s . e l e m e n t . t r i g g e r ( e v e n t ) ; 
                         r e t u r n   ! e v e n t . i s D e f a u l t P r e v e n t e d ( ) ; 
                 } , 
 
                 / /   a b s t r a c t 
                 c l e a r D r o p d o w n A l i g n m e n t P r e f e r e n c e :   f u n c t i o n ( )   { 
                         / /   c l e a r   t h e   c l a s s e s   u s e d   t o   f i g u r e   o u t   t h e   p r e f e r e n c e   o f   w h e r e   t h e   d r o p d o w n   s h o u l d   b e   o p e n e d 
                         t h i s . c o n t a i n e r . r e m o v e C l a s s ( " s e l e c t 2 - d r o p - a b o v e " ) ; 
                         t h i s . d r o p d o w n . r e m o v e C l a s s ( " s e l e c t 2 - d r o p - a b o v e " ) ; 
                 } , 
 
                 / * * 
                   *   O p e n s   t h e   d r o p d o w n 
                   * 
                   *   @ r e t u r n   { B o o l e a n }   w h e t h e r   o r   n o t   d r o p d o w n   w a s   o p e n e d .   T h i s   m e t h o d   w i l l   r e t u r n   f a l s e   i f ,   f o r   e x a m p l e , 
                   *   t h e   d r o p d o w n   i s   a l r e a d y   o p e n ,   o r   i f   t h e   ' o p e n '   e v e n t   l i s t e n e r   o n   t h e   e l e m e n t   c a l l e d   p r e v e n t D e f a u l t ( ) . 
                   * / 
                 / /   a b s t r a c t 
                 o p e n :   f u n c t i o n   ( )   { 
 
                         i f   ( ! t h i s . s h o u l d O p e n ( ) )   r e t u r n   f a l s e ; 
 
                         t h i s . o p e n i n g ( ) ; 
 
                         / /   O n l y   b i n d   t h e   d o c u m e n t   m o u s e m o v e   w h e n   t h e   d r o p d o w n   i s   v i s i b l e 
                         $ d o c u m e n t . o n ( " m o u s e m o v e . s e l e c t 2 E v e n t " ,   f u n c t i o n   ( e )   { 
                                 l a s t M o u s e P o s i t i o n . x   =   e . p a g e X ; 
                                 l a s t M o u s e P o s i t i o n . y   =   e . p a g e Y ; 
                         } ) ; 
 
                         r e t u r n   t r u e ; 
                 } , 
 
                 / * * 
                   *   P e r f o r m s   t h e   o p e n i n g   o f   t h e   d r o p d o w n 
                   * / 
                 / /   a b s t r a c t 
                 o p e n i n g :   f u n c t i o n ( )   { 
                         v a r   c i d   =   t h i s . c o n t a i n e r E v e n t N a m e , 
                                 s c r o l l   =   " s c r o l l . "   +   c i d , 
                                 r e s i z e   =   " r e s i z e . " + c i d , 
                                 o r i e n t   =   " o r i e n t a t i o n c h a n g e . " + c i d , 
                                 m a s k ; 
 
                         t h i s . c o n t a i n e r . a d d C l a s s ( " s e l e c t 2 - d r o p d o w n - o p e n " ) . a d d C l a s s ( " s e l e c t 2 - c o n t a i n e r - a c t i v e " ) ; 
 
                         t h i s . c l e a r D r o p d o w n A l i g n m e n t P r e f e r e n c e ( ) ; 
 
                         i f ( t h i s . d r o p d o w n [ 0 ]   ! = =   t h i s . b o d y . c h i l d r e n ( ) . l a s t ( ) [ 0 ] )   { 
                                 t h i s . d r o p d o w n . d e t a c h ( ) . a p p e n d T o ( t h i s . b o d y ) ; 
                         } 
 
                         / /   c r e a t e   t h e   d r o p d o w n   m a s k   i f   d o e s n ' t   a l r e a d y   e x i s t 
                         m a s k   =   $ ( " # s e l e c t 2 - d r o p - m a s k " ) ; 
                         i f   ( m a s k . l e n g t h   = = =   0 )   { 
                                 m a s k   =   $ ( d o c u m e n t . c r e a t e E l e m e n t ( " d i v " ) ) ; 
                                 m a s k . a t t r ( " i d " , " s e l e c t 2 - d r o p - m a s k " ) . a t t r ( " c l a s s " , " s e l e c t 2 - d r o p - m a s k " ) ; 
                                 m a s k . h i d e ( ) ; 
                                 m a s k . a p p e n d T o ( t h i s . b o d y ) ; 
                                 m a s k . o n ( " m o u s e d o w n   t o u c h s t a r t   c l i c k " ,   f u n c t i o n   ( e )   { 
                                         / /   P r e v e n t   I E   f r o m   g e n e r a t i n g   a   c l i c k   e v e n t   o n   t h e   b o d y 
                                         r e i n s e r t E l e m e n t ( m a s k ) ; 
 
                                         v a r   d r o p d o w n   =   $ ( " # s e l e c t 2 - d r o p " ) ,   s e l f ; 
                                         i f   ( d r o p d o w n . l e n g t h   >   0 )   { 
                                                 s e l f = d r o p d o w n . d a t a ( " s e l e c t 2 " ) ; 
                                                 i f   ( s e l f . o p t s . s e l e c t O n B l u r )   { 
                                                         s e l f . s e l e c t H i g h l i g h t e d ( { n o F o c u s :   t r u e } ) ; 
                                                 } 
                                                 s e l f . c l o s e ( ) ; 
                                                 e . p r e v e n t D e f a u l t ( ) ; 
                                                 e . s t o p P r o p a g a t i o n ( ) ; 
                                         } 
                                 } ) ; 
                         } 
 
                         / /   e n s u r e   t h e   m a s k   i s   a l w a y s   r i g h t   b e f o r e   t h e   d r o p d o w n 
                         i f   ( t h i s . d r o p d o w n . p r e v ( ) [ 0 ]   ! = =   m a s k [ 0 ] )   { 
                                 t h i s . d r o p d o w n . b e f o r e ( m a s k ) ; 
                         } 
 
                         / /   m o v e   t h e   g l o b a l   i d   t o   t h e   c o r r e c t   d r o p d o w n 
                         $ ( " # s e l e c t 2 - d r o p " ) . r e m o v e A t t r ( " i d " ) ; 
                         t h i s . d r o p d o w n . a t t r ( " i d " ,   " s e l e c t 2 - d r o p " ) ; 
 
                         / /   s h o w   t h e   e l e m e n t s 
                         m a s k . s h o w ( ) ; 
 
                         t h i s . p o s i t i o n D r o p d o w n ( ) ; 
                         t h i s . d r o p d o w n . s h o w ( ) ; 
                         t h i s . p o s i t i o n D r o p d o w n ( ) ; 
 
                         t h i s . d r o p d o w n . a d d C l a s s ( " s e l e c t 2 - d r o p - a c t i v e " ) ; 
 
                         / /   a t t a c h   l i s t e n e r s   t o   e v e n t s   t h a t   c a n   c h a n g e   t h e   p o s i t i o n   o f   t h e   c o n t a i n e r   a n d   t h u s   r e q u i r e 
                         / /   t h e   p o s i t i o n   o f   t h e   d r o p d o w n   t o   b e   u p d a t e d   a s   w e l l   s o   i t   d o e s   n o t   c o m e   u n g l u e d   f r o m   t h e   c o n t a i n e r 
                         v a r   t h a t   =   t h i s ; 
                         t h i s . c o n t a i n e r . p a r e n t s ( ) . a d d ( w i n d o w ) . e a c h ( f u n c t i o n   ( )   { 
                                 $ ( t h i s ) . o n ( r e s i z e + "   " + s c r o l l + "   " + o r i e n t ,   f u n c t i o n   ( e )   { 
                                         i f   ( t h a t . o p e n e d ( ) )   t h a t . p o s i t i o n D r o p d o w n ( ) ; 
                                 } ) ; 
                         } ) ; 
 
 
                 } , 
 
                 / /   a b s t r a c t 
                 c l o s e :   f u n c t i o n   ( )   { 
                         i f   ( ! t h i s . o p e n e d ( ) )   r e t u r n ; 
 
                         v a r   c i d   =   t h i s . c o n t a i n e r E v e n t N a m e , 
                                 s c r o l l   =   " s c r o l l . "   +   c i d , 
                                 r e s i z e   =   " r e s i z e . " + c i d , 
                                 o r i e n t   =   " o r i e n t a t i o n c h a n g e . " + c i d ; 
 
                         / /   u n b i n d   e v e n t   l i s t e n e r s 
                         t h i s . c o n t a i n e r . p a r e n t s ( ) . a d d ( w i n d o w ) . e a c h ( f u n c t i o n   ( )   {   $ ( t h i s ) . o f f ( s c r o l l ) . o f f ( r e s i z e ) . o f f ( o r i e n t ) ;   } ) ; 
 
                         t h i s . c l e a r D r o p d o w n A l i g n m e n t P r e f e r e n c e ( ) ; 
 
                         $ ( " # s e l e c t 2 - d r o p - m a s k " ) . h i d e ( ) ; 
                         t h i s . d r o p d o w n . r e m o v e A t t r ( " i d " ) ;   / /   o n l y   t h e   a c t i v e   d r o p d o w n   h a s   t h e   s e l e c t 2 - d r o p   i d 
                         t h i s . d r o p d o w n . h i d e ( ) ; 
                         t h i s . c o n t a i n e r . r e m o v e C l a s s ( " s e l e c t 2 - d r o p d o w n - o p e n " ) . r e m o v e C l a s s ( " s e l e c t 2 - c o n t a i n e r - a c t i v e " ) ; 
                         t h i s . r e s u l t s . e m p t y ( ) ; 
 
                         / /   N o w   t h a t   t h e   d r o p d o w n   i s   c l o s e d ,   u n b i n d   t h e   g l o b a l   d o c u m e n t   m o u s e m o v e   e v e n t 
                         $ d o c u m e n t . o f f ( " m o u s e m o v e . s e l e c t 2 E v e n t " ) ; 
 
                         t h i s . c l e a r S e a r c h ( ) ; 
                         t h i s . s e a r c h . r e m o v e C l a s s ( " s e l e c t 2 - a c t i v e " ) ; 
                         t h i s . o p t s . e l e m e n t . t r i g g e r ( $ . E v e n t ( " s e l e c t 2 - c l o s e " ) ) ; 
                 } , 
 
                 / * * 
                   *   O p e n s   c o n t r o l ,   s e t s   i n p u t   v a l u e ,   a n d   u p d a t e s   r e s u l t s . 
                   * / 
                 / /   a b s t r a c t 
                 e x t e r n a l S e a r c h :   f u n c t i o n   ( t e r m )   { 
                         t h i s . o p e n ( ) ; 
                         t h i s . s e a r c h . v a l ( t e r m ) ; 
                         t h i s . u p d a t e R e s u l t s ( f a l s e ) ; 
                 } , 
 
                 / /   a b s t r a c t 
                 c l e a r S e a r c h :   f u n c t i o n   ( )   { 
 
                 } , 
 
                 / / a b s t r a c t 
                 g e t M a x i m u m S e l e c t i o n S i z e :   f u n c t i o n ( )   { 
                         r e t u r n   e v a l u a t e ( t h i s . o p t s . m a x i m u m S e l e c t i o n S i z e ,   t h i s . o p t s . e l e m e n t ) ; 
                 } , 
 
                 / /   a b s t r a c t 
                 e n s u r e H i g h l i g h t V i s i b l e :   f u n c t i o n   ( )   { 
                         v a r   r e s u l t s   =   t h i s . r e s u l t s ,   c h i l d r e n ,   i n d e x ,   c h i l d ,   h b ,   r b ,   y ,   m o r e ,   t o p O f f s e t ; 
 
                         i n d e x   =   t h i s . h i g h l i g h t ( ) ; 
 
                         i f   ( i n d e x   <   0 )   r e t u r n ; 
 
                         i f   ( i n d e x   = =   0 )   { 
 
                                 / /   i f   t h e   f i r s t   e l e m e n t   i s   h i g h l i g h t e d   s c r o l l   a l l   t h e   w a y   t o   t h e   t o p , 
                                 / /   t h a t   w a y   a n y   u n s e l e c t a b l e   h e a d e r s   a b o v e   i t   w i l l   a l s o   b e   s c r o l l e d 
                                 / /   i n t o   v i e w 
 
                                 r e s u l t s . s c r o l l T o p ( 0 ) ; 
                                 r e t u r n ; 
                         } 
 
                         c h i l d r e n   =   t h i s . f i n d H i g h l i g h t a b l e C h o i c e s ( ) . f i n d ( ' . s e l e c t 2 - r e s u l t - l a b e l ' ) ; 
 
                         c h i l d   =   $ ( c h i l d r e n [ i n d e x ] ) ; 
 
                         t o p O f f s e t   =   ( c h i l d . o f f s e t ( )   | |   { } ) . t o p   | |   0 ; 
 
                         h b   =   t o p O f f s e t   +   c h i l d . o u t e r H e i g h t ( t r u e ) ; 
 
                         / /   i f   t h i s   i s   t h e   l a s t   c h i l d   l e t s   a l s o   m a k e   s u r e   s e l e c t 2 - m o r e - r e s u l t s   i s   v i s i b l e 
                         i f   ( i n d e x   = = =   c h i l d r e n . l e n g t h   -   1 )   { 
                                 m o r e   =   r e s u l t s . f i n d ( " l i . s e l e c t 2 - m o r e - r e s u l t s " ) ; 
                                 i f   ( m o r e . l e n g t h   >   0 )   { 
                                         h b   =   m o r e . o f f s e t ( ) . t o p   +   m o r e . o u t e r H e i g h t ( t r u e ) ; 
                                 } 
                         } 
 
                         r b   =   r e s u l t s . o f f s e t ( ) . t o p   +   r e s u l t s . o u t e r H e i g h t ( f a l s e ) ; 
                         i f   ( h b   >   r b )   { 
                                 r e s u l t s . s c r o l l T o p ( r e s u l t s . s c r o l l T o p ( )   +   ( h b   -   r b ) ) ; 
                         } 
                         y   =   t o p O f f s e t   -   r e s u l t s . o f f s e t ( ) . t o p ; 
 
                         / /   m a k e   s u r e   t h e   t o p   o f   t h e   e l e m e n t   i s   v i s i b l e 
                         i f   ( y   <   0   & &   c h i l d . c s s ( ' d i s p l a y ' )   ! =   ' n o n e '   )   { 
                                 r e s u l t s . s c r o l l T o p ( r e s u l t s . s c r o l l T o p ( )   +   y ) ;   / /   y   i s   n e g a t i v e 
                         } 
                 } , 
 
                 / /   a b s t r a c t 
                 f i n d H i g h l i g h t a b l e C h o i c e s :   f u n c t i o n ( )   { 
                         r e t u r n   t h i s . r e s u l t s . f i n d ( " . s e l e c t 2 - r e s u l t - s e l e c t a b l e : n o t ( . s e l e c t 2 - d i s a b l e d ) : n o t ( . s e l e c t 2 - s e l e c t e d ) " ) ; 
                 } , 
 
                 / /   a b s t r a c t 
                 m o v e H i g h l i g h t :   f u n c t i o n   ( d e l t a )   { 
                         v a r   c h o i c e s   =   t h i s . f i n d H i g h l i g h t a b l e C h o i c e s ( ) , 
                                 i n d e x   =   t h i s . h i g h l i g h t ( ) ; 
 
                         w h i l e   ( i n d e x   >   - 1   & &   i n d e x   <   c h o i c e s . l e n g t h )   { 
                                 i n d e x   + =   d e l t a ; 
                                 v a r   c h o i c e   =   $ ( c h o i c e s [ i n d e x ] ) ; 
                                 i f   ( c h o i c e . h a s C l a s s ( " s e l e c t 2 - r e s u l t - s e l e c t a b l e " )   & &   ! c h o i c e . h a s C l a s s ( " s e l e c t 2 - d i s a b l e d " )   & &   ! c h o i c e . h a s C l a s s ( " s e l e c t 2 - s e l e c t e d " ) )   { 
                                         t h i s . h i g h l i g h t ( i n d e x ) ; 
                                         b r e a k ; 
                                 } 
                         } 
                 } , 
 
                 / /   a b s t r a c t 
                 h i g h l i g h t :   f u n c t i o n   ( i n d e x )   { 
                         v a r   c h o i c e s   =   t h i s . f i n d H i g h l i g h t a b l e C h o i c e s ( ) , 
                                 c h o i c e , 
                                 d a t a ; 
 
                         i f   ( a r g u m e n t s . l e n g t h   = = =   0 )   { 
                                 r e t u r n   i n d e x O f ( c h o i c e s . f i l t e r ( " . s e l e c t 2 - h i g h l i g h t e d " ) [ 0 ] ,   c h o i c e s . g e t ( ) ) ; 
                         } 
 
                         i f   ( i n d e x   > =   c h o i c e s . l e n g t h )   i n d e x   =   c h o i c e s . l e n g t h   -   1 ; 
                         i f   ( i n d e x   <   0 )   i n d e x   =   0 ; 
 
                         t h i s . r e m o v e H i g h l i g h t ( ) ; 
 
                         c h o i c e   =   $ ( c h o i c e s [ i n d e x ] ) ; 
                         c h o i c e . a d d C l a s s ( " s e l e c t 2 - h i g h l i g h t e d " ) ; 
 
                         / /   e n s u r e   a s s i s t i v e   t e c h n o l o g y   c a n   d e t e r m i n e   t h e   a c t i v e   c h o i c e 
                         t h i s . s e a r c h . a t t r ( " a r i a - a c t i v e d e s c e n d a n t " ,   c h o i c e . f i n d ( " . s e l e c t 2 - r e s u l t - l a b e l " ) . a t t r ( " i d " ) ) ; 
 
                         t h i s . e n s u r e H i g h l i g h t V i s i b l e ( ) ; 
 
                         t h i s . l i v e R e g i o n . t e x t ( c h o i c e . t e x t ( ) ) ; 
 
                         d a t a   =   c h o i c e . d a t a ( " s e l e c t 2 - d a t a " ) ; 
                         i f   ( d a t a )   { 
                                 t h i s . o p t s . e l e m e n t . t r i g g e r ( {   t y p e :   " s e l e c t 2 - h i g h l i g h t " ,   v a l :   t h i s . i d ( d a t a ) ,   c h o i c e :   d a t a   } ) ; 
                         } 
                 } , 
 
                 r e m o v e H i g h l i g h t :   f u n c t i o n ( )   { 
                         t h i s . r e s u l t s . f i n d ( " . s e l e c t 2 - h i g h l i g h t e d " ) . r e m o v e C l a s s ( " s e l e c t 2 - h i g h l i g h t e d " ) ; 
                 } , 
 
                 t o u c h M o v e d :   f u n c t i o n ( )   { 
                         t h i s . _ t o u c h M o v e d   =   t r u e ; 
                 } , 
 
                 c l e a r T o u c h M o v e d :   f u n c t i o n ( )   { 
                     t h i s . _ t o u c h M o v e d   =   f a l s e ; 
                 } , 
 
                 / /   a b s t r a c t 
                 c o u n t S e l e c t a b l e R e s u l t s :   f u n c t i o n ( )   { 
                         r e t u r n   t h i s . f i n d H i g h l i g h t a b l e C h o i c e s ( ) . l e n g t h ; 
                 } , 
 
                 / /   a b s t r a c t 
                 h i g h l i g h t U n d e r E v e n t :   f u n c t i o n   ( e v e n t )   { 
                         v a r   e l   =   $ ( e v e n t . t a r g e t ) . c l o s e s t ( " . s e l e c t 2 - r e s u l t - s e l e c t a b l e " ) ; 
                         i f   ( e l . l e n g t h   >   0   & &   ! e l . i s ( " . s e l e c t 2 - h i g h l i g h t e d " ) )   { 
                                 v a r   c h o i c e s   =   t h i s . f i n d H i g h l i g h t a b l e C h o i c e s ( ) ; 
                                 t h i s . h i g h l i g h t ( c h o i c e s . i n d e x ( e l ) ) ; 
                         }   e l s e   i f   ( e l . l e n g t h   = =   0 )   { 
                                 / /   i f   w e   a r e   o v e r   a n   u n s e l e c t a b l e   i t e m   r e m o v e   a l l   h i g h l i g h t s 
                                 t h i s . r e m o v e H i g h l i g h t ( ) ; 
                         } 
                 } , 
 
                 / /   a b s t r a c t 
                 l o a d M o r e I f N e e d e d :   f u n c t i o n   ( )   { 
                         v a r   r e s u l t s   =   t h i s . r e s u l t s , 
                                 m o r e   =   r e s u l t s . f i n d ( " l i . s e l e c t 2 - m o r e - r e s u l t s " ) , 
                                 b e l o w ,   / /   p i x e l s   t h e   e l e m e n t   i s   b e l o w   t h e   s c r o l l   f o l d ,   b e l o w = = 0   i s   w h e n   t h e   e l e m e n t   i s   s t a r t i n g   t o   b e   v i s i b l e 
                                 p a g e   =   t h i s . r e s u l t s P a g e   +   1 , 
                                 s e l f = t h i s , 
                                 t e r m = t h i s . s e a r c h . v a l ( ) , 
                                 c o n t e x t = t h i s . c o n t e x t ; 
 
                         i f   ( m o r e . l e n g t h   = = =   0 )   r e t u r n ; 
                         b e l o w   =   m o r e . o f f s e t ( ) . t o p   -   r e s u l t s . o f f s e t ( ) . t o p   -   r e s u l t s . h e i g h t ( ) ; 
 
                         i f   ( b e l o w   < =   t h i s . o p t s . l o a d M o r e P a d d i n g )   { 
                                 m o r e . a d d C l a s s ( " s e l e c t 2 - a c t i v e " ) ; 
                                 t h i s . o p t s . q u e r y ( { 
                                                 e l e m e n t :   t h i s . o p t s . e l e m e n t , 
                                                 t e r m :   t e r m , 
                                                 p a g e :   p a g e , 
                                                 c o n t e x t :   c o n t e x t , 
                                                 m a t c h e r :   t h i s . o p t s . m a t c h e r , 
                                                 c a l l b a c k :   t h i s . b i n d ( f u n c t i o n   ( d a t a )   { 
 
                                         / /   i g n o r e   a   r e s p o n s e   i f   t h e   s e l e c t 2   h a s   b e e n   c l o s e d   b e f o r e   i t   w a s   r e c e i v e d 
                                         i f   ( ! s e l f . o p e n e d ( ) )   r e t u r n ; 
 
 
                                         s e l f . o p t s . p o p u l a t e R e s u l t s . c a l l ( t h i s ,   r e s u l t s ,   d a t a . r e s u l t s ,   { t e r m :   t e r m ,   p a g e :   p a g e ,   c o n t e x t : c o n t e x t } ) ; 
                                         s e l f . p o s t p r o c e s s R e s u l t s ( d a t a ,   f a l s e ,   f a l s e ) ; 
 
                                         i f   ( d a t a . m o r e = = = t r u e )   { 
                                                 m o r e . d e t a c h ( ) . a p p e n d T o ( r e s u l t s ) . h t m l ( s e l f . o p t s . e s c a p e M a r k u p ( e v a l u a t e ( s e l f . o p t s . f o r m a t L o a d M o r e ,   s e l f . o p t s . e l e m e n t ,   p a g e + 1 ) ) ) ; 
                                                 w i n d o w . s e t T i m e o u t ( f u n c t i o n ( )   {   s e l f . l o a d M o r e I f N e e d e d ( ) ;   } ,   1 0 ) ; 
                                         }   e l s e   { 
                                                 m o r e . r e m o v e ( ) ; 
                                         } 
                                         s e l f . p o s i t i o n D r o p d o w n ( ) ; 
                                         s e l f . r e s u l t s P a g e   =   p a g e ; 
                                         s e l f . c o n t e x t   =   d a t a . c o n t e x t ; 
                                         t h i s . o p t s . e l e m e n t . t r i g g e r ( {   t y p e :   " s e l e c t 2 - l o a d e d " ,   i t e m s :   d a t a   } ) ; 
                                 } ) } ) ; 
                         } 
                 } , 
 
                 / * * 
                   *   D e f a u l t   t o k e n i z e r   f u n c t i o n   w h i c h   d o e s   n o t h i n g 
                   * / 
                 t o k e n i z e :   f u n c t i o n ( )   { 
 
                 } , 
 
                 / * * 
                   *   @ p a r a m   i n i t i a l   w h e t h e r   o r   n o t   t h i s   i s   t h e   c a l l   t o   t h i s   m e t h o d   r i g h t   a f t e r   t h e   d r o p d o w n   h a s   b e e n   o p e n e d 
                   * / 
                 / /   a b s t r a c t 
                 u p d a t e R e s u l t s :   f u n c t i o n   ( i n i t i a l )   { 
                         v a r   s e a r c h   =   t h i s . s e a r c h , 
                                 r e s u l t s   =   t h i s . r e s u l t s , 
                                 o p t s   =   t h i s . o p t s , 
                                 d a t a , 
                                 s e l f   =   t h i s , 
                                 i n p u t , 
                                 t e r m   =   s e a r c h . v a l ( ) , 
                                 l a s t T e r m   =   $ . d a t a ( t h i s . c o n t a i n e r ,   " s e l e c t 2 - l a s t - t e r m " ) , 
                                 / /   s e q u e n c e   n u m b e r   u s e d   t o   d r o p   o u t - o f - o r d e r   r e s p o n s e s 
                                 q u e r y N u m b e r ; 
 
                         / /   p r e v e n t   d u p l i c a t e   q u e r i e s   a g a i n s t   t h e   s a m e   t e r m 
                         i f   ( i n i t i a l   ! = =   t r u e   & &   l a s t T e r m   & &   e q u a l ( t e r m ,   l a s t T e r m ) )   r e t u r n ; 
 
                         $ . d a t a ( t h i s . c o n t a i n e r ,   " s e l e c t 2 - l a s t - t e r m " ,   t e r m ) ; 
 
                         / /   i f   t h e   s e a r c h   i s   c u r r e n t l y   h i d d e n   w e   d o   n o t   a l t e r   t h e   r e s u l t s 
                         i f   ( i n i t i a l   ! = =   t r u e   & &   ( t h i s . s h o w S e a r c h I n p u t   = = =   f a l s e   | |   ! t h i s . o p e n e d ( ) ) )   { 
                                 r e t u r n ; 
                         } 
 
                         f u n c t i o n   p o s t R e n d e r ( )   { 
                                 s e a r c h . r e m o v e C l a s s ( " s e l e c t 2 - a c t i v e " ) ; 
                                 s e l f . p o s i t i o n D r o p d o w n ( ) ; 
                                 i f   ( r e s u l t s . f i n d ( ' . s e l e c t 2 - n o - r e s u l t s , . s e l e c t 2 - s e l e c t i o n - l i m i t , . s e l e c t 2 - s e a r c h i n g ' ) . l e n g t h )   { 
                                         s e l f . l i v e R e g i o n . t e x t ( r e s u l t s . t e x t ( ) ) ; 
                                 } 
                                 e l s e   { 
                                         s e l f . l i v e R e g i o n . t e x t ( s e l f . o p t s . f o r m a t M a t c h e s ( r e s u l t s . f i n d ( ' . s e l e c t 2 - r e s u l t - s e l e c t a b l e : n o t ( " . s e l e c t 2 - s e l e c t e d " ) ' ) . l e n g t h ) ) ; 
                                 } 
                         } 
 
                         f u n c t i o n   r e n d e r ( h t m l )   { 
                                 r e s u l t s . h t m l ( h t m l ) ; 
                                 p o s t R e n d e r ( ) ; 
                         } 
 
                         q u e r y N u m b e r   =   + + t h i s . q u e r y C o u n t ; 
 
                         v a r   m a x S e l S i z e   =   t h i s . g e t M a x i m u m S e l e c t i o n S i z e ( ) ; 
                         i f   ( m a x S e l S i z e   > = 1 )   { 
                                 d a t a   =   t h i s . d a t a ( ) ; 
                                 i f   ( $ . i s A r r a y ( d a t a )   & &   d a t a . l e n g t h   > =   m a x S e l S i z e   & &   c h e c k F o r m a t t e r ( o p t s . f o r m a t S e l e c t i o n T o o B i g ,   " f o r m a t S e l e c t i o n T o o B i g " ) )   { 
                                         r e n d e r ( " < l i   c l a s s = ' s e l e c t 2 - s e l e c t i o n - l i m i t ' > "   +   e v a l u a t e ( o p t s . f o r m a t S e l e c t i o n T o o B i g ,   o p t s . e l e m e n t ,   m a x S e l S i z e )   +   " < / l i > " ) ; 
                                         r e t u r n ; 
                                 } 
                         } 
 
                         i f   ( s e a r c h . v a l ( ) . l e n g t h   <   o p t s . m i n i m u m I n p u t L e n g t h )   { 
                                 i f   ( c h e c k F o r m a t t e r ( o p t s . f o r m a t I n p u t T o o S h o r t ,   " f o r m a t I n p u t T o o S h o r t " ) )   { 
                                         r e n d e r ( " < l i   c l a s s = ' s e l e c t 2 - n o - r e s u l t s ' > "   +   e v a l u a t e ( o p t s . f o r m a t I n p u t T o o S h o r t ,   o p t s . e l e m e n t ,   s e a r c h . v a l ( ) ,   o p t s . m i n i m u m I n p u t L e n g t h )   +   " < / l i > " ) ; 
                                 }   e l s e   { 
                                         r e n d e r ( " " ) ; 
                                 } 
                                 i f   ( i n i t i a l   & &   t h i s . s h o w S e a r c h )   t h i s . s h o w S e a r c h ( t r u e ) ; 
                                 r e t u r n ; 
                         } 
 
                         i f   ( o p t s . m a x i m u m I n p u t L e n g t h   & &   s e a r c h . v a l ( ) . l e n g t h   >   o p t s . m a x i m u m I n p u t L e n g t h )   { 
                                 i f   ( c h e c k F o r m a t t e r ( o p t s . f o r m a t I n p u t T o o L o n g ,   " f o r m a t I n p u t T o o L o n g " ) )   { 
                                         r e n d e r ( " < l i   c l a s s = ' s e l e c t 2 - n o - r e s u l t s ' > "   +   e v a l u a t e ( o p t s . f o r m a t I n p u t T o o L o n g ,   o p t s . e l e m e n t ,   s e a r c h . v a l ( ) ,   o p t s . m a x i m u m I n p u t L e n g t h )   +   " < / l i > " ) ; 
                                 }   e l s e   { 
                                         r e n d e r ( " " ) ; 
                                 } 
                                 r e t u r n ; 
                         } 
 
                         i f   ( o p t s . f o r m a t S e a r c h i n g   & &   t h i s . f i n d H i g h l i g h t a b l e C h o i c e s ( ) . l e n g t h   = = =   0 )   { 
                                 r e n d e r ( " < l i   c l a s s = ' s e l e c t 2 - s e a r c h i n g ' > "   +   e v a l u a t e ( o p t s . f o r m a t S e a r c h i n g ,   o p t s . e l e m e n t )   +   " < / l i > " ) ; 
                         } 
 
                         s e a r c h . a d d C l a s s ( " s e l e c t 2 - a c t i v e " ) ; 
 
                         t h i s . r e m o v e H i g h l i g h t ( ) ; 
 
                         / /   g i v e   t h e   t o k e n i z e r   a   c h a n c e   t o   p r e - p r o c e s s   t h e   i n p u t 
                         i n p u t   =   t h i s . t o k e n i z e ( ) ; 
                         i f   ( i n p u t   ! =   u n d e f i n e d   & &   i n p u t   ! =   n u l l )   { 
                                 s e a r c h . v a l ( i n p u t ) ; 
                         } 
 
                         t h i s . r e s u l t s P a g e   =   1 ; 
 
                         o p t s . q u e r y ( { 
                                 e l e m e n t :   o p t s . e l e m e n t , 
                                         t e r m :   s e a r c h . v a l ( ) , 
                                         p a g e :   t h i s . r e s u l t s P a g e , 
                                         c o n t e x t :   n u l l , 
                                         m a t c h e r :   o p t s . m a t c h e r , 
                                         c a l l b a c k :   t h i s . b i n d ( f u n c t i o n   ( d a t a )   { 
                                 v a r   d e f ;   / /   d e f a u l t   c h o i c e 
 
                                 / /   i g n o r e   o l d   r e s p o n s e s 
                                 i f   ( q u e r y N u m b e r   ! =   t h i s . q u e r y C o u n t )   { 
                                     r e t u r n ; 
                                 } 
 
                                 / /   i g n o r e   a   r e s p o n s e   i f   t h e   s e l e c t 2   h a s   b e e n   c l o s e d   b e f o r e   i t   w a s   r e c e i v e d 
                                 i f   ( ! t h i s . o p e n e d ( ) )   { 
                                         t h i s . s e a r c h . r e m o v e C l a s s ( " s e l e c t 2 - a c t i v e " ) ; 
                                         r e t u r n ; 
                                 } 
 
                                 / /   h a n d l e   a j a x   e r r o r 
                                 i f ( d a t a . h a s E r r o r   ! = =   u n d e f i n e d   & &   c h e c k F o r m a t t e r ( o p t s . f o r m a t A j a x E r r o r ,   " f o r m a t A j a x E r r o r " ) )   { 
                                         r e n d e r ( " < l i   c l a s s = ' s e l e c t 2 - a j a x - e r r o r ' > "   +   e v a l u a t e ( o p t s . f o r m a t A j a x E r r o r ,   o p t s . e l e m e n t ,   d a t a . j q X H R ,   d a t a . t e x t S t a t u s ,   d a t a . e r r o r T h r o w n )   +   " < / l i > " ) ; 
                                         r e t u r n ; 
                                 } 
 
                                 / /   s a v e   c o n t e x t ,   i f   a n y 
                                 t h i s . c o n t e x t   =   ( d a t a . c o n t e x t = = = u n d e f i n e d )   ?   n u l l   :   d a t a . c o n t e x t ; 
                                 / /   c r e a t e   a   d e f a u l t   c h o i c e   a n d   p r e p e n d   i t   t o   t h e   l i s t 
                                 i f   ( t h i s . o p t s . c r e a t e S e a r c h C h o i c e   & &   s e a r c h . v a l ( )   ! = =   " " )   { 
                                         d e f   =   t h i s . o p t s . c r e a t e S e a r c h C h o i c e . c a l l ( s e l f ,   s e a r c h . v a l ( ) ,   d a t a . r e s u l t s ) ; 
                                         i f   ( d e f   ! = =   u n d e f i n e d   & &   d e f   ! = =   n u l l   & &   s e l f . i d ( d e f )   ! = =   u n d e f i n e d   & &   s e l f . i d ( d e f )   ! = =   n u l l )   { 
                                                 i f   ( $ ( d a t a . r e s u l t s ) . f i l t e r ( 
                                                         f u n c t i o n   ( )   { 
                                                                 r e t u r n   e q u a l ( s e l f . i d ( t h i s ) ,   s e l f . i d ( d e f ) ) ; 
                                                         } ) . l e n g t h   = = =   0 )   { 
                                                         t h i s . o p t s . c r e a t e S e a r c h C h o i c e P o s i t i o n ( d a t a . r e s u l t s ,   d e f ) ; 
                                                 } 
                                         } 
                                 } 
 
                                 i f   ( d a t a . r e s u l t s . l e n g t h   = = =   0   & &   c h e c k F o r m a t t e r ( o p t s . f o r m a t N o M a t c h e s ,   " f o r m a t N o M a t c h e s " ) )   { 
                                         r e n d e r ( " < l i   c l a s s = ' s e l e c t 2 - n o - r e s u l t s ' > "   +   e v a l u a t e ( o p t s . f o r m a t N o M a t c h e s ,   o p t s . e l e m e n t ,   s e a r c h . v a l ( ) )   +   " < / l i > " ) ; 
                                         r e t u r n ; 
                                 } 
 
                                 r e s u l t s . e m p t y ( ) ; 
                                 s e l f . o p t s . p o p u l a t e R e s u l t s . c a l l ( t h i s ,   r e s u l t s ,   d a t a . r e s u l t s ,   { t e r m :   s e a r c h . v a l ( ) ,   p a g e :   t h i s . r e s u l t s P a g e ,   c o n t e x t : n u l l } ) ; 
 
                                 i f   ( d a t a . m o r e   = = =   t r u e   & &   c h e c k F o r m a t t e r ( o p t s . f o r m a t L o a d M o r e ,   " f o r m a t L o a d M o r e " ) )   { 
                                         r e s u l t s . a p p e n d ( " < l i   c l a s s = ' s e l e c t 2 - m o r e - r e s u l t s ' > "   +   o p t s . e s c a p e M a r k u p ( e v a l u a t e ( o p t s . f o r m a t L o a d M o r e ,   o p t s . e l e m e n t ,   t h i s . r e s u l t s P a g e ) )   +   " < / l i > " ) ; 
                                         w i n d o w . s e t T i m e o u t ( f u n c t i o n ( )   {   s e l f . l o a d M o r e I f N e e d e d ( ) ;   } ,   1 0 ) ; 
                                 } 
 
                                 t h i s . p o s t p r o c e s s R e s u l t s ( d a t a ,   i n i t i a l ) ; 
 
                                 p o s t R e n d e r ( ) ; 
 
                                 t h i s . o p t s . e l e m e n t . t r i g g e r ( {   t y p e :   " s e l e c t 2 - l o a d e d " ,   i t e m s :   d a t a   } ) ; 
                         } ) } ) ; 
                 } , 
 
                 / /   a b s t r a c t 
                 c a n c e l :   f u n c t i o n   ( )   { 
                         t h i s . c l o s e ( ) ; 
                 } , 
 
                 / /   a b s t r a c t 
                 b l u r :   f u n c t i o n   ( )   { 
                         / /   i f   s e l e c t O n B l u r   = =   t r u e ,   s e l e c t   t h e   c u r r e n t l y   h i g h l i g h t e d   o p t i o n 
                         i f   ( t h i s . o p t s . s e l e c t O n B l u r ) 
                                 t h i s . s e l e c t H i g h l i g h t e d ( { n o F o c u s :   t r u e } ) ; 
 
                         t h i s . c l o s e ( ) ; 
                         t h i s . c o n t a i n e r . r e m o v e C l a s s ( " s e l e c t 2 - c o n t a i n e r - a c t i v e " ) ; 
                         / /   s y n o n y m o u s   t o   . i s ( ' : f o c u s ' ) ,   w h i c h   i s   a v a i l a b l e   i n   j q u e r y   > =   1 . 6 
                         i f   ( t h i s . s e a r c h [ 0 ]   = = =   d o c u m e n t . a c t i v e E l e m e n t )   {   t h i s . s e a r c h . b l u r ( ) ;   } 
                         t h i s . c l e a r S e a r c h ( ) ; 
                         t h i s . s e l e c t i o n . f i n d ( " . s e l e c t 2 - s e a r c h - c h o i c e - f o c u s " ) . r e m o v e C l a s s ( " s e l e c t 2 - s e a r c h - c h o i c e - f o c u s " ) ; 
                 } , 
 
                 / /   a b s t r a c t 
                 f o c u s S e a r c h :   f u n c t i o n   ( )   { 
                         f o c u s ( t h i s . s e a r c h ) ; 
                 } , 
 
                 / /   a b s t r a c t 
                 s e l e c t H i g h l i g h t e d :   f u n c t i o n   ( o p t i o n s )   { 
                         i f   ( t h i s . _ t o u c h M o v e d )   { 
                             t h i s . c l e a r T o u c h M o v e d ( ) ; 
                             r e t u r n ; 
                         } 
                         v a r   i n d e x = t h i s . h i g h l i g h t ( ) , 
                                 h i g h l i g h t e d = t h i s . r e s u l t s . f i n d ( " . s e l e c t 2 - h i g h l i g h t e d " ) , 
                                 d a t a   =   h i g h l i g h t e d . c l o s e s t ( ' . s e l e c t 2 - r e s u l t ' ) . d a t a ( " s e l e c t 2 - d a t a " ) ; 
 
                         i f   ( d a t a )   { 
                                 t h i s . h i g h l i g h t ( i n d e x ) ; 
                                 t h i s . o n S e l e c t ( d a t a ,   o p t i o n s ) ; 
                         }   e l s e   i f   ( o p t i o n s   & &   o p t i o n s . n o F o c u s )   { 
                                 t h i s . c l o s e ( ) ; 
                         } 
                 } , 
 
                 / /   a b s t r a c t 
                 g e t P l a c e h o l d e r :   f u n c t i o n   ( )   { 
                         v a r   p l a c e h o l d e r O p t i o n ; 
                         r e t u r n   t h i s . o p t s . e l e m e n t . a t t r ( " p l a c e h o l d e r " )   | | 
                                 t h i s . o p t s . e l e m e n t . a t t r ( " d a t a - p l a c e h o l d e r " )   | |   / /   j q u e r y   1 . 4   c o m p a t 
                                 t h i s . o p t s . e l e m e n t . d a t a ( " p l a c e h o l d e r " )   | | 
                                 t h i s . o p t s . p l a c e h o l d e r   | | 
                                 ( ( p l a c e h o l d e r O p t i o n   =   t h i s . g e t P l a c e h o l d e r O p t i o n ( ) )   ! = =   u n d e f i n e d   ?   p l a c e h o l d e r O p t i o n . t e x t ( )   :   u n d e f i n e d ) ; 
                 } , 
 
                 / /   a b s t r a c t 
                 g e t P l a c e h o l d e r O p t i o n :   f u n c t i o n ( )   { 
                         i f   ( t h i s . s e l e c t )   { 
                                 v a r   f i r s t O p t i o n   =   t h i s . s e l e c t . c h i l d r e n ( ' o p t i o n ' ) . f i r s t ( ) ; 
                                 i f   ( t h i s . o p t s . p l a c e h o l d e r O p t i o n   ! = =   u n d e f i n e d   )   { 
                                         / / D e t e r m i n e   t h e   p l a c e h o l d e r   o p t i o n   b a s e d   o n   t h e   s p e c i f i e d   p l a c e h o l d e r O p t i o n   s e t t i n g 
                                         r e t u r n   ( t h i s . o p t s . p l a c e h o l d e r O p t i o n   = = =   " f i r s t "   & &   f i r s t O p t i o n )   | | 
                                                       ( t y p e o f   t h i s . o p t s . p l a c e h o l d e r O p t i o n   = = =   " f u n c t i o n "   & &   t h i s . o p t s . p l a c e h o l d e r O p t i o n ( t h i s . s e l e c t ) ) ; 
                                 }   e l s e   i f   ( $ . t r i m ( f i r s t O p t i o n . t e x t ( ) )   = = =   " "   & &   f i r s t O p t i o n . v a l ( )   = = =   " " )   { 
                                         / / N o   e x p l i c i t   p l a c e h o l d e r   o p t i o n   s p e c i f i e d ,   u s e   t h e   f i r s t   i f   i t ' s   b l a n k 
                                         r e t u r n   f i r s t O p t i o n ; 
                                 } 
                         } 
                 } , 
 
                 / * * 
                   *   G e t   t h e   d e s i r e d   w i d t h   f o r   t h e   c o n t a i n e r   e l e m e n t .     T h i s   i s 
                   *   d e r i v e d   f i r s t   f r o m   o p t i o n   ` w i d t h `   p a s s e d   t o   s e l e c t 2 ,   t h e n 
                   *   t h e   i n l i n e   ' s t y l e '   o n   t h e   o r i g i n a l   e l e m e n t ,   a n d   f i n a l l y 
                   *   f a l l s   b a c k   t o   t h e   j Q u e r y   c a l c u l a t e d   e l e m e n t   w i d t h . 
                   * / 
                 / /   a b s t r a c t 
                 i n i t C o n t a i n e r W i d t h :   f u n c t i o n   ( )   { 
                         f u n c t i o n   r e s o l v e C o n t a i n e r W i d t h ( )   { 
                                 v a r   s t y l e ,   a t t r s ,   m a t c h e s ,   i ,   l ,   a t t r ; 
 
                                 i f   ( t h i s . o p t s . w i d t h   = = =   " o f f " )   { 
                                         r e t u r n   n u l l ; 
                                 }   e l s e   i f   ( t h i s . o p t s . w i d t h   = = =   " e l e m e n t " ) { 
                                         r e t u r n   t h i s . o p t s . e l e m e n t . o u t e r W i d t h ( f a l s e )   = = =   0   ?   ' a u t o '   :   t h i s . o p t s . e l e m e n t . o u t e r W i d t h ( f a l s e )   +   ' p x ' ; 
                                 }   e l s e   i f   ( t h i s . o p t s . w i d t h   = = =   " c o p y "   | |   t h i s . o p t s . w i d t h   = = =   " r e s o l v e " )   { 
                                         / /   c h e c k   i f   t h e r e   i s   i n l i n e   s t y l e   o n   t h e   e l e m e n t   t h a t   c o n t a i n s   w i d t h 
                                         s t y l e   =   t h i s . o p t s . e l e m e n t . a t t r ( ' s t y l e ' ) ; 
                                         i f   ( s t y l e   ! = =   u n d e f i n e d )   { 
                                                 a t t r s   =   s t y l e . s p l i t ( ' ; ' ) ; 
                                                 f o r   ( i   =   0 ,   l   =   a t t r s . l e n g t h ;   i   <   l ;   i   =   i   +   1 )   { 
                                                         a t t r   =   a t t r s [ i ] . r e p l a c e ( / \ s / g ,   ' ' ) ; 
                                                         m a t c h e s   =   a t t r . m a t c h ( / ^ w i d t h : ( ( [ - + ] ? ( [ 0 - 9 ] * \ . ) ? [ 0 - 9 ] + ) ( p x | e m | e x | % | i n | c m | m m | p t | p c ) ) / i ) ; 
                                                         i f   ( m a t c h e s   ! = =   n u l l   & &   m a t c h e s . l e n g t h   > =   1 ) 
                                                                 r e t u r n   m a t c h e s [ 1 ] ; 
                                                 } 
                                         } 
 
                                         i f   ( t h i s . o p t s . w i d t h   = = =   " r e s o l v e " )   { 
                                                 / /   n e x t   c h e c k   i f   c s s ( ' w i d t h ' )   c a n   r e s o l v e   a   w i d t h   t h a t   i s   p e r c e n t   b a s e d ,   t h i s   i s   s o m e t i m e s   p o s s i b l e 
                                                 / /   w h e n   a t t a c h e d   t o   i n p u t   t y p e = h i d d e n   o r   e l e m e n t s   h i d d e n   v i a   c s s 
                                                 s t y l e   =   t h i s . o p t s . e l e m e n t . c s s ( ' w i d t h ' ) ; 
                                                 i f   ( s t y l e . i n d e x O f ( " % " )   >   0 )   r e t u r n   s t y l e ; 
 
                                                 / /   f i n a l l y ,   f a l l b a c k   o n   t h e   c a l c u l a t e d   w i d t h   o f   t h e   e l e m e n t 
                                                 r e t u r n   ( t h i s . o p t s . e l e m e n t . o u t e r W i d t h ( f a l s e )   = = =   0   ?   ' a u t o '   :   t h i s . o p t s . e l e m e n t . o u t e r W i d t h ( f a l s e )   +   ' p x ' ) ; 
                                         } 
 
                                         r e t u r n   n u l l ; 
                                 }   e l s e   i f   ( $ . i s F u n c t i o n ( t h i s . o p t s . w i d t h ) )   { 
                                         r e t u r n   t h i s . o p t s . w i d t h ( ) ; 
                                 }   e l s e   { 
                                         r e t u r n   t h i s . o p t s . w i d t h ; 
                               } 
                         } ; 
 
                         v a r   w i d t h   =   r e s o l v e C o n t a i n e r W i d t h . c a l l ( t h i s ) ; 
                         i f   ( w i d t h   ! = =   n u l l )   { 
                                 t h i s . c o n t a i n e r . c s s ( " w i d t h " ,   w i d t h ) ; 
                         } 
                 } 
         } ) ; 
 
         S i n g l e S e l e c t 2   =   c l a z z ( A b s t r a c t S e l e c t 2 ,   { 
 
                 / /   s i n g l e 
 
                 c r e a t e C o n t a i n e r :   f u n c t i o n   ( )   { 
                         v a r   c o n t a i n e r   =   $ ( d o c u m e n t . c r e a t e E l e m e n t ( " d i v " ) ) . a t t r ( { 
                                 " c l a s s " :   " s e l e c t 2 - c o n t a i n e r " 
                         } ) . h t m l ( [ 
                                 " < a   h r e f = ' j a v a s c r i p t : v o i d ( 0 ) '   c l a s s = ' s e l e c t 2 - c h o i c e '   t a b i n d e x = ' - 1 ' > " , 
                                 "       < s p a n   c l a s s = ' s e l e c t 2 - c h o s e n ' > & # 1 6 0 ; < / s p a n > < a b b r   c l a s s = ' s e l e c t 2 - s e a r c h - c h o i c e - c l o s e ' > < / a b b r > " , 
                                 "       < s p a n   c l a s s = ' s e l e c t 2 - a r r o w '   r o l e = ' p r e s e n t a t i o n ' > < b   r o l e = ' p r e s e n t a t i o n ' > < / b > < / s p a n > " , 
                                 " < / a > " , 
                                 " < l a b e l   f o r = ' '   c l a s s = ' s e l e c t 2 - o f f s c r e e n ' > < / l a b e l > " , 
                                 " < i n p u t   c l a s s = ' s e l e c t 2 - f o c u s s e r   s e l e c t 2 - o f f s c r e e n '   t y p e = ' t e x t '   a r i a - h a s p o p u p = ' t r u e '   r o l e = ' b u t t o n '   / > " , 
                                 " < d i v   c l a s s = ' s e l e c t 2 - d r o p   s e l e c t 2 - d i s p l a y - n o n e ' > " , 
                                 "       < d i v   c l a s s = ' s e l e c t 2 - s e a r c h ' > " , 
                                 "               < l a b e l   f o r = ' '   c l a s s = ' s e l e c t 2 - o f f s c r e e n ' > < / l a b e l > " , 
                                 "               < i n p u t   t y p e = ' t e x t '   a u t o c o m p l e t e = ' o f f '   a u t o c o r r e c t = ' o f f '   a u t o c a p i t a l i z e = ' o f f '   s p e l l c h e c k = ' f a l s e '   c l a s s = ' s e l e c t 2 - i n p u t '   r o l e = ' c o m b o b o x '   a r i a - e x p a n d e d = ' t r u e ' " , 
                                 "               a r i a - a u t o c o m p l e t e = ' l i s t '   / > " , 
                                 "       < / d i v > " , 
                                 "       < u l   c l a s s = ' s e l e c t 2 - r e s u l t s '   r o l e = ' l i s t b o x ' > " , 
                                 "       < / u l > " , 
                                 " < / d i v > " ] . j o i n ( " " ) ) ; 
                         r e t u r n   c o n t a i n e r ; 
                 } , 
 
                 / /   s i n g l e 
                 e n a b l e I n t e r f a c e :   f u n c t i o n ( )   { 
                         i f   ( t h i s . p a r e n t . e n a b l e I n t e r f a c e . a p p l y ( t h i s ,   a r g u m e n t s ) )   { 
                                 t h i s . f o c u s s e r . p r o p ( " d i s a b l e d " ,   ! t h i s . i s I n t e r f a c e E n a b l e d ( ) ) ; 
                         } 
                 } , 
 
                 / /   s i n g l e 
                 o p e n i n g :   f u n c t i o n   ( )   { 
                         v a r   e l ,   r a n g e ,   l e n ; 
 
                         i f   ( t h i s . o p t s . m i n i m u m R e s u l t s F o r S e a r c h   > =   0 )   { 
                                 t h i s . s h o w S e a r c h ( t r u e ) ; 
                         } 
 
                         t h i s . p a r e n t . o p e n i n g . a p p l y ( t h i s ,   a r g u m e n t s ) ; 
 
                         i f   ( t h i s . s h o w S e a r c h I n p u t   ! = =   f a l s e )   { 
                                 / /   I E   a p p e n d s   f o c u s s e r . v a l ( )   a t   t h e   e n d   o f   f i e l d   : /   s o   w e   m a n u a l l y   i n s e r t   i t   a t   t h e   b e g i n n i n g   u s i n g   a   r a n g e 
                                 / /   a l l   o t h e r   b r o w s e r s   h a n d l e   t h i s   j u s t   f i n e 
 
                                 t h i s . s e a r c h . v a l ( t h i s . f o c u s s e r . v a l ( ) ) ; 
                         } 
                         i f   ( t h i s . o p t s . s h o u l d F o c u s I n p u t ( t h i s ) )   { 
                                 t h i s . s e a r c h . f o c u s ( ) ; 
                                 / /   m o v e   t h e   c u r s o r   t o   t h e   e n d   a f t e r   f o c u s s i n g ,   o t h e r w i s e   i t   w i l l   b e   a t   t h e   b e g i n n i n g   a n d 
                                 / /   n e w   t e x t   w i l l   a p p e a r   * b e f o r e *   f o c u s s e r . v a l ( ) 
                                 e l   =   t h i s . s e a r c h . g e t ( 0 ) ; 
                                 i f   ( e l . c r e a t e T e x t R a n g e )   { 
                                         r a n g e   =   e l . c r e a t e T e x t R a n g e ( ) ; 
                                         r a n g e . c o l l a p s e ( f a l s e ) ; 
                                         r a n g e . s e l e c t ( ) ; 
                                 }   e l s e   i f   ( e l . s e t S e l e c t i o n R a n g e )   { 
                                         l e n   =   t h i s . s e a r c h . v a l ( ) . l e n g t h ; 
                                         e l . s e t S e l e c t i o n R a n g e ( l e n ,   l e n ) ; 
                                 } 
                         } 
 
                         / /   i n i t i a l i z e s   s e a r c h ' s   v a l u e   w i t h   n e x t S e a r c h T e r m   ( i f   d e f i n e d   b y   u s e r ) 
                         / /   i g n o r e   n e x t S e a r c h T e r m   i f   t h e   d r o p d o w n   i s   o p e n e d   b y   t h e   u s e r   p r e s s i n g   a   l e t t e r 
                         i f ( t h i s . s e a r c h . v a l ( )   = = =   " " )   { 
                                 i f ( t h i s . n e x t S e a r c h T e r m   ! =   u n d e f i n e d ) { 
                                         t h i s . s e a r c h . v a l ( t h i s . n e x t S e a r c h T e r m ) ; 
                                         t h i s . s e a r c h . s e l e c t ( ) ; 
                                 } 
                         } 
 
                         t h i s . f o c u s s e r . p r o p ( " d i s a b l e d " ,   t r u e ) . v a l ( " " ) ; 
                         t h i s . u p d a t e R e s u l t s ( t r u e ) ; 
                         t h i s . o p t s . e l e m e n t . t r i g g e r ( $ . E v e n t ( " s e l e c t 2 - o p e n " ) ) ; 
                 } , 
 
                 / /   s i n g l e 
                 c l o s e :   f u n c t i o n   ( )   { 
                         i f   ( ! t h i s . o p e n e d ( ) )   r e t u r n ; 
                         t h i s . p a r e n t . c l o s e . a p p l y ( t h i s ,   a r g u m e n t s ) ; 
 
                         t h i s . f o c u s s e r . p r o p ( " d i s a b l e d " ,   f a l s e ) ; 
 
                         i f   ( t h i s . o p t s . s h o u l d F o c u s I n p u t ( t h i s ) )   { 
                                 t h i s . f o c u s s e r . f o c u s ( ) ; 
                         } 
                 } , 
 
                 / /   s i n g l e 
                 f o c u s :   f u n c t i o n   ( )   { 
                         i f   ( t h i s . o p e n e d ( ) )   { 
                                 t h i s . c l o s e ( ) ; 
                         }   e l s e   { 
                                 t h i s . f o c u s s e r . p r o p ( " d i s a b l e d " ,   f a l s e ) ; 
                                 i f   ( t h i s . o p t s . s h o u l d F o c u s I n p u t ( t h i s ) )   { 
                                         t h i s . f o c u s s e r . f o c u s ( ) ; 
                                 } 
                         } 
                 } , 
 
                 / /   s i n g l e 
                 i s F o c u s e d :   f u n c t i o n   ( )   { 
                         r e t u r n   t h i s . c o n t a i n e r . h a s C l a s s ( " s e l e c t 2 - c o n t a i n e r - a c t i v e " ) ; 
                 } , 
 
                 / /   s i n g l e 
                 c a n c e l :   f u n c t i o n   ( )   { 
                         t h i s . p a r e n t . c a n c e l . a p p l y ( t h i s ,   a r g u m e n t s ) ; 
                         t h i s . f o c u s s e r . p r o p ( " d i s a b l e d " ,   f a l s e ) ; 
 
                         i f   ( t h i s . o p t s . s h o u l d F o c u s I n p u t ( t h i s ) )   { 
                                 t h i s . f o c u s s e r . f o c u s ( ) ; 
                         } 
                 } , 
 
                 / /   s i n g l e 
                 d e s t r o y :   f u n c t i o n ( )   { 
                         $ ( " l a b e l [ f o r = ' "   +   t h i s . f o c u s s e r . a t t r ( ' i d ' )   +   " ' ] " ) 
                                 . a t t r ( ' f o r ' ,   t h i s . o p t s . e l e m e n t . a t t r ( " i d " ) ) ; 
                         t h i s . p a r e n t . d e s t r o y . a p p l y ( t h i s ,   a r g u m e n t s ) ; 
 
                         c l e a n u p J Q u e r y E l e m e n t s . c a l l ( t h i s , 
                                 " s e l e c t i o n " , 
                                 " f o c u s s e r " 
                         ) ; 
                 } , 
 
                 / /   s i n g l e 
                 i n i t C o n t a i n e r :   f u n c t i o n   ( )   { 
 
                         v a r   s e l e c t i o n , 
                                 c o n t a i n e r   =   t h i s . c o n t a i n e r , 
                                 d r o p d o w n   =   t h i s . d r o p d o w n , 
                                 i d S u f f i x   =   n e x t U i d ( ) , 
                                 e l e m e n t L a b e l ; 
 
                         i f   ( t h i s . o p t s . m i n i m u m R e s u l t s F o r S e a r c h   <   0 )   { 
                                 t h i s . s h o w S e a r c h ( f a l s e ) ; 
                         }   e l s e   { 
                                 t h i s . s h o w S e a r c h ( t r u e ) ; 
                         } 
 
                         t h i s . s e l e c t i o n   =   s e l e c t i o n   =   c o n t a i n e r . f i n d ( " . s e l e c t 2 - c h o i c e " ) ; 
 
                         t h i s . f o c u s s e r   =   c o n t a i n e r . f i n d ( " . s e l e c t 2 - f o c u s s e r " ) ; 
 
                         / /   a d d   a r i a   a s s o c i a t i o n s 
                         s e l e c t i o n . f i n d ( " . s e l e c t 2 - c h o s e n " ) . a t t r ( " i d " ,   " s e l e c t 2 - c h o s e n - " + i d S u f f i x ) ; 
                         t h i s . f o c u s s e r . a t t r ( " a r i a - l a b e l l e d b y " ,   " s e l e c t 2 - c h o s e n - " + i d S u f f i x ) ; 
                         t h i s . r e s u l t s . a t t r ( " i d " ,   " s e l e c t 2 - r e s u l t s - " + i d S u f f i x ) ; 
                         t h i s . s e a r c h . a t t r ( " a r i a - o w n s " ,   " s e l e c t 2 - r e s u l t s - " + i d S u f f i x ) ; 
 
                         / /   r e w r i t e   l a b e l s   f r o m   o r i g i n a l   e l e m e n t   t o   f o c u s s e r 
                         t h i s . f o c u s s e r . a t t r ( " i d " ,   " s 2 i d _ a u t o g e n " + i d S u f f i x ) ; 
 
                         e l e m e n t L a b e l   =   $ ( " l a b e l [ f o r = ' "   +   t h i s . o p t s . e l e m e n t . a t t r ( " i d " )   +   " ' ] " ) ; 
                         t h i s . o p t s . e l e m e n t . f o c u s ( t h i s . b i n d ( f u n c t i o n   ( )   {   t h i s . f o c u s ( ) ;   } ) ) ; 
 
                         t h i s . f o c u s s e r . p r e v ( ) 
                                 . t e x t ( e l e m e n t L a b e l . t e x t ( ) ) 
                                 . a t t r ( ' f o r ' ,   t h i s . f o c u s s e r . a t t r ( ' i d ' ) ) ; 
 
                         / /   E n s u r e   t h e   o r i g i n a l   e l e m e n t   r e t a i n s   a n   a c c e s s i b l e   n a m e 
                         v a r   o r i g i n a l T i t l e   =   t h i s . o p t s . e l e m e n t . a t t r ( " t i t l e " ) ; 
                         t h i s . o p t s . e l e m e n t . a t t r ( " t i t l e " ,   ( o r i g i n a l T i t l e   | |   e l e m e n t L a b e l . t e x t ( ) ) ) ; 
 
                         t h i s . f o c u s s e r . a t t r ( " t a b i n d e x " ,   t h i s . e l e m e n t T a b I n d e x ) ; 
 
                         / /   w r i t e   l a b e l   f o r   s e a r c h   f i e l d   u s i n g   t h e   l a b e l   f r o m   t h e   f o c u s s e r   e l e m e n t 
                         t h i s . s e a r c h . a t t r ( " i d " ,   t h i s . f o c u s s e r . a t t r ( ' i d ' )   +   ' _ s e a r c h ' ) ; 
 
                         t h i s . s e a r c h . p r e v ( ) 
                                 . t e x t ( $ ( " l a b e l [ f o r = ' "   +   t h i s . f o c u s s e r . a t t r ( ' i d ' )   +   " ' ] " ) . t e x t ( ) ) 
                                 . a t t r ( ' f o r ' ,   t h i s . s e a r c h . a t t r ( ' i d ' ) ) ; 
 
                         t h i s . s e a r c h . o n ( " k e y d o w n " ,   t h i s . b i n d ( f u n c t i o n   ( e )   { 
                                 i f   ( ! t h i s . i s I n t e r f a c e E n a b l e d ( ) )   r e t u r n ; 
 
                                 / /   f i l t e r   2 2 9   k e y C o d e s   ( i n p u t   m e t h o d   e d i t o r   i s   p r o c e s s i n g   k e y   i n p u t ) 
                                 i f   ( 2 2 9   = =   e . k e y C o d e )   r e t u r n ; 
 
                                 i f   ( e . w h i c h   = = =   K E Y . P A G E _ U P   | |   e . w h i c h   = = =   K E Y . P A G E _ D O W N )   { 
                                         / /   p r e v e n t   t h e   p a g e   f r o m   s c r o l l i n g 
                                         k i l l E v e n t ( e ) ; 
                                         r e t u r n ; 
                                 } 
 
                                 s w i t c h   ( e . w h i c h )   { 
                                         c a s e   K E Y . U P : 
                                         c a s e   K E Y . D O W N : 
                                                 t h i s . m o v e H i g h l i g h t ( ( e . w h i c h   = = =   K E Y . U P )   ?   - 1   :   1 ) ; 
                                                 k i l l E v e n t ( e ) ; 
                                                 r e t u r n ; 
                                         c a s e   K E Y . E N T E R : 
                                                 t h i s . s e l e c t H i g h l i g h t e d ( ) ; 
                                                 k i l l E v e n t ( e ) ; 
                                                 r e t u r n ; 
                                         c a s e   K E Y . T A B : 
                                                 t h i s . s e l e c t H i g h l i g h t e d ( { n o F o c u s :   t r u e } ) ; 
                                                 r e t u r n ; 
                                         c a s e   K E Y . E S C : 
                                                 t h i s . c a n c e l ( e ) ; 
                                                 k i l l E v e n t ( e ) ; 
                                                 r e t u r n ; 
                                 } 
                         } ) ) ; 
 
                         t h i s . s e a r c h . o n ( " b l u r " ,   t h i s . b i n d ( f u n c t i o n ( e )   { 
                                 / /   a   w o r k a r o u n d   f o r   c h r o m e   t o   k e e p   t h e   s e a r c h   f i e l d   f o c u s s e d   w h e n   t h e   s c r o l l   b a r   i s   u s e d   t o   s c r o l l   t h e   d r o p d o w n . 
                                 / /   w i t h o u t   t h i s   t h e   s e a r c h   f i e l d   l o s e s   f o c u s   w h i c h   i s   a n n o y i n g 
                                 i f   ( d o c u m e n t . a c t i v e E l e m e n t   = = =   t h i s . b o d y . g e t ( 0 ) )   { 
                                         w i n d o w . s e t T i m e o u t ( t h i s . b i n d ( f u n c t i o n ( )   { 
                                                 i f   ( t h i s . o p e n e d ( ) )   { 
                                                         t h i s . s e a r c h . f o c u s ( ) ; 
                                                 } 
                                         } ) ,   0 ) ; 
                                 } 
                         } ) ) ; 
 
                         t h i s . f o c u s s e r . o n ( " k e y d o w n " ,   t h i s . b i n d ( f u n c t i o n   ( e )   { 
                                 i f   ( ! t h i s . i s I n t e r f a c e E n a b l e d ( ) )   r e t u r n ; 
 
                                 i f   ( e . w h i c h   = = =   K E Y . T A B   | |   K E Y . i s C o n t r o l ( e )   | |   K E Y . i s F u n c t i o n K e y ( e )   | |   e . w h i c h   = = =   K E Y . E S C )   { 
                                         r e t u r n ; 
                                 } 
 
                                 i f   ( t h i s . o p t s . o p e n O n E n t e r   = = =   f a l s e   & &   e . w h i c h   = = =   K E Y . E N T E R )   { 
                                         k i l l E v e n t ( e ) ; 
                                         r e t u r n ; 
                                 } 
 
                                 i f   ( e . w h i c h   = =   K E Y . D O W N   | |   e . w h i c h   = =   K E Y . U P 
                                         | |   ( e . w h i c h   = =   K E Y . E N T E R   & &   t h i s . o p t s . o p e n O n E n t e r ) )   { 
 
                                         i f   ( e . a l t K e y   | |   e . c t r l K e y   | |   e . s h i f t K e y   | |   e . m e t a K e y )   r e t u r n ; 
 
                                         t h i s . o p e n ( ) ; 
                                         k i l l E v e n t ( e ) ; 
                                         r e t u r n ; 
                                 } 
 
                                 i f   ( e . w h i c h   = =   K E Y . D E L E T E   | |   e . w h i c h   = =   K E Y . B A C K S P A C E )   { 
                                         i f   ( t h i s . o p t s . a l l o w C l e a r )   { 
                                                 t h i s . c l e a r ( ) ; 
                                         } 
                                         k i l l E v e n t ( e ) ; 
                                         r e t u r n ; 
                                 } 
                         } ) ) ; 
 
 
                         i n s t a l l K e y U p C h a n g e E v e n t ( t h i s . f o c u s s e r ) ; 
                         t h i s . f o c u s s e r . o n ( " k e y u p - c h a n g e   i n p u t " ,   t h i s . b i n d ( f u n c t i o n ( e )   { 
                                 i f   ( t h i s . o p t s . m i n i m u m R e s u l t s F o r S e a r c h   > =   0 )   { 
                                         e . s t o p P r o p a g a t i o n ( ) ; 
                                         i f   ( t h i s . o p e n e d ( ) )   r e t u r n ; 
                                         t h i s . o p e n ( ) ; 
                                 } 
                         } ) ) ; 
 
                         s e l e c t i o n . o n ( " m o u s e d o w n   t o u c h s t a r t " ,   " a b b r " ,   t h i s . b i n d ( f u n c t i o n   ( e )   { 
                                 i f   ( ! t h i s . i s I n t e r f a c e E n a b l e d ( ) )   { 
                                         r e t u r n ; 
                                 } 
 
                                 t h i s . c l e a r ( ) ; 
                                 k i l l E v e n t I m m e d i a t e l y ( e ) ; 
                                 t h i s . c l o s e ( ) ; 
 
                                 i f   ( t h i s . s e l e c t i o n )   { 
                                         t h i s . s e l e c t i o n . f o c u s ( ) ; 
                                 } 
                         } ) ) ; 
 
                         s e l e c t i o n . o n ( " m o u s e d o w n   t o u c h s t a r t " ,   t h i s . b i n d ( f u n c t i o n   ( e )   { 
                                 / /   P r e v e n t   I E   f r o m   g e n e r a t i n g   a   c l i c k   e v e n t   o n   t h e   b o d y 
                                 r e i n s e r t E l e m e n t ( s e l e c t i o n ) ; 
 
                                 i f   ( ! t h i s . c o n t a i n e r . h a s C l a s s ( " s e l e c t 2 - c o n t a i n e r - a c t i v e " ) )   { 
                                         t h i s . o p t s . e l e m e n t . t r i g g e r ( $ . E v e n t ( " s e l e c t 2 - f o c u s " ) ) ; 
                                 } 
 
                                 i f   ( t h i s . o p e n e d ( ) )   { 
                                         t h i s . c l o s e ( ) ; 
                                 }   e l s e   i f   ( t h i s . i s I n t e r f a c e E n a b l e d ( ) )   { 
                                         t h i s . o p e n ( ) ; 
                                 } 
 
                                 k i l l E v e n t ( e ) ; 
                         } ) ) ; 
 
                         d r o p d o w n . o n ( " m o u s e d o w n   t o u c h s t a r t " ,   t h i s . b i n d ( f u n c t i o n ( )   { 
                                 i f   ( t h i s . o p t s . s h o u l d F o c u s I n p u t ( t h i s ) )   { 
                                         t h i s . s e a r c h . f o c u s ( ) ; 
                                 } 
                         } ) ) ; 
 
                         s e l e c t i o n . o n ( " f o c u s " ,   t h i s . b i n d ( f u n c t i o n ( e )   { 
                                 k i l l E v e n t ( e ) ; 
                         } ) ) ; 
 
                         t h i s . f o c u s s e r . o n ( " f o c u s " ,   t h i s . b i n d ( f u n c t i o n ( ) { 
                                 i f   ( ! t h i s . c o n t a i n e r . h a s C l a s s ( " s e l e c t 2 - c o n t a i n e r - a c t i v e " ) )   { 
                                         t h i s . o p t s . e l e m e n t . t r i g g e r ( $ . E v e n t ( " s e l e c t 2 - f o c u s " ) ) ; 
                                 } 
                                 t h i s . c o n t a i n e r . a d d C l a s s ( " s e l e c t 2 - c o n t a i n e r - a c t i v e " ) ; 
                         } ) ) . o n ( " b l u r " ,   t h i s . b i n d ( f u n c t i o n ( )   { 
                                 i f   ( ! t h i s . o p e n e d ( ) )   { 
                                         t h i s . c o n t a i n e r . r e m o v e C l a s s ( " s e l e c t 2 - c o n t a i n e r - a c t i v e " ) ; 
                                         t h i s . o p t s . e l e m e n t . t r i g g e r ( $ . E v e n t ( " s e l e c t 2 - b l u r " ) ) ; 
                                 } 
                         } ) ) ; 
                         t h i s . s e a r c h . o n ( " f o c u s " ,   t h i s . b i n d ( f u n c t i o n ( ) { 
                                 i f   ( ! t h i s . c o n t a i n e r . h a s C l a s s ( " s e l e c t 2 - c o n t a i n e r - a c t i v e " ) )   { 
                                         t h i s . o p t s . e l e m e n t . t r i g g e r ( $ . E v e n t ( " s e l e c t 2 - f o c u s " ) ) ; 
                                 } 
                                 t h i s . c o n t a i n e r . a d d C l a s s ( " s e l e c t 2 - c o n t a i n e r - a c t i v e " ) ; 
                         } ) ) ; 
 
                         t h i s . i n i t C o n t a i n e r W i d t h ( ) ; 
                         t h i s . o p t s . e l e m e n t . h i d e ( ) ; 
                         t h i s . s e t P l a c e h o l d e r ( ) ; 
 
                 } , 
 
                 / /   s i n g l e 
                 c l e a r :   f u n c t i o n ( t r i g g e r C h a n g e )   { 
                         v a r   d a t a = t h i s . s e l e c t i o n . d a t a ( " s e l e c t 2 - d a t a " ) ; 
                         i f   ( d a t a )   {   / /   g u a r d   a g a i n s t   q u e u e d   q u i c k   c o n s e c u t i v e   c l i c k s 
                                 v a r   e v t   =   $ . E v e n t ( " s e l e c t 2 - c l e a r i n g " ) ; 
                                 t h i s . o p t s . e l e m e n t . t r i g g e r ( e v t ) ; 
                                 i f   ( e v t . i s D e f a u l t P r e v e n t e d ( ) )   { 
                                         r e t u r n ; 
                                 } 
                                 v a r   p l a c e h o l d e r O p t i o n   =   t h i s . g e t P l a c e h o l d e r O p t i o n ( ) ; 
                                 t h i s . o p t s . e l e m e n t . v a l ( p l a c e h o l d e r O p t i o n   ?   p l a c e h o l d e r O p t i o n . v a l ( )   :   " " ) ; 
                                 t h i s . s e l e c t i o n . f i n d ( " . s e l e c t 2 - c h o s e n " ) . e m p t y ( ) ; 
                                 t h i s . s e l e c t i o n . r e m o v e D a t a ( " s e l e c t 2 - d a t a " ) ; 
                                 t h i s . s e t P l a c e h o l d e r ( ) ; 
 
                                 i f   ( t r i g g e r C h a n g e   ! = =   f a l s e ) { 
                                         t h i s . o p t s . e l e m e n t . t r i g g e r ( {   t y p e :   " s e l e c t 2 - r e m o v e d " ,   v a l :   t h i s . i d ( d a t a ) ,   c h o i c e :   d a t a   } ) ; 
                                         t h i s . t r i g g e r C h a n g e ( { r e m o v e d : d a t a } ) ; 
                                 } 
                         } 
                 } , 
 
                 / * * 
                   *   S e t s   s e l e c t i o n   b a s e d   o n   s o u r c e   e l e m e n t ' s   v a l u e 
                   * / 
                 / /   s i n g l e 
                 i n i t S e l e c t i o n :   f u n c t i o n   ( )   { 
                         v a r   s e l e c t e d ; 
                         i f   ( t h i s . i s P l a c e h o l d e r O p t i o n S e l e c t e d ( ) )   { 
                                 t h i s . u p d a t e S e l e c t i o n ( n u l l ) ; 
                                 t h i s . c l o s e ( ) ; 
                                 t h i s . s e t P l a c e h o l d e r ( ) ; 
                         }   e l s e   { 
                                 v a r   s e l f   =   t h i s ; 
                                 t h i s . o p t s . i n i t S e l e c t i o n . c a l l ( n u l l ,   t h i s . o p t s . e l e m e n t ,   f u n c t i o n ( s e l e c t e d ) { 
                                         i f   ( s e l e c t e d   ! = =   u n d e f i n e d   & &   s e l e c t e d   ! = =   n u l l )   { 
                                                 s e l f . u p d a t e S e l e c t i o n ( s e l e c t e d ) ; 
                                                 s e l f . c l o s e ( ) ; 
                                                 s e l f . s e t P l a c e h o l d e r ( ) ; 
                                                 s e l f . n e x t S e a r c h T e r m   =   s e l f . o p t s . n e x t S e a r c h T e r m ( s e l e c t e d ,   s e l f . s e a r c h . v a l ( ) ) ; 
                                         } 
                                 } ) ; 
                         } 
                 } , 
 
                 i s P l a c e h o l d e r O p t i o n S e l e c t e d :   f u n c t i o n ( )   { 
                         v a r   p l a c e h o l d e r O p t i o n ; 
                         i f   ( t h i s . g e t P l a c e h o l d e r ( )   = = =   u n d e f i n e d )   r e t u r n   f a l s e ;   / /   n o   p l a c e h o l d e r   s p e c i f i e d   s o   n o   o p t i o n   s h o u l d   b e   c o n s i d e r e d 
                         r e t u r n   ( ( p l a c e h o l d e r O p t i o n   =   t h i s . g e t P l a c e h o l d e r O p t i o n ( ) )   ! = =   u n d e f i n e d   & &   p l a c e h o l d e r O p t i o n . p r o p ( " s e l e c t e d " ) ) 
                                 | |   ( t h i s . o p t s . e l e m e n t . v a l ( )   = = =   " " ) 
                                 | |   ( t h i s . o p t s . e l e m e n t . v a l ( )   = = =   u n d e f i n e d ) 
                                 | |   ( t h i s . o p t s . e l e m e n t . v a l ( )   = = =   n u l l ) ; 
                 } , 
 
                 / /   s i n g l e 
                 p r e p a r e O p t s :   f u n c t i o n   ( )   { 
                         v a r   o p t s   =   t h i s . p a r e n t . p r e p a r e O p t s . a p p l y ( t h i s ,   a r g u m e n t s ) , 
                                 s e l f = t h i s ; 
 
                         i f   ( o p t s . e l e m e n t . g e t ( 0 ) . t a g N a m e . t o L o w e r C a s e ( )   = = =   " s e l e c t " )   { 
                                 / /   i n s t a l l   t h e   s e l e c t i o n   i n i t i a l i z e r 
                                 o p t s . i n i t S e l e c t i o n   =   f u n c t i o n   ( e l e m e n t ,   c a l l b a c k )   { 
                                         v a r   s e l e c t e d   =   e l e m e n t . f i n d ( " o p t i o n " ) . f i l t e r ( f u n c t i o n ( )   {   r e t u r n   t h i s . s e l e c t e d   & &   ! t h i s . d i s a b l e d   } ) ; 
                                         / /   a   s i n g l e   s e l e c t   b o x   a l w a y s   h a s   a   v a l u e ,   n o   n e e d   t o   n u l l   c h e c k   ' s e l e c t e d ' 
                                         c a l l b a c k ( s e l f . o p t i o n T o D a t a ( s e l e c t e d ) ) ; 
                                 } ; 
                         }   e l s e   i f   ( " d a t a "   i n   o p t s )   { 
                                 / /   i n s t a l l   d e f a u l t   i n i t S e l e c t i o n   w h e n   a p p l i e d   t o   h i d d e n   i n p u t   a n d   d a t a   i s   l o c a l 
                                 o p t s . i n i t S e l e c t i o n   =   o p t s . i n i t S e l e c t i o n   | |   f u n c t i o n   ( e l e m e n t ,   c a l l b a c k )   { 
                                         v a r   i d   =   e l e m e n t . v a l ( ) ; 
                                         / / s e a r c h   i n   d a t a   b y   i d ,   s t o r i n g   t h e   a c t u a l   m a t c h i n g   i t e m 
                                         v a r   m a t c h   =   n u l l ; 
                                         o p t s . q u e r y ( { 
                                                 m a t c h e r :   f u n c t i o n ( t e r m ,   t e x t ,   e l ) { 
                                                         v a r   i s _ m a t c h   =   e q u a l ( i d ,   o p t s . i d ( e l ) ) ; 
                                                         i f   ( i s _ m a t c h )   { 
                                                                 m a t c h   =   e l ; 
                                                         } 
                                                         r e t u r n   i s _ m a t c h ; 
                                                 } , 
                                                 c a l l b a c k :   ! $ . i s F u n c t i o n ( c a l l b a c k )   ?   $ . n o o p   :   f u n c t i o n ( )   { 
                                                         c a l l b a c k ( m a t c h ) ; 
                                                 } 
                                         } ) ; 
                                 } ; 
                         } 
 
                         r e t u r n   o p t s ; 
                 } , 
 
                 / /   s i n g l e 
                 g e t P l a c e h o l d e r :   f u n c t i o n ( )   { 
                         / /   i f   a   p l a c e h o l d e r   i s   s p e c i f i e d   o n   a   s i n g l e   s e l e c t   w i t h o u t   a   v a l i d   p l a c e h o l d e r   o p t i o n   i g n o r e   i t 
                         i f   ( t h i s . s e l e c t )   { 
                                 i f   ( t h i s . g e t P l a c e h o l d e r O p t i o n ( )   = = =   u n d e f i n e d )   { 
                                         r e t u r n   u n d e f i n e d ; 
                                 } 
                         } 
 
                         r e t u r n   t h i s . p a r e n t . g e t P l a c e h o l d e r . a p p l y ( t h i s ,   a r g u m e n t s ) ; 
                 } , 
 
                 / /   s i n g l e 
                 s e t P l a c e h o l d e r :   f u n c t i o n   ( )   { 
                         v a r   p l a c e h o l d e r   =   t h i s . g e t P l a c e h o l d e r ( ) ; 
 
                         i f   ( t h i s . i s P l a c e h o l d e r O p t i o n S e l e c t e d ( )   & &   p l a c e h o l d e r   ! = =   u n d e f i n e d )   { 
 
                                 / /   c h e c k   f o r   a   p l a c e h o l d e r   o p t i o n   i f   a t t a c h e d   t o   a   s e l e c t 
                                 i f   ( t h i s . s e l e c t   & &   t h i s . g e t P l a c e h o l d e r O p t i o n ( )   = = =   u n d e f i n e d )   r e t u r n ; 
 
                                 t h i s . s e l e c t i o n . f i n d ( " . s e l e c t 2 - c h o s e n " ) . h t m l ( t h i s . o p t s . e s c a p e M a r k u p ( p l a c e h o l d e r ) ) ; 
 
                                 t h i s . s e l e c t i o n . a d d C l a s s ( " s e l e c t 2 - d e f a u l t " ) ; 
 
                                 t h i s . c o n t a i n e r . r e m o v e C l a s s ( " s e l e c t 2 - a l l o w c l e a r " ) ; 
                         } 
                 } , 
 
                 / /   s i n g l e 
                 p o s t p r o c e s s R e s u l t s :   f u n c t i o n   ( d a t a ,   i n i t i a l ,   n o H i g h l i g h t U p d a t e )   { 
                         v a r   s e l e c t e d   =   0 ,   s e l f   =   t h i s ,   s h o w S e a r c h I n p u t   =   t r u e ; 
 
                         / /   f i n d   t h e   s e l e c t e d   e l e m e n t   i n   t h e   r e s u l t   l i s t 
 
                         t h i s . f i n d H i g h l i g h t a b l e C h o i c e s ( ) . e a c h 2 ( f u n c t i o n   ( i ,   e l m )   { 
                                 i f   ( e q u a l ( s e l f . i d ( e l m . d a t a ( " s e l e c t 2 - d a t a " ) ) ,   s e l f . o p t s . e l e m e n t . v a l ( ) ) )   { 
                                         s e l e c t e d   =   i ; 
                                         r e t u r n   f a l s e ; 
                                 } 
                         } ) ; 
 
                         / /   a n d   h i g h l i g h t   i t 
                         i f   ( n o H i g h l i g h t U p d a t e   ! = =   f a l s e )   { 
                                 i f   ( i n i t i a l   = = =   t r u e   & &   s e l e c t e d   > =   0 )   { 
                                         t h i s . h i g h l i g h t ( s e l e c t e d ) ; 
                                 }   e l s e   { 
                                         t h i s . h i g h l i g h t ( 0 ) ; 
                                 } 
                         } 
 
                         / /   h i d e   t h e   s e a r c h   b o x   i f   t h i s   i s   t h e   f i r s t   w e   g o t   t h e   r e s u l t s   a n d   t h e r e   a r e   e n o u g h   o f   t h e m   f o r   s e a r c h 
 
                         i f   ( i n i t i a l   = = =   t r u e )   { 
                                 v a r   m i n   =   t h i s . o p t s . m i n i m u m R e s u l t s F o r S e a r c h ; 
                                 i f   ( m i n   > =   0 )   { 
                                         t h i s . s h o w S e a r c h ( c o u n t R e s u l t s ( d a t a . r e s u l t s )   > =   m i n ) ; 
                                 } 
                         } 
                 } , 
 
                 / /   s i n g l e 
                 s h o w S e a r c h :   f u n c t i o n ( s h o w S e a r c h I n p u t )   { 
                         i f   ( t h i s . s h o w S e a r c h I n p u t   = = =   s h o w S e a r c h I n p u t )   r e t u r n ; 
 
                         t h i s . s h o w S e a r c h I n p u t   =   s h o w S e a r c h I n p u t ; 
 
                         t h i s . d r o p d o w n . f i n d ( " . s e l e c t 2 - s e a r c h " ) . t o g g l e C l a s s ( " s e l e c t 2 - s e a r c h - h i d d e n " ,   ! s h o w S e a r c h I n p u t ) ; 
                         t h i s . d r o p d o w n . f i n d ( " . s e l e c t 2 - s e a r c h " ) . t o g g l e C l a s s ( " s e l e c t 2 - o f f s c r e e n " ,   ! s h o w S e a r c h I n p u t ) ; 
                         / / a d d   " s e l e c t 2 - w i t h - s e a r c h b o x "   t o   t h e   c o n t a i n e r   i f   s e a r c h   b o x   i s   s h o w n 
                         $ ( t h i s . d r o p d o w n ,   t h i s . c o n t a i n e r ) . t o g g l e C l a s s ( " s e l e c t 2 - w i t h - s e a r c h b o x " ,   s h o w S e a r c h I n p u t ) ; 
                 } , 
 
                 / /   s i n g l e 
                 o n S e l e c t :   f u n c t i o n   ( d a t a ,   o p t i o n s )   { 
 
                         i f   ( ! t h i s . t r i g g e r S e l e c t ( d a t a ) )   {   r e t u r n ;   } 
 
                         v a r   o l d   =   t h i s . o p t s . e l e m e n t . v a l ( ) , 
                                 o l d D a t a   =   t h i s . d a t a ( ) ; 
 
                         t h i s . o p t s . e l e m e n t . v a l ( t h i s . i d ( d a t a ) ) ; 
                         t h i s . u p d a t e S e l e c t i o n ( d a t a ) ; 
 
                         t h i s . o p t s . e l e m e n t . t r i g g e r ( {   t y p e :   " s e l e c t 2 - s e l e c t e d " ,   v a l :   t h i s . i d ( d a t a ) ,   c h o i c e :   d a t a   } ) ; 
 
                         t h i s . n e x t S e a r c h T e r m   =   t h i s . o p t s . n e x t S e a r c h T e r m ( d a t a ,   t h i s . s e a r c h . v a l ( ) ) ; 
                         t h i s . c l o s e ( ) ; 
 
                         i f   ( ( ! o p t i o n s   | |   ! o p t i o n s . n o F o c u s )   & &   t h i s . o p t s . s h o u l d F o c u s I n p u t ( t h i s ) )   { 
                                 t h i s . f o c u s s e r . f o c u s ( ) ; 
                         } 
 
                         i f   ( ! e q u a l ( o l d ,   t h i s . i d ( d a t a ) ) )   { 
                                 t h i s . t r i g g e r C h a n g e ( {   a d d e d :   d a t a ,   r e m o v e d :   o l d D a t a   } ) ; 
                         } 
                 } , 
 
                 / /   s i n g l e 
                 u p d a t e S e l e c t i o n :   f u n c t i o n   ( d a t a )   { 
 
                         v a r   c o n t a i n e r = t h i s . s e l e c t i o n . f i n d ( " . s e l e c t 2 - c h o s e n " ) ,   f o r m a t t e d ,   c s s C l a s s ; 
 
                         t h i s . s e l e c t i o n . d a t a ( " s e l e c t 2 - d a t a " ,   d a t a ) ; 
 
                         c o n t a i n e r . e m p t y ( ) ; 
                         i f   ( d a t a   ! = =   n u l l )   { 
                                 f o r m a t t e d = t h i s . o p t s . f o r m a t S e l e c t i o n ( d a t a ,   c o n t a i n e r ,   t h i s . o p t s . e s c a p e M a r k u p ) ; 
                         } 
                         i f   ( f o r m a t t e d   ! = =   u n d e f i n e d )   { 
                                 c o n t a i n e r . a p p e n d ( f o r m a t t e d ) ; 
                         } 
                         c s s C l a s s = t h i s . o p t s . f o r m a t S e l e c t i o n C s s C l a s s ( d a t a ,   c o n t a i n e r ) ; 
                         i f   ( c s s C l a s s   ! = =   u n d e f i n e d )   { 
                                 c o n t a i n e r . a d d C l a s s ( c s s C l a s s ) ; 
                         } 
 
                         t h i s . s e l e c t i o n . r e m o v e C l a s s ( " s e l e c t 2 - d e f a u l t " ) ; 
 
                         i f   ( t h i s . o p t s . a l l o w C l e a r   & &   t h i s . g e t P l a c e h o l d e r ( )   ! = =   u n d e f i n e d )   { 
                                 t h i s . c o n t a i n e r . a d d C l a s s ( " s e l e c t 2 - a l l o w c l e a r " ) ; 
                         } 
                 } , 
 
                 / /   s i n g l e 
                 v a l :   f u n c t i o n   ( )   { 
                         v a r   v a l , 
                                 t r i g g e r C h a n g e   =   f a l s e , 
                                 d a t a   =   n u l l , 
                                 s e l f   =   t h i s , 
                                 o l d D a t a   =   t h i s . d a t a ( ) ; 
 
                         i f   ( a r g u m e n t s . l e n g t h   = = =   0 )   { 
                                 r e t u r n   t h i s . o p t s . e l e m e n t . v a l ( ) ; 
                         } 
 
                         v a l   =   a r g u m e n t s [ 0 ] ; 
 
                         i f   ( a r g u m e n t s . l e n g t h   >   1 )   { 
                                 t r i g g e r C h a n g e   =   a r g u m e n t s [ 1 ] ; 
                         } 
 
                         i f   ( t h i s . s e l e c t )   { 
                                 t h i s . s e l e c t 
                                         . v a l ( v a l ) 
                                         . f i n d ( " o p t i o n " ) . f i l t e r ( f u n c t i o n ( )   {   r e t u r n   t h i s . s e l e c t e d   } ) . e a c h 2 ( f u n c t i o n   ( i ,   e l m )   { 
                                                 d a t a   =   s e l f . o p t i o n T o D a t a ( e l m ) ; 
                                                 r e t u r n   f a l s e ; 
                                         } ) ; 
                                 t h i s . u p d a t e S e l e c t i o n ( d a t a ) ; 
                                 t h i s . s e t P l a c e h o l d e r ( ) ; 
                                 i f   ( t r i g g e r C h a n g e )   { 
                                         t h i s . t r i g g e r C h a n g e ( { a d d e d :   d a t a ,   r e m o v e d : o l d D a t a } ) ; 
                                 } 
                         }   e l s e   { 
                                 / /   v a l   i s   a n   i d .   ! v a l   i s   t r u e   f o r   [ u n d e f i n e d , n u l l , ' ' , 0 ]   -   0   i s   l e g a l 
                                 i f   ( ! v a l   & &   v a l   ! = =   0 )   { 
                                         t h i s . c l e a r ( t r i g g e r C h a n g e ) ; 
                                         r e t u r n ; 
                                 } 
                                 i f   ( t h i s . o p t s . i n i t S e l e c t i o n   = = =   u n d e f i n e d )   { 
                                         t h r o w   n e w   E r r o r ( " c a n n o t   c a l l   v a l ( )   i f   i n i t S e l e c t i o n ( )   i s   n o t   d e f i n e d " ) ; 
                                 } 
                                 t h i s . o p t s . e l e m e n t . v a l ( v a l ) ; 
                                 t h i s . o p t s . i n i t S e l e c t i o n ( t h i s . o p t s . e l e m e n t ,   f u n c t i o n ( d a t a ) { 
                                         s e l f . o p t s . e l e m e n t . v a l ( ! d a t a   ?   " "   :   s e l f . i d ( d a t a ) ) ; 
                                         s e l f . u p d a t e S e l e c t i o n ( d a t a ) ; 
                                         s e l f . s e t P l a c e h o l d e r ( ) ; 
                                         i f   ( t r i g g e r C h a n g e )   { 
                                                 s e l f . t r i g g e r C h a n g e ( { a d d e d :   d a t a ,   r e m o v e d : o l d D a t a } ) ; 
                                         } 
                                 } ) ; 
                         } 
                 } , 
 
                 / /   s i n g l e 
                 c l e a r S e a r c h :   f u n c t i o n   ( )   { 
                         t h i s . s e a r c h . v a l ( " " ) ; 
                         t h i s . f o c u s s e r . v a l ( " " ) ; 
                 } , 
 
                 / /   s i n g l e 
                 d a t a :   f u n c t i o n ( v a l u e )   { 
                         v a r   d a t a , 
                                 t r i g g e r C h a n g e   =   f a l s e ; 
 
                         i f   ( a r g u m e n t s . l e n g t h   = = =   0 )   { 
                                 d a t a   =   t h i s . s e l e c t i o n . d a t a ( " s e l e c t 2 - d a t a " ) ; 
                                 i f   ( d a t a   = =   u n d e f i n e d )   d a t a   =   n u l l ; 
                                 r e t u r n   d a t a ; 
                         }   e l s e   { 
                                 i f   ( a r g u m e n t s . l e n g t h   >   1 )   { 
                                         t r i g g e r C h a n g e   =   a r g u m e n t s [ 1 ] ; 
                                 } 
                                 i f   ( ! v a l u e )   { 
                                         t h i s . c l e a r ( t r i g g e r C h a n g e ) ; 
                                 }   e l s e   { 
                                         d a t a   =   t h i s . d a t a ( ) ; 
                                         t h i s . o p t s . e l e m e n t . v a l ( ! v a l u e   ?   " "   :   t h i s . i d ( v a l u e ) ) ; 
                                         t h i s . u p d a t e S e l e c t i o n ( v a l u e ) ; 
                                         i f   ( t r i g g e r C h a n g e )   { 
                                                 t h i s . t r i g g e r C h a n g e ( { a d d e d :   v a l u e ,   r e m o v e d : d a t a } ) ; 
                                         } 
                                 } 
                         } 
                 } 
         } ) ; 
 
         M u l t i S e l e c t 2   =   c l a z z ( A b s t r a c t S e l e c t 2 ,   { 
 
                 / /   m u l t i 
                 c r e a t e C o n t a i n e r :   f u n c t i o n   ( )   { 
                         v a r   c o n t a i n e r   =   $ ( d o c u m e n t . c r e a t e E l e m e n t ( " d i v " ) ) . a t t r ( { 
                                 " c l a s s " :   " s e l e c t 2 - c o n t a i n e r   s e l e c t 2 - c o n t a i n e r - m u l t i " 
                         } ) . h t m l ( [ 
                                 " < u l   c l a s s = ' s e l e c t 2 - c h o i c e s ' > " , 
                                 "     < l i   c l a s s = ' s e l e c t 2 - s e a r c h - f i e l d ' > " , 
                                 "         < l a b e l   f o r = ' '   c l a s s = ' s e l e c t 2 - o f f s c r e e n ' > < / l a b e l > " , 
                                 "         < i n p u t   t y p e = ' t e x t '   a u t o c o m p l e t e = ' o f f '   a u t o c o r r e c t = ' o f f '   a u t o c a p i t a l i z e = ' o f f '   s p e l l c h e c k = ' f a l s e '   c l a s s = ' s e l e c t 2 - i n p u t ' > " , 
                                 "     < / l i > " , 
                                 " < / u l > " , 
                                 " < d i v   c l a s s = ' s e l e c t 2 - d r o p   s e l e c t 2 - d r o p - m u l t i   s e l e c t 2 - d i s p l a y - n o n e ' > " , 
                                 "       < u l   c l a s s = ' s e l e c t 2 - r e s u l t s ' > " , 
                                 "       < / u l > " , 
                                 " < / d i v > " ] . j o i n ( " " ) ) ; 
                         r e t u r n   c o n t a i n e r ; 
                 } , 
 
                 / /   m u l t i 
                 p r e p a r e O p t s :   f u n c t i o n   ( )   { 
                         v a r   o p t s   =   t h i s . p a r e n t . p r e p a r e O p t s . a p p l y ( t h i s ,   a r g u m e n t s ) , 
                                 s e l f = t h i s ; 
 
                         / /   T O D O   v a l i d a t e   p l a c e h o l d e r   i s   a   s t r i n g   i f   s p e c i f i e d 
                         i f   ( o p t s . e l e m e n t . g e t ( 0 ) . t a g N a m e . t o L o w e r C a s e ( )   = = =   " s e l e c t " )   { 
                                 / /   i n s t a l l   t h e   s e l e c t i o n   i n i t i a l i z e r 
                                 o p t s . i n i t S e l e c t i o n   =   f u n c t i o n   ( e l e m e n t ,   c a l l b a c k )   { 
 
                                         v a r   d a t a   =   [ ] ; 
 
                                         e l e m e n t . f i n d ( " o p t i o n " ) . f i l t e r ( f u n c t i o n ( )   {   r e t u r n   t h i s . s e l e c t e d   & &   ! t h i s . d i s a b l e d   } ) . e a c h 2 ( f u n c t i o n   ( i ,   e l m )   { 
                                                 d a t a . p u s h ( s e l f . o p t i o n T o D a t a ( e l m ) ) ; 
                                         } ) ; 
                                         c a l l b a c k ( d a t a ) ; 
                                 } ; 
                         }   e l s e   i f   ( " d a t a "   i n   o p t s )   { 
                                 / /   i n s t a l l   d e f a u l t   i n i t S e l e c t i o n   w h e n   a p p l i e d   t o   h i d d e n   i n p u t   a n d   d a t a   i s   l o c a l 
                                 o p t s . i n i t S e l e c t i o n   =   o p t s . i n i t S e l e c t i o n   | |   f u n c t i o n   ( e l e m e n t ,   c a l l b a c k )   { 
                                         v a r   i d s   =   s p l i t V a l ( e l e m e n t . v a l ( ) ,   o p t s . s e p a r a t o r ,   o p t s . t r a n s f o r m V a l ) ; 
                                         / / s e a r c h   i n   d a t a   b y   a r r a y   o f   i d s ,   s t o r i n g   m a t c h i n g   i t e m s   i n   a   l i s t 
                                         v a r   m a t c h e s   =   [ ] ; 
                                         o p t s . q u e r y ( { 
                                                 m a t c h e r :   f u n c t i o n ( t e r m ,   t e x t ,   e l ) { 
                                                         v a r   i s _ m a t c h   =   $ . g r e p ( i d s ,   f u n c t i o n ( i d )   { 
                                                                 r e t u r n   e q u a l ( i d ,   o p t s . i d ( e l ) ) ; 
                                                         } ) . l e n g t h ; 
                                                         i f   ( i s _ m a t c h )   { 
                                                                 m a t c h e s . p u s h ( e l ) ; 
                                                         } 
                                                         r e t u r n   i s _ m a t c h ; 
                                                 } , 
                                                 c a l l b a c k :   ! $ . i s F u n c t i o n ( c a l l b a c k )   ?   $ . n o o p   :   f u n c t i o n ( )   { 
                                                         / /   r e o r d e r   m a t c h e s   b a s e d   o n   t h e   o r d e r   t h e y   a p p e a r   i n   t h e   i d s   a r r a y   b e c a u s e   r i g h t   n o w 
                                                         / /   t h e y   a r e   i n   t h e   o r d e r   i n   w h i c h   t h e y   a p p e a r   i n   d a t a   a r r a y 
                                                         v a r   o r d e r e d   =   [ ] ; 
                                                         f o r   ( v a r   i   =   0 ;   i   <   i d s . l e n g t h ;   i + + )   { 
                                                                 v a r   i d   =   i d s [ i ] ; 
                                                                 f o r   ( v a r   j   =   0 ;   j   <   m a t c h e s . l e n g t h ;   j + + )   { 
                                                                         v a r   m a t c h   =   m a t c h e s [ j ] ; 
                                                                         i f   ( e q u a l ( i d ,   o p t s . i d ( m a t c h ) ) )   { 
                                                                                 o r d e r e d . p u s h ( m a t c h ) ; 
                                                                                 m a t c h e s . s p l i c e ( j ,   1 ) ; 
                                                                                 b r e a k ; 
                                                                         } 
                                                                 } 
                                                         } 
                                                         c a l l b a c k ( o r d e r e d ) ; 
                                                 } 
                                         } ) ; 
                                 } ; 
                         } 
 
                         r e t u r n   o p t s ; 
                 } , 
 
                 / /   m u l t i 
                 s e l e c t C h o i c e :   f u n c t i o n   ( c h o i c e )   { 
 
                         v a r   s e l e c t e d   =   t h i s . c o n t a i n e r . f i n d ( " . s e l e c t 2 - s e a r c h - c h o i c e - f o c u s " ) ; 
                         i f   ( s e l e c t e d . l e n g t h   & &   c h o i c e   & &   c h o i c e [ 0 ]   = =   s e l e c t e d [ 0 ] )   { 
 
                         }   e l s e   { 
                                 i f   ( s e l e c t e d . l e n g t h )   { 
                                         t h i s . o p t s . e l e m e n t . t r i g g e r ( " c h o i c e - d e s e l e c t e d " ,   s e l e c t e d ) ; 
                                 } 
                                 s e l e c t e d . r e m o v e C l a s s ( " s e l e c t 2 - s e a r c h - c h o i c e - f o c u s " ) ; 
                                 i f   ( c h o i c e   & &   c h o i c e . l e n g t h )   { 
                                         t h i s . c l o s e ( ) ; 
                                         c h o i c e . a d d C l a s s ( " s e l e c t 2 - s e a r c h - c h o i c e - f o c u s " ) ; 
                                         t h i s . o p t s . e l e m e n t . t r i g g e r ( " c h o i c e - s e l e c t e d " ,   c h o i c e ) ; 
                                 } 
                         } 
                 } , 
 
                 / /   m u l t i 
                 d e s t r o y :   f u n c t i o n ( )   { 
                         $ ( " l a b e l [ f o r = ' "   +   t h i s . s e a r c h . a t t r ( ' i d ' )   +   " ' ] " ) 
                                 . a t t r ( ' f o r ' ,   t h i s . o p t s . e l e m e n t . a t t r ( " i d " ) ) ; 
                         t h i s . p a r e n t . d e s t r o y . a p p l y ( t h i s ,   a r g u m e n t s ) ; 
 
                         c l e a n u p J Q u e r y E l e m e n t s . c a l l ( t h i s , 
                                 " s e a r c h C o n t a i n e r " , 
                                 " s e l e c t i o n " 
                         ) ; 
                 } , 
 
                 / /   m u l t i 
                 i n i t C o n t a i n e r :   f u n c t i o n   ( )   { 
 
                         v a r   s e l e c t o r   =   " . s e l e c t 2 - c h o i c e s " ,   s e l e c t i o n ; 
 
                         t h i s . s e a r c h C o n t a i n e r   =   t h i s . c o n t a i n e r . f i n d ( " . s e l e c t 2 - s e a r c h - f i e l d " ) ; 
                         t h i s . s e l e c t i o n   =   s e l e c t i o n   =   t h i s . c o n t a i n e r . f i n d ( s e l e c t o r ) ; 
 
                         v a r   _ t h i s   =   t h i s ; 
                         t h i s . s e l e c t i o n . o n ( " c l i c k " ,   " . s e l e c t 2 - c o n t a i n e r : n o t ( . s e l e c t 2 - c o n t a i n e r - d i s a b l e d )   . s e l e c t 2 - s e a r c h - c h o i c e : n o t ( . s e l e c t 2 - l o c k e d ) " ,   f u n c t i o n   ( e )   { 
                                 _ t h i s . s e a r c h [ 0 ] . f o c u s ( ) ; 
                                 _ t h i s . s e l e c t C h o i c e ( $ ( t h i s ) ) ; 
                         } ) ; 
 
                         / /   r e w r i t e   l a b e l s   f r o m   o r i g i n a l   e l e m e n t   t o   f o c u s s e r 
                         t h i s . s e a r c h . a t t r ( " i d " ,   " s 2 i d _ a u t o g e n " + n e x t U i d ( ) ) ; 
 
                         t h i s . s e a r c h . p r e v ( ) 
                                 . t e x t ( $ ( " l a b e l [ f o r = ' "   +   t h i s . o p t s . e l e m e n t . a t t r ( " i d " )   +   " ' ] " ) . t e x t ( ) ) 
                                 . a t t r ( ' f o r ' ,   t h i s . s e a r c h . a t t r ( ' i d ' ) ) ; 
                         t h i s . o p t s . e l e m e n t . f o c u s ( t h i s . b i n d ( f u n c t i o n   ( )   {   t h i s . f o c u s ( ) ;   } ) ) ; 
 
                         t h i s . s e a r c h . o n ( " i n p u t   p a s t e " ,   t h i s . b i n d ( f u n c t i o n ( )   { 
                                 i f   ( t h i s . s e a r c h . a t t r ( ' p l a c e h o l d e r ' )   & &   t h i s . s e a r c h . v a l ( ) . l e n g t h   = =   0 )   r e t u r n ; 
                                 i f   ( ! t h i s . i s I n t e r f a c e E n a b l e d ( ) )   r e t u r n ; 
                                 i f   ( ! t h i s . o p e n e d ( ) )   { 
                                         t h i s . o p e n ( ) ; 
                                 } 
                         } ) ) ; 
 
                         t h i s . s e a r c h . a t t r ( " t a b i n d e x " ,   t h i s . e l e m e n t T a b I n d e x ) ; 
 
                         t h i s . k e y d o w n s   =   0 ; 
                         t h i s . s e a r c h . o n ( " k e y d o w n " ,   t h i s . b i n d ( f u n c t i o n   ( e )   { 
                                 i f   ( ! t h i s . i s I n t e r f a c e E n a b l e d ( ) )   r e t u r n ; 
 
                                 + + t h i s . k e y d o w n s ; 
                                 v a r   s e l e c t e d   =   s e l e c t i o n . f i n d ( " . s e l e c t 2 - s e a r c h - c h o i c e - f o c u s " ) ; 
                                 v a r   p r e v   =   s e l e c t e d . p r e v ( " . s e l e c t 2 - s e a r c h - c h o i c e : n o t ( . s e l e c t 2 - l o c k e d ) " ) ; 
                                 v a r   n e x t   =   s e l e c t e d . n e x t ( " . s e l e c t 2 - s e a r c h - c h o i c e : n o t ( . s e l e c t 2 - l o c k e d ) " ) ; 
                                 v a r   p o s   =   g e t C u r s o r I n f o ( t h i s . s e a r c h ) ; 
 
                                 i f   ( s e l e c t e d . l e n g t h   & & 
                                         ( e . w h i c h   = =   K E Y . L E F T   | |   e . w h i c h   = =   K E Y . R I G H T   | |   e . w h i c h   = =   K E Y . B A C K S P A C E   | |   e . w h i c h   = =   K E Y . D E L E T E   | |   e . w h i c h   = =   K E Y . E N T E R ) )   { 
                                         v a r   s e l e c t e d C h o i c e   =   s e l e c t e d ; 
                                         i f   ( e . w h i c h   = =   K E Y . L E F T   & &   p r e v . l e n g t h )   { 
                                                 s e l e c t e d C h o i c e   =   p r e v ; 
                                         } 
                                         e l s e   i f   ( e . w h i c h   = =   K E Y . R I G H T )   { 
                                                 s e l e c t e d C h o i c e   =   n e x t . l e n g t h   ?   n e x t   :   n u l l ; 
                                         } 
                                         e l s e   i f   ( e . w h i c h   = = =   K E Y . B A C K S P A C E )   { 
                                                 i f   ( t h i s . u n s e l e c t ( s e l e c t e d . f i r s t ( ) ) )   { 
                                                         t h i s . s e a r c h . w i d t h ( 1 0 ) ; 
                                                         s e l e c t e d C h o i c e   =   p r e v . l e n g t h   ?   p r e v   :   n e x t ; 
                                                 } 
                                         }   e l s e   i f   ( e . w h i c h   = =   K E Y . D E L E T E )   { 
                                                 i f   ( t h i s . u n s e l e c t ( s e l e c t e d . f i r s t ( ) ) )   { 
                                                         t h i s . s e a r c h . w i d t h ( 1 0 ) ; 
                                                         s e l e c t e d C h o i c e   =   n e x t . l e n g t h   ?   n e x t   :   n u l l ; 
                                                 } 
                                         }   e l s e   i f   ( e . w h i c h   = =   K E Y . E N T E R )   { 
                                                 s e l e c t e d C h o i c e   =   n u l l ; 
                                         } 
 
                                         t h i s . s e l e c t C h o i c e ( s e l e c t e d C h o i c e ) ; 
                                         k i l l E v e n t ( e ) ; 
                                         i f   ( ! s e l e c t e d C h o i c e   | |   ! s e l e c t e d C h o i c e . l e n g t h )   { 
                                                 t h i s . o p e n ( ) ; 
                                         } 
                                         r e t u r n ; 
                                 }   e l s e   i f   ( ( ( e . w h i c h   = = =   K E Y . B A C K S P A C E   & &   t h i s . k e y d o w n s   = =   1 ) 
                                         | |   e . w h i c h   = =   K E Y . L E F T )   & &   ( p o s . o f f s e t   = =   0   & &   ! p o s . l e n g t h ) )   { 
 
                                         t h i s . s e l e c t C h o i c e ( s e l e c t i o n . f i n d ( " . s e l e c t 2 - s e a r c h - c h o i c e : n o t ( . s e l e c t 2 - l o c k e d ) " ) . l a s t ( ) ) ; 
                                         k i l l E v e n t ( e ) ; 
                                         r e t u r n ; 
                                 }   e l s e   { 
                                         t h i s . s e l e c t C h o i c e ( n u l l ) ; 
                                 } 
 
                                 i f   ( t h i s . o p e n e d ( ) )   { 
                                         s w i t c h   ( e . w h i c h )   { 
                                         c a s e   K E Y . U P : 
                                         c a s e   K E Y . D O W N : 
                                                 t h i s . m o v e H i g h l i g h t ( ( e . w h i c h   = = =   K E Y . U P )   ?   - 1   :   1 ) ; 
                                                 k i l l E v e n t ( e ) ; 
                                                 r e t u r n ; 
                                         c a s e   K E Y . E N T E R : 
                                                 t h i s . s e l e c t H i g h l i g h t e d ( ) ; 
                                                 k i l l E v e n t ( e ) ; 
                                                 r e t u r n ; 
                                         c a s e   K E Y . T A B : 
                                                 t h i s . s e l e c t H i g h l i g h t e d ( { n o F o c u s : t r u e } ) ; 
                                                 t h i s . c l o s e ( ) ; 
                                                 r e t u r n ; 
                                         c a s e   K E Y . E S C : 
                                                 t h i s . c a n c e l ( e ) ; 
                                                 k i l l E v e n t ( e ) ; 
                                                 r e t u r n ; 
                                         } 
                                 } 
 
                                 i f   ( e . w h i c h   = = =   K E Y . T A B   | |   K E Y . i s C o n t r o l ( e )   | |   K E Y . i s F u n c t i o n K e y ( e ) 
                                   | |   e . w h i c h   = = =   K E Y . B A C K S P A C E   | |   e . w h i c h   = = =   K E Y . E S C )   { 
                                         r e t u r n ; 
                                 } 
 
                                 i f   ( e . w h i c h   = = =   K E Y . E N T E R )   { 
                                         i f   ( t h i s . o p t s . o p e n O n E n t e r   = = =   f a l s e )   { 
                                                 r e t u r n ; 
                                         }   e l s e   i f   ( e . a l t K e y   | |   e . c t r l K e y   | |   e . s h i f t K e y   | |   e . m e t a K e y )   { 
                                                 r e t u r n ; 
                                         } 
                                 } 
 
                                 t h i s . o p e n ( ) ; 
 
                                 i f   ( e . w h i c h   = = =   K E Y . P A G E _ U P   | |   e . w h i c h   = = =   K E Y . P A G E _ D O W N )   { 
                                         / /   p r e v e n t   t h e   p a g e   f r o m   s c r o l l i n g 
                                         k i l l E v e n t ( e ) ; 
                                 } 
 
                                 i f   ( e . w h i c h   = = =   K E Y . E N T E R )   { 
                                         / /   p r e v e n t   f o r m   f r o m   b e i n g   s u b m i t t e d 
                                         k i l l E v e n t ( e ) ; 
                                 } 
 
                         } ) ) ; 
 
                         t h i s . s e a r c h . o n ( " k e y u p " ,   t h i s . b i n d ( f u n c t i o n   ( e )   { 
                                 t h i s . k e y d o w n s   =   0 ; 
                                 t h i s . r e s i z e S e a r c h ( ) ; 
                         } ) 
                         ) ; 
 
                         t h i s . s e a r c h . o n ( " b l u r " ,   t h i s . b i n d ( f u n c t i o n ( e )   { 
                                 t h i s . c o n t a i n e r . r e m o v e C l a s s ( " s e l e c t 2 - c o n t a i n e r - a c t i v e " ) ; 
                                 t h i s . s e a r c h . r e m o v e C l a s s ( " s e l e c t 2 - f o c u s e d " ) ; 
                                 t h i s . s e l e c t C h o i c e ( n u l l ) ; 
                                 i f   ( ! t h i s . o p e n e d ( ) )   t h i s . c l e a r S e a r c h ( ) ; 
                                 e . s t o p I m m e d i a t e P r o p a g a t i o n ( ) ; 
                                 t h i s . o p t s . e l e m e n t . t r i g g e r ( $ . E v e n t ( " s e l e c t 2 - b l u r " ) ) ; 
                         } ) ) ; 
 
                         t h i s . c o n t a i n e r . o n ( " c l i c k " ,   s e l e c t o r ,   t h i s . b i n d ( f u n c t i o n   ( e )   { 
                                 i f   ( ! t h i s . i s I n t e r f a c e E n a b l e d ( ) )   r e t u r n ; 
                                 i f   ( $ ( e . t a r g e t ) . c l o s e s t ( " . s e l e c t 2 - s e a r c h - c h o i c e " ) . l e n g t h   >   0 )   { 
                                         / /   c l i c k e d   i n s i d e   a   s e l e c t 2   s e a r c h   c h o i c e ,   d o   n o t   o p e n 
                                         r e t u r n ; 
                                 } 
                                 t h i s . s e l e c t C h o i c e ( n u l l ) ; 
                                 t h i s . c l e a r P l a c e h o l d e r ( ) ; 
                                 i f   ( ! t h i s . c o n t a i n e r . h a s C l a s s ( " s e l e c t 2 - c o n t a i n e r - a c t i v e " ) )   { 
                                         t h i s . o p t s . e l e m e n t . t r i g g e r ( $ . E v e n t ( " s e l e c t 2 - f o c u s " ) ) ; 
                                 } 
                                 t h i s . o p e n ( ) ; 
                                 t h i s . f o c u s S e a r c h ( ) ; 
                                 e . p r e v e n t D e f a u l t ( ) ; 
                         } ) ) ; 
 
                         t h i s . c o n t a i n e r . o n ( " f o c u s " ,   s e l e c t o r ,   t h i s . b i n d ( f u n c t i o n   ( )   { 
                                 i f   ( ! t h i s . i s I n t e r f a c e E n a b l e d ( ) )   r e t u r n ; 
                                 i f   ( ! t h i s . c o n t a i n e r . h a s C l a s s ( " s e l e c t 2 - c o n t a i n e r - a c t i v e " ) )   { 
                                         t h i s . o p t s . e l e m e n t . t r i g g e r ( $ . E v e n t ( " s e l e c t 2 - f o c u s " ) ) ; 
                                 } 
                                 t h i s . c o n t a i n e r . a d d C l a s s ( " s e l e c t 2 - c o n t a i n e r - a c t i v e " ) ; 
                                 t h i s . d r o p d o w n . a d d C l a s s ( " s e l e c t 2 - d r o p - a c t i v e " ) ; 
                                 t h i s . c l e a r P l a c e h o l d e r ( ) ; 
                         } ) ) ; 
 
                         t h i s . i n i t C o n t a i n e r W i d t h ( ) ; 
                         t h i s . o p t s . e l e m e n t . h i d e ( ) ; 
 
                         / /   s e t   t h e   p l a c e h o l d e r   i f   n e c e s s a r y 
                         t h i s . c l e a r S e a r c h ( ) ; 
                 } , 
 
                 / /   m u l t i 
                 e n a b l e I n t e r f a c e :   f u n c t i o n ( )   { 
                         i f   ( t h i s . p a r e n t . e n a b l e I n t e r f a c e . a p p l y ( t h i s ,   a r g u m e n t s ) )   { 
                                 t h i s . s e a r c h . p r o p ( " d i s a b l e d " ,   ! t h i s . i s I n t e r f a c e E n a b l e d ( ) ) ; 
                         } 
                 } , 
 
                 / /   m u l t i 
                 i n i t S e l e c t i o n :   f u n c t i o n   ( )   { 
                         v a r   d a t a ; 
                         i f   ( t h i s . o p t s . e l e m e n t . v a l ( )   = = =   " "   & &   t h i s . o p t s . e l e m e n t . t e x t ( )   = = =   " " )   { 
                                 t h i s . u p d a t e S e l e c t i o n ( [ ] ) ; 
                                 t h i s . c l o s e ( ) ; 
                                 / /   s e t   t h e   p l a c e h o l d e r   i f   n e c e s s a r y 
                                 t h i s . c l e a r S e a r c h ( ) ; 
                         } 
                         i f   ( t h i s . s e l e c t   | |   t h i s . o p t s . e l e m e n t . v a l ( )   ! = =   " " )   { 
                                 v a r   s e l f   =   t h i s ; 
                                 t h i s . o p t s . i n i t S e l e c t i o n . c a l l ( n u l l ,   t h i s . o p t s . e l e m e n t ,   f u n c t i o n ( d a t a ) { 
                                         i f   ( d a t a   ! = =   u n d e f i n e d   & &   d a t a   ! = =   n u l l )   { 
                                                 s e l f . u p d a t e S e l e c t i o n ( d a t a ) ; 
                                                 s e l f . c l o s e ( ) ; 
                                                 / /   s e t   t h e   p l a c e h o l d e r   i f   n e c e s s a r y 
                                                 s e l f . c l e a r S e a r c h ( ) ; 
                                         } 
                                 } ) ; 
                         } 
                 } , 
 
                 / /   m u l t i 
                 c l e a r S e a r c h :   f u n c t i o n   ( )   { 
                         v a r   p l a c e h o l d e r   =   t h i s . g e t P l a c e h o l d e r ( ) , 
                                 m a x W i d t h   =   t h i s . g e t M a x S e a r c h W i d t h ( ) ; 
 
                         i f   ( p l a c e h o l d e r   ! = =   u n d e f i n e d     & &   t h i s . g e t V a l ( ) . l e n g t h   = = =   0   & &   t h i s . s e a r c h . h a s C l a s s ( " s e l e c t 2 - f o c u s e d " )   = = =   f a l s e )   { 
                                 t h i s . s e a r c h . v a l ( p l a c e h o l d e r ) . a d d C l a s s ( " s e l e c t 2 - d e f a u l t " ) ; 
                                 / /   s t r e t c h   t h e   s e a r c h   b o x   t o   f u l l   w i d t h   o f   t h e   c o n t a i n e r   s o   a s   m u c h   o f   t h e   p l a c e h o l d e r   i s   v i s i b l e   a s   p o s s i b l e 
                                 / /   w e   c o u l d   c a l l   t h i s . r e s i z e S e a r c h ( ) ,   b u t   w e   d o   n o t   b e c a u s e   t h a t   r e q u i r e s   a   s i z e r   a n d   w e   d o   n o t   w a n t   t o   c r e a t e   o n e   s o   e a r l y   b e c a u s e   o f   a   f i r e f o x   b u g ,   s e e   # 9 4 4 
                                 t h i s . s e a r c h . w i d t h ( m a x W i d t h   >   0   ?   m a x W i d t h   :   t h i s . c o n t a i n e r . c s s ( " w i d t h " ) ) ; 
                         }   e l s e   { 
                                 t h i s . s e a r c h . v a l ( " " ) . w i d t h ( 1 0 ) ; 
                         } 
                 } , 
 
                 / /   m u l t i 
                 c l e a r P l a c e h o l d e r :   f u n c t i o n   ( )   { 
                         i f   ( t h i s . s e a r c h . h a s C l a s s ( " s e l e c t 2 - d e f a u l t " ) )   { 
                                 t h i s . s e a r c h . v a l ( " " ) . r e m o v e C l a s s ( " s e l e c t 2 - d e f a u l t " ) ; 
                         } 
                 } , 
 
                 / /   m u l t i 
                 o p e n i n g :   f u n c t i o n   ( )   { 
                         t h i s . c l e a r P l a c e h o l d e r ( ) ;   / /   s h o u l d   b e   d o n e   b e f o r e   s u p e r   s o   p l a c e h o l d e r   i s   n o t   u s e d   t o   s e a r c h 
                         t h i s . r e s i z e S e a r c h ( ) ; 
 
                         t h i s . p a r e n t . o p e n i n g . a p p l y ( t h i s ,   a r g u m e n t s ) ; 
 
                         t h i s . f o c u s S e a r c h ( ) ; 
 
                         / /   i n i t i a l i z e s   s e a r c h ' s   v a l u e   w i t h   n e x t S e a r c h T e r m   ( i f   d e f i n e d   b y   u s e r ) 
                         / /   i g n o r e   n e x t S e a r c h T e r m   i f   t h e   d r o p d o w n   i s   o p e n e d   b y   t h e   u s e r   p r e s s i n g   a   l e t t e r 
                         i f ( t h i s . s e a r c h . v a l ( )   = = =   " " )   { 
                                 i f ( t h i s . n e x t S e a r c h T e r m   ! =   u n d e f i n e d ) { 
                                         t h i s . s e a r c h . v a l ( t h i s . n e x t S e a r c h T e r m ) ; 
                                         t h i s . s e a r c h . s e l e c t ( ) ; 
                                 } 
                         } 
 
                         t h i s . u p d a t e R e s u l t s ( t r u e ) ; 
                         i f   ( t h i s . o p t s . s h o u l d F o c u s I n p u t ( t h i s ) )   { 
                                 t h i s . s e a r c h . f o c u s ( ) ; 
                         } 
                         t h i s . o p t s . e l e m e n t . t r i g g e r ( $ . E v e n t ( " s e l e c t 2 - o p e n " ) ) ; 
                 } , 
 
                 / /   m u l t i 
                 c l o s e :   f u n c t i o n   ( )   { 
                         i f   ( ! t h i s . o p e n e d ( ) )   r e t u r n ; 
                         t h i s . p a r e n t . c l o s e . a p p l y ( t h i s ,   a r g u m e n t s ) ; 
                 } , 
 
                 / /   m u l t i 
                 f o c u s :   f u n c t i o n   ( )   { 
                         t h i s . c l o s e ( ) ; 
                         t h i s . s e a r c h . f o c u s ( ) ; 
                 } , 
 
                 / /   m u l t i 
                 i s F o c u s e d :   f u n c t i o n   ( )   { 
                         r e t u r n   t h i s . s e a r c h . h a s C l a s s ( " s e l e c t 2 - f o c u s e d " ) ; 
                 } , 
 
                 / /   m u l t i 
                 u p d a t e S e l e c t i o n :   f u n c t i o n   ( d a t a )   { 
                         v a r   i d s   =   [ ] ,   f i l t e r e d   =   [ ] ,   s e l f   =   t h i s ; 
 
                         / /   f i l t e r   o u t   d u p l i c a t e s 
                         $ ( d a t a ) . e a c h ( f u n c t i o n   ( )   { 
                                 i f   ( i n d e x O f ( s e l f . i d ( t h i s ) ,   i d s )   <   0 )   { 
                                         i d s . p u s h ( s e l f . i d ( t h i s ) ) ; 
                                         f i l t e r e d . p u s h ( t h i s ) ; 
                                 } 
                         } ) ; 
                         d a t a   =   f i l t e r e d ; 
 
                         t h i s . s e l e c t i o n . f i n d ( " . s e l e c t 2 - s e a r c h - c h o i c e " ) . r e m o v e ( ) ; 
                         $ ( d a t a ) . e a c h ( f u n c t i o n   ( )   { 
                                 s e l f . a d d S e l e c t e d C h o i c e ( t h i s ) ; 
                         } ) ; 
                         s e l f . p o s t p r o c e s s R e s u l t s ( ) ; 
                 } , 
 
                 / /   m u l t i 
                 t o k e n i z e :   f u n c t i o n ( )   { 
                         v a r   i n p u t   =   t h i s . s e a r c h . v a l ( ) ; 
                         i n p u t   =   t h i s . o p t s . t o k e n i z e r . c a l l ( t h i s ,   i n p u t ,   t h i s . d a t a ( ) ,   t h i s . b i n d ( t h i s . o n S e l e c t ) ,   t h i s . o p t s ) ; 
                         i f   ( i n p u t   ! =   n u l l   & &   i n p u t   ! =   u n d e f i n e d )   { 
                                 t h i s . s e a r c h . v a l ( i n p u t ) ; 
                                 i f   ( i n p u t . l e n g t h   >   0 )   { 
                                         t h i s . o p e n ( ) ; 
                                 } 
                         } 
 
                 } , 
 
                 / /   m u l t i 
                 o n S e l e c t :   f u n c t i o n   ( d a t a ,   o p t i o n s )   { 
 
                         i f   ( ! t h i s . t r i g g e r S e l e c t ( d a t a )   | |   d a t a . t e x t   = = =   " " )   {   r e t u r n ;   } 
 
                         t h i s . a d d S e l e c t e d C h o i c e ( d a t a ) ; 
 
                         t h i s . o p t s . e l e m e n t . t r i g g e r ( {   t y p e :   " s e l e c t e d " ,   v a l :   t h i s . i d ( d a t a ) ,   c h o i c e :   d a t a   } ) ; 
 
                         / /   k e e p   t r a c k   o f   t h e   s e a r c h ' s   v a l u e   b e f o r e   i t   g e t s   c l e a r e d 
                         t h i s . n e x t S e a r c h T e r m   =   t h i s . o p t s . n e x t S e a r c h T e r m ( d a t a ,   t h i s . s e a r c h . v a l ( ) ) ; 
 
                         t h i s . c l e a r S e a r c h ( ) ; 
                         t h i s . u p d a t e R e s u l t s ( ) ; 
 
                         i f   ( t h i s . s e l e c t   | |   ! t h i s . o p t s . c l o s e O n S e l e c t )   t h i s . p o s t p r o c e s s R e s u l t s ( d a t a ,   f a l s e ,   t h i s . o p t s . c l o s e O n S e l e c t = = = t r u e ) ; 
 
                         i f   ( t h i s . o p t s . c l o s e O n S e l e c t )   { 
                                 t h i s . c l o s e ( ) ; 
                                 t h i s . s e a r c h . w i d t h ( 1 0 ) ; 
                         }   e l s e   { 
                                 i f   ( t h i s . c o u n t S e l e c t a b l e R e s u l t s ( ) > 0 )   { 
                                         t h i s . s e a r c h . w i d t h ( 1 0 ) ; 
                                         t h i s . r e s i z e S e a r c h ( ) ; 
                                         i f   ( t h i s . g e t M a x i m u m S e l e c t i o n S i z e ( )   >   0   & &   t h i s . v a l ( ) . l e n g t h   > =   t h i s . g e t M a x i m u m S e l e c t i o n S i z e ( ) )   { 
                                                 / /   i f   w e   r e a c h e d   m a x   s e l e c t i o n   s i z e   r e p a i n t   t h e   r e s u l t s   s o   c h o i c e s 
                                                 / /   a r e   r e p l a c e d   w i t h   t h e   m a x   s e l e c t i o n   r e a c h e d   m e s s a g e 
                                                 t h i s . u p d a t e R e s u l t s ( t r u e ) ; 
                                         }   e l s e   { 
                                                 / /   i n i t i a l i z e s   s e a r c h ' s   v a l u e   w i t h   n e x t S e a r c h T e r m   a n d   u p d a t e   s e a r c h   r e s u l t 
                                                 i f ( t h i s . n e x t S e a r c h T e r m   ! =   u n d e f i n e d ) { 
                                                         t h i s . s e a r c h . v a l ( t h i s . n e x t S e a r c h T e r m ) ; 
                                                         t h i s . u p d a t e R e s u l t s ( ) ; 
                                                         t h i s . s e a r c h . s e l e c t ( ) ; 
                                                 } 
                                         } 
                                         t h i s . p o s i t i o n D r o p d o w n ( ) ; 
                                 }   e l s e   { 
                                         / /   i f   n o t h i n g   l e f t   t o   s e l e c t   c l o s e 
                                         t h i s . c l o s e ( ) ; 
                                         t h i s . s e a r c h . w i d t h ( 1 0 ) ; 
                                 } 
                         } 
 
                         / /   s i n c e   i t s   n o t   p o s s i b l e   t o   s e l e c t   a n   e l e m e n t   t h a t   h a s   a l r e a d y   b e e n 
                         / /   a d d e d   w e   d o   n o t   n e e d   t o   c h e c k   i f   t h i s   i s   a   n e w   e l e m e n t   b e f o r e   f i r i n g   c h a n g e 
                         t h i s . t r i g g e r C h a n g e ( {   a d d e d :   d a t a   } ) ; 
 
                         i f   ( ! o p t i o n s   | |   ! o p t i o n s . n o F o c u s ) 
                                 t h i s . f o c u s S e a r c h ( ) ; 
                 } , 
 
                 / /   m u l t i 
                 c a n c e l :   f u n c t i o n   ( )   { 
                         t h i s . c l o s e ( ) ; 
                         t h i s . f o c u s S e a r c h ( ) ; 
                 } , 
 
                 a d d S e l e c t e d C h o i c e :   f u n c t i o n   ( d a t a )   { 
                         v a r   e n a b l e C h o i c e   =   ! d a t a . l o c k e d , 
                                 e n a b l e d I t e m   =   $ ( 
                                         " < l i   c l a s s = ' s e l e c t 2 - s e a r c h - c h o i c e ' > "   + 
                                         "         < d i v > < / d i v > "   + 
                                         "         < a   h r e f = ' # '   c l a s s = ' s e l e c t 2 - s e a r c h - c h o i c e - c l o s e '   t a b i n d e x = ' - 1 ' > < / a > "   + 
                                         " < / l i > " ) , 
                                 d i s a b l e d I t e m   =   $ ( 
                                         " < l i   c l a s s = ' s e l e c t 2 - s e a r c h - c h o i c e   s e l e c t 2 - l o c k e d ' > "   + 
                                         " < d i v > < / d i v > "   + 
                                         " < / l i > " ) ; 
                         v a r   c h o i c e   =   e n a b l e C h o i c e   ?   e n a b l e d I t e m   :   d i s a b l e d I t e m , 
                                 i d   =   t h i s . i d ( d a t a ) , 
                                 v a l   =   t h i s . g e t V a l ( ) , 
                                 f o r m a t t e d , 
                                 c s s C l a s s ; 
 
                         f o r m a t t e d = t h i s . o p t s . f o r m a t S e l e c t i o n ( d a t a ,   c h o i c e . f i n d ( " d i v " ) ,   t h i s . o p t s . e s c a p e M a r k u p ) ; 
                         i f   ( f o r m a t t e d   ! =   u n d e f i n e d )   { 
                                 c h o i c e . f i n d ( " d i v " ) . r e p l a c e W i t h ( $ ( " < d i v > < / d i v > " ) . h t m l ( f o r m a t t e d ) ) ; 
                         } 
                         c s s C l a s s = t h i s . o p t s . f o r m a t S e l e c t i o n C s s C l a s s ( d a t a ,   c h o i c e . f i n d ( " d i v " ) ) ; 
                         i f   ( c s s C l a s s   ! =   u n d e f i n e d )   { 
                                 c h o i c e . a d d C l a s s ( c s s C l a s s ) ; 
                         } 
 
                         i f ( e n a b l e C h o i c e ) { 
                             c h o i c e . f i n d ( " . s e l e c t 2 - s e a r c h - c h o i c e - c l o s e " ) 
                                     . o n ( " m o u s e d o w n " ,   k i l l E v e n t ) 
                                     . o n ( " c l i c k   d b l c l i c k " ,   t h i s . b i n d ( f u n c t i o n   ( e )   { 
                                     i f   ( ! t h i s . i s I n t e r f a c e E n a b l e d ( ) )   r e t u r n ; 
 
                                     t h i s . u n s e l e c t ( $ ( e . t a r g e t ) ) ; 
                                     t h i s . s e l e c t i o n . f i n d ( " . s e l e c t 2 - s e a r c h - c h o i c e - f o c u s " ) . r e m o v e C l a s s ( " s e l e c t 2 - s e a r c h - c h o i c e - f o c u s " ) ; 
                                     k i l l E v e n t ( e ) ; 
                                     t h i s . c l o s e ( ) ; 
                                     t h i s . f o c u s S e a r c h ( ) ; 
                             } ) ) . o n ( " f o c u s " ,   t h i s . b i n d ( f u n c t i o n   ( )   { 
                                     i f   ( ! t h i s . i s I n t e r f a c e E n a b l e d ( ) )   r e t u r n ; 
                                     t h i s . c o n t a i n e r . a d d C l a s s ( " s e l e c t 2 - c o n t a i n e r - a c t i v e " ) ; 
                                     t h i s . d r o p d o w n . a d d C l a s s ( " s e l e c t 2 - d r o p - a c t i v e " ) ; 
                             } ) ) ; 
                         } 
 
                         c h o i c e . d a t a ( " s e l e c t 2 - d a t a " ,   d a t a ) ; 
                         c h o i c e . i n s e r t B e f o r e ( t h i s . s e a r c h C o n t a i n e r ) ; 
 
                         v a l . p u s h ( i d ) ; 
                         t h i s . s e t V a l ( v a l ) ; 
                 } , 
 
                 / /   m u l t i 
                 u n s e l e c t :   f u n c t i o n   ( s e l e c t e d )   { 
                         v a r   v a l   =   t h i s . g e t V a l ( ) , 
                                 d a t a , 
                                 i n d e x ; 
                         s e l e c t e d   =   s e l e c t e d . c l o s e s t ( " . s e l e c t 2 - s e a r c h - c h o i c e " ) ; 
 
                         i f   ( s e l e c t e d . l e n g t h   = = =   0 )   { 
                                 t h r o w   " I n v a l i d   a r g u m e n t :   "   +   s e l e c t e d   +   " .   M u s t   b e   . s e l e c t 2 - s e a r c h - c h o i c e " ; 
                         } 
 
                         d a t a   =   s e l e c t e d . d a t a ( " s e l e c t 2 - d a t a " ) ; 
 
                         i f   ( ! d a t a )   { 
                                 / /   p r e v e n t   a   r a c e   c o n d i t i o n   w h e n   t h e   ' x '   i s   c l i c k e d   r e a l l y   f a s t   r e p e a t e d l y   t h e   e v e n t   c a n   b e   q u e u e d 
                                 / /   a n d   i n v o k e d   o n   a n   e l e m e n t   a l r e a d y   r e m o v e d 
                                 r e t u r n ; 
                         } 
 
                         v a r   e v t   =   $ . E v e n t ( " s e l e c t 2 - r e m o v i n g " ) ; 
                         e v t . v a l   =   t h i s . i d ( d a t a ) ; 
                         e v t . c h o i c e   =   d a t a ; 
                         t h i s . o p t s . e l e m e n t . t r i g g e r ( e v t ) ; 
 
                         i f   ( e v t . i s D e f a u l t P r e v e n t e d ( ) )   { 
                                 r e t u r n   f a l s e ; 
                         } 
 
                         w h i l e ( ( i n d e x   =   i n d e x O f ( t h i s . i d ( d a t a ) ,   v a l ) )   > =   0 )   { 
                                 v a l . s p l i c e ( i n d e x ,   1 ) ; 
                                 t h i s . s e t V a l ( v a l ) ; 
                                 i f   ( t h i s . s e l e c t )   t h i s . p o s t p r o c e s s R e s u l t s ( ) ; 
                         } 
 
                         s e l e c t e d . r e m o v e ( ) ; 
 
                         t h i s . o p t s . e l e m e n t . t r i g g e r ( {   t y p e :   " s e l e c t 2 - r e m o v e d " ,   v a l :   t h i s . i d ( d a t a ) ,   c h o i c e :   d a t a   } ) ; 
                         t h i s . t r i g g e r C h a n g e ( {   r e m o v e d :   d a t a   } ) ; 
 
                         r e t u r n   t r u e ; 
                 } , 
 
                 / /   m u l t i 
                 p o s t p r o c e s s R e s u l t s :   f u n c t i o n   ( d a t a ,   i n i t i a l ,   n o H i g h l i g h t U p d a t e )   { 
                         v a r   v a l   =   t h i s . g e t V a l ( ) , 
                                 c h o i c e s   =   t h i s . r e s u l t s . f i n d ( " . s e l e c t 2 - r e s u l t " ) , 
                                 c o m p o u n d   =   t h i s . r e s u l t s . f i n d ( " . s e l e c t 2 - r e s u l t - w i t h - c h i l d r e n " ) , 
                                 s e l f   =   t h i s ; 
 
                         c h o i c e s . e a c h 2 ( f u n c t i o n   ( i ,   c h o i c e )   { 
                                 v a r   i d   =   s e l f . i d ( c h o i c e . d a t a ( " s e l e c t 2 - d a t a " ) ) ; 
                                 i f   ( i n d e x O f ( i d ,   v a l )   > =   0 )   { 
                                         c h o i c e . a d d C l a s s ( " s e l e c t 2 - s e l e c t e d " ) ; 
                                         / /   m a r k   a l l   c h i l d r e n   o f   t h e   s e l e c t e d   p a r e n t   a s   s e l e c t e d 
                                         c h o i c e . f i n d ( " . s e l e c t 2 - r e s u l t - s e l e c t a b l e " ) . a d d C l a s s ( " s e l e c t 2 - s e l e c t e d " ) ; 
                                 } 
                         } ) ; 
 
                         c o m p o u n d . e a c h 2 ( f u n c t i o n ( i ,   c h o i c e )   { 
                                 / /   h i d e   a n   o p t g r o u p   i f   i t   d o e s n ' t   h a v e   a n y   s e l e c t a b l e   c h i l d r e n 
                                 i f   ( ! c h o i c e . i s ( ' . s e l e c t 2 - r e s u l t - s e l e c t a b l e ' ) 
                                         & &   c h o i c e . f i n d ( " . s e l e c t 2 - r e s u l t - s e l e c t a b l e : n o t ( . s e l e c t 2 - s e l e c t e d ) " ) . l e n g t h   = = =   0 )   { 
                                         c h o i c e . a d d C l a s s ( " s e l e c t 2 - s e l e c t e d " ) ; 
                                 } 
                         } ) ; 
 
                         i f   ( t h i s . h i g h l i g h t ( )   = =   - 1   & &   n o H i g h l i g h t U p d a t e   ! = =   f a l s e   & &   t h i s . o p t s . c l o s e O n S e l e c t   = = =   t r u e ) { 
                                 s e l f . h i g h l i g h t ( 0 ) ; 
                         } 
 
                         / / I f   a l l   r e s u l t s   a r e   c h o s e n   r e n d e r   f o r m a t N o M a t c h e s 
                         i f ( ! t h i s . o p t s . c r e a t e S e a r c h C h o i c e   & &   ! c h o i c e s . f i l t e r ( ' . s e l e c t 2 - r e s u l t : n o t ( . s e l e c t 2 - s e l e c t e d ) ' ) . l e n g t h   >   0 ) { 
                                 i f ( ! d a t a   | |   d a t a   & &   ! d a t a . m o r e   & &   t h i s . r e s u l t s . f i n d ( " . s e l e c t 2 - n o - r e s u l t s " ) . l e n g t h   = = =   0 )   { 
                                         i f   ( c h e c k F o r m a t t e r ( s e l f . o p t s . f o r m a t N o M a t c h e s ,   " f o r m a t N o M a t c h e s " ) )   { 
                                                 t h i s . r e s u l t s . a p p e n d ( " < l i   c l a s s = ' s e l e c t 2 - n o - r e s u l t s ' > "   +   e v a l u a t e ( s e l f . o p t s . f o r m a t N o M a t c h e s ,   s e l f . o p t s . e l e m e n t ,   s e l f . s e a r c h . v a l ( ) )   +   " < / l i > " ) ; 
                                         } 
                                 } 
                         } 
 
                 } , 
 
                 / /   m u l t i 
                 g e t M a x S e a r c h W i d t h :   f u n c t i o n ( )   { 
                         r e t u r n   t h i s . s e l e c t i o n . w i d t h ( )   -   g e t S i d e B o r d e r P a d d i n g ( t h i s . s e a r c h ) ; 
                 } , 
 
                 / /   m u l t i 
                 r e s i z e S e a r c h :   f u n c t i o n   ( )   { 
                         v a r   m i n i m u m W i d t h ,   l e f t ,   m a x W i d t h ,   c o n t a i n e r L e f t ,   s e a r c h W i d t h , 
                                 s i d e B o r d e r P a d d i n g   =   g e t S i d e B o r d e r P a d d i n g ( t h i s . s e a r c h ) ; 
 
                         m i n i m u m W i d t h   =   m e a s u r e T e x t W i d t h ( t h i s . s e a r c h )   +   1 0 ; 
 
                         l e f t   =   t h i s . s e a r c h . o f f s e t ( ) . l e f t ; 
 
                         m a x W i d t h   =   t h i s . s e l e c t i o n . w i d t h ( ) ; 
                         c o n t a i n e r L e f t   =   t h i s . s e l e c t i o n . o f f s e t ( ) . l e f t ; 
 
                         s e a r c h W i d t h   =   m a x W i d t h   -   ( l e f t   -   c o n t a i n e r L e f t )   -   s i d e B o r d e r P a d d i n g ; 
 
                         i f   ( s e a r c h W i d t h   <   m i n i m u m W i d t h )   { 
                                 s e a r c h W i d t h   =   m a x W i d t h   -   s i d e B o r d e r P a d d i n g ; 
                         } 
 
                         i f   ( s e a r c h W i d t h   <   4 0 )   { 
                                 s e a r c h W i d t h   =   m a x W i d t h   -   s i d e B o r d e r P a d d i n g ; 
                         } 
 
                         i f   ( s e a r c h W i d t h   < =   0 )   { 
                             s e a r c h W i d t h   =   m i n i m u m W i d t h ; 
                         } 
 
                         t h i s . s e a r c h . w i d t h ( M a t h . f l o o r ( s e a r c h W i d t h ) ) ; 
                 } , 
 
                 / /   m u l t i 
                 g e t V a l :   f u n c t i o n   ( )   { 
                         v a r   v a l ; 
                         i f   ( t h i s . s e l e c t )   { 
                                 v a l   =   t h i s . s e l e c t . v a l ( ) ; 
                                 r e t u r n   v a l   = = =   n u l l   ?   [ ]   :   v a l ; 
                         }   e l s e   { 
                                 v a l   =   t h i s . o p t s . e l e m e n t . v a l ( ) ; 
                                 r e t u r n   s p l i t V a l ( v a l ,   t h i s . o p t s . s e p a r a t o r ,   t h i s . o p t s . t r a n s f o r m V a l ) ; 
                         } 
                 } , 
 
                 / /   m u l t i 
                 s e t V a l :   f u n c t i o n   ( v a l )   { 
                         v a r   u n i q u e ; 
                         i f   ( t h i s . s e l e c t )   { 
                                 t h i s . s e l e c t . v a l ( v a l ) ; 
                         }   e l s e   { 
                                 u n i q u e   =   [ ] ; 
                                 / /   f i l t e r   o u t   d u p l i c a t e s 
                                 $ ( v a l ) . e a c h ( f u n c t i o n   ( )   { 
                                         i f   ( i n d e x O f ( t h i s ,   u n i q u e )   <   0 )   u n i q u e . p u s h ( t h i s ) ; 
                                 } ) ; 
                                 t h i s . o p t s . e l e m e n t . v a l ( u n i q u e . l e n g t h   = = =   0   ?   " "   :   u n i q u e . j o i n ( t h i s . o p t s . s e p a r a t o r ) ) ; 
                         } 
                 } , 
 
                 / /   m u l t i 
                 b u i l d C h a n g e D e t a i l s :   f u n c t i o n   ( o l d ,   c u r r e n t )   { 
                         v a r   c u r r e n t   =   c u r r e n t . s l i c e ( 0 ) , 
                                 o l d   =   o l d . s l i c e ( 0 ) ; 
 
                         / /   r e m o v e   i n t e r s e c t i o n   f r o m   e a c h   a r r a y 
                         f o r   ( v a r   i   =   0 ;   i   <   c u r r e n t . l e n g t h ;   i + + )   { 
                                 f o r   ( v a r   j   =   0 ;   j   <   o l d . l e n g t h ;   j + + )   { 
                                         i f   ( e q u a l ( t h i s . o p t s . i d ( c u r r e n t [ i ] ) ,   t h i s . o p t s . i d ( o l d [ j ] ) ) )   { 
                                                 c u r r e n t . s p l i c e ( i ,   1 ) ; 
                                                 i f ( i > 0 ) { 
                                                         i - - ; 
                                                 } 
                                                 o l d . s p l i c e ( j ,   1 ) ; 
                                                 j - - ; 
                                         } 
                                 } 
                         } 
 
                         r e t u r n   { a d d e d :   c u r r e n t ,   r e m o v e d :   o l d } ; 
                 } , 
 
 
                 / /   m u l t i 
                 v a l :   f u n c t i o n   ( v a l ,   t r i g g e r C h a n g e )   { 
                         v a r   o l d D a t a ,   s e l f = t h i s ; 
 
                         i f   ( a r g u m e n t s . l e n g t h   = = =   0 )   { 
                                 r e t u r n   t h i s . g e t V a l ( ) ; 
                         } 
 
                         o l d D a t a = t h i s . d a t a ( ) ; 
                         i f   ( ! o l d D a t a . l e n g t h )   o l d D a t a = [ ] ; 
 
                         / /   v a l   i s   a n   i d .   ! v a l   i s   t r u e   f o r   [ u n d e f i n e d , n u l l , ' ' , 0 ]   -   0   i s   l e g a l 
                         i f   ( ! v a l   & &   v a l   ! = =   0 )   { 
                                 t h i s . o p t s . e l e m e n t . v a l ( " " ) ; 
                                 t h i s . u p d a t e S e l e c t i o n ( [ ] ) ; 
                                 t h i s . c l e a r S e a r c h ( ) ; 
                                 i f   ( t r i g g e r C h a n g e )   { 
                                         t h i s . t r i g g e r C h a n g e ( { a d d e d :   t h i s . d a t a ( ) ,   r e m o v e d :   o l d D a t a } ) ; 
                                 } 
                                 r e t u r n ; 
                         } 
 
                         / /   v a l   i s   a   l i s t   o f   i d s 
                         t h i s . s e t V a l ( v a l ) ; 
 
                         i f   ( t h i s . s e l e c t )   { 
                                 t h i s . o p t s . i n i t S e l e c t i o n ( t h i s . s e l e c t ,   t h i s . b i n d ( t h i s . u p d a t e S e l e c t i o n ) ) ; 
                                 i f   ( t r i g g e r C h a n g e )   { 
                                         t h i s . t r i g g e r C h a n g e ( t h i s . b u i l d C h a n g e D e t a i l s ( o l d D a t a ,   t h i s . d a t a ( ) ) ) ; 
                                 } 
                         }   e l s e   { 
                                 i f   ( t h i s . o p t s . i n i t S e l e c t i o n   = = =   u n d e f i n e d )   { 
                                         t h r o w   n e w   E r r o r ( " v a l ( )   c a n n o t   b e   c a l l e d   i f   i n i t S e l e c t i o n ( )   i s   n o t   d e f i n e d " ) ; 
                                 } 
 
                                 t h i s . o p t s . i n i t S e l e c t i o n ( t h i s . o p t s . e l e m e n t ,   f u n c t i o n ( d a t a ) { 
                                         v a r   i d s = $ . m a p ( d a t a ,   s e l f . i d ) ; 
                                         s e l f . s e t V a l ( i d s ) ; 
                                         s e l f . u p d a t e S e l e c t i o n ( d a t a ) ; 
                                         s e l f . c l e a r S e a r c h ( ) ; 
                                         i f   ( t r i g g e r C h a n g e )   { 
                                                 s e l f . t r i g g e r C h a n g e ( s e l f . b u i l d C h a n g e D e t a i l s ( o l d D a t a ,   s e l f . d a t a ( ) ) ) ; 
                                         } 
                                 } ) ; 
                         } 
                         t h i s . c l e a r S e a r c h ( ) ; 
                 } , 
 
                 / /   m u l t i 
                 o n S o r t S t a r t :   f u n c t i o n ( )   { 
                         i f   ( t h i s . s e l e c t )   { 
                                 t h r o w   n e w   E r r o r ( " S o r t i n g   o f   e l e m e n t s   i s   n o t   s u p p o r t e d   w h e n   a t t a c h e d   t o   < s e l e c t > .   A t t a c h   t o   < i n p u t   t y p e = ' h i d d e n ' / >   i n s t e a d . " ) ; 
                         } 
 
                         / /   c o l l a p s e   s e a r c h   f i e l d   i n t o   0   w i d t h   s o   i t s   c o n t a i n e r   c a n   b e   c o l l a p s e d   a s   w e l l 
                         t h i s . s e a r c h . w i d t h ( 0 ) ; 
                         / /   h i d e   t h e   c o n t a i n e r 
                         t h i s . s e a r c h C o n t a i n e r . h i d e ( ) ; 
                 } , 
 
                 / /   m u l t i 
                 o n S o r t E n d : f u n c t i o n ( )   { 
 
                         v a r   v a l = [ ] ,   s e l f = t h i s ; 
 
                         / /   s h o w   s e a r c h   a n d   m o v e   i t   t o   t h e   e n d   o f   t h e   l i s t 
                         t h i s . s e a r c h C o n t a i n e r . s h o w ( ) ; 
                         / /   m a k e   s u r e   t h e   s e a r c h   c o n t a i n e r   i s   t h e   l a s t   i t e m   i n   t h e   l i s t 
                         t h i s . s e a r c h C o n t a i n e r . a p p e n d T o ( t h i s . s e a r c h C o n t a i n e r . p a r e n t ( ) ) ; 
                         / /   s i n c e   w e   c o l l a p s e d   t h e   w i d t h   i n   d r a g S t a r t e d ,   w e   r e s i z e   i t   h e r e 
                         t h i s . r e s i z e S e a r c h ( ) ; 
 
                         / /   u p d a t e   s e l e c t i o n 
                         t h i s . s e l e c t i o n . f i n d ( " . s e l e c t 2 - s e a r c h - c h o i c e " ) . e a c h ( f u n c t i o n ( )   { 
                                 v a l . p u s h ( s e l f . o p t s . i d ( $ ( t h i s ) . d a t a ( " s e l e c t 2 - d a t a " ) ) ) ; 
                         } ) ; 
                         t h i s . s e t V a l ( v a l ) ; 
                         t h i s . t r i g g e r C h a n g e ( ) ; 
                 } , 
 
                 / /   m u l t i 
                 d a t a :   f u n c t i o n ( v a l u e s ,   t r i g g e r C h a n g e )   { 
                         v a r   s e l f = t h i s ,   i d s ,   o l d ; 
                         i f   ( a r g u m e n t s . l e n g t h   = = =   0 )   { 
                                   r e t u r n   t h i s . s e l e c t i o n 
                                           . c h i l d r e n ( " . s e l e c t 2 - s e a r c h - c h o i c e " ) 
                                           . m a p ( f u n c t i o n ( )   {   r e t u r n   $ ( t h i s ) . d a t a ( " s e l e c t 2 - d a t a " ) ;   } ) 
                                           . g e t ( ) ; 
                         }   e l s e   { 
                                 o l d   =   t h i s . d a t a ( ) ; 
                                 i f   ( ! v a l u e s )   {   v a l u e s   =   [ ] ;   } 
                                 i d s   =   $ . m a p ( v a l u e s ,   f u n c t i o n ( e )   {   r e t u r n   s e l f . o p t s . i d ( e ) ;   } ) ; 
                                 t h i s . s e t V a l ( i d s ) ; 
                                 t h i s . u p d a t e S e l e c t i o n ( v a l u e s ) ; 
                                 t h i s . c l e a r S e a r c h ( ) ; 
                                 i f   ( t r i g g e r C h a n g e )   { 
                                         t h i s . t r i g g e r C h a n g e ( t h i s . b u i l d C h a n g e D e t a i l s ( o l d ,   t h i s . d a t a ( ) ) ) ; 
                                 } 
                         } 
                 } 
         } ) ; 
 
         $ . f n . s e l e c t 2   =   f u n c t i o n   ( )   { 
 
                 v a r   a r g s   =   A r r a y . p r o t o t y p e . s l i c e . c a l l ( a r g u m e n t s ,   0 ) , 
                         o p t s , 
                         s e l e c t 2 , 
                         m e t h o d ,   v a l u e ,   m u l t i p l e , 
                         a l l o w e d M e t h o d s   =   [ " v a l " ,   " d e s t r o y " ,   " o p e n e d " ,   " o p e n " ,   " c l o s e " ,   " f o c u s " ,   " i s F o c u s e d " ,   " c o n t a i n e r " ,   " d r o p d o w n " ,   " o n S o r t S t a r t " ,   " o n S o r t E n d " ,   " e n a b l e " ,   " d i s a b l e " ,   " r e a d o n l y " ,   " p o s i t i o n D r o p d o w n " ,   " d a t a " ,   " s e a r c h " ] , 
                         v a l u e M e t h o d s   =   [ " o p e n e d " ,   " i s F o c u s e d " ,   " c o n t a i n e r " ,   " d r o p d o w n " ] , 
                         p r o p e r t y M e t h o d s   =   [ " v a l " ,   " d a t a " ] , 
                         m e t h o d s M a p   =   {   s e a r c h :   " e x t e r n a l S e a r c h "   } ; 
 
                 t h i s . e a c h ( f u n c t i o n   ( )   { 
                         i f   ( a r g s . l e n g t h   = = =   0   | |   t y p e o f ( a r g s [ 0 ] )   = = =   " o b j e c t " )   { 
                                 o p t s   =   a r g s . l e n g t h   = = =   0   ?   { }   :   $ . e x t e n d ( { } ,   a r g s [ 0 ] ) ; 
                                 o p t s . e l e m e n t   =   $ ( t h i s ) ; 
 
                                 i f   ( o p t s . e l e m e n t . g e t ( 0 ) . t a g N a m e . t o L o w e r C a s e ( )   = = =   " s e l e c t " )   { 
                                         m u l t i p l e   =   o p t s . e l e m e n t . p r o p ( " m u l t i p l e " ) ; 
                                 }   e l s e   { 
                                         m u l t i p l e   =   o p t s . m u l t i p l e   | |   f a l s e ; 
                                         i f   ( " t a g s "   i n   o p t s )   { o p t s . m u l t i p l e   =   m u l t i p l e   =   t r u e ; } 
                                 } 
 
                                 s e l e c t 2   =   m u l t i p l e   ?   n e w   w i n d o w . S e l e c t 2 [ " c l a s s " ] . m u l t i ( )   :   n e w   w i n d o w . S e l e c t 2 [ " c l a s s " ] . s i n g l e ( ) ; 
                                 s e l e c t 2 . i n i t ( o p t s ) ; 
                         }   e l s e   i f   ( t y p e o f ( a r g s [ 0 ] )   = = =   " s t r i n g " )   { 
 
                                 i f   ( i n d e x O f ( a r g s [ 0 ] ,   a l l o w e d M e t h o d s )   <   0 )   { 
                                         t h r o w   " U n k n o w n   m e t h o d :   "   +   a r g s [ 0 ] ; 
                                 } 
 
                                 v a l u e   =   u n d e f i n e d ; 
                                 s e l e c t 2   =   $ ( t h i s ) . d a t a ( " s e l e c t 2 " ) ; 
                                 i f   ( s e l e c t 2   = = =   u n d e f i n e d )   r e t u r n ; 
 
                                 m e t h o d = a r g s [ 0 ] ; 
 
                                 i f   ( m e t h o d   = = =   " c o n t a i n e r " )   { 
                                         v a l u e   =   s e l e c t 2 . c o n t a i n e r ; 
                                 }   e l s e   i f   ( m e t h o d   = = =   " d r o p d o w n " )   { 
                                         v a l u e   =   s e l e c t 2 . d r o p d o w n ; 
                                 }   e l s e   { 
                                         i f   ( m e t h o d s M a p [ m e t h o d ] )   m e t h o d   =   m e t h o d s M a p [ m e t h o d ] ; 
 
                                         v a l u e   =   s e l e c t 2 [ m e t h o d ] . a p p l y ( s e l e c t 2 ,   a r g s . s l i c e ( 1 ) ) ; 
                                 } 
                                 i f   ( i n d e x O f ( a r g s [ 0 ] ,   v a l u e M e t h o d s )   > =   0 
                                         | |   ( i n d e x O f ( a r g s [ 0 ] ,   p r o p e r t y M e t h o d s )   > =   0   & &   a r g s . l e n g t h   = =   1 ) )   { 
                                         r e t u r n   f a l s e ;   / /   a b o r t   t h e   i t e r a t i o n ,   r e a d y   t o   r e t u r n   f i r s t   m a t c h e d   v a l u e 
                                 } 
                         }   e l s e   { 
                                 t h r o w   " I n v a l i d   a r g u m e n t s   t o   s e l e c t 2   p l u g i n :   "   +   a r g s ; 
                         } 
                 } ) ; 
                 r e t u r n   ( v a l u e   = = =   u n d e f i n e d )   ?   t h i s   :   v a l u e ; 
         } ; 
 
         / /   p l u g i n   d e f a u l t s ,   a c c e s s i b l e   t o   u s e r s 
         $ . f n . s e l e c t 2 . d e f a u l t s   =   { 
                 w i d t h :   " c o p y " , 
                 l o a d M o r e P a d d i n g :   0 , 
                 c l o s e O n S e l e c t :   t r u e , 
                 o p e n O n E n t e r :   t r u e , 
                 c o n t a i n e r C s s :   { } , 
                 d r o p d o w n C s s :   { } , 
                 c o n t a i n e r C s s C l a s s :   " " , 
                 d r o p d o w n C s s C l a s s :   " " , 
                 f o r m a t R e s u l t :   f u n c t i o n ( r e s u l t ,   c o n t a i n e r ,   q u e r y ,   e s c a p e M a r k u p )   { 
                         v a r   m a r k u p = [ ] ; 
                         m a r k M a t c h ( t h i s . t e x t ( r e s u l t ) ,   q u e r y . t e r m ,   m a r k u p ,   e s c a p e M a r k u p ) ; 
                         r e t u r n   m a r k u p . j o i n ( " " ) ; 
                 } , 
                 t r a n s f o r m V a l :   f u n c t i o n ( v a l )   { 
                         r e t u r n   $ . t r i m ( v a l ) ; 
                 } , 
                 f o r m a t S e l e c t i o n :   f u n c t i o n   ( d a t a ,   c o n t a i n e r ,   e s c a p e M a r k u p )   { 
                         r e t u r n   d a t a   ?   e s c a p e M a r k u p ( t h i s . t e x t ( d a t a ) )   :   u n d e f i n e d ; 
                 } , 
                 s o r t R e s u l t s :   f u n c t i o n   ( r e s u l t s ,   c o n t a i n e r ,   q u e r y )   { 
                         r e t u r n   r e s u l t s ; 
                 } , 
                 f o r m a t R e s u l t C s s C l a s s :   f u n c t i o n ( d a t a )   { r e t u r n   d a t a . c s s ; } , 
                 f o r m a t S e l e c t i o n C s s C l a s s :   f u n c t i o n ( d a t a ,   c o n t a i n e r )   { r e t u r n   u n d e f i n e d ; } , 
                 m i n i m u m R e s u l t s F o r S e a r c h :   0 , 
                 m i n i m u m I n p u t L e n g t h :   0 , 
                 m a x i m u m I n p u t L e n g t h :   n u l l , 
                 m a x i m u m S e l e c t i o n S i z e :   0 , 
                 i d :   f u n c t i o n   ( e )   {   r e t u r n   e   = =   u n d e f i n e d   ?   n u l l   :   e . i d ;   } , 
                 t e x t :   f u n c t i o n   ( e )   { 
                     i f   ( e   & &   t h i s . d a t a   & &   t h i s . d a t a . t e x t )   { 
                         i f   ( $ . i s F u n c t i o n ( t h i s . d a t a . t e x t ) )   { 
                             r e t u r n   t h i s . d a t a . t e x t ( e ) ; 
                         }   e l s e   { 
                             r e t u r n   e [ t h i s . d a t a . t e x t ] ; 
                         } 
                     }   e l s e   { 
                         r e t u r n   e . t e x t ; 
                     } 
                 } , 
                 m a t c h e r :   f u n c t i o n ( t e r m ,   t e x t )   { 
                         r e t u r n   s t r i p D i a c r i t i c s ( ' ' + t e x t ) . t o U p p e r C a s e ( ) . i n d e x O f ( s t r i p D i a c r i t i c s ( ' ' + t e r m ) . t o U p p e r C a s e ( ) )   > =   0 ; 
                 } , 
                 s e p a r a t o r :   " , " , 
                 t o k e n S e p a r a t o r s :   [ ] , 
                 t o k e n i z e r :   d e f a u l t T o k e n i z e r , 
                 e s c a p e M a r k u p :   d e f a u l t E s c a p e M a r k u p , 
                 b l u r O n C h a n g e :   f a l s e , 
                 s e l e c t O n B l u r :   f a l s e , 
                 a d a p t C o n t a i n e r C s s C l a s s :   f u n c t i o n ( c )   {   r e t u r n   c ;   } , 
                 a d a p t D r o p d o w n C s s C l a s s :   f u n c t i o n ( c )   {   r e t u r n   n u l l ;   } , 
                 n e x t S e a r c h T e r m :   f u n c t i o n ( s e l e c t e d O b j e c t ,   c u r r e n t S e a r c h T e r m )   {   r e t u r n   u n d e f i n e d ;   } , 
                 s e a r c h I n p u t P l a c e h o l d e r :   ' ' , 
                 c r e a t e S e a r c h C h o i c e P o s i t i o n :   ' t o p ' , 
                 s h o u l d F o c u s I n p u t :   f u n c t i o n   ( i n s t a n c e )   { 
                         / /   A t t e m p t   t o   d e t e c t   t o u c h   d e v i c e s 
                         v a r   s u p p o r t s T o u c h E v e n t s   =   ( ( ' o n t o u c h s t a r t '   i n   w i n d o w )   | | 
                                                                               ( n a v i g a t o r . m s M a x T o u c h P o i n t s   >   0 ) ) ; 
 
                         / /   O n l y   d e v i c e s   w h i c h   s u p p o r t   t o u c h   e v e n t s   s h o u l d   b e   s p e c i a l   c a s e d 
                         i f   ( ! s u p p o r t s T o u c h E v e n t s )   { 
                                 r e t u r n   t r u e ; 
                         } 
 
                         / /   N e v e r   f o c u s   t h e   i n p u t   i f   s e a r c h   i s   d i s a b l e d 
                         i f   ( i n s t a n c e . o p t s . m i n i m u m R e s u l t s F o r S e a r c h   <   0 )   { 
                                 r e t u r n   f a l s e ; 
                         } 
 
                         r e t u r n   t r u e ; 
                 } 
         } ; 
 
         $ . f n . s e l e c t 2 . l o c a l e s   =   [ ] ; 
 
         $ . f n . s e l e c t 2 . l o c a l e s [ ' e n ' ]   =   { 
                   f o r m a t M a t c h e s :   f u n c t i o n   ( m a t c h e s )   {   i f   ( m a t c h e s   = = =   1 )   {   r e t u r n   " O n e   r e s u l t   i s   a v a i l a b l e ,   p r e s s   e n t e r   t o   s e l e c t   i t . " ;   }   r e t u r n   m a t c h e s   +   "   r e s u l t s   a r e   a v a i l a b l e ,   u s e   u p   a n d   d o w n   a r r o w   k e y s   t o   n a v i g a t e . " ;   } , 
                   f o r m a t N o M a t c h e s :   f u n c t i o n   ( )   {   r e t u r n   " N o   m a t c h e s   f o u n d " ;   } , 
                   f o r m a t A j a x E r r o r :   f u n c t i o n   ( j q X H R ,   t e x t S t a t u s ,   e r r o r T h r o w n )   {   r e t u r n   " L o a d i n g   f a i l e d " ;   } , 
                   f o r m a t I n p u t T o o S h o r t :   f u n c t i o n   ( i n p u t ,   m i n )   {   v a r   n   =   m i n   -   i n p u t . l e n g t h ;   r e t u r n   " P l e a s e   e n t e r   "   +   n   +   "   o r   m o r e   c h a r a c t e r "   +   ( n   = =   1   ?   " "   :   " s " ) ;   } , 
                   f o r m a t I n p u t T o o L o n g :   f u n c t i o n   ( i n p u t ,   m a x )   {   v a r   n   =   i n p u t . l e n g t h   -   m a x ;   r e t u r n   " P l e a s e   d e l e t e   "   +   n   +   "   c h a r a c t e r "   +   ( n   = =   1   ?   " "   :   " s " ) ;   } , 
                   f o r m a t S e l e c t i o n T o o B i g :   f u n c t i o n   ( l i m i t )   {   r e t u r n   " Y o u   c a n   o n l y   s e l e c t   "   +   l i m i t   +   "   i t e m "   +   ( l i m i t   = =   1   ?   " "   :   " s " ) ;   } , 
                   f o r m a t L o a d M o r e :   f u n c t i o n   ( p a g e N u m b e r )   {   r e t u r n   " L o a d i n g   m o r e   r e s u l t s & " ;   } , 
                   f o r m a t S e a r c h i n g :   f u n c t i o n   ( )   {   r e t u r n   " S e a r c h i n g & " ;   } 
         } ; 
 
         $ . e x t e n d ( $ . f n . s e l e c t 2 . d e f a u l t s ,   $ . f n . s e l e c t 2 . l o c a l e s [ ' e n ' ] ) ; 
 
         $ . f n . s e l e c t 2 . a j a x D e f a u l t s   =   { 
                 t r a n s p o r t :   $ . a j a x , 
                 p a r a m s :   { 
                         t y p e :   " G E T " , 
                         c a c h e :   f a l s e , 
                         d a t a T y p e :   " j s o n " 
                 } 
         } ; 
 
         / /   e x p o r t s 
         w i n d o w . S e l e c t 2   =   { 
                 q u e r y :   { 
                         a j a x :   a j a x , 
                         l o c a l :   l o c a l , 
                         t a g s :   t a g s 
                 } ,   u t i l :   { 
                         d e b o u n c e :   d e b o u n c e , 
                         m a r k M a t c h :   m a r k M a t c h , 
                         e s c a p e M a r k u p :   d e f a u l t E s c a p e M a r k u p , 
                         s t r i p D i a c r i t i c s :   s t r i p D i a c r i t i c s 
                 } ,   " c l a s s " :   { 
                         " a b s t r a c t " :   A b s t r a c t S e l e c t 2 , 
                         " s i n g l e " :   S i n g l e S e l e c t 2 , 
                         " m u l t i " :   M u l t i S e l e c t 2 
                 } 
         } ; 
 
 } ( j Q u e r y ) ) ; 
   ;       http://localhost:8080/static/appbuilder/select2/select2.js     4D     4D                            Q        Q') )     jQuery!!            +H!!       C  H                                            5    5                    G   5    5   =   /         
   5    [       ]    Q'    fn   each2   undefined   extend!!      $       +H!!           each2B   !    !        
       5!!       !!   each2!!    ;5 !!       C  )     L                          /      @ K  )D B  )D )                 G     
  Q      Q      Q      Q      Q       Q      Q      Q      Q	      Q
      Q      Q      Q    #  Q      Q      Q    	  Q      Q   W  Q      Q      Q      Q      Q      Q    "  Q   W  Q      Q   W   Q    5      I   [   >]   >]      Q[    	]   ]   ]    ]   %]   &]	   ']
   (]   ]   ]   ]   !]   "]   $]   #]   ]   .]      ]      ]      ]      Q=      QY    =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]    =   ]!   =   ]"   =   ]#   =   ]$   =   ]%   =   ]&   =   ]'   =   ](   =   ])   =   ]*   =   ]+   =   ],   =   ]-   =   ].   =   ]/   =   ]0   =   ]1   =   ]2   =   ]3   =   ]4   =   ]5   =   ]6   =   ]7   =   ]8   =   ]9   =   ]:   =;   ]<   ==   ]>   ==   ]?   ==   ]@   =A   ]B   =C   ]D   =E   ]F   =E   ]G   =H   ]I   =J   ]K   =J   ]L   =J   ]M   =J   ]N   =J   ]O   =J   ]P   =J   ]Q   =J   ]R   =S   ]T   =S   ]U   =S   ]V   =S   ]W   =S   ]X   =S   ]Y   =S   ]Z   =S   ][   =S   ]\   =S   ]]   =S   ]^   =_   ]`   =_   ]a   =_   ]b   =_   ]c   =_   ]d   =_   ]e   =_   ]f   =_   ]g   =_   ]h   =_   ]i   =_   ]j   =_   ]k   =_   ]l   =m   ]n   =m   ]o   =p   ]q   =p   ]r   =s   ]t   =s   ]u   =s   ]v   =s   ]w   =s   ]x   =s   ]y   =s   ]z   =s   ]{   =s   ]|   =s   ]}   =s   ]~   =s   ]   =s   ]   =s   ]   =s   ]   =s   ]   =s   ]   =s   ]   =s   ]   =s   ]   =s   ]   =s   ]   =s   ]   =s   ]   =s   ]   =s   ]   =s   ]   =s   ]   =s   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]   =   ]  =   ]  =   ]  =   ]  =   ]  =   ]  =   ]  =   ]  =	  ]
  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]   =  ]!  =  ]"  =  ]#  =  ]$  =  ]%  =  ]&  =  ]'  =  ](  =  ])  =  ]*  =  ]+  =  ],  =  ]-  =  ].  =  ]/  =  ]0  =  ]1  =  ]2  =  ]3  =  ]4  =  ]5  =  ]6  =  ]7  =8  ]9  =:  ];  =<  ]=  =>  ]?  =>  ]@  =>  ]A  =>  ]B  =>  ]C  =>  ]D  =>  ]E  =>  ]F  =>  ]G  =H  ]I  =H  ]J  =H  ]K  =H  ]L  =H  ]M  =N  ]O  =N  ]P  =N  ]Q  =N  ]R  =N  ]S  =N  ]T  =N  ]U  =N  ]V  =N  ]W  =N  ]X  =N  ]Y  =N  ]Z  =N  ][  =N  ]\  =N  ]]  =N  ]^  =_  ]`  =_  ]a  =_  ]b  =_  ]c  =_  ]d  =_  ]e  =_  ]f  =_  ]g  =_  ]h  =_  ]i  =_  ]j  =_  ]k  =_  ]l  =_  ]m  =_  ]n  =_  ]o  =p  ]q  =p  ]r  =p  ]s  =p  ]t  =p  ]u  =p  ]v  =p  ]w  =p  ]x  =p  ]y  =p  ]z  =p  ]{  =p  ]|  =p  ]}  =p  ]~  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]   =  ]  =  ]  =  ]  =  ]  =  ]  =	  ]
  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]   =!  ]"  =!  ]#  =!  ]$  =!  ]%  =!  ]&  =!  ]'  =!  ](  =!  ])  =!  ]*  =!  ]+  =!  ],  =!  ]-  =!  ].  =/  ]0  =/  ]1  =2  ]3  =2  ]4  =2  ]5  =2  ]6  =2  ]7  =2  ]8  =2  ]9  =2  ]:  =2  ];  =2  ]<  =2  ]=  =2  ]>  =2  ]?  =2  ]@  =2  ]A  =2  ]B  =2  ]C  =2  ]D  =2  ]E  =2  ]F  =2  ]G  =2  ]H  =2  ]I  =2  ]J  =2  ]K  =2  ]L  =2  ]M  =2  ]N  =2  ]O  =2  ]P  =Q  ]R  =Q  ]S  =Q  ]T  =Q  ]U  =Q  ]V  =W  ]X  =W  ]Y  =W  ]Z  =W  ][  =W  ]\  =W  ]]  =W  ]^  =W  ]_  =W  ]`  =W  ]a  =W  ]b  =W  ]c  =W  ]d  =W  ]e  =f  ]g  =f  ]h  =f  ]i  =f  ]j  =f  ]k  =f  ]l  =f  ]m  =f  ]n  =f  ]o  =f  ]p  =f  ]q  =f  ]r  =f  ]s  =f  ]t  =u  ]v  =w  ]x  =w  ]y  =w  ]z  =w  ]{  =w  ]|  =w  ]}  =w  ]~  =w  ]  =w  ]  =w  ]  =w  ]  =w  ]  =w  ]  =w  ]  =w  ]  =w  ]  =w  ]  =w  ]  =w  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =   ]  =   ]  =   ]  =   ]  =   ]  =   ]  =   ]  =   ]  =   ]	  =
  ]  =
  ]  =
  ]  =
  ]  =
  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]   =!  ]"  =!  ]#  =!  ]$  =!  ]%  =!  ]&  =!  ]'  =!  ](  =!  ])  =!  ]*  =!  ]+  =!  ],  =!  ]-  =!  ].  =!  ]/  =!  ]0  =!  ]1  =!  ]2  =3  ]4  =3  ]5  =3  ]6  =3  ]7  =3  ]8  =3  ]9  =3  ]:  =3  ];  =3  ]<  =3  ]=  =3  ]>  =3  ]?  =3  ]@  =3  ]A  =3  ]B  =C  ]D  =E  ]F  =E  ]G  =E  ]H  =E  ]I  =E  ]J  =E  ]K  =E  ]L  =E  ]M  =E  ]N  =E  ]O  =E  ]P  =E  ]Q  =E  ]R  =E  ]S  =E  ]T  =E  ]U  =E  ]V  =E  ]W  =E  ]X  =E  ]Y  =E  ]Z  =E  ][  =E  ]\  =E  ]]  =E  ]^  =E  ]_  =E  ]`  =E  ]a  =E  ]b  =E  ]c  =E  ]d  =E  ]e  =E  ]f  =g  ]h  =g  ]i  =g  ]j  =g  ]k  =g  ]l  =g  ]m  =g  ]n  =o  ]p  =q  ]r  =q  ]s  =q  ]t  =q  ]u  =q  ]v  =q  ]w  =q  ]x  =q  ]y  =q  ]z  =q  ]{  =   ]|  =   ]}  =   ]~  =   ]  =   ]  =   ]  =   ]  =   ]  =   ]  =   ]  =   ]  =   ]  =   ]  =   ]  =   ]  =   ]  =   ]  =   ]  =   ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]  =  ]   !  Q     :    Q!   :   $  QV     [L   "   ]  #   ]  $   ]  %   ]  &   ]  '   ]  (   ]  )   ]  *   ]  +   ]  ,   ]  -   ]  .   ]  /   ]  0   ]  1   ]  2   ]  3   ]  4   ]  5   ]  6   ]  7   ]  8   ]  9   ]  :   ]  ;   ]  <   ]  =   ]  >   ]  ?   ]  @   ]  A   ]  B   ]  C   ]  D   ]  E   ]  F   ]  G   ]  H   ]  I   ]  J   ]  K   ]  : W  QV   V  [c   M   ]  N   ]  O   ]  P   ]  Q   ]  R   ]  S   ]  T   ]  U   ]  V   ]  W   ]  X   ]  Y   ]  Z   ]  [   ]  \   ]  ]   ]  ^   ]  _   ]  `   ]  a   ]  b   ]  : W  QV   V  [   d   ]  e   ]  f   ]  g   ]  h   ]  i   ]  j   ]  k   ]  l   ]  m   ]  n   ]  o   ]  p   ]  q   ]  r   ]  s   ]  t   ]  u   ]  v   ]  w   ]  x   ]  y   ]  z   ]   {   ]  |   ]  }   ]  ~   ]     ]     ]  : W  Q   5     0  Q   5  5  [   =  ]	  >]
  C]  C]  [   ]  [   ]  =  ]  =  ]     ]     ]     ]     ]     ]     ]  >]  >]  @]  >]     ]     ]     ]  =  ]   Z    ]!  V  ]"  V  ]#  B]$  B]%     ]&     ]'     ](  =  ])  =*  ]+     ],  0  Q   5  5  Z    0-  Q   5  5  5-  =.  [      ]/     ]0     ]1     ]2     ]3     ]4     ]5     ]6  9Q   7  
   5  5  5     5  5  5-  =.  7 Q   5  5  [      59  ]:  [   =;  ]<  B]=  =>  ]?  ]@  08  Q    [   [      ]9     ]A     ]B  ]C  [      ]D     ]E  V  ]#     ]F  ]G  [   V  ]H  V  ]I  V  ]J  ]K  0   Q- 1	4Q^cegi	   S   M          A N [ n        & D Q V b   + 0 > C U _ t       	   $  	 	 	  	D 	P 	a 	 	 	 	 	 	  
 
( 
a 
t 
 2 9 O ^ e ~         G n s        
 ' a o  								     window   Select2   x   y   TAB   ENTER   ESC   SPACE	   LEFT   UP   RIGHT	   DOWN   SHIFT	   CTRL   ALT   PAGE_UP   PAGE_DOWN	   HOME   END   BACKSPACE   DELETE   isArrow   isControl   isFunctionKey[   <div class='select2-measure-scrollbar'></div>   A    $   !                                                &                                                 :   o,   AA   2   AE             AO   4   AU   6   AV   8   :   AY   <   B    $   "            C         C    $   #         
                ;   >   D    $   $   
                              y   DZ         Dz         E    $   %                                                                 (                     F    $   &         {   G    $   '                       "            }   ~   H    $   (   $   "   &      $   (   *   &   g,   u,      I    $   )             (   *   ,   0       .            
      .   ,      J    $   *   4   H   K    $   +   0      2   6   4      i,   @   B   D      L    $   ,   ?   9   =   6   8   ;   <   :   A   =   b,   `,   H   F      LJ      Lj      M    $   -   >   @   B   n,      N    $   .      C       D   G   F   E   J   H                NJ      Nj      O    $   /                             L   ,   N   L   P   R   N   .   0       *      P                                                       J   L   OI      OO   N   OU   "   P    $   0   T   V      c,   P   R   T   Q    $   1   V   X   J   R    $   2   T   X   X         Z   \   V   ^   L   d,   Z         S    $   3      Z   d   \   `   `   f   b   h      ^   ~,         T    $   4   j   d   l      b   p   n   f         >      TZ   (   U    $   5             h   x   j   z   l                      n   p                                 r   r   v   t   D   V    $   6   |   ~      ^   E   VY   `   W    $   7         t            r,   X    $   8         Y    $   9          v      2      x            N      Z    $   :   y      {   }            $   ,   k,   b   a    $   A                                                  '                                               e,   P   aa   3   ae             ao   5   au   7   av   9   ;   ay   =   b    $   B                  S   c    $   C      	             	      <   ?   !   d    $   D                           V   W   z   dz         e    $   E                                                                 )               G   [      f    $   F         |   g    $   G         !      !      #      `      y      h    $   H   %   #   '      %   )   +      '   h,   v,   e   hv      i    $   I             )   +   -       /         	         /   -   h   1   j    $   J   5      I   k    $   K   1      3   7   5      j,   A   C   E      l    $   L   @   :   >   7   9   <   =   ;      B      k   a,   I      G   lj      m    $   M   ?   A   C   q   o   n    $   N      D       E   H   G   F   K   I      r   I         nj      o    $   O                             M   -   O   M   Q   S   O   /   1       +      Q                                                 T   K   M   u   oi      ou   #   oo   O   p    $   P   U   W      }   Q   S   U   q    $   Q   K   W   Y   r    $   R   U   Y   Y         [   ]   W   _   M   }   [         s    $   S       [   e   ]   a   a   g   c   i      _   ?            t    $   T   k      e   m      c   q   o   g         f,      tz   )   u    $   U             i   y   k   {   m                      o   q                                 s   s   w   u      v    $   V   }         _      vy   a   w    $   W         u               s,   $   X         $   Y          w      3                      O      z    $   Z   z      |   ~            %   @   l,   c                                                                                                            document   Object	   bind	   init   destroy   optionToData   prepareOpts   monitorSource   triggerSelect   triggerChange%   isInterfaceEnabled   enableInterface   enable   disable   readonly   opened!   positionDropdown   shouldOpenA   clearDropdownAlignmentPreference	   open   opening   close   externalSearch   clearSearch/   getMaximumSelectionSize-   ensureHighlightVisible1   findHighlightableChoices   moveHighlight   highlight   removeHighlight   touchMoved   clearTouchMoved-   countSelectableResults'   highlightUnderEvent!   loadMoreIfNeeded   tokenize   updateResults   cancel	   blur   focusSearch#   selectHighlighted   getPlaceholder)   getPlaceholderOption%   initContainerWidth   createContainer   focus   isFocused   initContainer   clear   initSelection7   isPlaceholderOptionSelected   setPlaceholder%   postprocessResults   showSearch   onSelect   updateSelection   val	   data   selectChoice!   clearPlaceholder#   addSelectedChoice   unselect#   getMaxSearchWidth   resizeSearch   getVal   setVal%   buildChangeDetails   onSortStart   onSortEnd   fn   select2   defaults	   copy   width   loadMorePadding   closeOnSelect   openOnEnter   containerCss   dropdownCss   #   containerCssClass!   dropdownCssClass   formatResult   transformVal   formatSelection   sortResults)   formatResultCssClass/   formatSelectionCssClass/   minimumResultsForSearch%   minimumInputLength%   maximumInputLength)   maximumSelectionSize   id	   text   matcher   ,   separator   tokenSeparators   tokenizer   escapeMarkup   blurOnChange   selectOnBlur-   adaptContainerCssClass+   adaptDropdownCssClass   nextSearchTerm-   searchInputPlaceholder   top5   createSearchChoicePosition!   shouldFocusInput   locales   en   formatMatches   formatNoMatches   formatAjaxError'   formatInputTooShort%   formatInputTooLong+   formatSelectionTooBig   formatLoadMore   formatSearching   extend   ajaxDefaults	   ajax   transport   GET	   type   cache	   json   dataType   params   local	   tags   query   debounce   markMatch   stripDiacritics	   util   abstract   single   multi   class!!)      $   undefined   checkFormatter   clazz   stripDiacritics   getCursorInfo   $document   sizer   syncCssClasses   reinsertElement   focus	   ajax!   measureTextWidth   indexOf1   installFilteredMouseMove)   getSideBorderPadding   equal#   lastMousePosition   debounce)   killEventImmediately5   MEASURE_SCROLLBAR_TEMPLATE   AbstractSelect2	   tags'   scrollBarDimensions'   defaultEscapeMarkup!   defaultTokenizer   KEY   SingleSelect2+   cleanupJQueryElements!   measureScrollbar   evaluate   MultiSelect2   markMatch/   installKeyUpChangeEvent-   installDebouncedScroll   local   splitVal   DIACRITICS   countResults   killEvent   nextUid      +H!!          reinsertElement 7  W8  7  W8  l             5!!          stripDiacritics u8  Z9  ]8  Z9  t                  match 8  9  8  9  v             55!!          indexOf p9  :  `9  :  }             5 !!       !   measureScrollbar  =:  ;  #:  ;               5 !!          equal ;  >  ;  >               5!!          splitVal >  ?  >  ?               5 !!       )   getSideBorderPadding @  i@  ?  i@     !          5 !!       /   installKeyUpChangeEvent @  B  o@  B     $             element    key   B  @  oA  @  oA     '          5   B  A  yB  A  yB     %          55!!       1   installFilteredMouseMove C  D  eC  D     %             B C  D  C  D     )          55!!          debounce \F  G  KF  G        (          quietMillis    fn    ctx    timeout   B  F  G  F  G               	   args   B  CG  zG  ;G  zG     0          5 55!!       -   installDebouncedScroll G  H  G  H     #             element    notify   B H  6H  G  6H     2          5    B _H  H  VH  H     &          5 5!!          focus H  M  H  M                  $el   B  I  |M  I  |M     "           55!!          getCursorInfo M  O  M  O              5!!          killEvent O  BP  O  BP               5!!       )   killEventImmediately dP  P  GP  P  $  !          5 !!       !   measureTextWidth P  T  P  T  )            5!!          syncCssClasses !T  W  
T  W  @     0          adapter    replacements    adapted   B  &U  U  U  U  H  2          5   B  vV  kW  nV  kW  T  2          5 5!!          markMatch W  Y  W  Y  c            5 !!       '   defaultEscapeMarkup Z  [  Z  [  s                replace_map   B F[  [  =[  [  ~  ?          5 5!!       	   ajax 	a  k  `  k       :          options    timeout    handler    quietMillis    ajaxUrl 	   self   B b  k  a  k                 query    B  hb  k  _b  k    1   (          B Ch  i  :h  i    &          5    B i  4k  i  4k    #          5 555!!          local n  [w  n  [w       H       	   data    dataText    tmp 	   text    B wo  o  no  o              5    B  p  p  p  p              5    B tr  r  kr  r               5    B r  Tw  r  Tw       0          query    t    filtered    process    B s  v  s  v       8          group   B +u  cu  #u  cu    4          5 5   B v  "w  v  "w    ,          5 55!!       	   tags w  z  uw  z              	   data    isFunc    B w  z  w  z       (          query    t    filtered    B  x  y  x  y    (          555!!          checkFormatter *{  4|  {  4|  3            5 !!          evaluate }  }  }  }  B            5!!          countResults }  ~  }  ~  J               count    B 4~  ~  ,~  ~  L             5 5!!       !   defaultTokenizer   w    w  a     :       5 !!       +   cleanupJQueryElements    C  }  C    "          	   self    B   ;    ;    #          5 5!!    	      clazz  t          !                                                             W   QV   T  A,  R  0    QV   5    V   0   QV   5    T  5    0   QV         
V   5    T : 0    QV       prototype   constructor   parent   extend!!      SuperClass   methods   constructor       +H!!           constructorC                                                           #               ' !!              +H;       5;5!!       !!   x!!!!   y!!    !!          isArrowB   	    	  F             5 !!          isControlB 	  
  	  
  Q             5 !!          isFunctionKeyB   r  
  r  ^              5!!       !!   TAB!!!!   ENTER!!!!   ESC!!!!   SPACE!!!!	   LEFT!!!!   UP!!!!   RIGHT!!!!	   DOWN!!!!   SHIFT!!!!	   CTRL!!!!   ALT!!!!   PAGE_UP!!!!   PAGE_DOWN!!!!	   HOME!!!!   END!!!!   BACKSPACE!!!!   DELETE!!!!   isArrow!!!!   isControl!!!!   isFunctionKey!!    !!    	      nextUid<c                                                B7  7  :7  7  i                  G?   Q    ) !!      counter         +H!!          nextUidb  e7  }7  ]7  }7  i   8          5;5!!       	   bindB _    V                	   func 	   self    B               	       5 5!!       	   initB              B   	       results    search    B   o    o    b   
       5    B     
      9          5   B           E          5    B _  y  W  y    D          5    B E  K  <  K    ,          5    B    .    .  !  (          5    B  X    O    "  '          5    B         $  L          5   B         /  ]          5 5!!          destroyB  8    /    S     :       	   self   B  $        Y  &          55!!          optionToDataB                     5 !!          prepareOptsB 
                	    	   opts    element    idKey 	   self   B      
      |          5   B F  L  >  L    )   *          query    populate    id    liveRegion   B           %   0       55   B   	    	    #          5    B           0   :          query 	   data 	   term    process    B   T  }  T    $   0          group    B g    _       =          5 5   B @  h  8  h    +          5 5   B =  Q  5  Q               5    B &  _    _  %  ?          5    B         (  :          	   data   B    G    G  *  l             obj    B          .  9          555   B    $    $  =  :          5    B         @  :          5 5!!          monitorSourceB  w    n    M      2          el 	   self    B         P  7          5   B    C    C  V  ,          5    B    F    F  o      
       5    B         x  >          5 5!!          triggerSelectB              
       5!!          triggerChangeB $  ^    ^        
       5!!       %   isInterfaceEnabledB            $   
       5 !!          enableInterfaceB    |    |    !   
       5!!          enableB              
       5 !!          disableB               
       5!!          readonlyB =  B  5  B       
       5 !!          openedB  r    i         
       5 !!       !   positionDropdownB            "             container    dropLeft    dropWidth    offset    viewPortRight   B    	    	    ,          5    B  6    .      +          5 5!!          shouldOpenB          A     
       5 !!       A   clearDropdownAlignmentPreferenceB  T  G  L  G  N  2   
       5 !!       	   openB          [     
          B v    m    b  <          5 5!!          openingB    	 }  	 n     J          scroll    resize    orient 	   mask 	   that   B (      ?          5    B  	 	  	   ?   
          B N	 	 E	 	   B          5 55!!          closeB  	  	       "          scroll    resize    orient    B  : m 1 m   ?   
       5 5!!          externalSearchB       !   
       5 !!          clearSearchB  N ] E ]             5!!       /   getMaximumSelectionSizeB        )   
       5!!       -   ensureHighlightVisibleB  : & 1 &   )   2       5!!       1   findHighlightableChoicesB  g  _    *   
       5 !!          moveHighlightB                  5!!          highlightB O ! F ! &            5!!          removeHighlightB  E  =  D  !   
       5!!          touchMovedB      H     
       5 !!          clearTouchMovedB  # U  U L  !   
       5!!       -   countSelectableResultsB      Q  (   
       5 !!       '   highlightUnderEventB       V  &          5!!       !   loadMoreIfNeededB  ! ( ! ( b  #   B          results 	   more 	   page 	   self 	   term    context   B $ k( $ k( v  5             B  & ' & '   2          5 55!!          tokenizeB  ( ) ( )             5 !!          updateResultsB ) B ) B                 initial    search    results 	   opts 	   self    queryNumber    postRender    render      postRender  - . - .             5       render / q/ 
/ q/             5    B k8 B b8 B   1   R          def    B  = %> = %>   %   
       5    B  A A A A   .          5 55!!          cancelB  C *C B *C +     
       5 !!       	   blurB  XC E OC E 0            5!!          focusSearchB  E F E F >     
       5!!       #   selectHighlightedB CF XH :F XH C  $   "       5 !!          getPlaceholderB  H ,J H ,J U  !   
       5 !!       )   getPlaceholderOptionB  iJ ]M aJ ]M _  &   "       5!!       %   initContainerWidthB  N BW N BW t  %            +   resolveContainerWidth  N V N V u  *   J       55!!    *   !!	   bind!!!!	   init!!!!   destroy!!!!   optionToData!!!!   prepareOpts!!!!   monitorSource!!!!   triggerSelect!!!!   triggerChange!!!!%   isInterfaceEnabled!!!!   enableInterface!!!!   enable!!!!   disable!!!!   readonly!!!!   opened!!!!!   positionDropdown!!!!   shouldOpen!!!!A   clearDropdownAlignmentPreference!!!!	   open!!!!   opening!!!!   close!!!!   externalSearch!!!!   clearSearch!!!!/   getMaximumSelectionSize!!!!-   ensureHighlightVisible!!!!1   findHighlightableChoices!!!!   moveHighlight!!!!   highlight!!!!   removeHighlight!!!!   touchMoved!!!!   clearTouchMoved!!!!-   countSelectableResults!!!!'   highlightUnderEvent!!!!!   loadMoreIfNeeded!!!!   tokenize!!!!   updateResults!!!!   cancel!!!!	   blur!!!!   focusSearch!!!!#   selectHighlighted!!!!   getPlaceholder!!!!)   getPlaceholderOption!!!!%   initContainerWidth!!    !!           createContainerB  W \ W \   "          5!!          enableInterfaceB  \ ] \ ]   !         5 !!          openingB  ] d ] d      C      5 !!          closeB  d e d e             5 !!          focusB  e g e g      "       5 !!          isFocusedB  Eg g <g g 	     
       5!!          cancelB  g h g h            5!!          destroyB  h j h j            5!!          initContainerB  Dj  ;j  $      "          selection   B  n n n n @  7   
       5    B q 6v q 6v S  9          5    B pv yx hv yx s  5            B  w Sx w Sx w  8          55   B x | x |   ;   2       5   B } } } }   E          5   B A~  8~    L          5    B       D   "       5   B        B          5   B       4          5    B  < 9 4 9   8          5   B  Y 7 Q 7   -          5   B  q n i n   6          55!!          clearB          "       5 !!          initSelectionB  8  /  	      "       	   self    B   z  	  N          55!!       7   isPlaceholderOptionSelectedB  8  0  	  -   
       5!!          prepareOptsB  > d 5 d  	     +       	   opts 	   self   B S  J  &	  .             B      '	  I   
       5 5   B ] 1 T 1 -	  D              callback    id    match    B \ m T m 2	  )          5   B      9	  M          5 55!!          getPlaceholderB      D	             5 !!          setPlaceholderB  7 ` . ` P	  !          5!!       %   postprocessResultsB     a	  %   B          selected 	   self   B { B r B f	  ;          55!!          showSearchB     	     
       5 !!          onSelectB A . 8 . 	     "       5!!          updateSelectionB e  \  	  "   *       5!!          valB      	     c          triggerChange 	   data 	   self    oldData    B      	  3   
       5    B     	  _          5    B s  k  	  C          55!!          clearSearchB   X  X 	     
       5!!       	   dataB   {  	     ;       5 !!       !!   createContainer!!!!   enableInterface!!!!   opening!!!!   close!!!!   focus!!!!   isFocused!!!!   cancel!!!!   destroy!!!!   initContainer!!!!   clear!!!!   initSelection!!!!7   isPlaceholderOptionSelected!!!!   prepareOpts!!!!   getPlaceholder!!!!   setPlaceholder!!!!%   postprocessResults!!!!   showSearch!!!!   onSelect!!!!   updateSelection!!!!   val!!!!   clearSearch!!!!	   data!!    !!           createContainerB  + 1 " 1 
  "          5!!          prepareOptsB  c  Z  (
     +       	   opts 	   self   B       /
  .          	   data   B  / \ ' \ 3
  :   
       5    B m  d  3
  x          5 5   B     :
  D              callback    ids    matches   B     ?
  )             el    B W  O  @
  ?          5 5   B   i  i H
  M           555!!          selectChoiceB     a
     *       5 !!          destroyB      t
           5!!          initContainerB  $ Z  Z 
                selection    _this   B     
     
       5    B  }  t  
  7   
       5    B      
  <          5   B q  h  
  9          5   B   [  [   7   
       5    B       5   
       5    B U  L    D          5    B         D          55!!          enableInterfaceB   ;  ; 2  !         5 !!          initSelectionB  o  f  9      "       	   self    B = m 5 m C  N          55!!          clearSearchB      O            5!!       !   clearPlaceholderB      ^  #          5!!          openingB   ,  , e     #      5 !!          closeB  X  O  ~            5!!          focusB   9  9      
       5!!          isFocusedB  i  `       
       5!!          updateSelectionB       "   "          ids    filtered 	   self   B  p ! g !   "          5   B        "   
       5 5!!          tokenizeB  I  A              5 !!          onSelectB  J  J      J       5 !!          cancelB  w  n       
       5 !!       #   addSelectedChoiceB       $   "          B   G   G   ;   
       5    B  i ? ` ?   1   
       5 5!!          unselectB ) /	   /	      *       5 !!       %   postprocessResultsB h	 ~ _	 ~ G  %   :          val 	   self   B 
  y
  M  #          5   B # }  } V  #          55!!       #   getMaxSearchWidthB      n  #   
       5!!          resizeSearchB  E  <  s     "       5!!          getValB                  5 !!          setValB '         "          unique   B   h  h   %   
       5 5!!       %   buildChangeDetailsB       %   *       5 !!          valB  V!  V!      [          triggerChange    oldData 	   self   B  !  !   C          55!!          onSortStartB  ! # ! #             5 !!          onSortEndB  H# % @# %                val 	   self    B  E% % =% % 
  G   
       5 5!!       	   dataB & ) & )      3       	   self   B  & )' & )'   "   
       5    B ' ' ' '   ,          5 5!!       !!   createContainer!!!!   prepareOpts!!!!   selectChoice!!!!   destroy!!!!   initContainer!!!!   enableInterface!!!!   initSelection!!!!   clearSearch!!!!!   clearPlaceholder!!!!   opening!!!!   close!!!!   focus!!!!   isFocused!!!!   updateSelection!!!!   tokenize!!!!   onSelect!!!!   cancel!!!!#   addSelectedChoice!!!!   unselect!!!!%   postprocessResults!!!!#   getMaxSearchWidth!!!!   resizeSearch!!!!   getVal!!!!   setVal!!!!%   buildChangeDetails!!!!   val!!!!   onSortStart!!!!   onSortEnd!!!!	   data!!    !!     	      $.fn.select2c            K                         
       " 7) 2 .) 2 '                	W   QW  Q    5   5      
V   >l    Qf       QZ   =   `    =   `   =   `   =   `    	  QZ   =   `    =	   `    
  Q[   =
   ]      QV     
    Q     H   V        
 ]    Array   prototype   slice	   call   opened   isFocused   container   dropdown   val	   data   externalSearch   search	   each!!   	   args	   opts   select2   method   value   multiple   allowedMethods   valueMethods   propertyMethods   methodsMap   arguments   .this        +H!!      !!   val!!   destroy!!   opened!!	   open!!   close!!   focus!!   isFocused!!   container!!   dropdown!!   onSortStart!!   onSortEnd!!   enable!!   disable!!   readonly!!!   positionDropdown!!	   data!!   search   !!       !!   search!!    !!          $.fn.select2/<b  s+ V2 j+ V2 2     b       5;5!!            !!            !!          formatResultB 3 4 3 4 j     
       5 !!          transformValB 4 4 4 4 o            5 !!          formatSelectionB 5 }5 5 }5 r  "   
       5!!          sortResultsB 5 5 5 5 u            5!!       )   formatResultCssClassB 6 !6  6 !6 x  &          5 !!       /   formatSelectionCssClassB L6 q6 D6 q6 y  )          5!!          idB 7 :7 7 :7 ~            5 !!       	   textB S7 q8 J7 q8      *       5 !!          matcherB 8 9 8 9             5!!       -   adaptContainerCssClassB 9 : 9 :   (          5 !!       +   adaptDropdownCssClassB 7: K: /: K:   '          5!!          nextSearchTermB m: : e: :              5 !!       !   shouldFocusInputB ; P= ; P=   #          5 !!    !   !!   width!!!!   loadMorePadding!!!!   closeOnSelect!!!!   openOnEnter!!!!   containerCss!!!!   dropdownCss!!!!#   containerCssClass!!!!!   dropdownCssClass!!!!   formatResult!!!!   transformVal!!!!   formatSelection!!!!   sortResults!!!!)   formatResultCssClass!!!!/   formatSelectionCssClass!!!!/   minimumResultsForSearch!!!!%   minimumInputLength!!!!%   maximumInputLength!!!!)   maximumSelectionSize!!!!   id!!!!	   text!!!!   matcher!!!!   separator!!!!   tokenSeparators!!!!   tokenizer!!!!   escapeMarkup!!!!   blurOnChange!!!!   selectOnBlur!!!!-   adaptContainerCssClass!!!!+   adaptDropdownCssClass!!!!   nextSearchTerm!!!!-   searchInputPlaceholder!!!!5   createSearchChoicePosition!!!!!   shouldFocusInput!!    !!           formatMatchesB = r> = r>   !          5 !!          formatNoMatchesB  > > > >   #          5!!          formatAjaxErrorB > ? > ?   #          5!!       '   formatInputTooShortB C? ? :? ?   '          5!!       %   formatInputTooLongB ? N@ ? N@   &          5 !!       +   formatSelectionTooBigB y@ @ p@ @   )          5!!          formatLoadMoreB @ #A @ #A   "          5 !!          formatSearchingB  HA cA ?A cA   #          5!!       !!   formatMatches!!!!   formatNoMatches!!!!   formatAjaxError!!!!'   formatInputTooShort!!!!%   formatInputTooLong!!!!+   formatSelectionTooBig!!!!   formatLoadMore!!!!   formatSearching!!    !!       !!	   type!!!!   cache!!!!   dataType!!    !!       !!   transport!!!!   params!!    !!       !!	   ajax!!!!   local!!!!	   tags!!    !!       !!   debounce!!!!   markMatch!!!!   escapeMarkup!!!!   stripDiacritics!!    !!       !!   abstract!!!!   single!!!!   multi!!    !!       !!   query!!!!	   util!!!!   class!!    ;5;+eX      [>[>?t[   ;    :http://localhost:8080/static/appbuilder/select2/select2.js necko:classified 1 strongly-framed 1 request-method GET response-head HTTP/1.0 200 OK
Content-Length: 148536
Content-Type: application/javascript
Last-Modified: Sat, 09 Dec 2017 10:57:03 GMT
Cache-Control: public, max-age=43200
Expires: Fri, 23 Nov 2018 23:15:07 GMT
ETag: "1512817023.0-148536-2450076460"
Date: Fri, 23 Nov 2018 11:15:07 GMT
Accept-Ranges: bytes
Server: Werkzeug/0.14.1 Python/3.6.7
 original-response-headers Content-Length: 148536
Content-Type: application/javascript
Last-Modified: Sat, 09 Dec 2017 10:57:03 GMT
Cache-Control: public, max-age=43200
Expires: Fri, 23 Nov 2018 23:15:07 GMT
ETag: "1512817023.0-148536-2450076460"
Date: Fri, 23 Nov 2018 11:15:07 GMT
Accept-Ranges: bytes
Server: Werkzeug/0.14.1 Python/3.6.7
 uncompressed-len 0 net-response-time-onstart 63 net-response-time-onstop 64 alt-data 1;148536,javascript/moz-bytecode-20181116154524 alt-data-from-child 1  